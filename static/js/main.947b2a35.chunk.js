(this["webpackJsonpbubble-set-demo"]=this["webpackJsonpbubble-set-demo"]||[]).push([[0],{280:function(t,e,i){},288:function(t,e){function i(t){this._d=t,this._elements=[]}t.exports=i,i.prototype.checkEdgeCrossing=function(t,e,i,a){return Math.min(t.x,e.x)<=Math.max(i.x,a.x)&&Math.min(i.x,a.x)<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=Math.max(i.y,a.y)&&Math.min(i.y,a.y)<=Math.max(t.y,e.y)&&(((i.x-t.x)*(i.y-a.y)-(i.y-t.y)*(i.x-a.x))*((i.x-e.x)*(i.y-a.y)-(i.y-e.y)*(i.x-a.x))<0&&((t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x))*((t.x-a.x)*(t.y-e.y)-(t.y-a.y)*(t.x-e.x))<0)},i.prototype.isEmpty=function(){return 0===this.size()},i.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]},i.prototype.modify_Prim=function(t,e,i,a){for(var r=this._elements.length,n=this._elements.length-1;n>=0;n--){var s=this._d[this._elements[n]].start,h=this._d[this._elements[n]].end,o=this._d[this._elements[n]].clusterid2;this._d.hasOwnProperty(this._elements[n])&&o!=i?this.checkEdgeCrossing(s,h,t,e)&&s.cat!=t.cat&&h.cat!=e.cat&&(this._d[this._elements[n]].score+=a):this._elements.splice(n,1)}var l=this._elements;this._elements=[];for(var d=0;d<l.length;d++)this.enq(l[d]);var c=this._elements.length;if(!(c<=1||c==r))for(var g=parseInt((c-2)/2);g>=0;g--)this.adjust(g,c-1)},i.prototype.searchFather=function(t,e){for(;e!=t[e];)t[e]=t[t[e]],e=t[e];return e},i.prototype.adjust=function(t,e){for(var i=t,a=2*i+1,r=this._elements[i];a<=e&&(a<e&&this._compare(a,a+1)&&a++,!(this._d[r].score<=this._d[this._elements[a]].score));)this._elements[i]=this._elements[a],i=a,a=2*a+1;this._elements[i]=r},i.prototype.modify_Kruskal_V2=function(t,e,i,a){for(var r=[],n=this._elements.length-1;n>=0;n--){var s=this._d[this._elements[n]].start,h=this._d[this._elements[n]].end,o=this.searchFather(i,this._d[this._elements[n]].clusterid1),l=this.searchFather(i,this._d[this._elements[n]].clusterid2);this._d.hasOwnProperty(this._elements[n])?o!=l?(this.checkEdgeCrossing(s,h,t,e)&&s.cat!=t.cat&&h.cat!=e.cat&&(this._d[this._elements[n]].score+=a),r.push(this._elements[n])):(delete this._d[this._elements[n]],this._elements.splice(n,1)):this._elements.splice(n,1)}var d=r.length;if(!(d<=1)){this._elements=[];for(var c=0;c<d;c++)this.enq(r[c])}},i.prototype.modify_Kruskal=function(t,e,i,a,r){for(var n=this._elements.length,s=parseInt((n-2)/2);s>=0;s--)this.adjust(s,n-1)},i.prototype.deq=function(){var t=this.peek(),e=this._elements.pop(),i=this.size();if(0===i)return t;this._elements[0]=e;for(var a=0;a<i;){var r=a,n=2*a+1,s=2*a+2;if(n<i&&this._compare(n,r)>=0&&(r=n),s<i&&this._compare(s,r)>=0&&(r=s),r===a)break;this._swap(r,a),a=r}return t},i.prototype.enq=function(t){for(var e=this._elements.push(t),i=e-1;i>0;){var a=Math.floor((i-1)/2);if(this._compare(i,a)<=0)break;this._swap(a,i),i=a}return e},i.prototype.size=function(){return this._elements.length},i.prototype.forEach=function(t){return this._elements.forEach(t)},i.prototype._compare=function(t,e){return this._d[this._elements[e]].score-this._d[this._elements[t]].score},i.prototype._swap=function(t,e){var i=this._elements[t];this._d[this._elements[t]].pid=e,this._d[this._elements[e]].pid=t,this._elements[t]=this._elements[e],this._elements[e]=i}},378:function(t,e,i){"use strict";i.r(e);var a=i(6),r=i(0),n=i.n(r),s=i(26),h=i.n(s);i(89),i.p,i(280);var o=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,389)).then((function(e){var i=e.getCLS,a=e.getFID,r=e.getFCP,n=e.getLCP,s=e.getTTFB;i(t),a(t),r(t),n(t),s(t)}))},l=i(10),d=i(11),c=i(21),g=i(20),u=i(1),p=["#fbb132","#434343","#8701ec","#f700ff","#0885c2","#1c8b3c","#ed334e"],y=i(63),f=20,x=(r.Component,["#f700ff","#fbb132","#0885c2","#001aff","#7b28b7","#1c8b3c","#ed334e"]),v=(r.Component,["#f700ff","#fbb132","#0885c2","#001aff","#7b28b7","#1c8b3c","#ed334e"]),m=(r.Component,["#f700ff","#fbb132","#0885c2","#001aff","#7b28b7","#1c8b3c","#ed334e"]),E=(r.Component,["#fbb132","#8701ec","#434343","#f700ff","#0885c2","#1c8b3c","#ed334e"]),D=i(63),b=20,F=(r.Component,["#ffcc99","#001aff","#c0c0c0","#7b28b7","#1c8b3c","#ed334e"]),M=(r.Component,["#fbb132","#8701ec","#434343","#f700ff","#0885c2","#1c8b3c","#ed334e"]),k=i(63),w=20,I=i(140),P=(r.Component,i(22)),A=i(385),C=i(386),N=i(383),S=i(384),B=(i(285),i(59));function _(t,e,i,a){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-a,2))}function O(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function j(t){var e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/e,t[1]/e]}function V(t,e,i,a,r){u.l("#mainsvg").append("circle").attr("class","elespace").attr("cx",t).attr("cy",e).attr("r",i).attr("fill",a).attr("stroke",r).attr("stroke-width",1)}function L(t,e,i,a,r){u.l("svg").append("rect").attr("x",t-i/2).attr("y",e-a/2).attr("width",i).attr("height",a).attr("fill","none").attr("stroke",r).attr("stroke-width",2)}function X(t,e,i,a){u.l("svg").append("line").attr("x1",t[0]).attr("y1",t[1]).attr("x2",e[0]).attr("y2",e[1]).attr("stroke-width",a).attr("stroke",i).on("mouseover",(function(){u.l(this).attr("stroke","red")})).on("mouseout",(function(){u.l(this).attr("stroke",i)}))}function G(t,e,i,a,r,n){var s=(r-i)*(t-i)+(n-a)*(e-a);if(s<=0)return-1;var h=(r-i)*(r-i)+(n-a)*(n-a);if(s>=h)return-1;var o=s/h,l=i+(r-i)*o,d=a+(n-a)*o;return Math.sqrt((t-l)*(t-l)+(d-e)*(d-e))}function Y(t,e,i,a){var r=Math.sqrt(Math.pow(t-a.x,2)+Math.pow(e-a.y,2)),n={x:a.x-t,y:-a.y+e},s=Math.acos(n.x/Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))),h=Math.acos(i/r);return a.y<e?{p1:{x:t+Math.cos(h+s)*i,y:e-Math.sin(h+s)*i},p2:{x:t+Math.cos(h-s)*i,y:e+Math.sin(h-s)*i}}:(s=Math.PI-s,{p1:{x:t+Math.cos(Math.PI-h-s)*i,y:e+Math.sin(Math.PI-h-s)*i},p2:{x:t+Math.cos(Math.PI-(h-s))*i,y:e-Math.sin(Math.PI-(h-s))*i}})}function U(t,e,i,a,r,n){var s=[],h=Math.pow(t-a,2)+Math.pow(e-r,2)-Math.pow(i+n,2),o=Math.pow(t-a,2)+Math.pow(e-r,2)-Math.pow(i-n,2),l=[a-t,r-e],d=j([-l[1],l[0]]),c=[t+i*d[0],e+i*d[1]],g=[a+n*d[0],r+n*d[1]];s.push([c,g]);var u=[-1*d[0],-1*d[1]],p=[t+i*u[0],e+i*u[1]],y=[a+n*u[0],r+n*u[1]];if(s.push([p,y]),h<0&&o<0)return[];if(h<0&&o>0)return s;if(0==h&&o>0)return s;if(h>0&&o>0){var f=(i*a+n*t)/(i+n),x=(i*r+n*e)/(i+n),v=Y(t,e,i,{x:f,y:x}),m=Y(a,r,n,{x:f,y:x}),E=v.p1,D={x:f,y:x},b=m.p1,F=(b.y-E.y)*(D.x-E.x)-(D.y-E.y)*(b.x-E.x);return Math.abs(F)<=1e-6?(s.push([[v.p1.x,v.p1.y],[m.p1.x,m.p1.y]]),s.push([[v.p2.x,v.p2.y],[m.p2.x,m.p2.y]])):(s.push([[v.p1.x,v.p1.y],[m.p2.x,m.p2.y]]),s.push([[v.p2.x,v.p2.y],[m.p1.x,m.p1.y]])),s}return[]}function T(t,e,i,a){var r="";r+="M "+t[0]+","+t[1];var n=0,s=[t[0]-i[0],t[1]-i[1]],h=[e[0]-i[0],e[1]-i[1]],o=s[0]*h[1]-h[0]*s[1];o>0?n=1:o<=0&&(n=0),r+=" A "+a+","+a+" 0 "+n+" ,0 "+e[0]+","+e[1],u.l("svg").append("path").attr("d",r).attr("fill","none").attr("stroke","black").attr("stroke-width","1")}function R(t,e){var i=O(t),a=O(e),r=(t[0]*e[0]+t[1]*e[1])/(i*a);return Math.acos(r)}function W(t,e,i,a,r){return[(t-i)*Math.cos(r)-(e-a)*Math.sin(r)+i,(t-i)*Math.sin(r)+(e-a)*Math.cos(r)+a]}function q(t,e){return t[0]*e[1]-e[0]*t[1]}i(379),i(117);var z=function(t,e,i){if(i){this.points=[];for(var a=0;a<t.length;a++)this.points.push(t[a])}else this.points=t;this.degree=e,this.dimension=t[0].length,2==e?(this.baseFunc=this.basisDeg2,this.baseFuncRangeInt=2):3==e?(this.baseFunc=this.basisDeg3,this.baseFuncRangeInt=2):4==e?(this.baseFunc=this.basisDeg4,this.baseFuncRangeInt=3):5==e&&(this.baseFunc=this.basisDeg5,this.baseFuncRangeInt=3)};z.prototype.seqAt=function(t){var e=this.points,i=this.degree+1;return function(a){return a<i?e[0][t]:e.length+i<=a?e[e.length-1][t]:e[a-i][t]}},z.prototype.basisDeg2=function(t){return-.5<=t&&t<.5?.75-t*t:.5<=t&&t<=1.5?1.125+(t/2-1.5)*t:-1.5<=t&&t<-.5?1.125+(1.5+t/2)*t:0},z.prototype.basisDeg3=function(t){return-1<=t&&t<0?2/3+(-1-t/2)*t*t:1<=t&&t<=2?4/3+t*((1-t/6)*t-2):-2<=t&&t<-1?4/3+t*(2+(1+t/6)*t):0<=t&&t<1?2/3+(t/2-1)*t*t:0},z.prototype.basisDeg4=function(t){return-1.5<=t&&t<-.5?55/96+t*(-5/24+t*(-5/4+(-5/6-t/6)*t)):.5<=t&&t<1.5?55/96+t*(5/24+t*(-5/4+(5/6-t/6)*t)):1.5<=t&&t<=2.5?625/384+t*(-125/48+t*(25/16+(-5/12+t/24)*t)):-2.5<=t&&t<=-1.5?625/384+t*(125/48+t*(25/16+(5/12+t/24)*t)):-1.5<=t&&t<1.5?115/192+t*t*(-5/8+t*t/4):0},z.prototype.basisDeg5=function(t){return-2<=t&&t<-1?.425+t*(-5/8+t*(-7/4+t*(-5/4+(-3/8-t/24)*t))):0<=t&&t<1?.55+t*t*((1/4-t/12)*t*t-.5):2<=t&&t<=3?2.025+t*(-27/8+t*(9/4+t*(-3/4+(1/8-t/120)*t))):-3<=t&&t<-2?2.025+t*(27/8+t*(9/4+t*(3/4+(1/8+t/120)*t))):1<=t&&t<2?.425+t*(5/8+t*(-7/4+t*(5/4+(-3/8+t/24)*t))):-1<=t&&t<0?.55+t*t*((1/4+t/12)*t*t-.5):0},z.prototype.getInterpol=function(t,e){for(var i=this.baseFunc,a=this.baseFuncRangeInt,r=Math.floor(e),n=0,s=r-a;s<=r+a;s++)n+=t(s)*i(e-s);return n},z.prototype.calcAt=function(t){if(t*=2*(this.degree+1)+this.points.length,2==this.dimension)return[this.getInterpol(this.seqAt(0),t),this.getInterpol(this.seqAt(1),t)];if(3==this.dimension)return[this.getInterpol(this.seqAt(0),t),this.getInterpol(this.seqAt(1),t),this.getInterpol(this.seqAt(2),t)];for(var e=[],i=0;i<this.dimension;i++)e.push(this.getInterpol(this.seqAt(i),t));return e};var H,K,J,Q,Z,$=z,tt=i(286),et=i(142),it=i(143),at=i(81),rt=(at.ShapeInfo,at.Intersection,at.Point2D,at.IntersectionQuery),nt=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],st=10,ht=15,ot=ht-5,lt=20,dt=lt-5,ct=5,gt="circle",ut=1,pt=1,yt=3,ft=[.001],xt=2,vt=1,mt=Math.sqrt(.25*(xt-1)*(xt-1)+.25*(xt-1)*(xt-1)),Et={},Dt={},bt={},Ft=1e-10,Mt=[],kt=!1,wt=[],It=2e3,Pt=2e3,At=10,Ct=Number.MAX_VALUE,Nt={},St=u.f().x((function(t){return t[0]})).y((function(t){return t[1]})).curve(u.b),Bt=u.f().x((function(t){return t[0]})).y((function(t){return t[1]})).curve(u.c);function _t(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array|t instanceof Object){var e=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(e[i]=_t(t[i]));return e}throw new Error("Unable to clone obj! Its type isn't supported.")}var Ot=function(t){Object(c.a)(i,t);var e=Object(g.a)(i);function i(){var t;return Object(l.a)(this,i),(t=e.call(this)).onChangeEdgeWidth=function(e){e,t.setState({edgeWidth:e}),t.changeEdgeWidth(t.selectedEdge,e)},t.onChangeNodeR0=function(e){ot=e,t.setState({nodeR0:e})},t.onChangeNodeR1=function(e){ot=(ht=e)-5,t.setState({nodeR1:e,nodeR0:ht-5})},t.onChangeEdgeR0=function(e){dt=e,t.setState({edgeR0:e})},t.onChangeEdgeR1=function(e){dt=(lt=e)-5,t.setState({edgeR1:e,edgeR0:dt})},t.onChangePixelGroup=function(e){xt=e,t.setState({pixelGroup:e})},t.onChangeGap=function(e){vt=e,t.setState({gapBetween:e})},t.state={nodeR0:10,nodeR1:20,edgeR0:15,edgeR1:20,pixelGroup:3,gapBetween:1,edgeWidth:ct,hasSelectEdge:!1},t.isfirstcreate=!0,t.pointData=[],t.canvasWidth=-1,t.canvasHeight=-1,t.maxX=-1,t.maxY=-1,t.minX=-1,t.minY=-1,t.maxDis=Number.MIN_VALUE,t.catPointDict={},t.catEdgeDict={},t.edges=[],t.maxDistance=-1,t.itemShape="",t.itemBBox=[],t.catEnergyField={},t.catNotGroup={},t.activeRegion={x:0,y:0,width:0,height:0},t.energyField={width:0,height:0,field:[]},t.editMode=!1,t.editIndex=-1,t.updatedEnergyPoints={},t.selectedEdge=-1,t.edgeControlPoints=[],t.hasMST=!1,t.updateIdx=[],t.hasBubbles=!1,t.firstFlag=!0,t}return Object(d.a)(i,[{key:"init",value:function(){this.pointData=[],this.canvasWidth=-1,this.canvasHeight=-1,this.maxX=-1,this.maxY=-1,this.minX=-1,this.minY=-1,this.maxDis=Number.MIN_VALUE,this.catPointDict={},this.catEdgeDict={},this.edges=[],this.maxDistance=-1,this.itemShape="",this.itemBBox=[],this.catEnergyField={},this.catNotGroup={},this.activeRegion={x:0,y:0,width:0,height:0},this.energyField={width:0,height:0,field:[]},this.editMode=!1,this.editIndex=-1,this.updatedEnergyPoints={},this.selectedEdge=-1,this.updateIdx=[],this.firstFlag=!0}},{key:"init_all",value:function(){nt=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],st=10,ot=(ht=15)-5,dt=(lt=20)-5,ct=5,5,gt="circle",ut=1,pt=1,-.8,0,yt=3,ft=[.001],xt=2,vt=1,mt=Math.sqrt(.25*(xt-1)*(xt-1)+.25*(xt-1)*(xt-1)),Et={},Dt={},bt={},Ft=1e-10,[],0,Mt=[],kt=!1,wt=[],It=2e3,Pt=2e3,At=10,Ct=Number.MAX_VALUE,Nt={},0,!1,{},this.setState({nodeR0:10,nodeR1:20,edgeR0:15,edgeR1:20,pixelGroup:3,gapBetween:1,edgeWidth:ct,hasSelectEdge:!1}),this.isfirstcreate=!0,this.pointData=[],this.canvasWidth=-1,this.canvasHeight=-1,this.maxX=-1,this.maxY=-1,this.minX=-1,this.minY=-1,this.maxDis=Number.MIN_VALUE,this.catPointDict={},this.catEdgeDict={},this.edges=[],this.maxDistance=-1,this.itemShape="",this.itemBBox=[],this.catEnergyField={},this.catNotGroup={},this.activeRegion={x:0,y:0,width:0,height:0},this.energyField={width:0,height:0,field:[]},this.editMode=!1,this.editIndex=-1,this.updatedEnergyPoints={},this.selectedEdge=-1,this.edgeControlPoints=[],this.hasMST=!1,this.updateIdx=[],this.hasBubbles=!1,this.firstFlag=!0,this.render(),this.componentDidMount()}},{key:"bubbleState",value:function(){return this.hasBubbles}},{key:"setViewBox",value:function(t,e,i,a){}},{key:"componentDidMount",value:function(){this.props.onRef(this),this.canvasWidth=document.getElementById("mainsvg").getBoundingClientRect().width,this.canvasHeight=document.getElementById("mainsvg").getBoundingClientRect().height,document.oncontextmenu=function(){return!1}}},{key:"preProcessPoints",value:function(t,e){for(var i=0;i<t.length;i++){var a=void 0;1==t[i].flag?(a=this.pointData[t[i].id]).flag=!0:a=t[i];for(var r=0;r<a.catArray.length;r++){var n=a.catArray[r];e.hasOwnProperty(n)||(e[n]=[]),e[n].push(a)}}}},{key:"preProcessEdges",value:function(t,e,i){for(var a=0;a<t.length;a++){var r=void 0,n=void 0;1==t[a].flag?((r=this.edges[t[a].id]).flag=!0,n=this.pointData[r.start].catArray,i.push(r)):n=(r=t[a]).startpoint.catArray;for(var s=0;s<n.length;s++){var h=n[s];e.hasOwnProperty(h)||(e[h]=[]),e[h].push(r)}}}},{key:"editReDraw",value:function(t,e,i,a){console.time("Total Time");_t(this.edges);this.pointData=i,this.edges=a,this.catPointDict={},this.catEdgeDict={},this.updateIdx=[],this.itemShape=this.pointData[0].shape;for(var r=0;r<this.pointData.length;r++){this.pointData[r].x=parseFloat(this.pointData[r].x),this.pointData[r].y=parseFloat(this.pointData[r].y),this.pointData[r].id=r,this.pointData[r].cat=this.pointData[r].cat.toString();var n=this.pointData[r].cat.split(","),s=[];if(n.length>1){this.pointData[r].multicat=!0;for(var h=0;h<n.length;h++)s.push(n[h])}else this.pointData[r].multicat=!1,s.push(this.pointData[r].cat);this.pointData[r].catArray=s}this.centralizeData(!1),this.calEdgeLength(),this.calActiveRegion(!1);var o={},l={},d=[];this.preProcessPoints(t,o),this.preProcessEdges(e,l,d),console.time("cal energy field"),this.calEnergyField_Part(o,l),console.timeEnd("cal energy field"),console.time("cal final energy field"),this.calFinalEnergeField_Part(),console.timeEnd("cal final energy field"),console.time("fill cross edge"),this.fillCrossingEdge_Part(d),console.timeEnd("fill cross edge"),u.m("path").remove(),!1,0,this.firstFlag=!0,this.findOutLine(),this.calOutLine(),this.calEdgeControlPoints(),console.timeEnd("Total Time");var c=this;u.l("svg").on("click",(function(){console.log("click svg!"),u.l("svg").selectAll("line").filter((function(){return parseInt(u.l(this).attr("index"))==c.selectedEdge})).attr("stroke","red").attr("opacity",0),c.selectedEdge=-1,c.setState({hasSelectEdge:!1,edgeWidth:ct})}))}},{key:"getData",value:function(){if(this.props.pointData&&this.props.edges){if(this.props.edges.length>0&&(this.hasMST=!0),this.init(),0==this.hasMST){var t=this.props.createMST();this.pointData=t[0],this.edges=t[1],nt=t[2],this.hasMST=!0}else this.pointData=this.props.pointData,this.edges=this.props.edges;this.itemShape=this.pointData[0].shape;for(var e=0;e<this.pointData.length;e++){this.pointData[e].x=parseFloat(this.pointData[e].x),this.pointData[e].y=parseFloat(this.pointData[e].y),this.pointData[e].id=e,this.pointData[e].cat=this.pointData[e].cat.toString(),Ct=this.pointData[e].hasOwnProperty("radius")?Math.min(Ct,this.pointData[e].radius*this.pointData[e].radius*Math.PI):Math.min(Ct,this.pointData[e].width*this.pointData[e].width);var i=this.pointData[e].cat.split(","),a=[];if(i.length>1){this.pointData[e].multicat=!0;for(var r=0;r<i.length;r++)a.push(i[r])}else this.pointData[e].multicat=!1,a.push(this.pointData[e].cat);this.pointData[e].catArray=a}this.loadEdgeData(),this.props.handleCreated&&this.props.handleCreated()}}},{key:"centralizeData",value:function(t){this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxX=Number.MIN_VALUE,this.maxY=Number.MIN_VALUE;for(var e=0;e<this.pointData.length;e++){if("circle"==gt){if("rectangle"==this.itemShape){var i=Math.sqrt(Math.pow(this.pointData[e].width,2)+Math.pow(this.pointData[e].height,2))/2;this.pointData[e].radius=i}this.pointData[e].maxX=this.pointData[e].x+this.pointData[e].radius,this.pointData[e].minX=this.pointData[e].x-this.pointData[e].radius,this.pointData[e].maxY=this.pointData[e].y+this.pointData[e].radius,this.pointData[e].minY=this.pointData[e].y-this.pointData[e].radius}else"rectangle"==gt&&("circle"==this.itemShape&&(this.pointData[e].width=2*this.pointData[e].radius,this.pointData[e].height=2*this.pointData[e].radius),this.pointData[e].maxX=this.pointData[e].x+this.pointData[e].width/2,this.pointData[e].minX=this.pointData[e].x-this.pointData[e].width/2,this.pointData[e].maxY=this.pointData[e].y+this.pointData[e].height/2,this.pointData[e].minY=this.pointData[e].y-this.pointData[e].height/2);this.maxX=Math.max(this.maxX,this.pointData[e].maxX),this.maxY=Math.max(this.maxY,this.pointData[e].maxY),this.minX=Math.min(this.minX,this.pointData[e].minX),this.minY=Math.min(this.minY,this.pointData[e].minY);for(var a=0;a<this.pointData[e].catArray.length;a++){var r=this.pointData[e].catArray[a];this.catPointDict.hasOwnProperty(r)||(this.catPointDict[r]=[],this.catPointDict[r].minX=Number.MAX_VALUE,this.catPointDict[r].maxX=Number.MIN_VALUE,this.catPointDict[r].minY=Number.MAX_VALUE,this.catPointDict[r].maxY=Number.MIN_VALUE),this.catPointDict[r].push(this.pointData[e]),this.catPointDict[r].minX=Math.min(this.catPointDict[r].minX,this.pointData[e].minX),this.catPointDict[r].maxX=Math.max(this.catPointDict[r].maxX,this.pointData[e].maxX),this.catPointDict[r].minY=Math.min(this.catPointDict[r].minY,this.pointData[e].minY),this.catPointDict[r].maxY=Math.max(this.catPointDict[r].maxY,this.pointData[e].maxY)}}for(var n=0;n<this.edges.length;n++){var s=this.edges[n].start,h=this.edges[n].end,o=this.pointData[s].catArray,l=Math.min(this.pointData[s].x,this.pointData[h].x),d=Math.min(this.pointData[s].y,this.pointData[h].y),c=Math.max(this.pointData[s].x,this.pointData[h].x),g=Math.max(this.pointData[s].y,this.pointData[h].y);if(this.edges[n].virtrual)for(var p=this.edges[n].virtrualNodes,y=0;y<p.length;y++){var f=p[y][0],x=p[y][1];l=Math.min(l,f),d=Math.min(d,x),c=Math.max(c,f),g=Math.max(g,x)}this.maxX=Math.max(this.maxX,c),this.maxY=Math.max(this.maxY,g),this.minX=Math.min(this.minX,l),this.minY=Math.min(this.minY,d),this.edges[n].x=l,this.edges[n].y=d,this.edges[n].width=c-l,this.edges[n].height=g-d;for(var v=0;v<o.length;v++){var m=o[v];this.catPointDict[m].minX=Math.min(this.catPointDict[m].minX,l),this.catPointDict[m].maxX=Math.max(this.catPointDict[m].maxX,c),this.catPointDict[m].minY=Math.min(this.catPointDict[m].minY,d),this.catPointDict[m].maxY=Math.max(this.catPointDict[m].maxY,g)}}for(var E=0;E<this.edges.length;E++){var D=this.edges[E].cat;this.catEdgeDict.hasOwnProperty(D)||(this.catEdgeDict[D]=[]),this.catEdgeDict[D].push(this.edges[E])}t&&(u.l("#mainsvg").attr("viewBox",this.minX-Math.max(ht,lt)-st-10+" "+(this.minY-Math.max(ht,lt)-st-10)+" "+(this.maxX-this.minX+2*Math.max(ht,lt)+2*st+20)+" "+(this.maxY-this.minY+2*Math.max(ht,lt)+2*st+20)),u.l("#leftsvg").attr("viewBox",this.minX-Math.max(ht,lt)-st-10+" "+(this.minY-Math.max(ht,lt)-st-10)+" "+(this.maxX-this.minX+2*Math.max(ht,lt)+2*st+20)+" "+(this.maxY-this.minY+2*Math.max(ht,lt)+2*st+20)),u.m("g").attr("transform","")),0==kt&&(K=this.minX-Math.max(ht,lt)-st-10,J=this.minY-Math.max(ht,lt)-st-10,Q=this.maxX-this.minX+2*Math.max(ht,lt)+2*st+20,Z=this.maxY-this.minY+2*Math.max(ht,lt)+2*st+20,kt=!0)}},{key:"drawPointData",value:function(){var t=this;nt=this.props.colorArray,u.l("svg").call(u.n().extent([[K,J],[Q,Z]]).scaleExtent([1,8]).on("zoom",(function(t){var e=t.transform;u.m("g").attr("transform",e)})));var e=this;u.e().on("start",(function(){})).on("drag",(function(t){u.l(this).attr("cx",t.x).attr("cy",t.y)}));var i=[];if("circle"==this.itemShape){for(var a=function(i){var a=i;H.append("circle").attr("class","dataPoint").attr("cx",t.pointData[i].x).attr("cy",t.pointData[i].y).attr("r",t.pointData[i].radius).attr("fill",(function(t,i){return nt[e.pointData[a].catArray[e.pointData[a].catArray.length-1]]})).attr("catefory",t.pointData[i].cat).attr("index",a).on("mouseover",(function(t,i){console.log(e.pointData[a])}))},r=0;r<this.pointData.length;r++)a(r);i=document.getElementsByTagName("circle");for(var n=0;n<i.length;n++)this.itemBBox.push({id:i[n].getAttribute("index"),bbox:i[n].getBBox()})}else if("rectangle"==this.itemShape){for(var s=function(i){var a=i;H.append("rect").attr("class","dataPoint").attr("x",t.pointData[i].x-t.pointData[i].width/2).attr("y",t.pointData[i].y-t.pointData[i].height/2).attr("width",t.pointData[i].width).attr("height",t.pointData[i].height).attr("fill",(function(){return nt[e.pointData[a].catArray[e.pointData[a].catArray.length-1]]})).attr("catefory",t.pointData[i].cat).attr("index",a).on("mouseover",(function(t,i){console.log(e.pointData[a])}))},h=0;h<this.pointData.length;h++)s(h);i=document.getElementsByTagName("rect");for(var o=0;o<i.length;o++)this.itemBBox.push({id:i[o].getAttribute("index"),bbox:i[o].getBBox()})}}},{key:"isInEdgeRange",value:function(t,e,i,a){var r=i.x,n=i.y,s=a.x,h=a.y,o=(s-r)*(t-r)+(h-n)*(e-n);return!(o<=0)&&!(o>=(s-r)*(s-r)+(h-n)*(h-n))}},{key:"calEdgeControlPoints",value:function(){function t(t,e){return t.avgdis-e.avgdis}this.edgeControlPoints=[];for(var e=[],i=0;i<this.edges.length;i++)this.edgeControlPoints.push([]),e.push([]);for(var a in Et)for(var r=0;r<Et[a].length;r++)for(var n=Et[a][r],s=0;s<n.length;s++){for(var h=Number.MAX_VALUE,o=-1,l=0;l<this.edges.length;l++){var d=this.edges[l];if(d.cat==a){var c=this.pointData[d.start],g=this.pointData[d.end],u=G(n[s][0],n[s][1],c.x,c.y,g.x,g.y);u>0&&u<h&&(h=u,o=l)}}o>=0&&e[o].push({order:r,index:s,dis:h})}for(var p=0;p<e.length;p++){for(var y=!1,f=[],x=1;x<e[p].length;x++){var v=e[p][x-1].index;e[p][x].index-v==1?(y||(y=!0),f.push(e[p][x-1])):y&&(f.push(e[p][x-1]),y=!1,this.edgeControlPoints[p].push(f),f=[])}y&&(f.push(e[p][e[p].length-1]),this.edgeControlPoints[p].push(f))}console.log(this.edgeControlPoints);for(var m=0;m<this.edgeControlPoints.length;m++)if(this.edgeControlPoints[m].length>2){for(var E=0;E<this.edgeControlPoints[m].length;E++){for(var D=0,b=0;b<this.edgeControlPoints[m][E].length;b++)D+=this.edgeControlPoints[m][E][b].dis;D/=this.edgeControlPoints[m][E].length,this.edgeControlPoints[m][E].avgdis=D}this.edgeControlPoints[m].sort(t);var F=[this.edgeControlPoints[m][0],this.edgeControlPoints[m][1]];this.edgeControlPoints[m]=F}}},{key:"changeEdgeWidth",value:function(t,e){var i=e-ct;i*=1.5;var a=this.edges[t].cat,r=this.pointData[this.edges[t].start],n=this.pointData[this.edges[t].end],s=[n.x-r.x,n.y-r.y],h=[-s[1],s[0]];h=j(h);var o=this.edgeControlPoints[t],l=o[0],d=o[1],c=Et[a][l[0].order][l[0].index],g=[c[0]-r.x,c[1]-r.y],u=g[0]*h[0]+g[1]*h[1];l.length,d.length;if(u>0){for(var p=i*h[0],y=i*h[1],f=0;f<l.length;f++){var x=l[f].index,v=l[f].order;Et[a][v][x][0]=Dt[a][v][x][0]+p,Et[a][v][x][1]=Dt[a][v][x][1]+y}for(var m=0;m<d.length;m++){var E=d[m].index,D=d[m].order;Et[a][D][E][0]=Dt[a][D][E][0]-p,Et[a][D][E][1]=Dt[a][D][E][1]-y}}else{for(var b=i*h[0],F=i*h[1],M=0;M<l.length;M++){var k=l[M].index,w=l[M].order;Et[a][w][k][0]=Dt[a][w][k][0]-b,Et[a][w][k][1]=Dt[a][w][k][1]-F}for(var I=0;I<d.length;I++){var P=d[I].index,A=d[I].order;Et[a][A][P][0]=Dt[a][A][P][0]+b,Et[a][A][P][1]=Dt[a][A][P][1]+F}}for(var C="",N=0;N<Et[a].length;N++)C+=St(Et[a][N]);this.reDraw(a,this,C)}},{key:"handleEdgeWidth",value:function(t,e){t.stopPropagation();var i=this;i.selectedEdge=parseInt(u.l(e).attr("index")),i.setState({hasSelectEdge:!0}),u.l("svg").selectAll("line").filter((function(){return parseInt(u.l(e).attr("index"))==i.selectedEdge})).attr("stroke","red").attr("opacity",1)}},{key:"drawEdges",value:function(){u.l("#mainsvg").selectAll("line").remove();var t=this;function e(e){e.stopPropagation(),t.selectedEdge=parseInt(u.l(this).attr("index")),t.setState({hasSelectEdge:!0}),u.l("svg").selectAll("line").filter((function(){return parseInt(u.l(this).attr("index"))==t.selectedEdge})).attr("stroke","red").attr("opacity",1)}for(var i=0;i<this.edges.length;i++){var a=this.edges[i].start,r=this.edges[i].end,n=i;if(this.edges[i].virtrual){for(var s=this.edges[i].virtrualNodes,h=[this.pointData[a].x,this.pointData[a].y],o=void 0,l=0;l<s.length;l++)o=s[l],H.append("line").attr("x1",h[0]).attr("y1",h[1]).attr("x2",o[0]).attr("y2",o[1]).attr("index",n).attr("stroke-width",3).attr("stroke","black").attr("opacity",0).on("mouseover",(function(e,i){if(!t.state.hasSelectEdge){var a=u.l(this).attr("index");u.l("svg").selectAll("line").filter((function(){return u.l(this).attr("index")==a})).attr("opacity",1)}})).on("mouseout",(function(e,i){if(!t.state.hasSelectEdge){var a=u.l(this).attr("index");u.l("svg").selectAll("line").filter((function(){return u.l(this).attr("index")==a})).attr("opacity",0)}})).on("click",e),h=o;o=[this.pointData[r].x,this.pointData[r].y],H.append("line").attr("x1",h[0]).attr("y1",h[1]).attr("x2",o[0]).attr("y2",o[1]).attr("index",n).attr("stroke-width",3).attr("stroke","black").attr("opacity",0).on("mouseover",(function(e,i){if(!t.state.hasSelectEdge){var a=u.l(this).attr("index");u.l("svg").selectAll("line").filter((function(){return u.l(this).attr("index")==a})).attr("opacity",1)}})).on("mouseout",(function(e,i){if(!t.state.hasSelectEdge){var a=u.l(this).attr("index");u.l("svg").selectAll("line").filter((function(){return u.l(this).attr("index")==a})).attr("opacity",0)}})).on("click",e)}else H.append("line").attr("x1",this.pointData[a].x).attr("y1",this.pointData[a].y).attr("x2",this.pointData[r].x).attr("y2",this.pointData[r].y).attr("index",n).attr("stroke-width",3).attr("stroke","black").attr("opacity",0).on("mouseover",(function(e,i){if(!t.state.hasSelectEdge){var a=u.l(this).attr("index");u.l("svg").selectAll("line").filter((function(){return u.l(this).attr("index")==a})).attr("opacity",1)}})).on("mouseout",(function(e,i){if(!t.state.hasSelectEdge){var a=u.l(this).attr("index");u.l("svg").selectAll("line").filter((function(){return u.l(this).attr("index")==a})).attr("opacity",0)}})).on("click",e)}}},{key:"calEdgeLength",value:function(){for(var t=Number.MAX_VALUE,e=Number.MIN_VALUE,i=0;i<this.edges.length;i++){var a=this.pointData[this.edges[i].start],r=this.pointData[this.edges[i].end];if(this.edges[i].virtrual){var n=this.edges[i].virtrualNodes,s=void 0,h=void 0,o=0;s=[a.x,a.y];for(var l=0;l<n.length;l++)h=n[l],o+=_(s[0],s[1],h[0],h[1]),s=h;(o+=_(s[0],s[1],r.x,r.y))>e&&(e=o),o<t&&(t=o)}else{var d=_(a.x,a.y,r.x,r.y);d>e&&(e=d),d<t&&(t=d)}}this.maxEdgeLength=e,this.minEdgeLength=t}},{key:"componentWillUpdate",value:function(t,e,i){}},{key:"findOutLine",value:function(){for(var t in this.catEnergyField)this.updatedEnergyPoints[t]=[];ft=[.01],console.time("isoline");var e={};for(var t in this.catEnergyField){e[t]=[];for(var i=parseInt((this.catEnergyField[t].boundingY-this.catEnergyField[t].y)/xt),a=parseInt((this.catEnergyField[t].boundingX-this.catEnergyField[t].x)/xt),r=parseInt((this.catEnergyField[t].boundingHeight*xt+this.catEnergyField[t].boundingY-this.catEnergyField[t].y)/xt),n=parseInt((this.catEnergyField[t].boundingWidth*xt+this.catEnergyField[t].boundingX-this.catEnergyField[t].x)/xt),s=0,h=i;h<r;h++){e[t].push([]);for(var o=a;o<n;o++)e[t][s].push(this.catEnergyField[t].finalField[h][o]);s++}}var l=this.calISOLine(ft,e),d={};Et={};var c={};for(var t in l)for(var g=this.catEnergyField[t].boundingX,u=this.catEnergyField[t].boundingY,p=0,y=0;y<l[t].length;y++){var f=[];c.hasOwnProperty(t)||(c[t]=[]);var x=At;l[t][y].length,l[t][y].length;for(var v=0;v<l[t][y].length;v+=x)f.push([l[t][y][v][0]*xt+g,l[t][y][v][1]*xt+u]);c[t].push(f);for(var m=!1,E=0;E<this.catPointDict[t].length&&!(m=et([this.catPointDict[t][E].x,this.catPointDict[t][E].y],f));E++);if(m){0==p&&(c[t].selectidx=[],Et[t]=[]),c[t].selectidx.push(c[t].length-1),d[t]=[];for(var D=0;D<l[t][y].length;D+=x)d[t].push([l[t][y][D][0],l[t][y][D][1]]);bt[t]=!1;var b=Et[t].length;Et[t][b]=[],Et[t][b]=f;for(var F=0,M=Et[t][b].length,k=0;k<M;k++)F+=_(Et[t][b][k][0],Et[t][b][k][1],Et[t][b][(k+1)%M][0],Et[t][b][(k+1)%M][1]);F/=M,Et[t][b].meandis=F,p++}}for(var w in console.timeEnd("isoline"),console.time("remove isoline"),this.catEnergyField)this.updatedEnergyPoints[w]=[];for(var t in l)for(var I=c[t].selectidx,P=0;P<c[t].length;P++){for(var A=!1,C=0;C<I.length;C++)if(P==I[C]){A=!0;break}if(!A){for(var N=!0,S=0;S<I.length;S++){for(var B=0;B<c[t][P].length&&0!=(N=et([c[t][P][B][0],c[t][P][B][1]],c[t][I[S]]));B++);if(N)break}if(N){if(it(c[t][P])<Ct)continue;for(var O=0,j=c[t][P].length,V=[-1,-1];O<j;){var L=(O-1+j)%j,X=(O+1)%j,G=[c[t][P][L][0]-c[t][P][O][0],c[t][P][L][1]-c[t][P][O][1]],Y=[c[t][P][X][0]-c[t][P][O][0],c[t][P][X][1]-c[t][P][O][1]],U=[G[0]+Y[0],G[1]+Y[1]],T=Math.sqrt(U[0]*U[0]+U[1]*U[1]);0!=T&&(U=[U[0]/T,U[1]/T]);var R=[c[t][P][O][0]+2*U[0],c[t][P][O][1]+2*U[1]];if(et(R,c[t][P])){V=[R[0],R[1]];break}O++}var W=!0;if(-1!=V[0]&&-1!=V[1]){var q=parseInt((V[1]-this.catEnergyField[t].y)/xt),z=parseInt((V[0]-this.catEnergyField[t].x)/xt);this.catEnergyField[t].finalField[q][z]>.01&&(W=!1)}if(!W)continue;var H=Et[t].length;Et[t][H]=[];for(var K=0;K<c[t][P].length;K++)Et[t][H].push([c[t][P][K][0],c[t][P][K][1]]);for(var J=0,Q=Et[t][H].length,Z=0;Z<Q;Z++)J+=_(Et[t][H][Z][0],Et[t][H][Z][1],Et[t][H][(Z+1)%Q][0],Et[t][H][(Z+1)%Q][1]);J/=Q,Et[t][H].meandis=J}}}console.timeEnd("remove isoline")}},{key:"calOutLine",value:function(){var t={};for(var e in this.catEnergyField){t[e]=[];for(var i="",a=0;a<Et[e].length;a++)t[e].push(St(Et[e][a])),i+=St(Et[e][a]);this.drawISOLinesV2(e,this,i)}for(var e in console.log("path_info!!!"),console.log(JSON.stringify(t)),Et){Dt[e]=[];for(var r=0;r<Et[e].length;r++){Dt[e][r]=[];for(var n=0;n<Et[e][r].length;n++)Dt[e][r].push([]),Dt[e][r][n].push(Et[e][r][n][0]),Dt[e][r][n].push(Et[e][r][n][1])}}}},{key:"loadEdgeData",value:function(){console.time("Total Time"),this.centralizeData(!0),this.calEdgeLength(),this.calActiveRegion(!0),console.time("cal energe"),this.calEnergyField(),console.timeEnd("cal energe"),console.time("cal final energe"),this.calFinalEnergeField(),console.timeEnd("cal final energe"),console.time("fill cross edge"),this.fillCrossingEdge(),console.timeEnd("fill cross edge"),console.time("create gap"),this.createGapInBoundary(),console.timeEnd("create gap"),u.l("svg").selectAll("*").remove(),H=u.l("svg").append("g"),!1,0,this.findOutLine(),this.calOutLine(),this.calEdgeControlPoints(),this.drawEdges(),this.drawPointData(),console.timeEnd("Total Time");var t=this;u.l("svg").on("click",(function(){console.log("click svg!"),u.l("svg").selectAll("line").filter((function(){return parseInt(u.l(this).attr("index"))==t.selectedEdge})).attr("stroke","red").attr("opacity",0),t.selectedEdge=-1,t.setState({hasSelectEdge:!1,edgeWidth:ct})}))}},{key:"afterEditReDraw",value:function(){this.pointData=this.props.pointData,this.edges=this.props.edges,this.drawEdges(),this.drawPointData();var t=this;u.l("svg").on("click",(function(){console.log("click svg!"),u.l("svg").selectAll("line").filter((function(){return parseInt(u.l(this).attr("index"))==t.selectedEdge})).attr("stroke","red").attr("opacity",0),t.selectedEdge=-1,t.setState({hasSelectEdge:!1,edgeWidth:ct})}))}},{key:"calActiveRegion",value:function(t){for(var e in this.catPointDict){!t&&this.catEnergyField.hasOwnProperty(e)||(this.catEnergyField[e]={});var i=this.catPointDict[e].maxX,a=this.catPointDict[e].minX,r=this.catPointDict[e].maxY,n=this.catPointDict[e].minY;if(this.catEnergyField[e].boundingX=a-Math.max(ht,lt)-st,this.catEnergyField[e].boundingY=n-Math.max(ht,lt)-st,this.catEnergyField[e].boundingWidth=Math.ceil((i-a+2*Math.max(ht,lt)+2*st)/xt),this.catEnergyField[e].boundingHeight=Math.ceil((r-n+2*Math.max(ht,lt)+2*st)/xt),t||!this.catEnergyField[e].hasOwnProperty("field")){var s=this.catEnergyField[e].boundingX+.5*this.catEnergyField[e].boundingWidth,h=this.catEnergyField[e].boundingY+.5*this.catEnergyField[e].boundingHeight;this.catEnergyField[e].x=parseInt(s-.5*It),this.catEnergyField[e].y=parseInt(h-.5*Pt),this.catEnergyField[e].width=parseInt(It/xt),this.catEnergyField[e].height=parseInt(Pt/xt),this.catEnergyField[e].field=[],this.catEnergyField[e].barrierMap=[];for(var o=0;o<Pt;o++)this.catEnergyField[e].field.push(new Array(It).fill(0)),this.catEnergyField[e].barrierMap.push(new Array(It).fill(0))}}this.hasBubbles=!0}},{key:"calDistanceToItem",value:function(t,e,i){if("circle"==gt){var a=_(t,e,i.x,i.y);return a<i.radius?0:a-i.radius}}},{key:"getPointEdgeDistance",value:function(t,e,i,a,r,n){var s,h=i-t,o=a-e,l=r-t,d=n-e,c=l*h+d*o;s=c<=0||(c=(l=h-l)*h+(d=o-d)*o)<=0?0:c*c/(h*h+o*o);var g=l*l+d*d-s;return g<0&&(g=0),Math.sqrt(g)}},{key:"calDistanceToEdgeV2",value:function(t,e,i){var a,r;if(0==i.flag?(a=i.startpoint,r=i.endpoint):(a=this.pointData[i.start],r=this.pointData[i.end]),i.virtrual&&i.virtrualNodes.length>0){for(var n,s,h,o=i.virtrualNodes,l=[a.x,a.y],d=Number.MAX_VALUE,c=0,g=0,u=-1,p=0;p<o.length;p++){n=o[p];var y=this.getPointEdgeDistance(l[0],l[1],n[0],n[1],t,e);y<d&&(d=y,u=p),l=n}l=[a.x,a.y];for(var f=0;f<u;f++)n=o[f],c+=_(l[0],l[1],n[0],n[1]),l=n;0==u?(l=[a.x,a.y],n=o[0]):(l=o[u-1],n=o[u]);var x=this.getPointEdgeDistance(r.x,r.y,o[o.length-1][0],o[o.length-1][1],t,e);x<d&&(d=x,c+=_(l[0],l[1],n[0],n[1]),l=n,n=[r.x,r.y]),h=d;var v=[t-l[0],e-l[1]],m=[n[0]-l[0],n[1]-l[1]],E=(l[0],n[0],l[1],n[1],n[0],n[1],_(l[0],l[1],n[0],n[1]));c+=(m[0]*v[0]+m[1]*v[1])/E,l=[a.x,a.y];for(var D=0;D<o.length;D++)n=o[D],g+=_(l[0],l[1],n[0],n[1]),l=n;s=(g+=_(l[0],l[1],r.x,r.y))-c;var b=Math.min(c,s);return b<0&&(b=-1),[h,b,g]}var F=this.getPointEdgeDistance(a.x,a.y,r.x,r.y,t,e),M=[t-a.x,e-a.y],k=[r.x-a.x,r.y-a.y],w=(a.x,r.x,a.y,r.y,r.x,r.y,_(a.x,a.y,r.x,r.y)),I=(k[0]*M[0]+k[1]*M[1])/w,P=I,A=w-I,C=Math.min(P,A);return C<0&&(C=-1),[F,C,w]}},{key:"calDistanceToEdge",value:function(t,e,i){var a=this.pointData[i.start],r=this.pointData[i.end];if(i.virtrual){for(var n,s,h,o=i.virtrualNodes,l=[a.x,a.y],d=Number.MAX_VALUE,c=0,g=0,u=-1,p=0;p<o.length;p++){n=o[p];var y=this.getPointEdgeDistance(l[0],l[1],n[0],n[1],t,e);y<d&&(d=y,u=p),l=n}l=[a.x,a.y];for(var f=0;f<u;f++)n=o[f],c+=_(l[0],l[1],n[0],n[1]),l=n;0==u?(l=[a.x,a.y],n=o[0]):(l=o[u-1],n=o[u]);var x=this.getPointEdgeDistance(r.x,r.y,o[o.length-1][0],o[o.length-1][1],t,e);x<d&&(d=x,c+=_(l[0],l[1],n[0],n[1]),l=n,n=[r.x,r.y]),h=d;var v=[t-l[0],e-l[1]],m=[n[0]-l[0],n[1]-l[1]],E=(l[0],n[0],l[1],n[1],n[0],n[1],_(l[0],l[1],n[0],n[1]));c+=(m[0]*v[0]+m[1]*v[1])/E,l=[a.x,a.y];for(var D=0;D<o.length;D++)n=o[D],g+=_(l[0],l[1],n[0],n[1]),l=n;s=(g+=_(l[0],l[1],r.x,r.y))-c;var b=Math.min(c,s);return b<0&&(b=-1),[h,b,g]}var F=this.getPointEdgeDistance(a.x,a.y,r.x,r.y,t,e),M=[t-a.x,e-a.y],k=[r.x-a.x,r.y-a.y],w=(a.x,r.x,a.y,r.y,r.x,r.y,_(a.x,a.y,r.x,r.y)),I=(k[0]*M[0]+k[1]*M[1])/w,P=I,A=w-I,C=Math.min(P,A);return C<0&&(C=-1),[F,C,w]}},{key:"isRectIntersects",value:function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0)&&(e.maxX>t.minX&&e.maxY>t.minY&&e.minX<t.maxX&&e.minY<t.maxY)}},{key:"isThisCat",value:function(t,e){for(var i=t.catArray,a=0;a<i.length;a++)if(i[a]==e)return!0;return!1}},{key:"LabelGroupElement",value:function(){var t=2*ht;for(var e in this.catPointDict){for(var i=0;i<this.catPointDict[e].length;i++)if(0!=this.catPointDict[e][i].isGroup){var a=!0,r=this.catPointDict[e][i].x,n=this.catPointDict[e][i].y;for(var s in this.catPointDict)if(e!=s){for(var h=0;h<this.catPointDict[s].length;h++){if(_(r,n,this.catPointDict[s][h].x,this.catPointDict[s][h].y)<t+this.catPointDict[s][h].radius+this.catPointDict[e][i].radius){a=!1,this.catPointDict[s][h].isGroup=!1;break}}if(0==a)break;if(this.catEdgeDict.hasOwnProperty(s)){for(var o=0;o<this.catEdgeDict[s].length;o++)if(this.calDistanceToEdge(r,n,this.catEdgeDict[s][o])[0]<t+this.catPointDict[e][i].radius){a=!1,this.catEdgeDict[s][o].isGroup=!1;break}if(0==a)break}}this.catPointDict[e][i].isGroup=a}if(this.catEdgeDict.hasOwnProperty(e))for(var l=0;l<this.catEdgeDict[e].length;l++){this.pointData[this.catEdgeDict[e][l].start],this.pointData[this.catEdgeDict[e][l].end];if(0!=this.catEdgeDict[e][l].isGroup){var d=!0;for(var c in this.catPointDict)if(e!=c){for(var g=0;g<this.catPointDict[c].length;g++){var u=this.catPointDict[c][g].x,p=this.catPointDict[c][g].y;if(this.calDistanceToEdge(u,p,this.catEdgeDict[e][l])[0]<t+this.catPointDict[c][g].radius){d=!1,this.catPointDict[c][g].isGroup=!1;break}}if(0==d)break}this.catEdgeDict[e][l].isGroup=d}}}}},{key:"calEnergyField_Part",value:function(t,e){for(var i in console.log("calEnergyField_Part:"),console.log(e),this.catPointDict)if(!this.catEnergyField[i].hasOwnProperty("finalField")){this.catPointDict[i].pointMap=[],this.catEnergyField[i].pointBarrierMap=[],this.catEnergyField[i].edgeBarrierMap=[],this.catEnergyField[i].pointIndexMap=[],this.catEnergyField[i].edgeIndexMap=[],this.catEnergyField[i].edgeIndexMap2=[],this.catEnergyField[i].finalField=[],this.catEnergyField[i].subUpdate=[];for(var a=0;a<Pt;a++){this.catEnergyField[i].finalField.push(new Array(It).fill(0)),this.catEnergyField[i].subUpdate.push(new Array(It).fill(0)),this.catEnergyField[i].pointBarrierMap.push(new Array(It).fill(0)),this.catEnergyField[i].edgeBarrierMap.push(new Array(It).fill(0)),this.catEnergyField[i].pointIndexMap.push(new Array(It).fill(-1)),this.catEnergyField[i].edgeIndexMap.push(new Array(It).fill(-1)),this.catEnergyField[i].edgeIndexMap2.push([]);for(var r=0;r<It;r++)this.catEnergyField[i].edgeIndexMap2[a].push([])}}for(var i in this.catPointDict){t.hasOwnProperty(i)||(t[i]=[]),e.hasOwnProperty(i)||(e[i]=[]);for(var n=t[i],s=0;s<n.length;s++){var h=n[s],o=void 0,l=void 0,d=void 0,c=void 0;o=Math.floor((h.minX-ht-10-this.catEnergyField[i].x)/xt),o=Math.max(0,o),l=Math.min(Math.ceil((h.maxX+ht+10-this.catEnergyField[i].x)/xt),this.catEnergyField[i].width),l=Math.max(0,l),d=Math.floor((h.minY-ht-10-this.catEnergyField[i].y)/xt),d=Math.max(0,d),c=Math.min(Math.ceil((h.maxY+ht+10-this.catEnergyField[i].y)/xt),this.catEnergyField[i].height),c=Math.max(0,c);for(var g=d;g<c;g++)for(var u=o;u<l;u++){var p=u*xt+this.catEnergyField[i].x,y=g*xt+this.catEnergyField[i].y;this.updateIdx.push([parseInt(y),parseInt(p)]);var f=this.calDistanceToItem(p,y,h);if(f<ht+mt){var x=ut*Math.pow(ht-f,2)/Math.pow(ht-ot,2);0==n[s].flag?(this.catEnergyField[i].field[g][u]-=x,this.catEnergyField[i].finalField[g][u]=0,this.catEnergyField[i].subUpdate[g][u]=1,(this.catEnergyField[i].field[g][u]<=.015||-1==this.catEnergyField[i].edgeIndexMap[g][u])&&(this.catEnergyField[i].field[g][u]=0,this.catEnergyField[i].pointBarrierMap[g][u]=0,this.catEnergyField[i].pointIndexMap[g][u]=-1,this.catEnergyField[i].barrierMap[g][u]=0)):(this.catEnergyField[i].field[g][u]+=x,this.catEnergyField[i].finalField[g][u]=0,this.catEnergyField[i].subUpdate[g][u]=0,0==this.catEnergyField[i].barrierMap[g][u]&&(this.catEnergyField[i].barrierMap[g][u]=5),0==this.catEnergyField[i].pointBarrierMap[g][u]&&(this.catEnergyField[i].pointBarrierMap[g][u]=5),-1==this.catEnergyField[i].pointIndexMap[g][u]&&(this.catEnergyField[i].pointIndexMap[g][u]=h.id))}1==n[s].flag&&(f<=yt+mt&&(3!=this.catEnergyField[i].barrierMap[g][u]&&(this.catEnergyField[i].barrierMap[g][u]=1),3!=this.catEnergyField[i].pointBarrierMap[g][u]&&(this.catEnergyField[i].pointBarrierMap[g][u]=1)),f<=mt&&(this.catEnergyField[i].barrierMap[g][u]=3,this.catEnergyField[i].pointBarrierMap[g][u]=3,this.catEnergyField[i].pointIndexMap[g][u]=h.id))}}var v=this.maxEdgeLength/1.5;console.log(this.maxEdgeLength);var m=e[i];m.sort((function(t,e){return t.flag-e.flag}));for(var E=0;E<m.length;E++){var D=void 0,b=void 0,F=void 0,M=void 0,k=m[E].start,w=m[E].end;D=Math.floor((m[E].x-lt-10-this.catEnergyField[i].x)/xt),D=Math.max(0,D),b=Math.min(Math.ceil((m[E].x+m[E].width+lt+10-this.catEnergyField[i].x)/xt),this.catEnergyField[i].width),b=Math.max(0,b),F=Math.floor((m[E].y-lt-10-this.catEnergyField[i].y)/xt),F=Math.max(0,F),M=Math.min(Math.ceil((m[E].y+m[E].height+lt+10-this.catEnergyField[i].y)/xt),this.catEnergyField[i].height),M=Math.max(0,M);for(var I=F;I<M;I++)for(var P=D;P<b;P++){var A=P*xt+this.catEnergyField[i].x,C=I*xt+this.catEnergyField[i].y;this.updateIdx.push([parseInt(C),parseInt(A)]);var N=this.calDistanceToEdgeV2(A,C,m[E]),S=N[0],B=N[1],_=N[2];if(!(B<0)){if(S<lt+mt){var O=lt;_>v&&(O=2*lt/(1+(lt-2)/(lt/10*_)*B)),O>lt&&(O=lt),O>2*ht&&(O=2*ht);var j=void 0;if(j=S>O?0:pt*Math.pow(O-S,2)/Math.pow(lt-dt,2),1==m[E].flag){this.catEnergyField[i].finalField[I][P];this.catEnergyField[i].field[I][P]+=j,this.catEnergyField[i].finalField[I][P]=0,this.catEnergyField[i].subUpdate[I][P]=0,0!=this.catEnergyField[i].barrierMap[I][P]&&5!=this.catEnergyField[i].barrierMap[I][P]||j>0&&(this.catEnergyField[i].barrierMap[I][P]=6),0!=this.catEnergyField[i].edgeBarrierMap[I][P]&&5!=this.catEnergyField[i].edgeBarrierMap[I][P]||j>0&&(this.catEnergyField[i].edgeBarrierMap[I][P]=6),j>0&&(this.catEnergyField[i].edgeIndexMap[I][P]=k,this.catEnergyField[i].edgeIndexMap2[I][P].push({start:k,end:w}))}else{this.catEnergyField[i].field[I][P]-=j,this.catEnergyField[i].finalField[I][P]=0,this.catEnergyField[i].subUpdate[I][P]=1;var V=!1;if(-1==this.catEnergyField[i].pointIndexMap[I][P]&&1==this.catEnergyField[i].edgeIndexMap2[I][P].length&&this.catEnergyField[i].edgeIndexMap2[I][P][0].start==k&&this.catEnergyField[i].edgeIndexMap2[I][P][0].end==w&&(V=!0),this.catEnergyField[i].field[I][P]<=.015||V){this.catEnergyField[i].field[I][P]=0,this.catEnergyField[i].edgeBarrierMap[I][P]=0,this.catEnergyField[i].edgeIndexMap[I][P]=-1;for(var L=this.catEnergyField[i].edgeIndexMap2[I][P].length-1;L>=0;L--){var X=this.catEnergyField[i].edgeIndexMap2[I][P][L].start,G=this.catEnergyField[i].edgeIndexMap2[I][P][L].end;X==k&&G==w&&this.catEnergyField[i].edgeIndexMap2[I][P].splice(L,1)}this.catEnergyField[i].barrierMap[I][P]=0}}}1==m[E].flag&&(S<=yt+mt&&(4!=this.catEnergyField[i].barrierMap[I][P]&&3!=this.catEnergyField[i].barrierMap[I][P]&&1!=this.catEnergyField[i].barrierMap[I][P]&&(this.catEnergyField[i].barrierMap[I][P]=2),4!=this.catEnergyField[i].edgeBarrierMap[I][P]&&3!=this.catEnergyField[i].edgeBarrierMap[I][P]&&1!=this.catEnergyField[i].edgeBarrierMap[I][P]&&(this.catEnergyField[i].edgeBarrierMap[I][P]=2)),S<=2+mt&&(this.catEnergyField[i].barrierMap[I][P]=4,this.catEnergyField[i].edgeBarrierMap[I][P]=4))}}}}}},{key:"calEnergyField",value:function(){for(var t in this.catPointDict){this.catPointDict[t].pointMap=[],this.catEnergyField[t].pointBarrierMap=[],this.catEnergyField[t].edgeBarrierMap=[],this.catEnergyField[t].pointIndexMap=[],this.catEnergyField[t].edgeIndexMap=[],this.catEnergyField[t].edgeIndexMap2=[],this.catEnergyField[t].finalField=[],this.catEnergyField[t].subUpdate=[];for(var e=0;e<Pt;e++){this.catEnergyField[t].subUpdate.push(new Array(It).fill(0)),this.catEnergyField[t].finalField.push(new Array(It).fill(0)),this.catEnergyField[t].pointBarrierMap.push(new Array(It).fill(0)),this.catEnergyField[t].edgeBarrierMap.push(new Array(It).fill(0)),this.catEnergyField[t].pointIndexMap.push(new Array(It).fill(-1)),this.catEnergyField[t].edgeIndexMap.push(new Array(It).fill(-1)),this.catEnergyField[t].edgeIndexMap2.push([]);for(var i=0;i<It;i++)this.catEnergyField[t].edgeIndexMap2[e].push([])}}for(var t in this.catPointDict){for(var a=this.catPointDict[t],r=0;r<a.length;r++){var n=a[r];this.catPointDict[t].pointMap.push([]);var s,h,o,l;s=Math.floor((n.minX-ht-10-this.catEnergyField[t].x)/xt),h=Math.min(Math.ceil((n.maxX+ht+10-this.catEnergyField[t].x)/xt),this.catEnergyField[t].width),o=Math.floor((n.minY-ht-10-this.catEnergyField[t].y)/xt),l=Math.min(Math.ceil((n.maxY+ht+10-this.catEnergyField[t].y)/xt),this.catEnergyField[t].height);for(var d=o;d<l;d++)for(var c=s;c<h;c++){var g=c*xt+this.catEnergyField[t].x,u=d*xt+this.catEnergyField[t].y,p=this.calDistanceToItem(g,u,n);if(p<ht+mt){var y=ut*Math.pow(ht-p,2)/Math.pow(ht-ot,2);this.catEnergyField[t].field[d][c]+=y,0==this.catEnergyField[t].barrierMap[d][c]&&(this.catEnergyField[t].barrierMap[d][c]=5),0==this.catEnergyField[t].pointBarrierMap[d][c]&&(this.catEnergyField[t].pointBarrierMap[d][c]=5),-1==this.catEnergyField[t].pointIndexMap[d][c]&&(this.catEnergyField[t].pointIndexMap[d][c]=n.id)}if(n.multicat)for(var f=n.catArray,x=0;x<f.length;x++)if(f[x]!=t&&parseInt(f[x])<parseInt(t)&&p<ht+10){var v=c*xt+this.catEnergyField[t].x,m=d*xt+this.catEnergyField[t].y,E=Math.floor((v-this.catEnergyField[f[x]].x)/xt),D=Math.floor((m-this.catEnergyField[f[x]].y)/xt);Math.pow(ht-p,2),Math.pow(ht-ot,2);E>0&&D>0&&E<this.catEnergyField[f[x]].width&&this.catEnergyField[f[x]].height}p<=yt+mt&&(3!=this.catEnergyField[t].barrierMap[d][c]&&(this.catEnergyField[t].barrierMap[d][c]=1),3!=this.catEnergyField[t].pointBarrierMap[d][c]&&(this.catEnergyField[t].pointBarrierMap[d][c]=1)),p<=mt&&(this.catEnergyField[t].barrierMap[d][c]=3,this.catPointDict[t].pointMap[r].push([c,d]),this.catEnergyField[t].pointBarrierMap[d][c]=3,this.catEnergyField[t].pointIndexMap[d][c]=n.id)}}var b=this.maxEdgeLength/2;if(this.catEdgeDict.hasOwnProperty(t))for(var F=this.catEdgeDict[t],M=0;M<F.length;M++){var k,w,I,P,A=F[M].start,C=F[M].end;k=Math.floor((F[M].x-lt-10-this.catEnergyField[t].x)/xt),w=Math.min(Math.ceil((F[M].x+F[M].width+lt+10-this.catEnergyField[t].x)/xt),this.catEnergyField[t].width),I=Math.floor((F[M].y-lt-10-this.catEnergyField[t].y)/xt),P=Math.min(Math.ceil((F[M].y+F[M].height+lt+10-this.catEnergyField[t].y)/xt),this.catEnergyField[t].height);for(var N=I;N<P;N++)for(var S=k;S<w;S++){var B=S*xt+this.catEnergyField[t].x,_=N*xt+this.catEnergyField[t].y,O=this.calDistanceToEdge(B,_,F[M]),j=O[0],V=O[1],L=O[2];if(!(V<0)){if(j<lt+mt){var X=lt;L>b&&(X=2*lt/(1+(lt-2)/(lt/10*L)*V)),X>lt&&(X=lt),X>2*ht&&(X=2*ht);var G=void 0;G=j>X?0:pt*Math.pow(X-j,2)/Math.pow(lt-dt,2),this.catEnergyField[t].field[N][S]+=G,0!=this.catEnergyField[t].barrierMap[N][S]&&5!=this.catEnergyField[t].barrierMap[N][S]||G>0&&(this.catEnergyField[t].barrierMap[N][S]=6),0!=this.catEnergyField[t].edgeBarrierMap[N][S]&&5!=this.catEnergyField[t].edgeBarrierMap[N][S]||G>0&&(this.catEnergyField[t].edgeBarrierMap[N][S]=6),G>0&&(this.catEnergyField[t].edgeIndexMap[N][S]=A,this.catEnergyField[t].edgeIndexMap2[N][S].push({start:A,end:C}))}var Y=this.pointData[A],U=this.pointData[C];if(Y.multicat&&U.multicat){for(var T=!1,R=-1,W=0;W<Y.catArray.length;W++){var q=Y.catArray[W];if(q!=t)for(var z=0;z<U.catArray.length;z++){var H=U.catArray[z];if(H!=t&&H==q){T=!0,R=q;break}}}if(T&&parseInt(R)<parseInt(t)&&j<lt+20+mt){var K=S*xt+this.catEnergyField[t].x,J=N*xt+this.catEnergyField[t].y,Q=Math.floor((K-this.catEnergyField[R].x)/xt),Z=Math.floor((J-this.catEnergyField[R].y)/xt),$=pt*Math.pow(lt-0,2)/Math.pow(lt-dt,2);Q>0&&Z>0&&Q<this.catEnergyField[R].width&&Z<this.catEnergyField[R].height&&(this.catEnergyField[R].field[Z][Q]+=$,this.catEnergyField[R].edgeIndexMap[Z][Q]=Y.id,this.catEnergyField[R].edgeIndexMap2[Z][Q].push({start:Y.id,end:U.id}))}}j<=yt+mt&&(4!=this.catEnergyField[t].barrierMap[N][S]&&3!=this.catEnergyField[t].barrierMap[N][S]&&1!=this.catEnergyField[t].barrierMap[N][S]&&(this.catEnergyField[t].barrierMap[N][S]=2),4!=this.catEnergyField[t].edgeBarrierMap[N][S]&&3!=this.catEnergyField[t].edgeBarrierMap[N][S]&&1!=this.catEnergyField[t].edgeBarrierMap[N][S]&&(this.catEnergyField[t].edgeBarrierMap[N][S]=2)),j<=2+mt&&(this.catEnergyField[t].barrierMap[N][S]=4,this.catEnergyField[t].edgeBarrierMap[N][S]=4)}}}}}},{key:"checkEdgeCrossing",value:function(t,e,i,a){var r=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),n=(t.x-a.x)*(e.y-a.y)-(t.y-a.y)*(e.x-a.x);if(r*n>=0)return[!1];var s=(i.x-t.x)*(a.y-t.y)-(i.y-t.y)*(a.x-t.x);if(s*(s+r-n)>=0)return[!1];var h=s/(n-r),o=h*(e.x-t.x),l=h*(e.y-t.y);return[!0,{x:t.x+o,y:t.y+l}]}},{key:"createGapInBoundary",value:function(){var t=this.state.gapBetween;if(0!=t)for(var e in this.catEnergyField){for(var i=this.catEnergyField[e].finalField,a=[],r=parseInt((this.catEnergyField[e].boundingY-this.catEnergyField[e].y)/xt),n=parseInt((this.catEnergyField[e].boundingX-this.catEnergyField[e].x)/xt),s=parseInt((this.catEnergyField[e].boundingHeight*xt+this.catEnergyField[e].boundingY-this.catEnergyField[e].y)/xt),h=parseInt((this.catEnergyField[e].boundingWidth*xt+this.catEnergyField[e].boundingX-this.catEnergyField[e].x)/xt),o=r;o<s;o++)for(var l=n;l<h;l++)if(0!=i[o][l]&&4!=this.catEnergyField[e].barrierMap[o][l]){for(var d=!1,c=0;c<t;c++){var g=c+1;if(l+g<this.catEnergyField[e].width&&0==i[o][l+g]){d=!0;break}if(l-g>0&&0==i[o][l-g]){d=!0;break}if(o-g>0&&0==i[o-g][l]){d=!0;break}if(o+g<this.catEnergyField[e].height&&0==i[o+g][l]){d=!0;break}if(l+g<this.catEnergyField[e].width&&o-g>0&&0==i[o-g][l+g]){d=!0;break}if(l+g<this.catEnergyField[e].width&&o+g<this.catEnergyField[e].height&&0==i[o+g][l+g]){d=!0;break}if(l-g>0&&o-g>0&&0==i[o-g][l-g]){d=!0;break}if(l-g>0&&o+g<this.catEnergyField[e].height&&0==i[o+g][l-g]){d=!0;break}}d&&a.push([l,o])}for(var u=0;u<a.length;u++){var p=a[u][0],y=a[u][1];this.catEnergyField[e].finalField[y][p]=0}}}},{key:"removeEmptyZone",value:function(t){for(var e in t){var i=t[e],a=[],r=this.catEnergyField[e].finalField;this.catEnergyField[e].isoLineMap=[];for(var n=0;n<i.length;n++){for(var s=[],h=0;h<i[n].length;h++)s.push({x:i[n][h][0],y:i[n][h][1]});a.push(s)}for(var o=[],l=0;l<a.length;l++)o.push([]);for(var d=0;d<this.catEnergyField[e].height;d++){this.catEnergyField[e].isoLineMap.push([]);for(var c=0;c<this.catEnergyField[e].width;c++)if(this.catEnergyField[e].isoLineMap[d].push(-1),r[d][c]>0)for(var g=0;g<a.length;g++){if(rt.pointInPolygon({x:c,y:d},a[g])){o[g].push([c,d]),this.catEnergyField[e].isoLineMap[d][c]=g;break}}}for(var u=[],p=0;p<this.catPointDict[e].pointMap.length;p++){for(var y=this.catPointDict[e].pointMap[p],f=!0,x=-1,v=0;v<y.length;v++){var m=y[v][0],E=y[v][1];if(0==v&&this.catEnergyField[e].isoLineMap[E][m]>-1&&(x=this.catEnergyField[e].isoLineMap[E][m]),-1==this.catEnergyField[e].isoLineMap[E][m]||this.catEnergyField[e].isoLineMap[E][m]!=x){f=!1;break}}f&&u.push(x)}for(var D=[],b=0;b<o.length;b++){for(var F=!0,M=0;M<u.length;M++)if(b==u[M]){F=!1;break}F&&D.push(b)}for(var k=0;k<D.length;k++)for(var w=o[D[k]],I=0;I<w.length;I++){var P=w[I][0],A=w[I][1];this.catEnergyField[e].finalField[A][P]=0}for(var C=[],N=0;N<i.length;N++){for(var S=!1,B=0;B<D.length;B++)if(N==D[B]){S=!0;break}S||C.push(i[N])}t[e]=C}return console.log(t),t}},{key:"isSameCat",value:function(t,e){for(var i=0;i<t.length;i++)for(var a=t[i],r=0;r<e.length;r++){if(a==e[r])return!0}return!1}},{key:"isContained",value:function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}},{key:"calFinalEnergeFieldForOverlap",value:function(){for(var t in this.catEnergyField)for(var e in this.catNotGroup[t])for(var i in this.catNotGroup[t][e]){e=parseInt(e),i=parseInt(i);var a=Math.ceil(i/xt),r=Math.ceil(e/xt),n=i+this.catEnergyField[t].x,s=e+this.catEnergyField[t].y,h=this.catEnergyField[t].gfield[e][i],o=h,l=!1,d=this.catEnergyField[t].gpointIndexMap[e][i],c=this.catEnergyField[t].gedgeIndexMap[e][i],g=void 0;if((-1!=c||-1!=d)&&(c>-1&&(g=this.pointData[c].multicat?this.pointData[c].catArray:[this.pointData[c].cat]),d>-1&&(g=this.pointData[d].multicat?this.pointData[d].catArray:[this.pointData[d].cat]),3!=this.catEnergyField[t].gbarrierMap[e][i]&&4!=this.catEnergyField[t].gbarrierMap[e][i]||(l=!0),l&&0==this.catEnergyField[t].gfield[e][i]&&(h=1,this.catEnergyField[t].gfield[e][i]=1,this.catEnergyField[t].field[r][a]=1),0!=h)){for(var u in this.catEnergyField)if(u!=t&&u!=t&&n<this.catEnergyField[u].x+this.catEnergyField[u].gwidth&&n>this.catEnergyField[u].x&&s<this.catEnergyField[u].y+this.catEnergyField[u].gheight&&s>this.catEnergyField[u].y){var p=Math.floor(n-this.catEnergyField[u].x),y=Math.floor(s-this.catEnergyField[u].y),f=this.catEnergyField[u].gfield[y][p],x=!1,v=this.catEnergyField[u].gpointIndexMap[y][p],m=this.catEnergyField[u].gedgeIndexMap[y][p],E=void 0;if(-1==v&&-1==m)continue;if(m>-1&&(E=this.pointData[m].multicat?this.pointData[m].catArray:[this.pointData[m].cat]),v>-1&&(E=this.pointData[v].multicat?this.pointData[v].catArray:[this.pointData[v].cat]),this.isContained(E,t))continue;if(this.isContained(g,u)&&3!=this.catEnergyField[u].gpointBarrierMap[y][p])continue;if(3!=this.catEnergyField[u].gbarrierMap[y][p]&&4!=this.catEnergyField[u].gbarrierMap[y][p]||(x=!0),0==f)continue;if(l||x)if(l&&!x)o=h;else{if(!l&&x){o=0;break}l&&x&&(o=4==this.catEnergyField[t].gbarrierMap[e][i]?h:0)}else{if(f>h){o=0;break}o=h}}this.catEnergyField[t].finalField[r][a]=o,4==this.catEnergyField[t].barrierMap[r][a]&&(this.catEnergyField[t].finalField[r][a]=1e4)}}}},{key:"updateEnergyPoints",value:function(){for(var t in this.updatedEnergyPoints)for(var e=0;e<this.updatedEnergyPoints[t].length;e++){var i=this.updatedEnergyPoints[t][e][0],a=this.updatedEnergyPoints[t][e][1],r=i*xt+this.catEnergyField[t].x,n=a*xt+this.catEnergyField[t].y,s=this.catEnergyField[t].field[a][i],h=s,o=!1;if(0!=s&&(3!=this.catEnergyField[t].barrierMap[a][i]&&4!=this.catEnergyField[t].barrierMap[a][i]||(o=!0),o&&0==this.catEnergyField[t].field[a][i]&&(s=1,this.catEnergyField[t].field[a][i]=1),0!=s)){for(var l in this.catEnergyField)if(l!=t&&l!=t&&r<this.catEnergyField[l].boundingX+this.catEnergyField[l].boundingWidth*xt&&r>this.catEnergyField[l].boundingX&&n<this.catEnergyField[l].boundingY+this.catEnergyField[l].boundingHeight*xt&&n>this.catEnergyField[l].boundingY){var d=Math.floor((r-this.catEnergyField[l].x)/xt),c=Math.floor((n-this.catEnergyField[l].y)/xt),g=this.catEnergyField[l].field[c][d],u=!1;if(1!=this.catEnergyField[l].pointBarrierMap[c][d]&&3!=this.catEnergyField[l].pointBarrierMap[c][d]||(u=!0),0==g)continue;if(o||u)if(o&&!u)h=s;else{if(!o&&u){h=0;break}o&&u&&(h=4==this.catEnergyField[t].barrierMap[a][i]?s:0)}else{if(g>s){h=0;break}h=s}}this.catEnergyField[t].finalField[a][i]=h}}}},{key:"calFinalEnergeField_Part",value:function(){for(var t in this.updateIdx=new Set(this.updateIdx),this.catEnergyField){var e,i=Object(P.a)(this.updateIdx);try{for(i.s();!(e=i.n()).done;){var a=e.value,r=parseInt(a[1]),n=parseInt(a[0]),s=parseInt((r-this.catEnergyField[t].x)/xt),h=parseInt((n-this.catEnergyField[t].y)/xt);s=Math.min(s,this.catEnergyField[t].width-1),h=Math.min(h,this.catEnergyField[t].height-1),s=Math.max(s,0),h=Math.max(h,0);var o=this.catEnergyField[t].field[h][s],l=o,d=!1,c=this.catEnergyField[t].pointIndexMap[h][s],g=this.catEnergyField[t].edgeIndexMap[h][s],u=void 0;if((-1!=g||-1!=c)&&(g>-1&&(u=this.pointData[g].multicat?this.pointData[g].catArray:[this.pointData[g].cat]),c>-1&&(u=this.pointData[c].multicat?this.pointData[c].catArray:[this.pointData[c].cat]),3!=this.catEnergyField[t].barrierMap[h][s]&&4!=this.catEnergyField[t].barrierMap[h][s]||(d=!0),d&&this.catEnergyField[t].field[h][s]<=.015&&1!=this.catEnergyField[t].subUpdate[h][s]&&(o=1,this.catEnergyField[t].edgeIndexMap[h][s]=this.edges[g].start,this.catEnergyField[t].edgeIndexMap2[h][s].push({start:this.edges[g].start,end:this.edges[g].end}),this.catEnergyField[t].field[h][s]=1),0!=o)){for(var p in this.catEnergyField)if(p!=t&&p!=t&&r<this.catEnergyField[p].boundingX+this.catEnergyField[p].boundingWidth*xt&&r>this.catEnergyField[p].boundingX&&n<this.catEnergyField[p].boundingY+this.catEnergyField[p].boundingHeight*xt&&n>this.catEnergyField[p].boundingY){var y=Math.floor((r-this.catEnergyField[p].x)/xt),f=Math.floor((n-this.catEnergyField[p].y)/xt),x=this.catEnergyField[p].field[f][y],v=!1,m=this.catEnergyField[p].pointIndexMap[f][y],E=this.catEnergyField[p].edgeIndexMap[f][y],D=void 0;if(-1==m&&-1==E)continue;if(E>-1&&(D=this.pointData[E].multicat?this.pointData[E].catArray:[this.pointData[E].cat]),m>-1&&(D=this.pointData[m].multicat?this.pointData[m].catArray:[this.pointData[m].cat]),this.isContained(D,t))continue;if(this.isContained(u,p)&&3!=this.catEnergyField[p].pointBarrierMap[f][y])continue;if(3!=this.catEnergyField[p].barrierMap[f][y]&&4!=this.catEnergyField[p].barrierMap[f][y]||(v=!0),0==x)continue;if(d||v)if(d&&!v)l=o;else{if(!d&&v){l=0;break}d&&v&&(l=4==this.catEnergyField[t].barrierMap[h][s]?o:0)}else{if(x>o){l=0;break}l=o}}this.catEnergyField[t].finalField[h][s]=l,4==this.catEnergyField[t].barrierMap[h][s]&&1!=this.catEnergyField[t].subUpdate[h][s]&&(this.catEnergyField[t].finalField[h][s]=1e4)}}}catch(b){i.e(b)}finally{i.f()}}}},{key:"calFinalEnergeField",value:function(){for(var t in this.catEnergyField)for(var e=parseInt((this.catEnergyField[t].boundingY-this.catEnergyField[t].y)/xt),i=parseInt((this.catEnergyField[t].boundingX-this.catEnergyField[t].x)/xt),a=parseInt((this.catEnergyField[t].boundingHeight*xt+this.catEnergyField[t].boundingY-this.catEnergyField[t].y)/xt),r=parseInt((this.catEnergyField[t].boundingWidth*xt+this.catEnergyField[t].boundingX-this.catEnergyField[t].x)/xt),n=e;n<a;n++)for(var s=i;s<r;s++){var h=s*xt+this.catEnergyField[t].x,o=n*xt+this.catEnergyField[t].y,l=this.catEnergyField[t].field[n][s],d=l,c=!1,g=this.catEnergyField[t].pointIndexMap[n][s],u=this.catEnergyField[t].edgeIndexMap[n][s],p=void 0;if((-1!=u||-1!=g)&&(u>-1&&(p=this.pointData[u].multicat?this.pointData[u].catArray:[this.pointData[u].cat]),g>-1&&(p=this.pointData[g].multicat?this.pointData[g].catArray:[this.pointData[g].cat]),3!=this.catEnergyField[t].barrierMap[n][s]&&4!=this.catEnergyField[t].barrierMap[n][s]||(c=!0),c&&0==this.catEnergyField[t].field[n][s]&&(this.catEnergyField[t].edgeIndexMap[n][s]=this.edges[u].start,this.catEnergyField[t].edgeIndexMap2[n][s].push({start:this.edges[u].start,end:this.edges[u].end}),l=1,this.catEnergyField[t].field[n][s]=1),0!=l)){for(var y in this.catEnergyField)if(y!=t&&y!=t&&h<=this.catEnergyField[y].boundingX+this.catEnergyField[y].boundingWidth*xt&&h>=this.catEnergyField[y].boundingX&&o<=this.catEnergyField[y].boundingY+this.catEnergyField[y].boundingHeight*xt&&o>=this.catEnergyField[y].boundingY){var f=Math.floor((h-this.catEnergyField[y].x)/xt),x=Math.floor((o-this.catEnergyField[y].y)/xt),v=this.catEnergyField[y].field[x][f],m=!1,E=this.catEnergyField[y].pointIndexMap[x][f],D=this.catEnergyField[y].edgeIndexMap[x][f],b=void 0;if(-1==E&&-1==D)continue;if(D>-1&&(b=this.pointData[D].multicat?this.pointData[D].catArray:[this.pointData[D].cat]),E>-1&&(b=this.pointData[E].multicat?this.pointData[E].catArray:[this.pointData[E].cat]),this.isContained(b,t))continue;if(this.isContained(p,y)&&3!=this.catEnergyField[y].pointBarrierMap[x][f])continue;if(3!=this.catEnergyField[y].barrierMap[x][f]&&4!=this.catEnergyField[y].barrierMap[x][f]||(m=!0),0==v)continue;if(c||m)if(c&&!m)d=l;else{if(!c&&m){d=0;break}c&&m&&(d=4==this.catEnergyField[t].barrierMap[n][s]?l:0)}else{if(v>l){d=0;break}d=l}}this.catEnergyField[t].finalField[n][s]=d,4==this.catEnergyField[t].barrierMap[n][s]&&(this.catEnergyField[t].finalField[n][s]=1e4)}}}},{key:"recalFinalEnergeField",value:function(t){var e={};for(var i in this.catEnergyField)e[i]={minX:Number.MAX_VALUE,minY:Number.MAX_VALUE,maxX:Number.MIN_VALUE,maxY:Number.MIN_VALUE};for(var a in this.catEnergyField)if(a!=t)for(var r=0;r<this.updatedEnergyPoints[t].length;r++){var n=this.updatedEnergyPoints[t][r][0]*xt+this.catEnergyField[t].x,s=this.updatedEnergyPoints[t][r][1]*xt+this.catEnergyField[t].y,h=parseInt((n-this.catEnergyField[a].x)/xt),o=parseInt((s-this.catEnergyField[a].y)/xt);e[a].minX=Math.min(e[a].minX,h),e[a].minY=Math.min(e[a].minY,o),e[a].maxX=Math.max(e[a].maxX,h),e[a].maxY=Math.max(e[a].maxY,o);var l=this.catEnergyField[a].field[o][h],d=l,c=!1,g=this.catEnergyField[a].pointIndexMap[o][h],u=this.catEnergyField[a].edgeIndexMap[o][h],p=void 0;if((-1!=u||-1!=g)&&(u>-1&&(p=this.pointData[u].multicat?this.pointData[u].catArray:[this.pointData[u].cat]),g>-1&&(p=this.pointData[g].multicat?this.pointData[g].catArray:[this.pointData[g].cat]),3!=this.catEnergyField[a].barrierMap[o][h]&&4!=this.catEnergyField[a].barrierMap[o][h]||(c=!0),c&&0==this.catEnergyField[a].field[o][h]&&(this.catEnergyField[a].edgeIndexMap[o][h]=this.edges[u].start,this.catEnergyField[a].edgeIndexMap2[o][h].push({start:this.edges[u].start,end:this.edges[u].end}),l=1,this.catEnergyField[a].field[o][h]=1),0!=l)){for(var y in this.catEnergyField)if(y!=a&&y!=t&&n<=this.catEnergyField[y].boundingX+this.catEnergyField[y].boundingWidth*xt&&n>=this.catEnergyField[y].boundingX&&s<=this.catEnergyField[y].boundingY+this.catEnergyField[y].boundingHeight*xt&&s>=this.catEnergyField[y].boundingY){var f=Math.floor((n-this.catEnergyField[y].x)/xt),x=Math.floor((s-this.catEnergyField[y].y)/xt),v=this.catEnergyField[y].field[x][f],m=!1,E=this.catEnergyField[y].pointIndexMap[x][f],D=this.catEnergyField[y].edgeIndexMap[x][f],b=void 0;if(-1==E&&-1==D)continue;if(D>-1&&(b=this.pointData[D].multicat?this.pointData[D].catArray:[this.pointData[D].cat]),E>-1&&(b=this.pointData[E].multicat?this.pointData[E].catArray:[this.pointData[E].cat]),this.isContained(b,a))continue;if(this.isContained(p,y)&&3!=this.catEnergyField[y].pointBarrierMap[x][f])continue;if(3!=this.catEnergyField[y].barrierMap[x][f]&&4!=this.catEnergyField[y].barrierMap[x][f]||(m=!0),0==v)continue;if(c||m)if(c&&!m)d=l;else{if(!c&&m){d=0;break}c&&m&&(d=4==this.catEnergyField[a].barrierMap[o][h]?l:0)}else{if(v>l){d=0;break}d=l}}this.catEnergyField[a].finalField[o][h]=d,4==this.catEnergyField[a].barrierMap[o][h]&&(this.catEnergyField[a].finalField[o][h]=1e4)}}this.smoothEnergyField(e)}},{key:"updateFinalField",value:function(t,e,i){for(var a=parseInt(t),r=Et[e].length,n=[],s=Number.MAX_VALUE,h=Number.MIN_VALUE,o=-1;o<=1;o++)n.push({x:Et[e][(a+o)%r][0],y:Et[e][(a+o)%r][1]}),s=Math.min(s,Et[e][(a+o)%r][1]),h=Math.max(h,Et[e][(a+o)%r][1]);for(var l=[],d=0;d<3;d++){var c=n[d],g=n[(d+1)%3],u={};u.y1=Math.min(c.y,g.y),u.y2=Math.max(c.y,g.y),c.y==g.y?(u.flag=!0,u.val1=Math.min(c.x,g.x),u.val2=Math.max(c.x,g.x)):(u.flag=!1,u.val1=(g.x-c.x)/(g.y-c.y),u.val2=(c.x*g.y-g.x*c.y)/(g.y-c.y)),l.push(u)}for(var p=s;p<h;p++){for(var y=Number.MAX_VALUE,f=Number.MIN_VALUE,x=!1,v=0;v<3;v++)if(p>=l[v].y1&&p<=l[v].y2){if(1==l[v].flag){y=l[v].val1,f=l[v].val2,x=!0;break}var m=l[v].val1*p+l[v].val2;y=Math.min(y,m),f=Math.max(f,m)}if(1!=x||0!=i){y=parseInt(y),f=parseInt(f);for(var E=y;E<=f;E++){var D=Math.min(parseInt((p-this.catEnergyField[e].y)/xt),this.catEnergyField[e].height),b=Math.min(parseInt((E-this.catEnergyField[e].x)/xt),this.catEnergyField[e].width);D=Math.max(D,0),b=Math.max(b,0),this.catEnergyField[e].field[parseInt(D)][parseInt(b)]=i,this.catEnergyField[e].finalField[parseInt(D)][parseInt(b)]=i,this.updatedEnergyPoints[e].push([parseInt(b),parseInt(D)])}}}}},{key:"drawEnergyField",value:function(t){nt=this.props.colorArray;for(var e=this.catEnergyField[t].finalField,i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++)if(!(e[i][a]<1e-4)){var r=a*xt+this.catEnergyField[t].x,n=i*xt+this.catEnergyField[t].y,s=e[i][a];H.append("rect").attr("x",r-.5).attr("y",n-.5).attr("width",1).attr("height",1).attr("class","energyfieldrect").attr("fill",(function(){return nt[parseInt(t)]})).attr("opacity",1).attr("fieldvalue",s).on("mouseover",(function(t){console.log(u.l(t.target).attr("fieldvalue"))}))}}},{key:"drawBarrierMap",value:function(){for(var t in this.catEnergyField)for(var e=this.catEnergyField[t].barrierMap,i=0;i<this.catEnergyField[t].height;i++)for(var a=0;a<this.catEnergyField[t].width;a++){var r=i+this.catEnergyField[t].y,n=a+this.catEnergyField[t].x;3==e[i][a]&&L(n,r,1,1,"red"),4==e[i][a]&&L(n,r,1,1,"green"),1==e[i][a]&&L(n,r,1,1,"yellow"),2==e[i][a]&&L(n,r,1,1,"orange")}}},{key:"drawBSpline",value:function(t,e){u.l("svg");for(var i=function(i){0==i&&console.log(t[i]),H.append("path").style("fill",e).style("stroke","none").style("opacity",.5).attr("d",(function(){var e="";return e+=u.f().x((function(t){return t[0]})).y((function(t){return t[1]}))(t[i])+""})).on("mouseover",(function(){u.l(this).style("stroke","red").style("stroke-width",3),console.log(i)})).on("mouseout",(function(){u.l(this).style("stroke",e).style("stroke-width",.5)}))},a=0;a<t.length;a++)i(a)}},{key:"drawBSplineV2",value:function(t,e){u.l("svg");H.append("path").style("fill",e).style("stroke","none").style("opacity",.5).attr("d",(function(){var e="";return e+=u.f().x((function(t){return t[0]})).y((function(t){return t[1]}))(t)+""})).on("mouseover",(function(){u.l(this).style("stroke","red").style("stroke-width",3)})).on("mouseout",(function(){u.l(this).style("stroke",e).style("stroke-width",.5)}))}},{key:"fillPolygonForEdge",value:function(t,e,i,a){for(var r=t.length,n=Number.MIN_VALUE,s=Number.MAX_VALUE,h=Number.MIN_VALUE,o=Number.MAX_VALUE,l={},d=0;d<r;d++){var c=t[d][0],g=t[d][1],u=t[(d+1)%r][0],p=t[(d+1)%r][1];if(n=Math.max(n,g),s=Math.min(s,g),h=Math.max(h,c),o=Math.min(o,c),parseInt(g)!=parseInt(p)){var y=void 0;y=g>p?u:c;var f=parseInt(Math.min(g,p));l.hasOwnProperty(f)||(l[f]=[]),l[f].push({x:y,dx:(u-c)/(p-g),ymax:Math.max(g,p)})}}for(var x=[],v=s;v<n;v++){var m=parseInt(v);if(l.hasOwnProperty(m))for(var E=0;E<l[m].length;E++)x.push(l[m][E]);x.sort((function(t,e){return Math.abs(t.x-e.x)>Ft?t.x<e.x:Math.abs(t.dx-e.dx)>Ft?t.dx<e.dx:t.ymax<e.ymax}));var D=x.length;if(0==D);else if(D<=1){var b=Math.ceil((x[0].x-this.catEnergyField[e].x)/xt),F=Math.ceil((v-this.catEnergyField[e].y)/xt);b=Math.min(b,this.catEnergyField[e].width-2),b=Math.max(b,0),F=Math.min(F,this.catEnergyField[e].height-2),F=Math.max(F,0),b=parseInt(b),F=parseInt(F);var M=b*xt+this.catEnergyField[e].x,k=F*xt+this.catEnergyField[e].y,w=Math.floor((M-this.catEnergyField[a].x)/xt),I=Math.floor((k-this.catEnergyField[a].y)/xt);w>0&&w<this.catEnergyField[a].width&&I>0&&I<this.catEnergyField[a].height&&0==this.catEnergyField[e].finalField[F][b]&&this.catEnergyField[e].edgeBarrierMap[F][b]>0&&(i[e][F][b]=this.catEnergyField[e].field[F][b])}else for(var P=[],A=0;A<D;A++){var C={};if(C.x=x[A].x,C.y=x[A].ymax,parseInt(C.y)!=parseInt(v))if(0==P.length)P.push(C);else if(1==P.length){var N=P[0];if(Math.abs(C.x-N.x)<Ft?C.y>v&&N.y>v&&P.push(C):P.push(C),2==P.length){var S=P.shift().x,B=P.shift().x,_=Math.min(S,B),O=Math.max(S,B);for(_=Math.max(_,o),O=Math.min(O,h);_<O;){var j=Math.ceil((_-this.catEnergyField[e].x)/xt),V=Math.ceil((v-this.catEnergyField[e].y)/xt);j=Math.min(j,this.catEnergyField[e].width-2),j=Math.max(j,0),V=Math.min(V,this.catEnergyField[e].height-2),V=Math.max(V,0),j=parseInt(j),V=parseInt(V);var L=j*xt+this.catEnergyField[e].x,X=V*xt+this.catEnergyField[e].y,G=Math.floor((L-this.catEnergyField[a].x)/xt),Y=Math.floor((X-this.catEnergyField[a].y)/xt);G>0&&G<this.catEnergyField[a].width&&Y>0&&Y<this.catEnergyField[a].height&&0==this.catEnergyField[e].finalField[V][j]&&this.catEnergyField[e].edgeBarrierMap[V][j]>0&&(i[e][V][j]=this.catEnergyField[e].field[V][j]),_++}}}}for(var U=D-1;U>=0;U--)x[U].x+=x[U].dx,x[U].ymax<=v&&x.splice(U,1)}}},{key:"fillPolygon",value:function(t,e,i){for(var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=t.length,n=Number.MIN_VALUE,s=Number.MAX_VALUE,h=Number.MIN_VALUE,o=Number.MAX_VALUE,l={},d=0;d<r;d++){var c=t[d][0],g=t[d][1],u=t[(d+1)%r][0],p=t[(d+1)%r][1];if(n=Math.max(n,g),s=Math.min(s,g),h=Math.max(h,c),o=Math.min(o,c),parseInt(g)!=parseInt(p)){var y=void 0;y=g>p?u:c;var f=parseInt(Math.min(g,p));l.hasOwnProperty(f)||(l[f]=[]),l[f].push({x:y,dx:(u-c)/(p-g),ymax:Math.max(g,p)})}}for(var x=[],v=s;v<n;v++){var m=parseInt(v);if(l.hasOwnProperty(m))for(var E=0;E<l[m].length;E++)x.push(l[m][E]);x.sort((function(t,e){return Math.abs(t.x-e.x)>Ft?t.x<e.x:Math.abs(t.dx-e.dx)>Ft?t.dx<e.dx:t.ymax<e.ymax}));var D=x.length;if(0==D);else if(D<=1){var b=Math.ceil((x[0].x-this.catEnergyField[e].x)/xt),F=Math.ceil((v-this.catEnergyField[e].y)/xt);b=Math.min(b,this.catEnergyField[e].width-2),b=Math.max(b,0),F=Math.min(F,this.catEnergyField[e].height-2),F=Math.max(F,0),b=parseInt(b),F=parseInt(F),this.catEnergyField[e].finalField[F][b]=i,a||(this.catEnergyField[e].field[F][b]=i),this.updatedEnergyPoints[e].push([b,F])}else for(var M=[],k=0;k<D;k++){var w={};if(w.x=x[k].x,w.y=x[k].ymax,parseInt(w.y)!=parseInt(v))if(0==M.length)M.push(w);else if(1==M.length){var I=M[0];if(Math.abs(w.x-I.x)<Ft?w.y>v&&I.y>v&&M.push(w):M.push(w),2==M.length){var P=M.shift().x,A=M.shift().x,C=Math.min(P,A),N=Math.max(P,A);for(C=Math.max(C,o),N=Math.min(N,h);C<N;){var S=Math.ceil((C-this.catEnergyField[e].x)/xt),B=Math.ceil((v-this.catEnergyField[e].y)/xt);S=Math.min(S,this.catEnergyField[e].width-2),S=Math.max(S,0),B=Math.min(B,this.catEnergyField[e].height-2),B=Math.max(B,0),S=parseInt(S),B=parseInt(B),this.catEnergyField[e].finalField[B][S]=i,a||(this.catEnergyField[e].field[B][S]=i),this.updatedEnergyPoints[e].push([S,B]),C++}}}}for(var _=D-1;_>=0;_--)x[_].x+=x[_].dx,x[_].ymax<=v&&x.splice(_,1)}}},{key:"drawISOLinesV2",value:function(t,e,i){for(var a=0;a<4;a++)u.l("#bounding"+t.toString()+a.toString()).remove();for(var r=0;r<Et[t].length;r++)for(var n=0;n<Et[t][r].length;n++)u.l("#circle"+t.toString()+"i"+r.toString()+"i"+n.toString()).remove();for(var s in Et)s!=t&&u.l("#path"+s).attr("fill-opacity",.5);var h;bt[t]=!1,e.editMode=!1,nt=this.props.colorArray,Nt[t]=[];var o=[],l=e.catEnergyField[t].boundingX,d=e.catEnergyField[t].boundingY,c=e.catEnergyField[t].boundingX+e.catEnergyField[t].boundingWidth*xt-5*xt,g=e.catEnergyField[t].boundingY+e.catEnergyField[t].boundingHeight*xt-5*xt;function p(){var e=!1;if(u.l(this)._groups[0][0].attributes.hasOwnProperty("id")&&(e=!0),0!=e){var i=u.l(this)._groups[0][0].attributes.id.value,a=parseInt(i[6]);if(a>=0&&a<=9){for(var r="",n="",s=7;s<i.length;s++)if("i"==i[s]){for(s++;"i"!=i[s];)r+=i[s++];for(s++;s<i.length;)n+=i[s++];break}r=parseInt(r),n=parseInt(n),h=Et[t][r].length,wt=[];for(var o=0;o<Et[t].length;o++){wt[o]=[];for(var l=0;l<Et[t][o].length;l++)wt[o].push([Et[t][o][l][0],Et[t][o][l][1]])}[].push(n),0;var d=[];d[0]=Et[t][r][n][0],d[1]=Et[t][r][n][1];var c=[];c[0]=Et[t][r][(n+1)%h][0],c[1]=Et[t][r][(n+1)%h][1],(Mt=[]).push(d),Mt.push(c)}}}function y(i){var a=!1;if(i.sourceEvent.target.attributes.hasOwnProperty("id")&&(a=!0),0!=a){var r=i.sourceEvent.target.attributes.id.value.toString(),n=parseInt(r[6]),s=i.x,o=i.y;if(s=Math.min(s,c),s=Math.max(s,l),o=Math.min(o,g),o=Math.max(o,d),u.l(this).attr("cx",s).attr("cy",o),n>=0&&n<=9){for(var p="",y="",f=7;f<r.length;f++)if("i"==r[f]){for(f++;"i"!=r[f];)p+=r[f++];for(f++;f<r.length;)y+=r[f++];break}if(p=parseInt(p),y=parseInt(y),console.log("dragged control point"),console.log("("+p+", "+y+")"),!Et[t].hasOwnProperty(p))return;h=Et[t][p].length,Et[t][p][y][0]=s,Et[t][p][y][1]=o;for(var x="",v=0;v<Et[t].length;v++)if(v==p){var m=Et[t][v].length,E=[],D=(y-1+m)%m;Nt[t].push(D),Nt[t].sort((function(t,e){return t-e}));for(var b={},F=0;F<Nt[t].length;F++)b[Nt[t][F]]=1;var M=void 0;M=Nt[t].length>0?Nt[t][0]:0;for(var k=0;k<m;k++){var w=(M+k)%m;if(b.hasOwnProperty(w)){var I=[];I.push([Et[t][v][(w-1+m)%m][0],Et[t][v][(w-1+m)%m][1]]),I.push([Et[t][v][w][0],Et[t][v][w][1]]),I.push([Et[t][v][(w+1)%m][0],Et[t][v][(w+1)%m][1]]),I.push([Et[t][v][(w+2)%m][0],Et[t][v][(w+2)%m][1]]),I.push([Et[t][v][(w+3)%m][0],Et[t][v][(w+2)%m][1]]);var P=[Et[t][v][w][0],Et[t][v][w][1]],A=[Et[t][v][(w+2)%m][0],Et[t][v][(w+2)%m][1]];u.l("svg").append("path").attr("id","temp_path").attr("d",Bt(I)).attr("fill","none");for(var C=u.l("#temp_path").node(),N=C.getTotalLength(),S=0,B=Number.MAX_VALUE,O=N/5,j=Number.MAX_VALUE,V=0;V<=N/5;V++){var L=C.getPointAtLength(5*V),X=_(P[0],P[1],L.x,L.y),G=_(A[0],A[1],L.x,L.y);X<B&&(S=V,B=X),G<j&&(O=V,j=G)}for(var Y=S;Y<=O;Y++){var U=C.getPointAtLength(5*Y);E.push([U.x,U.y])}u.l("#temp_path").remove(),k++}else E.push([Et[t][v][w][0],Et[t][v][w][1]])}x+=St(E)}else x+=St(Et[t][v]);e.reDraw(t,e,x)}}}function f(){var i=!1;if(u.l(this)._groups[0][0].attributes.hasOwnProperty("id")&&(i=!0),0!=i){var a=u.l(this)._groups[0][0].attributes.id.value,r=parseInt(a[6]);if(r>=0&&r<=9){for(var n="",s="",h=7;h<a.length;h++)if("i"==a[h]){for(h++;"i"!=a[h];)n+=a[h++];for(h++;h<a.length;)s+=a[h++];break}n=parseInt(n),s=parseInt(s);var o=[],l=Et[t][n].length;o.push([Et[t][n][(s+l-1)%l][0],Et[t][n][(s+l-1)%l][1]]),o.push([wt[n][s][0],wt[n][s][1]]),o.push([Et[t][n][(s+1)%l][0],Et[t][n][(s+1)%l][1]]),o.push([Et[t][n][s][0],Et[t][n][s][1]]);var d=Et[t][n][s];Mt.push(d);var c=[Mt[1][0]-Mt[0][0],Mt[1][1]-Mt[0][1]],g=[Mt[2][0]-Mt[0][0],Mt[2][1]-Mt[0][1]],p=0;c[0]*g[1]-g[0]*c[1]<=0?0==n&&(p=10):n>0&&(p=10),e.fillPolygon(o,t,p)}}}o.push({x:l,y:d}),o.push({x:c,y:d}),o.push({x:c,y:g}),o.push({x:l,y:g}),H.append("path").attr("id","path"+t).attr("d",i).attr("fill",nt[t]).attr("fill-opacity",.5).attr("fill-rule","evenodd").style("stroke",nt[t]).style("stroke-width",1).on("mouseover",(function(){e.editMode||u.l(this).style("stroke","red").style("stroke-width",3)})).on("mouseout",(function(){e.editMode||u.l(this).style("stroke",nt[t]).style("stroke-width",1)})).on("mousedown",(function(i){if(2==i.button)if(console.log("click!"),0!=bt[t]||e.editMode){if(e.editMode&&bt[t]){for(var a=0;a<4;a++)u.l("#bounding"+t.toString()+a.toString()).remove();for(var r=0;r<Et[t].length;r++)for(var n=0;n<Et[t][r].length;n++)u.l("#circle"+t.toString()+"i"+r.toString()+"i"+n.toString()).remove();for(var s in Et)s!=t&&u.l("#path"+s).attr("fill-opacity",.5);bt[t]=!1,e.editMode=!1}}else{e.editMode=!0;for(var h=0;h<4;h++)H.append("line").attr("id","bounding"+t.toString()+h.toString()).attr("x1",o[h].x).attr("y1",o[h].y).attr("x2",o[(h+1)%4].x).attr("y2",o[(h+1)%4].y).attr("stroke","red").attr("stroke-width","1px");for(var l in Et)l!=t&&u.l("#path"+l).attr("fill-opacity",.2);for(var d=0;d<Et[t].length;d++)for(var c=0;c<Et[t][d].length;c++)H.append("circle").attr("id","circle"+t.toString()+"i"+d.toString()+"i"+c.toString()).attr("cx",Et[t][d][c][0]).attr("cy",Et[t][d][c][1]).attr("r",3).attr("fill","red").attr("fill-opacity",.5).on("mouseover",(function(){u.l(this).attr("stroke","red").attr("stroke-width",2)})).on("mouseout",(function(){u.l(this).attr("stroke","none").attr("stroke-width",1)})).call(u.e().on("start",p).on("drag",y).on("end",f));bt[t]=!0}}))}},{key:"reDraw",value:function(t,e,i){nt=this.props.colorArray;var a=Et[t].length,r=[],n=e.catEnergyField[t].boundingX,s=e.catEnergyField[t].boundingY,h=e.catEnergyField[t].boundingX+e.catEnergyField[t].boundingWidth*xt-5*xt,o=e.catEnergyField[t].boundingY+e.catEnergyField[t].boundingHeight*xt-5*xt;function l(){var e=!1;if(u.l(this)._groups[0][0].attributes.hasOwnProperty("id")&&(e=!0),0!=e){var i=u.l(this)._groups[0][0].attributes.id.value,r=parseInt(i[6]);if(r>=0&&r<=9){for(var n="",s="",h=7;h<i.length;h++)if("i"==i[h]){for(h++;"i"!=i[h];)n+=i[h++];for(h++;h<i.length;)s+=i[h++];break}n=parseInt(n),s=parseInt(s),a=Et[t][n].length,wt=[];for(var o=0;o<Et[t].length;o++){wt[o]=[];for(var l=0;l<Et[t][o].length;l++)wt[o].push([Et[t][o][l][0],Et[t][o][l][1]])}[].push(s),0;var d=[];d[0]=Et[t][n][s][0],d[1]=Et[t][n][s][1];var c=[];c[0]=Et[t][n][(s+1)%a][0],c[1]=Et[t][n][(s+1)%a][1],(Mt=[]).push(d),Mt.push(c)}}}function d(i){var r=!1;if(i.sourceEvent.target.attributes.hasOwnProperty("id")&&(r=!0),0!=r){var l=i.sourceEvent.target.attributes.id.value.toString(),d=parseInt(l[6]),c=i.x,g=i.y;if(c=Math.min(c,h),c=Math.max(c,n),g=Math.min(g,o),g=Math.max(g,s),u.l(this).attr("cx",c).attr("cy",g),d>=0&&d<=9){for(var p="",y="",f=7;f<l.length;f++)if("i"==l[f]){for(f++;"i"!=l[f];)p+=l[f++];for(f++;f<l.length;)y+=l[f++];break}if(p=parseInt(p),y=parseInt(y),console.log("dragged control point"),console.log("("+p+", "+y+")"),!Et[t].hasOwnProperty(p))return;a=Et[t][p].length,Et[t][p][y][0]=c,Et[t][p][y][1]=g;for(var x="",v=0;v<Et[t].length;v++)if(v==p){var m=Et[t][v].length,E=[],D=(y-1+m)%m;Nt[t].push(D),Nt[t].sort((function(t,e){return t-e}));for(var b={},F=0;F<Nt[t].length;F++)b[Nt[t][F]]=1;var M=void 0;M=Nt[t].length>0?Nt[t][0]:0;for(var k=0;k<m;k++){var w=(M+k)%m;if(b.hasOwnProperty(w)){var I=[];I.push([Et[t][v][w][0],Et[t][v][w][1]]),I.push([Et[t][v][(w+1)%m][0],Et[t][v][(w+1)%m][1]]),I.push([Et[t][v][(w+2)%m][0],Et[t][v][(w+2)%m][1]]),u.l("svg").append("path").attr("id","temp_path").attr("d",Bt(I)).attr("fill","none");for(var P=u.l("#temp_path").node(),A=P.getTotalLength(),C=0;C<=A/5;C++){var N=P.getPointAtLength(5*C);E.push([N.x,N.y])}u.l("#temp_path").remove(),k++}else E.push([Et[t][v][w][0],Et[t][v][w][1]])}x+=St(E)}else x+=St(Et[t][v]);e.reDraw(t,e,x)}}}function c(){var i=!1;if(u.l(this)._groups[0][0].attributes.hasOwnProperty("id")&&(i=!0),0!=i){var a=u.l(this)._groups[0][0].attributes.id.value,r=parseInt(a[6]);if(r>=0&&r<=9){for(var n="",s="",h=7;h<a.length;h++)if("i"==a[h]){for(h++;"i"!=a[h];)n+=a[h++];for(h++;h<a.length;)s+=a[h++];break}n=parseInt(n),s=parseInt(s);var o=[],l=Et[t][n].length;o.push([Et[t][n][(s+l-1)%l][0],Et[t][n][(s+l-1)%l][1]]),o.push([wt[n][s][0],wt[n][s][1]]),o.push([Et[t][n][(s+1)%l][0],Et[t][n][(s+1)%l][1]]),o.push([Et[t][n][s][0],Et[t][n][s][1]]);var d=Et[t][n][s];Mt.push(d);var c=[Mt[1][0]-Mt[0][0],Mt[1][1]-Mt[0][1]],g=[Mt[2][0]-Mt[0][0],Mt[2][1]-Mt[0][1]],p=0;c[0]*g[1]-g[0]*c[1]<=0?0==n&&(p=10):n>0&&(p=10),e.fillPolygon(o,t,p)}}}r.push({x:n,y:s}),r.push({x:h,y:s}),r.push({x:h,y:o}),r.push({x:n,y:o}),u.l("#path"+t).attr("id","path"+t).attr("d",i).attr("fill",nt[t]).attr("fill-opacity",.5).attr("fill-rule","evenodd").style("stroke",nt[t]).style("stroke-width",1).on("mouseover",(function(){e.editMode||u.l(this).style("stroke","red").style("stroke-width",3)})).on("mouseout",(function(){e.editMode||u.l(this).style("stroke",nt[t]).style("stroke-width",1)})).on("mousedown",(function(i){if(2==i.button)if(console.log("click!"),0!=bt[t]||e.editMode){if(e.editMode&&bt[t]){for(var a=0;a<4;a++)u.l("#bounding"+t.toString()+a.toString()).remove();for(var n=0;n<Et[t].length;n++)for(var s=0;s<Et[t][n].length;s++)u.l("#circle"+t.toString()+"i"+n.toString()+"i"+s.toString()).remove();for(var h in Et)h!=t&&u.l("#path"+h).attr("fill-opacity",.5);bt[t]=!1,e.editMode=!1}}else{e.editMode=!0;for(var o=0;o<4;o++)H.append("line").attr("id","bounding"+t.toString()+o.toString()).attr("x1",r[o].x).attr("y1",r[o].y).attr("x2",r[(o+1)%4].x).attr("y2",r[(o+1)%4].y).attr("stroke","red").attr("stroke-width","1px");for(var g in Et)g!=t&&u.l("#path"+g).attr("fill-opacity",.2);for(var p=0;p<Et[t].length;p++)for(var y=0;y<Et[t][p].length;y++)H.append("circle").attr("id","circle"+t.toString()+"i"+p.toString()+"i"+y.toString()).attr("cx",Et[t][p][y][0]).attr("cy",Et[t][p][y][1]).attr("r",3).attr("fill","red").attr("fill-opacity",.5).on("mouseover",(function(){u.l(this).attr("stroke","red").attr("stroke-width",2)})).on("mouseout",(function(){u.l(this).attr("stroke","none").attr("stroke-width",1)})).call(u.e().on("start",l).on("drag",d).on("end",c));bt[t]=!0}}))}},{key:"drawOutline",value:function(t,e){new Array;var i=u.f().x((function(t){return t[0]})).y((function(t){return t[1]})).curve(u.d)(t);H.append("path").attr("d",i).attr("fill-opacity",.5).attr("fill",e).attr("fill-rule","evenodd")}},{key:"drawISOLines",value:function(t,e,i,a,r){u.l("svg");for(var n=function(e){H.append("path").style("fill","none").style("stroke",r).style("stroke-width",.5).style("opacity",1).attr("d",(function(){var r="";return r+=u.f().x((function(t){return t[0]+i})).y((function(t){return t[1]+a}))(t[e])+""})).on("mouseover",(function(){u.l(this).style("stroke","red").style("stroke-width",3),console.log(e)})).on("mouseout",(function(){u.l(this).style("stroke","black").style("stroke-width",.5)}))},s=0;s<t.length;s++)n(s)}},{key:"calOneISOLine",value:function(t,e){var i=this.catEnergyField[e].finalField;return tt.isoLines(i,t,{polygons:!1,linearRing:!1,noFrame:!0})[0]}},{key:"calISOLine",value:function(t,e){var i={};for(var a in this.catEnergyField){var r,n=e[a];r=tt.isoLines(n,t,{polygons:!1,linearRing:!1,noFrame:!0}),i[a]=r[0]}return i}},{key:"BSplineInterpolate",value:function(t){for(var e=[],i=[],a=0;a<t.length;a++){if(t.length-a>5){if(a%5==0&&e.push(t[a]),a>0&&a%15==0){for(var r=new $(e,3),n=.01;n<=1;n+=.01){var s=r.calcAt(n);i.push(s)}(e=[]).push(t[a])}}else a%3==0&&e.push(t[a])}for(r=new $(e,3),n=.01;n<=1;n+=.01){s=r.calcAt(n);i.push(s)}return i}},{key:"normalizeKernel",value:function(t){for(var e=0,i=0;i<t.length;i++)for(var a=0;a<t.length;a++)e+=t[i][a];for(var r=0;r<t.length;r++)for(var n=0;n<t.length;n++)t[r][n]=t[r][n]/e;return t}},{key:"getGaussianKernel",value:function(t,e){for(var i=[],a=0;a<e;a++){i.push([]);for(var r=0;r<e;r++)i[a].push(0)}for(var n=parseInt(e/2)/1,s=1/(2*Math.PI*t*t),h=0;h<e;h++)for(var o=0;o<e;o++){var l=h/1,d=o/1,c=Math.pow(l-n,2),g=Math.pow(d-n,2);i[h][o]=s*Math.exp(-(g*g+c*c)/(2*t*t))}return i=this.normalizeKernel(i)}},{key:"checkSingularPoint",value:function(t,e,i){var a=this.catEnergyField[t].finalField,r=!0;return e+1<this.catEnergyField[t].width&&a[i][e+1]>0&&(r=!1),e-1>0&&a[i][e-1]>0&&(r=!1),i-1>0&&a[i-1][e]>0&&(r=!1),i+1<this.catEnergyField[t].height&&a[i+1][e]>0&&(r=!1),e+1<this.catEnergyField[t].width&&i-1>0&&a[i-1][e+1]>0&&(r=!1),e+1<this.catEnergyField[t].width&&i+1<this.catEnergyField[t].height&&a[i+1][e+1]>0&&(r=!1),e-1>0&&i-1>0&&a[i-1][e-1]>0&&(r=!1),e-1>0&&i+1<this.catEnergyField[t].height&&a[i+1][e-1]>0&&(r=!1),r}},{key:"fillCrossingEdge_Part",value:function(t){for(var e in this.catEnergyField)this.catEnergyField[e].edgeCrossingList=[];for(var i=0;i<t.length;i++){var a=t[i].cat,r=this.pointData[t[i].start],n=this.pointData[t[i].end],s=[];if(this.edges[i].virtrual&&t[i].virtrualNodes.length>0){s.push([{x:r.x,y:r.y},{x:t[i].virtrualNodes[0][0],y:t[i].virtrualNodes[0][1]}]);for(var h=0;h<t[i].virtrualNodes.length;h++)h+1<t[i].virtrualNodes.length&&s.push([{x:t[i].virtrualNodes[h][0],y:t[i].virtrualNodes[h][1]},{x:t[i].virtrualNodes[h+1][0],y:t[i].virtrualNodes[h+1][1]}]);var o=t[i].virtrualNodes.length;s.push([{x:t[i].virtrualNodes[o-1][0],y:t[i].virtrualNodes[o-1][1]},{x:n.x,y:n.y}])}else s.push([{x:r.x,y:r.y},{x:n.x,y:n.y}]);for(var l=0;l<this.edges.length;l++){var d=this.edges[l].cat;if(a!=d){var c=this.pointData[this.edges[l].start],g=this.pointData[this.edges[l].end],u=[];if(this.edges[l].virtrual&&this.edges[l].virtrualNodes.length>0){u.push([{x:c.x,y:c.y},{x:this.edges[l].virtrualNodes[0][0],y:this.edges[l].virtrualNodes[0][1]}]);for(var p=0;p<this.edges[l].virtrualNodes.length;p++)p+1<this.edges[l].virtrualNodes.length&&u.push([{x:this.edges[l].virtrualNodes[p][0],y:this.edges[l].virtrualNodes[p][1]},{x:this.edges[l].virtrualNodes[p+1][0],y:this.edges[l].virtrualNodes[p+1][1]}]);var y=this.edges[l].virtrualNodes.length;u.push([{x:this.edges[l].virtrualNodes[y-1][0],y:this.edges[l].virtrualNodes[y-1][1]},{x:g.x,y:g.y}])}else u.push([{x:c.x,y:c.y},{x:g.x,y:g.y}]);for(var f=0;f<s.length;f++)for(var x=s[f][0],v=s[f][1],m=0;m<u.length;m++){var E=u[m][0],D=u[m][1],b=this.checkEdgeCrossing(x,v,E,D);b[0]&&(this.catEnergyField[a].edgeCrossingList.push([b[1],i,l,s[f],u[m]]),this.catEnergyField[d].edgeCrossingList.push([b[1],l,i,u[m],s[f]]))}}}}var F={};for(var e in this.catEnergyField){F[e]=this.catEnergyField[e].finalField;for(var M=this.catEnergyField[e].edgeCrossingList,k=[],w=0;w<M.length;w++){k.push([]);for(var I=M[w][0],P=(M[w][1],M[w][2]),A=M[w][3],C=M[w][4],N=this.edges[P].cat,S=0,B=_(A[0].x,A[0].y,A[1].x,A[1].y),O=[A[1].x-A[0].x,A[1].y-A[0].y],V=[C[1].x-C[0].x,C[1].y-C[0].y],L=j(O),X=j(V),G=.5,Y=[],U=[],T=[],R=[],W=!1,q=!1,z=!1;S<lt&&!W;){for(var H=[I.x+S*X[0],I.y+S*X[1]],K=0,J=!1,Q=!1;K<B/2;){if(!J&&!W&&!q){var Z=[H[0]+L[0]*K,H[1]+L[1]*K],$=Math.floor((Z[0]-this.catEnergyField[e].x)/xt),tt=Math.floor((Z[1]-this.catEnergyField[e].y)/xt),et=Math.floor((Z[0]-this.catEnergyField[N].x)/xt),it=Math.floor((Z[1]-this.catEnergyField[N].y)/xt);if(et>0&&et<this.catEnergyField[N].width&&it>0&&it<this.catEnergyField[N].height&&3==this.catEnergyField[N].pointBarrierMap[it][et]){W=!0;break}$>0&&$<this.catEnergyField[e].width&&tt>0&&tt<this.catEnergyField[e].height&&this.catEnergyField[e].finalField[tt][$]>0&&(J=!0,4!=this.catEnergyField[e].edgeBarrierMap[tt][$]?0==T.length?(Y.push([$,tt]),T=[$,tt]):Math.abs(T[0]-$)<=5&&Math.abs(T[1]-tt)<=5?(T=[$,tt],Y.push([$,tt])):q=!0:Y.push([$,tt]))}if(!Q&&!W&&!z){var at=[H[0]-L[0]*K,H[1]-L[1]*K],rt=Math.floor((at[0]-this.catEnergyField[e].x)/xt),nt=Math.floor((at[1]-this.catEnergyField[e].y)/xt),st=Math.floor((at[0]-this.catEnergyField[N].x)/xt),ht=Math.floor((at[1]-this.catEnergyField[N].y)/xt);if(st>0&&st<this.catEnergyField[N].width&&ht>0&&ht<this.catEnergyField[N].height&&3==this.catEnergyField[N].pointBarrierMap[ht][st]){W=!0;break}rt>0&&rt<this.catEnergyField[e].width&&nt>0&&nt<this.catEnergyField[e].height&&this.catEnergyField[e].finalField[nt][rt]>0&&(Q=!0,4!=this.catEnergyField[e].edgeBarrierMap[nt][rt]?0==R.length?(U.push([rt,nt]),R=[rt,nt]):Math.abs(R[0]-rt)<=5&&Math.abs(R[1]-nt)<=5?(R=[rt,nt],U.push([rt,nt])):z=!0:U.push([rt,nt]))}if(J&&Q||q&&z)break;K+=G}S+=G}for(var ot=[[Math.floor((I.x-this.catEnergyField[e].x)/xt),Math.floor((I.y-this.catEnergyField[e].y)/xt)]],dt=0;dt<Y.length;dt++)ot.push(Y[dt]);for(var ct=U.length-1;ct>=0;ct--)ot.push(U[ct]);k[w].push(ot),Y=[],U=[],T=[],R=[];var gt=!1;for(q=!1,z=!1,S=0;S<lt&&!gt;){for(var ut=[I.x-S*X[0],I.y-S*X[1]],pt=0,yt=!1,ft=!1;pt<B/2;){if(!yt&&!gt&&!q){var vt=[ut[0]+L[0]*pt,ut[1]+L[1]*pt],mt=Math.floor((vt[0]-this.catEnergyField[e].x)/xt),Et=Math.floor((vt[1]-this.catEnergyField[e].y)/xt),Dt=Math.floor((vt[0]-this.catEnergyField[N].x)/xt),bt=Math.floor((vt[1]-this.catEnergyField[N].y)/xt);if(Dt>0&&Dt<this.catEnergyField[N].width&&bt>0&&bt<this.catEnergyField[N].height&&3==this.catEnergyField[N].pointBarrierMap[bt][Dt]){gt=!0;break}mt>0&&mt<this.catEnergyField[e].width&&Et>0&&Et<this.catEnergyField[e].height&&this.catEnergyField[e].finalField[Et][mt]>0&&(yt=!0,4!=this.catEnergyField[e].edgeBarrierMap[Et][mt]?0==T.length?(Y.push([mt,Et]),T=[mt,Et]):Math.abs(T[0]-mt)<=5&&Math.abs(T[1]-Et)<=5?(T=[mt,Et],Y.push([mt,Et])):q=!0:Y.push([mt,Et]))}if(!ft&&!gt&&!z){var Ft=[ut[0]-L[0]*pt,ut[1]-L[1]*pt],Mt=Math.floor((Ft[0]-this.catEnergyField[e].x)/xt),kt=Math.floor((Ft[1]-this.catEnergyField[e].y)/xt),wt=Math.floor((Ft[0]-this.catEnergyField[N].x)/xt),It=Math.floor((Ft[1]-this.catEnergyField[N].y)/xt);if(wt>0&&wt<this.catEnergyField[N].width&&It>0&&It<this.catEnergyField[N].height&&3==this.catEnergyField[N].pointBarrierMap[It][wt]){gt=!0;break}Mt>0&&Mt<this.catEnergyField[e].width&&kt>0&&kt<this.catEnergyField[e].height&&this.catEnergyField[e].finalField[kt][Mt]>0&&(ft=!0,4!=this.catEnergyField[e].edgeBarrierMap[kt][Mt]?0==R.length?(U.push([Mt,kt]),R=[Mt,kt]):Math.abs(R[0]-Mt)<=5&&Math.abs(R[1]-kt)<=5?(R=[Mt,kt],U.push([Mt,kt])):z=!0:U.push([Mt,kt]))}if(yt&&ft||q&&z)break;pt+=G}S+=G}ot=[[Math.floor((I.x-this.catEnergyField[e].x)/xt),Math.floor((I.y-this.catEnergyField[e].y)/xt)]];for(var Pt=0;Pt<Y.length;Pt++)ot.push(Y[Pt]);for(var At=U.length-1;At>=0;At--)ot.push(U[At]);k[w].push(ot)}for(var Ct=0;Ct<k.length;Ct++)for(var Nt=M[Ct][2],St=this.edges[Nt].cat,Bt=this.catEnergyField[e].x,_t=this.catEnergyField[e].y,Ot=0;Ot<k[Ct].length;Ot++){for(var jt=0;jt<k[Ct][Ot].length;jt++)k[Ct][Ot][jt][0]=k[Ct][Ot][jt][0]*xt+Bt,k[Ct][Ot][jt][1]=k[Ct][Ot][jt][1]*xt+_t;this.fillPolygonForEdge(k[Ct][Ot],e,F,St)}}for(var e in this.catEnergyField)this.catEnergyField[e].finalField=F[e]}},{key:"fillCrossingEdge",value:function(){for(var t in this.catEnergyField)this.catEnergyField[t].edgeCrossingList=[];for(var e=0;e<this.edges.length;e++){var i=this.edges[e].cat,a=this.pointData[this.edges[e].start],r=this.pointData[this.edges[e].end],n=[];if(this.edges[e].virtrual){n.push([{x:a.x,y:a.y},{x:this.edges[e].virtrualNodes[0][0],y:this.edges[e].virtrualNodes[0][1]}]);for(var s=0;s<this.edges[e].virtrualNodes.length;s++)s+1<this.edges[e].virtrualNodes.length&&n.push([{x:this.edges[e].virtrualNodes[s][0],y:this.edges[e].virtrualNodes[s][1]},{x:this.edges[e].virtrualNodes[s+1][0],y:this.edges[e].virtrualNodes[s+1][1]}]);var h=this.edges[e].virtrualNodes.length;n.push([{x:this.edges[e].virtrualNodes[h-1][0],y:this.edges[e].virtrualNodes[h-1][1]},{x:r.x,y:r.y}])}else n.push([{x:a.x,y:a.y},{x:r.x,y:r.y}]);for(var o=e+1;o<this.edges.length;o++){var l=this.edges[o].cat;if(i!=l){var d=this.pointData[this.edges[o].start],c=this.pointData[this.edges[o].end],g=[];if(this.edges[o].virtrual){g.push([{x:d.x,y:d.y},{x:this.edges[o].virtrualNodes[0][0],y:this.edges[o].virtrualNodes[0][1]}]);for(var u=0;u<this.edges[o].virtrualNodes.length;u++)u+1<this.edges[o].virtrualNodes.length&&g.push([{x:this.edges[o].virtrualNodes[u][0],y:this.edges[o].virtrualNodes[u][1]},{x:this.edges[o].virtrualNodes[u+1][0],y:this.edges[o].virtrualNodes[u+1][1]}]);var p=this.edges[o].virtrualNodes.length;g.push([{x:this.edges[o].virtrualNodes[p-1][0],y:this.edges[o].virtrualNodes[p-1][1]},{x:c.x,y:c.y}])}else g.push([{x:d.x,y:d.y},{x:c.x,y:c.y}]);for(var y=0;y<n.length;y++)for(var f=n[y][0],x=n[y][1],v=0;v<g.length;v++){var m=g[v][0],E=g[v][1],D=this.checkEdgeCrossing(f,x,m,E);D[0]&&(this.catEnergyField[i].edgeCrossingList.push([D[1],e,o,n[y],g[v]]),this.catEnergyField[l].edgeCrossingList.push([D[1],o,e,g[v],n[y]]))}}}}var b={};for(var t in this.catEnergyField){b[t]=this.catEnergyField[t].finalField;for(var F=this.catEnergyField[t].edgeCrossingList,M=[],k=0;k<F.length;k++){M.push([]);for(var w=F[k][0],I=(F[k][1],F[k][2],F[k][3]),P=F[k][4],A=0,C=_(I[0].x,I[0].y,I[1].x,I[1].y),N=[I[1].x-I[0].x,I[1].y-I[0].y],S=[P[1].x-P[0].x,P[1].y-P[0].y],B=j(N),O=j(S),V=.5,L=[],X=[],G=[],Y=[],U=!1,T=!1,R=!1;A<lt&&!U;){for(var W=[w.x+A*O[0],w.y+A*O[1]],q=0,z=!1,H=!1;q<C/2;){if(!z&&!U&&!T){var K=[W[0]+B[0]*q,W[1]+B[1]*q],J=Math.floor((K[0]-this.catEnergyField[t].x)/xt),Q=Math.floor((K[1]-this.catEnergyField[t].y)/xt);for(var Z in this.catEdgeDict){var $=Z,tt=Math.floor((K[0]-this.catEnergyField[$].x)/xt),et=Math.floor((K[1]-this.catEnergyField[$].y)/xt);if(tt>0&&tt<this.catEnergyField[$].width&&et>0&&et<this.catEnergyField[$].height&&3==this.catEnergyField[$].pointBarrierMap[et][tt]){U=!0;break}}J>0&&J<this.catEnergyField[t].width&&Q>0&&Q<this.catEnergyField[t].height&&this.catEnergyField[t].finalField[Q][J]>0&&(z=!0,4!=this.catEnergyField[t].edgeBarrierMap[Q][J]?0==G.length?(L.push([J,Q]),G=[J,Q]):Math.abs(G[0]-J)<=5&&Math.abs(G[1]-Q)<=5?(G=[J,Q],L.push([J,Q])):T=!0:L.push([J,Q]))}if(!H&&!U&&!R){var it=[W[0]-B[0]*q,W[1]-B[1]*q],at=Math.floor((it[0]-this.catEnergyField[t].x)/xt),rt=Math.floor((it[1]-this.catEnergyField[t].y)/xt);for(var Z in this.catEdgeDict){var nt=Z,st=Math.floor((it[0]-this.catEnergyField[nt].x)/xt),ht=Math.floor((it[1]-this.catEnergyField[nt].y)/xt);if(st>0&&st<this.catEnergyField[nt].width&&ht>0&&ht<this.catEnergyField[nt].height&&3==this.catEnergyField[nt].pointBarrierMap[ht][st]){U=!0;break}}at>0&&at<this.catEnergyField[t].width&&rt>0&&rt<this.catEnergyField[t].height&&this.catEnergyField[t].finalField[rt][at]>0&&(H=!0,4!=this.catEnergyField[t].edgeBarrierMap[rt][at]?0==Y.length?(X.push([at,rt]),Y=[at,rt]):Math.abs(Y[0]-at)<=5&&Math.abs(Y[1]-rt)<=5?(Y=[at,rt],X.push([at,rt])):R=!0:X.push([at,rt]))}if(z&&H||T&&R)break;q+=V}A+=V}for(var ot=[[Math.floor((w.x-this.catEnergyField[t].x)/xt),Math.floor((w.y-this.catEnergyField[t].y)/xt)]],dt=0;dt<L.length;dt++)ot.push(L[dt]);for(var ct=X.length-1;ct>=0;ct--)ot.push(X[ct]);M[k].push(ot),L=[],X=[],G=[],Y=[];var gt=!1;for(T=!1,R=!1,A=0;A<lt&&!gt;){for(var ut=[w.x-A*O[0],w.y-A*O[1]],pt=0,yt=!1,ft=!1;pt<C/2;){if(!yt&&!gt&&!T){var vt=[ut[0]+B[0]*pt,ut[1]+B[1]*pt],mt=Math.floor((vt[0]-this.catEnergyField[t].x)/xt),Et=Math.floor((vt[1]-this.catEnergyField[t].y)/xt);for(var Z in this.catEdgeDict){var Dt=Z,bt=Math.floor((vt[0]-this.catEnergyField[Dt].x)/xt),Ft=Math.floor((vt[1]-this.catEnergyField[Dt].y)/xt);if(bt>0&&bt<this.catEnergyField[Dt].width&&Ft>0&&Ft<this.catEnergyField[Dt].height&&3==this.catEnergyField[Dt].pointBarrierMap[Ft][bt]){gt=!0;break}}mt>0&&mt<this.catEnergyField[t].width&&Et>0&&Et<this.catEnergyField[t].height&&this.catEnergyField[t].finalField[Et][mt]>0&&(yt=!0,4!=this.catEnergyField[t].edgeBarrierMap[Et][mt]?0==G.length?(L.push([mt,Et]),G=[mt,Et]):Math.abs(G[0]-mt)<=5&&Math.abs(G[1]-Et)<=5?(G=[mt,Et],L.push([mt,Et])):T=!0:L.push([mt,Et]))}if(!ft&&!gt&&!R){var Mt=[ut[0]-B[0]*pt,ut[1]-B[1]*pt],kt=Math.floor((Mt[0]-this.catEnergyField[t].x)/xt),wt=Math.floor((Mt[1]-this.catEnergyField[t].y)/xt);for(var Z in this.catEdgeDict){var It=Z,Pt=Math.floor((Mt[0]-this.catEnergyField[It].x)/xt),At=Math.floor((Mt[1]-this.catEnergyField[It].y)/xt);if(Pt>0&&Pt<this.catEnergyField[It].width&&At>0&&At<this.catEnergyField[It].height&&3==this.catEnergyField[It].pointBarrierMap[At][Pt]){gt=!0;break}}kt>0&&kt<this.catEnergyField[t].width&&wt>0&&wt<this.catEnergyField[t].height&&this.catEnergyField[t].finalField[wt][kt]>0&&(ft=!0,4!=this.catEnergyField[t].edgeBarrierMap[wt][kt]?0==Y.length?(X.push([kt,wt]),Y=[kt,wt]):Math.abs(Y[0]-kt)<=5&&Math.abs(Y[1]-wt)<=5?(Y=[kt,wt],X.push([kt,wt])):R=!0:X.push([kt,wt]))}if(yt&&ft||T&&R)break;pt+=V}A+=V}ot=[[Math.floor((w.x-this.catEnergyField[t].x)/xt),Math.floor((w.y-this.catEnergyField[t].y)/xt)]];for(var Ct=0;Ct<L.length;Ct++)ot.push(L[Ct]);for(var Nt=X.length-1;Nt>=0;Nt--)ot.push(X[Nt]);M[k].push(ot)}for(var St=0;St<M.length;St++)for(var Bt=F[St][2],_t=this.edges[Bt].cat,Ot=this.catEnergyField[t].x,jt=this.catEnergyField[t].y,Vt=0;Vt<M[St].length;Vt++){for(var Lt=0;Lt<M[St][Vt].length;Lt++)M[St][Vt][Lt][0]=M[St][Vt][Lt][0]*xt+Ot,M[St][Vt][Lt][1]=M[St][Vt][Lt][1]*xt+jt;this.fillPolygonForEdge(M[St][Vt],t,b,_t)}}for(var t in this.catEnergyField)this.catEnergyField[t].finalField=b[t]}},{key:"smoothEnergyField",value:function(t){var e=this.getGaussianKernel(1.5,3),i=parseInt(1.5);for(var a in this.catEnergyField){for(var r=t[a].minX,n=t[a].maxX,s=t[a].minY,h=t[a].maxY,o=n-r+1,l=h-s+1,d=[],c=0;c<l+10;c++)d.push(new Array(o+10).fill(0));for(var g=s;g<=h;g++)for(var u=r;u<=n;u++){for(var p=0,y=0;y<3;y++)for(var f=0;f<3;f++){var x=g+(y-i),v=u+(f-i);x>0&&x<this.catEnergyField[a].height&&v>0&&v<this.catEnergyField[a].width&&(p+=e[y][f]*this.catEnergyField[a].finalField[x][v])}p>0&&(d[g-s][u-r]=p)}for(var m=s;m<=h;m++)for(var E=r;E<=n;E++)this.catEnergyField[a].finalField[m][E]=d[m-s][E-r]}}},{key:"saveOutline",value:function(t){var e=[];for(var i in t)for(var a=0;a<t[i].length;a++){for(var r=[],n=0;n<t[i][a].length;n++)r.push({x:t[i][a][n][0],y:t[i][a][n][1]});e.push({cat:i,id:a,isInterior:!1,parentID:-1,points:r})}console.log(JSON.stringify(e))}},{key:"removeOverlaps",value:function(){for(var t in this.updateEnergyPoints(),u.l("svg").selectAll("path").remove(),!1,0,this.firstFlag=!0,this.findOutLine(),this.calOutLine(),this.calEdgeControlPoints(),this.catEnergyField)this.updatedEnergyPoints[t]=[]}},{key:"render",value:function(){return Object(a.jsxs)("div",{id:"Sliders",children:[Object(a.jsx)("br",{}),Object(a.jsxs)(A.a,{children:[Object(a.jsxs)(C.a,{span:12,children:[Object(a.jsx)("h4",{children:"Node Radius"}),Object(a.jsx)(N.a,{min:1,max:50,onChange:this.onChangeNodeR1,value:"number"===typeof ht?ht:20})]}),Object(a.jsx)(C.a,{span:4,children:Object(a.jsx)(S.a,{min:1,max:50,style:{margin:"0 16px"},value:ht,onChange:this.onChangeNodeR1})})]}),Object(a.jsxs)(A.a,{children:[Object(a.jsxs)(C.a,{span:12,children:[Object(a.jsx)("h4",{children:"Global Edge Width"}),Object(a.jsx)(N.a,{min:10,max:100,onChange:this.onChangeEdgeR1,value:"number"===typeof lt?lt:20})]}),Object(a.jsx)(C.a,{span:4,children:Object(a.jsx)(S.a,{min:10,max:100,style:{margin:"0 16px"},value:lt,onChange:this.onChangeEdgeR1})})]}),Object(a.jsxs)(A.a,{children:[Object(a.jsxs)(C.a,{span:12,children:[Object(a.jsx)("h4",{children:"Pixel Group"}),Object(a.jsx)(N.a,{min:1,max:10,onChange:this.onChangePixelGroup,value:"number"===typeof xt?xt:2})]}),Object(a.jsx)(C.a,{span:4,children:Object(a.jsx)(S.a,{min:1,max:10,style:{margin:"0 16px"},value:xt,onChange:this.onChangePixelGroup})})]}),Object(a.jsxs)(A.a,{children:[Object(a.jsxs)(C.a,{span:12,children:[Object(a.jsx)("h4",{children:"Gap Between Different Groups"}),Object(a.jsx)(N.a,{min:0,max:5,onChange:this.onChangeGap,value:"number"===typeof vt?vt:1})]}),Object(a.jsx)(C.a,{span:4,children:Object(a.jsx)(S.a,{min:0,max:5,style:{margin:"0 16px"},value:vt,onChange:this.onChangeGap})})]}),Object(a.jsxs)(A.a,{children:[Object(a.jsxs)(C.a,{span:12,children:[Object(a.jsx)("h4",{children:"Edge Width"}),Object(a.jsx)(N.a,{min:1,max:10,onChange:this.onChangeEdgeWidth,value:this.state.edgeWidth,disabled:!this.state.hasSelectEdge})]}),Object(a.jsx)(C.a,{span:4,children:Object(a.jsx)(S.a,{min:1,max:10,style:{margin:"0 16px"},value:this.state.edgeWidth,onChange:this.onChangeEdgeWidth,disabled:!this.state.hasSelectEdge})})]}),Object(a.jsx)("br",{}),Object(a.jsx)(B.a,{onClick:this.getData.bind(this),disabled:!this.props.hasLoadData,children:"Draw Bubbles"}),Object(a.jsx)(B.a,{onClick:this.removeOverlaps.bind(this),disabled:!this.props.hasLoadData,children:"Remove Overlaps"})]})}}]),i}(r.Component);Ot.defaultProps={pointData:[],edges:[]};var jt,Vt,Lt,Xt,Gt,Yt,Ut=Ot,Tt=i(387),Rt=i(118),Wt=i(81),qt=Wt.ShapeInfo,zt=Wt.Intersection,Ht=(Wt.Point2D,Wt.IntersectionQuery),Kt=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],Jt=i(63),Qt=10,Zt=40,$t=i(140),te=1,ee=1,ie=1,ae=Number.MIN_VALUE,re=Number.MAX_VALUE,ne=i(288),se="#mainsvg",he="#leftsvg",oe=[],le=[],de=[],ce=[],ge=!1,ue=1920,pe=1040,ye=1920,fe=1040;function xe(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array|t instanceof Object){var e=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(e[i]=xe(t[i]));return e}throw new Error("Unable to clone obj! Its type isn't supported.")}var ve=function(t){Object(c.a)(i,t);var e=Object(g.a)(i);function i(){var t;return Object(l.a)(this,i),(t=e.call(this)).onRef=function(e){t.child=e},t.state={read:!1,pointData:[],edges:[],hasinit:!1,hasEdit:!1,hascreated:!1,editV:!1,colorArray:["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"]},t.issplit=!1,t.pointData=[],t.canvasWidth=-1,t.canvasHeight=-1,t.maxX=-1,t.maxY=-1,t.minX=-1,t.minY=-1,t.maxDis=Number.MIN_VALUE,t.catPointDict={},t.edges=[],t.graph=null,t.clustergraph=null,t.maxDistance=-1,t.itemShape="",t.isSelect=!1,t.selectItem=null,t.clusterDict={},t.clustergraphInfo={},t.clusterArr=[],t.noiseDict={},t.itemBBox=[],t.intersecEdges=[],t.vis=[],t.heap1={},t.heap2={},t.QTree=null,t.f=[],t.edgesdict=[],t.idx=0,t.draggedIndex=-1,t.draggedEdgeIndex=-1,t.draggedEdgeSeg=-1,t.nodeStartDict=[],t.nodeEndDict=[],t.lastClickIndex=-1,t.lastClickItem=null,t.deletedEdge=[],t.addedEdge=[],t.tempEdges=[],t}return Object(d.a)(i,[{key:"init",value:function(){Kt=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],Qt=10,Zt=40,50,te=1,ee=1,ie=1,ae=Number.MIN_VALUE,re=Number.MAX_VALUE,se="#mainsvg",he="#leftsvg",[],[],[],[],oe=[],le=[],de=[],ce=[],ge=!1,this.setState({read:!1,pointData:[],edges:[],hasinit:!1,hasEdit:!1,hascreated:!1,editV:!1,colorArray:["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"]}),this.pointData=[],this.canvasWidth=-1,this.canvasHeight=-1,this.maxX=-1,this.maxY=-1,this.minX=-1,this.minY=-1,this.maxDis=Number.MIN_VALUE,this.catPointDict={},this.edges=[],this.graph=null,this.clustergraph=null,this.maxDistance=-1,this.itemShape="",this.isSelect=!1,this.selectItem=null,this.clusterDict={},this.clustergraphInfo={},this.clusterArr=[],this.noiseDict={},this.itemBBox=[],this.intersecEdges=[],this.vis=[],this.heap1={},this.heap2={},this.QTree=null,this.f=[],this.edgesdict=[],this.idx=0,this.draggedEdgeIndex=-1,this.draggedEdgeSeg=-1,this.nodeStartDict=[],this.nodeEndDict=[],this.lastClickIndex=-1,this.lastClickItem=null,this.deletedEdge=[],this.addedEdge=[],this.tempEdges=[],this.componentWillMount(),this.render(),this.componentDidMount(),this.child.init_all()}},{key:"searchFather",value:function(t){for(;t!=this.f[t];)this.f[t]=this.f[this.f[t]],t=this.f[t];return t}},{key:"unionFather",value:function(t,e){this.f[this.searchFather(e)]=this.searchFather(t)}},{key:"componentWillMount",value:function(){fe=window.screen.availHeight,ye=window.screen.availWidth}},{key:"componentDidMount",value:function(){this.props.onRef(this),this.canvasWidth=document.getElementById("mainsvg").getBoundingClientRect().width,this.canvasHeight=document.getElementById("mainsvg").getBoundingClientRect().height}},{key:"centralizeData",value:function(){for(var t=Number.MAX_VALUE,e=Number.MAX_VALUE,i=Number.MIN_VALUE,a=Number.MIN_VALUE,r=0;r<this.pointData.length;r++)this.pointData[r].x>i&&(i=this.pointData[r].x),this.pointData[r].y>a&&(a=this.pointData[r].y),this.pointData[r].x<t&&(t=this.pointData[r].x),this.pointData[r].y<e&&(e=this.pointData[r].y);this.maxX=i,this.minX=t,this.maxY=a,this.minY=e,u.l("#mainsvg").attr("viewBox",t-20+" "+(e-20)+" "+(i-t+40)+" "+(a-e+40)),u.l("#leftsvg").attr("viewBox",t-20+" "+(e-20)+" "+(i-t+40)+" "+(a-e+40)),jt=t-20,Vt=e-20,Lt=i-t+40,Xt=a-e+40}},{key:"calEPS",value:function(){for(var t=0,e=0,i=Number.MIN_VALUE,a=0;a<this.pointData.length;a++)for(var r=a+1;r<this.pointData.length;r++){var n=this.calDistance(this.pointData[a],this.pointData[r]);t+=n,e+=1,n>i&&(i=n)}Qt=.035*i,this.maxDis=i,re=t/e-10}},{key:"addNewPoints",value:function(t){console.log("addNewPoints"),t.x=parseFloat(t.x),t.y=parseFloat(t.y),t.id=this.pointData.length,t.cat=t.cat.toString();var e=t.cat.split(","),i=[];if(e.length>1){t.multicat=!0;for(var a=0;a<e.length;a++)i.push(e[a])}else t.multicat=!1,i.push(t.cat);t.catArray=i;for(var r=0;r<t.catArray.length;r++){var n=t.catArray[r];this.catPointDict.hasOwnProperty(n)||(this.catPointDict[n]=[]),this.catPointDict[n].push(t)}this.pointData.push(t);var s=xe(this.pointData[this.pointData.length-1]);s.flag=!0,s.id=this.pointData.length-1,oe.push(s),this.calEPS(),this.drawPointData(),this.optimizeMST(!0),this.setState({pointData:this.pointData}),this.setState({edges:this.edges})}},{key:"getData",value:function(){if(Kt=this.props.colorArray,this.setState({colorArray:Kt}),this.state.hasinit)this.applyEdit();else if(this.props.pointData){this.init(),this.props.edges&&(this.edges=this.props.edges),console.log(this.edges.length),this.pointData=this.props.pointData,this.itemShape=this.pointData[0].shape;for(var t=0;t<this.pointData.length;t++){this.pointData[t].x=parseFloat(this.pointData[t].x),this.pointData[t].y=parseFloat(this.pointData[t].y),this.pointData[t].id=t,this.pointData[t].cat=this.pointData[t].cat.toString();var e=this.pointData[t].cat.split(","),i=[];if(e.length>1){this.pointData[t].multicat=!0;for(var a=0;a<e.length;a++)i.push(e[a])}else this.pointData[t].multicat=!1,i.push(this.pointData[t].cat);this.pointData[t].catArray=i;for(var r=0;r<this.pointData[t].catArray.length;r++){var n=this.pointData[t].catArray[r];this.catPointDict.hasOwnProperty(n)||(this.catPointDict[n]=[]),this.catPointDict[n].push(this.pointData[t])}}console.log(this.catPointDict),this.centralizeData(),this.calEPS(),u.l(se).selectAll("*").remove(),this.drawPointData();var s=+new Date;this.generateTreeWithHierarchical();var h=+new Date;console.log("Spanning tree: "+(h-s)+"ms"),this.drawEdges(),this.countEdgeCrossingWithRouting(),this.props.hasCreate(),console.log(this.edges),this.setState({pointData:this.pointData}),this.setState({edges:this.edges}),this.setState({hasinit:!0})}return[this.pointData,this.edges,Kt]}},{key:"createGraph",value:function(){for(var t=new Jt.Graph(this.pointData.length),e=0;e<t.V;e++)t.node(e).label=this.pointData[e].cat;this.graph=t}},{key:"sortEdgesGlobal",value:function(){var t=[],e=[],i=[],a=[],r=Number.MIN_VALUE;for(var n in this.catPointDict)for(var s=0;s<this.catPointDict[n].length;s++)for(var h=s+1;h<this.catPointDict[n].length;h++){var o=this.calDistance(this.catPointDict[n][s],this.catPointDict[n][h]),l=this.calEdgeMess(this.catPointDict[n][s],this.catPointDict[n][h]);e.push(o),i.push(l),o>r&&(r=o),a.push([this.catPointDict[n][s].id,this.catPointDict[n][h].id,o,l])}this.maxDistance=r;for(var d=0;d<a.length;d++){var c=a[d][0],g=a[d][1],u=a[d][2]/r,p=a[d][3],y=u*(p+1);t.push([c,g,y,u,p])}return t.sort((function(t,e){return t[2]-e[2]})),t}},{key:"sortEdgesGlobalWithMinDis",value:function(){var t=[],e=[],i=[],a=[],r=Number.MIN_VALUE;for(var n in this.catPointDict)for(var s=0;s<this.catPointDict[n].length;s++)for(var h=s+1;h<this.catPointDict[n].length;h++){var o=this.calDistance(this.catPointDict[n][s],this.catPointDict[n][h]),l=this.calEdgeMess(this.catPointDict[n][s],this.catPointDict[n][h]);e.push(o),i.push(l),o>r&&(r=o),a.push([this.catPointDict[n][s].id,this.catPointDict[n][h].id,o,l])}this.maxDistance=r;for(var d=0;d<a.length;d++){var c=a[d][0],g=a[d][1],u=a[d][2]/r,p=a[d][3],y=u;t.push([c,g,y,u,p])}return t.sort((function(t,e){return t[2]-e[2]})),t}},{key:"sortEdgesInCategory",value:function(t){for(var e=[],i=0;i<this.catPointDict[t].length;i++)for(var a=i+1;a<this.catPointDict[t].length;a++){var r=this.calEdgeWeight(this.catPointDict[t][i],this.catPointDict[t][a]);e.push([this.catPointDict[t][i].id,this.catPointDict[t][a].id,r])}return e.sort((function(t,e){return t[2]-e[2]})),e}},{key:"checkEdgeCrossing",value:function(t,e,i,a){return Math.min(t.x,e.x)<=Math.max(i.x,a.x)&&Math.min(i.x,a.x)<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=Math.max(i.y,a.y)&&Math.min(i.y,a.y)<=Math.max(t.y,e.y)&&(((i.x-t.x)*(i.y-a.y)-(i.y-t.y)*(i.x-a.x))*((i.x-e.x)*(i.y-a.y)-(i.y-e.y)*(i.x-a.x))<0&&((t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x))*((t.x-a.x)*(t.y-e.y)-(t.y-a.y)*(t.x-e.x))<0)}},{key:"calEdgeWeightWithCrossing",value:function(t,e){for(var i=this.calDistance(t,e),a=this.calEdgeMess(t,e),r=0,n=0;n<this.edges.length;n++){var s=this.edges[n].start,h=this.edges[n].end,o=this.pointData[s].cat;t.cat!=o&&this.checkEdgeCrossing(t,e,this.pointData[s],this.pointData[h])&&(r+=1)}return[i*(a+1)*(r+1)/this.maxDistance,i/this.maxDistance,a,r]}},{key:"calEdgeWeightWithCrossing2",value:function(t,e){for(var i=this.calDistance(t,e),a=this.calEdgeMess(t,e),r=0,n=0;n<this.edges.length;n++){var s=this.edges[n].start,h=this.edges[n].end,o=this.pointData[s].cat;t.cat!=o&&this.checkEdgeCrossing(t,e,this.pointData[s],this.pointData[h])&&(r+=1)}return[i*(a+1)*(r+1)/this.maxDistance,i/this.maxDistance,a,r]}},{key:"checkNewEdge",value:function(t,e){if(t.cat!=e.cat)return!0;for(var i=0;i<this.edges.length;i++){var a=this.pointData[this.edges[i].start],r=this.pointData[this.edges[i].end];if(a.cat!=t.cat&&a.cat!=e.cat&&r.cat!=t.cat&&r.cat!=e.cat&&this.checkEdgeCrossing(a,r,t,e))return!0}return!1}},{key:"calBackbone",value:function(){var t,e=[];t=this.sortEdgesGlobal();for(var i=0;i<t.length;i++){var a=t[i][0],r=t[i][1],n=t[i][2],s=t[i][3],h=t[i][4];if(this.pointData[a].cat==this.pointData[r].cat)new Jt.DepthFirstSearch(this.graph,a).hasPathTo(r)||(this.checkNewEdge(this.pointData[a],this.pointData[r])?e.push({start:a,end:r,weight:n,dis:s,crossnum:-1,mess:h}):(this.graph.addEdge(a,r),this.edges.push({start:a,end:r,weight:n,dis:s,mess:h})))}for(;!this.checkConnect();){for(var o=[],l=0;l<e.length;l++){var d=e[l].start,c=e[l].end;this.pointData[d].cat;if(!new Jt.DepthFirstSearch(this.graph,d).hasPathTo(c)){var g=this.calEdgeWeightWithCrossing(this.pointData[d],this.pointData[c]);e[l].weight=g[0],e[l].crossnum=g[3],o.push(e[l])}}for(var u=Number.MAX_VALUE,p=-1,y=0;y<o.length;y++)u>o[y].weight&&(u=o[y].weight,p=y);var f=o[p].start,x=o[p].end;this.graph.addEdge(f,x),this.edges.push({start:f,end:x,weight:o[p].weight,dis:o[p].dis,mess:o[p].mess,crossnum:o[p].crossnum})}console.log(this.graph),console.log(this.edges),console.log(e)}},{key:"calBackboneWithMinDis",value:function(){var t;t=this.sortEdgesGlobalWithMinDis();for(var e=0;e<t.length;e++){var i=t[e][0],a=t[e][1],r=t[e][2],n=t[e][3],s=t[e][4];if(this.pointData[i].cat==this.pointData[a].cat)new Jt.DepthFirstSearch(this.graph,i).hasPathTo(a)||(this.graph.addEdge(i,a),this.edges.push({start:i,end:a,weight:r,dis:n,mess:s}))}console.log(this.graph),console.log(this.edges),console.log([])}},{key:"checkConnectBetweenAllClusterV2",value:function(){for(var t in this.clusterDict){if(this.clustergraphInfo[t].edgesnum!=this.clustergraphInfo[t].nodesnum-1)return!1}return!0}},{key:"checkConnectBetweenAllCluster",value:function(){for(var t in this.clusterDict)for(var e=this.clusterDict[t][0].id,i=new Jt.DepthFirstSearch(this.clustergraph,e),a=1;a<this.clusterDict[t].length;a++)if(!i.hasPathTo(this.clusterDict[t][a].id))return!1;return!0}},{key:"checkConnectBetweenTwoClusterV2",value:function(t,e){return this.searchFather(t)==this.searchFather(e)}},{key:"checkConnectBetweenTwoCluster",value:function(t,e){return!!new Jt.DepthFirstSearch(this.clustergraph,t).hasPathTo(e)}},{key:"checkConnect",value:function(){for(var t in this.catPointDict)for(var e=this.catPointDict[t][0].id,i=new Jt.DepthFirstSearch(this.graph,e),a=1;a<this.catPointDict[t].length;a++)if(!i.hasPathTo(this.catPointDict[t][a].id))return!1;return!0}},{key:"sortRemoveEdges",value:function(t){var e,i;return t.sort(e.weight-i.weight),t}},{key:"calEdgeWeightWithCrossing",value:function(t,e){for(var i=this.calDistance(t,e),a=this.calEdgeMess(t,e),r=0,n=0;n<this.edges.length;n++){var s=this.edges[n].start,h=this.edges[n].end,o=this.pointData[s].cat;t.cat!=o&&this.checkEdgeCrossing(t,e,this.pointData[s],this.pointData[h])&&(r+=1)}return[i*(a+1)*(r+1)/this.maxDistance,i/this.maxDistance,a,r]}},{key:"calEdgeWeightWithCrossing2",value:function(t,e){for(var i=this.calDistance(t,e),a=this.calEdgeMess(t,e),r=0,n=0;n<this.edges.length;n++){var s=this.edges[n].start,h=this.edges[n].end,o=this.pointData[s].cat;t.cat!=o&&this.checkEdgeCrossing(t,e,this.pointData[s],this.pointData[h])&&(r+=1)}return[i*(a+1)*(r+1)/this.maxDistance,i/this.maxDistance,a,r]}},{key:"calDistance",value:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}},{key:"calEdgeMess",value:function(t,e){for(var i=0,a=0;a<this.pointData.length;a++){if(this.pointData[a].cat!=t.cat&&this.pointData[a].cat!=e.cat)if(this.isPointInEdgeRange(t,e,this.pointData[a]))this.calPointEdgeDistance(t,e,this.pointData[a])<Qt&&(i+=1)}return i}},{key:"calEdgeWeight",value:function(t,e){return[this.calDistance(t,e),this.calEdgeMess(t,e)]}},{key:"getVecNorm",value:function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}},{key:"calVecCosine",value:function(t,e){return(t[0]*e[0]+t[1]*e[1])/(this.getVecNorm(t)*this.getVecNorm(e))}},{key:"isPointInEdgeRange",value:function(t,e,i){var a=[i.x-t.x,i.y-t.y],r=[e.x-t.x,e.y-t.y];if(this.calVecCosine(a,r)<0)return!1;var n=[i.x-e.x,i.y-e.y],s=[t.x-e.x,t.y-e.y];return!(this.calVecCosine(n,s)<0)}},{key:"calPointEdgeDistance",value:function(t,e,i){var a=[e.x-t.x,e.y-t.y],r=[i.x-t.x,i.y-t.y],n=(a[0]*r[0]+a[1]*r[1])/this.getVecNorm(a),s=this.getVecNorm(r);return Math.sqrt(Math.pow(s,2)-Math.pow(n,2))}},{key:"calCrossingCost",value:function(){}},{key:"drawLine",value:function(t,e,i,a,r){u.l(se).append("line").attr("x1",t).attr("y1",e).attr("x2",i).attr("y2",a).attr("stroke-width",2).attr("stroke",r)}},{key:"drawEdges",value:function(){for(var t=this,e=0;e<t.edges.length;e++)t.edges[e].id=e,t.edges[e].SVGElement=[];u.l(se).select("#edgeGroup").empty()&&u.l(se).insert("g","#pointGroup").attr("id","edgeGroup"),u.l(he).select("#edgeGroup").empty()&&u.l(he).insert("g","#pointGroup").attr("id","edgeGroup"),u.m("line").remove(),u.m(".controlPoints").remove();for(var i=0;i<this.edges.length;i++)this.drawOneEdge(i)}},{key:"savePointData",value:function(){var t=this;u.m("circle").each((function(){var e=u.l(this).attr("cx"),i=u.l(this).attr("cy"),a=u.l(this).attr("index");t.pointData[a].x=parseFloat(e),t.pointData[a].y=parseFloat(i),t.pointData[a].cat=t.pointData[a].cat.toString()})),console.log(t.pointData),console.log(JSON.stringify(t.pointData))}},{key:"saveEdgeData",value:function(){for(var t=[],e=0;e<this.edges.length;e++)this.edges[e].isdelete||(this.edges[e].index=t.length,t.push(this.edges[e]));this.edges=t,console.log(JSON.stringify(this.edges))}},{key:"loadEdgeData",value:function(){var t=this;fetch("/data/manuallyDataEdge.txt",{method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"},mode:"cors",cache:"default"}).then((function(t){return t.json()})).then((function(e){console.log(e),t.edges=e;for(var i=t,a=0;a<t.edges.length;a++){var r=t.edges[a].start,n=t.edges[a].end;u.l(se).append("line").attr("x1",t.pointData[r].x).attr("y1",t.pointData[r].y).attr("x2",t.pointData[n].x).attr("y2",t.pointData[n].y).attr("stroke-width",2).attr("stroke","black").attr("index",a).on("click",(function(){var t=u.l(this).attr("index");i.edges[t].isdelete=!0,u.l(this).remove(),console.log(i.edges)}))}t.countEdgeCrossing()}))}},{key:"clickItem",value:function(t){if(this.isSelect){if(u.l(t.target).attr("index")!=this.selectItem){var e=this.selectItem,i=u.l(t.target).attr("index");if(this.pointData[e].cat==this.pointData[i].cat){this.isSelect=!1,this.selectItem=null,this.edges.push({start:e,end:i,index:this.edges.length,isdelete:!1});var a=this;u.l(se).append("line").attr("x1",this.pointData[e].x).attr("y1",this.pointData[e].y).attr("x2",this.pointData[i].x).attr("y2",this.pointData[i].y).attr("stroke-width",2).attr("stroke","black").attr("index",this.edges.length-1).on("click",(function(){var t=u.l(this).attr("index");a.edges[t].isdelete=!0,u.l(this).remove(),console.log(a.edges)}))}}}else this.isSelect=!0,this.selectItem=u.l(t.target).attr("index"),console.log(this.selectItem)}},{key:"deleteEdge",value:function(t){var e=t,i=this;u.m("line").filter((function(){return parseInt(u.l(this).attr("index"))==e})).remove(),u.m(".controlPoints").filter((function(){return parseInt(u.l(this).attr("edgeindex"))==e})).remove(),u.m(".controlPoints").filter((function(){return parseInt(u.l(this).attr("edgeindex"))>e})).attr("edgeindex",(function(){return parseInt(u.l(this).attr("edgeindex"))-1})),u.m("line").filter((function(){return parseInt(u.l(this).attr("index"))>e})).attr("index",(function(){return parseInt(u.l(this).attr("index"))-1})),i.edges.splice(e,1);for(var a=0;a<i.edges.length;a++)i.edges[a].id=a}},{key:"optimizeMST",value:function(t){this.clustergraphInfo={};for(var e=new Jt.Graph(this.pointData.length),i=0;i<e.V;i++)e.node(i).label=this.pointData[i].cat;for(var a=0;a<this.edges.length;a++){var r=this.edges[a].start,n=this.edges[a].end;this.edges[a].cat;e.addEdge(r,n)}this.graph=e;var s=new Jt.ConnectedComponents(e);console.log(s.componentCount());var h={};for(var o in this.catPointDict)h[o]=[];for(var l=[],d=0;d<s.componentCount();d++)l.push([]);for(var c=0;c<e.V;c++){var g=this.pointData[c];l[s.componentId(c)].push(g)}for(var p=0;p<l.length;p++){h[l[p][0].cat].push(l[p])}for(var y in this.clusterDict=h,this.clusterDict)this.clustergraphInfo[y]={edgesnum:0,nodesnum:this.clusterDict[y].length};l=[];var f=0;for(var x in this.clusterDict)for(var v=0;v<this.clusterDict[x].length;v++)l.push({points:this.clusterDict[x][v],cat:x,id:f}),this.clusterDict[x][v].id=f,f+=1;this.clusterArr=l;for(var m=new Jt.Graph(this.clusterArr.length),E=0;E<m.V;E++)m.node(E).label=this.clusterArr[E].cat;this.clustergraph=m,this.itemBBox=[];for(var D=document.getElementsByClassName("dataPoint"),b=0;b<D.length;b++)this.itemBBox.push({id:D[b].getAttribute("index"),bbox:D[b].getBBox()});if(t){for(var F=[],M=0;M<this.edges.length;M++)F.push(this.edges[M]);var k=this.recalculateSpanningTreeAfterEdit(F);u.m(".deleteOpEdge").remove(),ce=[];for(var w=0;w<k.length;w++){this.drawOneEdgeAfterEdit(F,k[w]);var I=xe(F[k[w]]);I.id=k[w],I.flag=!0,ce.push(I)}this.tempEdges=F}else{for(var P=this.recalculateSpanningTree(),A=0;A<P.length;A++)this.drawOneEdge(P[A]),this.edges[P[A]].new=!0;this.countEdgeCrossing(),this.draggedIndex=-1,this.deletedEdge=[],this.addedEdge=[],this.setState({pointData:this.pointData,edges:this.edges})}}},{key:"sufaceRoutingAll",value:function(){for(var t=0;t<this.edges.length;t++){var e=this.edges[t],i=this.pointData[e.start.id],a=this.pointData[e.end.id],r=this.pointData[e.start.id].cat,n=[];n.push([i.x,i.y]),n.push([a.x,a.y]);for(var s=[{start:[i.x,i.y],end:[a.x,a.y],ids:[0,1]}];s.length>0;){var h=5,o=!1,l=s.pop();i=l.start,a=l.end;var d=l.ids;u.m("line").remove(),u.l(se).append("line").attr("x1",i[0]).attr("y1",i[1]).attr("x2",a[0]).attr("y2",a[1]).attr("stroke-width",2).attr("stroke","red");var c=this.findCrossingBetweenEdgeRect(i,a,r);if(0!=c.length){this.edges[t].virtrual=!0;var g=c[0].points,p=c[0].rect,y=[[p.x,p.y],[p.x+p.width,p.y]],f=[[p.x,p.y+p.height],[p.x+p.width,p.y+p.height]],x=[[p.x,p.y],[p.x,p.y+p.height]],v=[[p.x+p.width,p.y],[p.x+p.width,p.y+p.height]],m=g[0],E=g[1],D=void 0;if(y[1][1]==m.y&&f[1][1]==E.y||f[1][1]==m.y&&y[1][1]==E.y||x[0][0]==m.x&&v[0][0]==E.x||x[0][0]==E.x&&v[0][0]==m.x){var b=-1;if(y[1][1]==m.y&&f[1][1]==E.y){var F=m.x-p.x,M=E.x-p.x;b=F+M<p.width?F>M?3:2:F<M?4:1}else if(f[1][1]==m.y&&y[1][1]==E.y){var k=E.x-p.x,w=m.x-p.x;b=k+w<p.width?k>w?3:2:k<w?4:1}else if(x[0][0]==m.x&&v[0][0]==E.x){var I=m.y-p.y,P=E.y-p.y;b=I+P<p.width?I>P?3:4:I<P?2:1}else if(x[0][0]==E.x&&v[0][0]==m.x){var A=E.y-p.y,C=m.y-p.y;b=A+C<p.width?A>C?3:4:A<C?2:1}for(var N=[],S=0,B=-1,_=-1;;){1==b?N=o?[p.x+p.width,p.y+p.height]:[p.x,p.y]:2==b?N=o?[p.x,p.y+p.height]:[p.x+p.width,p.y]:3==b?N=o?[p.x,p.y]:[p.x+p.width,p.y+p.height]:4==b&&(N=o?[p.x+p.width,p.y]:[p.x,p.y+p.height]);var O=[p.x+p.width/2,p.y+p.height/2],j=[N[0]-O[0],N[1]-O[1]],V=this.getVecNorm(j);if(j[0]=j[0]/V,j[1]=j[1]/V,D=[N[0]+h*j[0],N[1]+h*j[1]],this.checkVNodeInBound(D,r)){if(o||(h/=1.5),o=!o,(S+=1)>10)break}else if(o?B=D:_=D,o=!o,-1!=B&&-1!=_)break}if(-1==B&&-1==_){this.edges[t].virtrual=!1;continue}if(-1!=B&&-1!=_){for(var L=Number.MAX_VALUE,X=null,G=[B,_],Y=0;Y<G.length;Y++){for(var U=G[Y],T=0,R=0;R<this.edges.length;R++){var W=this.pointData[this.edges[R].start],q=this.pointData[this.edges[R].end];if(W.cat!=r){var z={x:i[0],y:i[1],cat:r},H={x:U[0],y:U[1],cat:r},K={x:a[0],y:a[1],cat:r};this.checkEdgeCrossing(W,q,z,H)&&(T+=1),this.checkEdgeCrossing(W,q,H,K)&&(T+=1)}}T<L&&(L=T,X=G[Y])}D=X}else D=-1!=B?B:_}else{var J=[m.x,E.y],Q=[];J[0]==p.x&&J[1]==p.y?Q=[p.x,p.y]:J[0]==p.x+p.width&&J[1]==p.y?Q=[p.x+p.width,p.y]:J[0]==p.x+p.width&&J[1]==p.y+p.height?Q=[p.x+p.width,p.y+p.height]:J[0]==p.x&&J[1]==p.y+p.height?Q=[p.x,p.y+p.height]:(J=[E.x,m.y])[0]==p.x&&J[1]==p.y?Q=[p.x,p.y]:J[0]==p.x+p.width&&J[1]==p.y?Q=[p.x+p.width,p.y]:J[0]==p.x+p.width&&J[1]==p.y+p.height?Q=[p.x+p.width,p.y+p.height]:J[0]==p.x&&J[1]==p.y+p.height&&(Q=[p.x,p.y+p.height]);var Z=[p.x+p.width/2,p.y+p.height/2],$=[Q[0]-Z[0],Q[1]-Z[1]],tt=this.getVecNorm($);$[0]=$[0]/tt,$[1]=$[1]/tt,D=[Q[0]+h*$[0],Q[1]+h*$[1]]}for(var et=!1,it=0;it<n.length;it++)if(D[0]==n[it][0]&&D[1]==n[it][1]){et=!0;break}if(!et){var at;at=d[0]+1,n.splice(at,0,D);for(var rt=0;rt<s.length;rt++)s[rt].ids[0]>=at&&(s[rt].ids[0]=s[rt].ids[0]+1),s[rt].ids[1]>=at&&(s[rt].ids[1]=s[rt].ids[1]+1);s.push({start:i,end:D,ids:[d[0],at]}),s.push({start:D,end:a,ids:[at,d[1]+1]})}}}n.pop(),n.splice(0,1),this.edges[t].virtrualNodes=n}}},{key:"surfaceRoutingEdge",value:function(t){var e=this.pointData[t.start],i=this.pointData[t.end],a=this.pointData[t.start].cat,r=[];r.push([e.x,e.y]),r.push([i.x,i.y]);for(var n=[{start:[e.x,e.y],end:[i.x,i.y],ids:[0,1]}];n.length>0;){var s=5,h=!1,o=n.pop();e=o.start,i=o.end;var l=o.ids,d=this.findCrossingBetweenEdgeRect(e,i,a);if(0!=d.length){t.virtrual=!0;var c=d[0].points,g=d[0].rect,u=[[g.x,g.y],[g.x+g.width,g.y]],p=[[g.x,g.y+g.height],[g.x+g.width,g.y+g.height]],y=[[g.x,g.y],[g.x,g.y+g.height]],f=[[g.x+g.width,g.y],[g.x+g.width,g.y+g.height]],x=c[0],v=c[1],m=void 0;if(u[1][1]==x.y&&p[1][1]==v.y||p[1][1]==x.y&&u[1][1]==v.y||y[0][0]==x.x&&f[0][0]==v.x||y[0][0]==v.x&&f[0][0]==x.x){var E=-1;if(u[1][1]==x.y&&p[1][1]==v.y){var D=x.x-g.x,b=v.x-g.x;E=D+b<g.width?D>b?3:2:D<b?4:1}else if(p[1][1]==x.y&&u[1][1]==v.y){var F=v.x-g.x,M=x.x-g.x;E=F+M<g.width?F>M?3:2:F<M?4:1}else if(y[0][0]==x.x&&f[0][0]==v.x){var k=x.y-g.y,w=v.y-g.y;E=k+w<g.width?k>w?3:4:k<w?2:1}else if(y[0][0]==v.x&&f[0][0]==x.x){var I=v.y-g.y,P=x.y-g.y;E=I+P<g.width?I>P?3:4:I<P?2:1}for(var A=[],C=0,N=-1,S=-1;;){1==E?A=h?[g.x+g.width,g.y+g.height]:[g.x,g.y]:2==E?A=h?[g.x,g.y+g.height]:[g.x+g.width,g.y]:3==E?A=h?[g.x,g.y]:[g.x+g.width,g.y+g.height]:4==E&&(A=h?[g.x+g.width,g.y]:[g.x,g.y+g.height]);var B=[g.x+g.width/2,g.y+g.height/2],_=[A[0]-B[0],A[1]-B[1]],O=this.getVecNorm(_);if(_[0]=_[0]/O,_[1]=_[1]/O,m=[A[0]+s*_[0],A[1]+s*_[1]],this.checkVNodeInBound(m,a)){if(h||(s/=1.5),h=!h,(C+=1)>10)break}else if(h?N=m:S=m,h=!h,-1!=N&&-1!=S)break}if(-1==N&&-1==S){t.virtrual=!1;continue}if(-1!=N&&-1!=S){for(var j=Number.MAX_VALUE,V=null,L=[N,S],X=0;X<L.length;X++){for(var G=L[X],Y=0,U=0;U<this.edges.length;U++){var T=this.pointData[this.edges[U].start],R=this.pointData[this.edges[U].end];if(T.cat!=a){var W={x:e[0],y:e[1],cat:a},q={x:G[0],y:G[1],cat:a},z={x:i[0],y:i[1],cat:a};this.checkEdgeCrossing(T,R,W,q)&&(Y+=1),this.checkEdgeCrossing(T,R,q,z)&&(Y+=1)}}Y<j&&(j=Y,V=L[X])}m=V}else m=-1!=N?N:S}else{var H=[x.x,v.y],K=[];H[0]==g.x&&H[1]==g.y?K=[g.x,g.y]:H[0]==g.x+g.width&&H[1]==g.y?K=[g.x+g.width,g.y]:H[0]==g.x+g.width&&H[1]==g.y+g.height?K=[g.x+g.width,g.y+g.height]:H[0]==g.x&&H[1]==g.y+g.height?K=[g.x,g.y+g.height]:(H=[v.x,x.y])[0]==g.x&&H[1]==g.y?K=[g.x,g.y]:H[0]==g.x+g.width&&H[1]==g.y?K=[g.x+g.width,g.y]:H[0]==g.x+g.width&&H[1]==g.y+g.height?K=[g.x+g.width,g.y+g.height]:H[0]==g.x&&H[1]==g.y+g.height&&(K=[g.x,g.y+g.height]);var J=[g.x+g.width/2,g.y+g.height/2],Q=[K[0]-J[0],K[1]-J[1]],Z=this.getVecNorm(Q);Q[0]=Q[0]/Z,Q[1]=Q[1]/Z,m=[K[0]+s*Q[0],K[1]+s*Q[1]]}for(var $=!1,tt=0;tt<r.length;tt++)if(m[0]==r[tt][0]&&m[1]==r[tt][1]){$=!0;break}if(!$){var et;et=l[0]+1,r.splice(et,0,m);for(var it=0;it<n.length;it++)n[it].ids[0]>=et&&(n[it].ids[0]=n[it].ids[0]+1),n[it].ids[1]>=et&&(n[it].ids[1]=n[it].ids[1]+1);n.push({start:e,end:m,ids:[l[0],et]}),n.push({start:m,end:i,ids:[et,l[1]+1]})}}}return r.pop(),r.splice(0,1),t.virtrualNodes=r,0==r.length&&(t.virtrual=!1),t}},{key:"hasLinked",value:function(t,e){for(var i=0;i<this.edges.length;i++){var a=this.edges[i];if(a.start==t&&a.end==e)return!0;if(a.start==e&&a.end==t)return!0}return!1}},{key:"addEdge",value:function(t,e,i){var a={start:t,end:e,weight:-1,cat:i,dis:-1,virtrual:!1,virtrualNodes:[],id:this.edges.length,isLocalTree:!1};a=this.surfaceRoutingEdge(a);for(var r=0,n=this.pointData[t],s=this.pointData[e],h=0;h<this.edges.length;h++){var o=this.pointData[this.edges[h].start],l=this.pointData[this.edges[h].end];o.cat!=n.cat&&o.cat!=s.cat&&this.checkEdgeCrossing(n,s,o,l)&&(r+=1)}var d=this.calDistance(n,s),c=this.calEdgeMess(n,s),g=te*r+ee*d/this.maxDis+ie*c;a.score=g,this.edges.push(a),this.drawOneEdge(a.id)}},{key:"drawOneEdge",value:function(t){this.edges[t].SVGElement=[];var e=this.edges[t],i=this;var a=u.e().on("start",(function(){var t=parseInt(u.l(this).attr("edgeindex"));le=[];var e=xe(i.edges[t]);e.startpoint=xe(i.pointData[i.edges[t].start]),e.endpoint=xe(i.pointData[i.edges[t].end]),e.flag=!1,le.push(e)})).on("drag",(function(t){var e=parseInt(u.l(this).attr("edgeindex")),a=parseInt(u.l(this).attr("segindex"));i.edges[e].virtrualNodes[a][0]=t.x,i.edges[e].virtrualNodes[a][1]=t.y;var r="#"+u.l(this).attr("id");u.m(r).attr("cx",t.x).attr("cy",t.y),u.m("line").filter((function(){return parseInt(u.l(this).attr("index"))==e&&parseInt(u.l(this).attr("segindex"))==a})).attr("x2",t.x).attr("y2",t.y),u.m("line").filter((function(){return parseInt(u.l(this).attr("index"))==e&&parseInt(u.l(this).attr("segindex"))==a+1})).attr("x1",t.x).attr("y1",t.y)})).on("end",(function(){var t=parseInt(u.l(this).attr("edgeindex")),e=xe(i.edges[t]);e.id=t,e.flag=!0,le.push(e),i.setState({pointData:i.pointData}),i.setState({edges:i.edges}),i.child.bubbleState()&&i.child.editReDraw(oe,le,i.pointData,i.edges),oe=[],le=[]}));var r=u.e().on("start",(function(t){console.log("drag start edge!");var e=parseInt(u.l(this).attr("index")),s=i.pointData[i.edges[e].start],h=i.pointData[i.edges[e].end];le=[];var o=xe(i.edges[e]);if(o.startpoint=xe(s),o.endpoint=xe(h),o.flag=!1,le.push(o),u.m("line").filter((function(){return parseInt(u.l(this).attr("index"))==e})).attr("stroke","red"),"true"==u.l(this).attr("isvirtrual")){var l=parseInt(u.l(this).attr("segindex"));i.edges[e].virtrualNodes.splice(l,0,[t.x,t.y]),i.draggedEdgeIndex=e,i.draggedEdgeSeg=l}else i.edges[e].virtrual=!0,i.edges[e].virtrualNodes.push([t.x,t.y]),i.draggedEdgeIndex=e,i.draggedEdgeSeg=0;u.m("line").filter((function(){return parseInt(u.l(this).attr("index"))==e})).remove(),i.edges[e].SVGElement=[];for(var d=i.edges[e].virtrualNodes,c=[s.x,s.y],g=[],p=0;p<d.length;p++){g=d[p];var y=u.l(se).select("#edgeGroup").append("line").attr("x1",c[0]).attr("y1",c[1]).attr("x2",g[0]).attr("y2",g[1]).attr("stroke-width",2).attr("stroke","black").attr("index",e).attr("isvirtrual",!0).attr("segindex",p).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black"),console.log(i.edges[t])})).on("mousedown",n).call(r);u.l(he).select("#edgeGroup").append("line").attr("x1",c[0]).attr("y1",c[1]).attr("x2",g[0]).attr("y2",g[1]).attr("stroke-width",2).attr("stroke","black").attr("index",e).attr("isvirtrual",!0).attr("segindex",p).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black"),console.log(i.edges[t])})).on("mousedown",n).call(r),i.edges[e].SVGElement.push(y),c=g}var f=u.l(se).select("#edgeGroup").append("line").attr("x1",c[0]).attr("y1",c[1]).attr("x2",h.x).attr("y2",h.y).attr("stroke-width",2).attr("stroke","black").attr("index",e).attr("isvirtrual",!0).attr("segindex",d.length).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black"),console.log(i.edges[t])})).on("mousedown",n).call(r);u.l(he).select("#edgeGroup").append("line").attr("x1",c[0]).attr("y1",c[1]).attr("x2",h.x).attr("y2",h.y).attr("stroke-width",2).attr("stroke","black").attr("index",e).attr("isvirtrual",!0).attr("segindex",d.length).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black"),console.log(i.edges[t])})).on("mousedown",n).call(r),i.edges[e].SVGElement.push(f);for(var x=0;x<d.length;x++)u.l(se).select("#edgeGroup").append("circle").attr("class","controlPoints").attr("cx",d[x][0]).attr("cy",d[x][1]).attr("r",5).attr("fill","red").attr("opacity",0).attr("edgeindex",e).attr("segindex",x).attr("id","e"+e.toString()+"s"+x.toString()).on("mouseover",(function(){var t="#"+u.l(this).attr("id");u.m(t).attr("opacity",1)})).on("mouseout",(function(){var t="#"+u.l(this).attr("id");u.m(t).attr("opacity",0)})).call(a),u.l(he).select("#edgeGroup").append("circle").attr("class","controlPoints").attr("cx",d[x][0]).attr("cy",d[x][1]).attr("r",5).attr("fill","red").attr("opacity",0).attr("edgeindex",e).attr("segindex",x).attr("id","e"+e.toString()+"s"+x.toString()).on("mouseover",(function(){var t="#"+u.l(this).attr("id");u.m(t).attr("opacity",1)})).on("mouseout",(function(){var t="#"+u.l(this).attr("id");u.m(t).attr("opacity",0)})).call(a)})).on("drag",(function(t){if(-1!=i.draggedEdgeIndex){t.sourceEvent.stopPropagation();var e=i.draggedEdgeIndex,a=i.draggedEdgeSeg;i.edges[e].virtrualNodes[a][0]=t.x,i.edges[e].virtrualNodes[a][1]=t.y,u.m("line").filter((function(){var t=parseInt(u.l(this).attr("index")),e=parseInt(u.l(this).attr("segindex"));return t==i.draggedEdgeIndex&&e==i.draggedEdgeSeg})).attr("x2",t.x).attr("y2",t.y),u.m("line").filter((function(){var t=parseInt(u.l(this).attr("index")),e=parseInt(u.l(this).attr("segindex"));return t==i.draggedEdgeIndex&&e==i.draggedEdgeSeg+1})).attr("x1",t.x).attr("y1",t.y),u.m(".controlPoints").filter((function(){var t=parseInt(u.l(this).attr("edgeindex")),e=parseInt(u.l(this).attr("segindex"));return t==i.draggedEdgeIndex&&e==i.draggedEdgeSeg})).attr("cx",t.x).attr("cy",t.y)}})).on("end",(function(t){var e=i.draggedEdgeIndex,a=xe(i.edges[e]);a.id=e,a.flag=!0,le.push(a),i.setState({pointData:i.pointData}),i.setState({edges:i.edges}),i.child.bubbleState()&&i.child.editReDraw(oe,le,i.pointData,i.edges),oe=[],le=[],i.draggedEdgeSeg=-1,i.draggedEdgeIndex=-1}));function n(t){if(2==t.button){i.setState({hasEdit:!0});var e=parseInt(u.l(this).attr("index")),a=i.edges[e].start,r=i.edges[e].end,n=xe(i.edges[e]);for(var s in n.startpoint=xe(i.pointData[a]),n.endpoint=xe(i.pointData[r]),n.flag=!1,le.push(n),i.setState({pointData:i.pointData}),i.setState({edges:i.edges}),i.child.bubbleState()&&i.child.editReDraw(oe,le,i.pointData,i.edges),oe=[],le=[],i.deletedEdge.push([a,r]),i.deleteEdge(e),i.optimizeMST(!0),i.catPointDict)i.findCircle(s)}}var s=e.start,h=e.end;if(e.virtrual){for(var o,l=e.virtrualNodes,d=[this.pointData[s].x,this.pointData[s].y],c=0;c<l.length;c++){o=l[c];var g=u.l(se).select("#edgeGroup").append("line").attr("x1",d[0]).attr("y1",d[1]).attr("x2",o[0]).attr("y2",o[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",c).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",n).call(r);u.l(he).select("#edgeGroup").append("line").attr("x1",d[0]).attr("y1",d[1]).attr("x2",o[0]).attr("y2",o[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",c).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",n).call(r),d=o,this.edges[t].SVGElement.push(g)}o=[this.pointData[h].x,this.pointData[h].y];var p=u.l(se).select("#edgeGroup").append("line").attr("x1",d[0]).attr("y1",d[1]).attr("x2",o[0]).attr("y2",o[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",l.length).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",n).call(r);u.l(he).select("#edgeGroup").append("line").attr("x1",d[0]).attr("y1",d[1]).attr("x2",o[0]).attr("y2",o[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",l.length).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",n).call(r),this.edges[t].SVGElement.push(p);for(var y=0;y<l.length;y++)u.l(se).select("#edgeGroup").append("circle").attr("class","controlPoints").attr("cx",l[y][0]).attr("cy",l[y][1]).attr("r",5).attr("edgeindex",t).attr("segindex",y).attr("fill","red").attr("opacity",0).attr("id","e"+t.toString()+"s"+y.toString()).on("mouseover",(function(){var t="#"+u.l(this).attr("id");u.m(t).attr("opacity",1)})).on("mouseout",(function(){var t="#"+u.l(this).attr("id");u.m(t).attr("opacity",0)})).call(a),u.l(he).select("#edgeGroup").append("circle").attr("class","controlPoints").attr("cx",l[y][0]).attr("cy",l[y][1]).attr("r",5).attr("edgeindex",t).attr("segindex",y).attr("fill","red").attr("opacity",0).attr("id","e"+t.toString()+"s"+y.toString()).on("mouseover",(function(){var t="#"+u.l(this).attr("id");u.m(t).attr("opacity",1)})).on("mouseout",(function(){var t="#"+u.l(this).attr("id");u.m(t).attr("opacity",0)})).call(a)}else{var f=u.l(se).select("#edgeGroup").append("line").attr("x1",this.pointData[s].x).attr("y1",this.pointData[s].y).attr("x2",this.pointData[h].x).attr("y2",this.pointData[h].y).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!1).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",n).call(r);u.l(he).select("#edgeGroup").append("line").attr("x1",this.pointData[s].x).attr("y1",this.pointData[s].y).attr("x2",this.pointData[h].x).attr("y2",this.pointData[h].y).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!1).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",n).call(r),this.edges[t].SVGElement.push(f)}}},{key:"applyEdit",value:function(){this.edges=this.tempEdges,this.deletedEdge=[],this.addedEdge=[],this.drawEdges(),this.setState({hasEdit:!1,edges:this.edges,pointData:this.pointData}),this.child.bubbleState()&&this.child.editReDraw([],ce,this.pointData,this.edges),ce=[]}},{key:"drawOneEdgeAfterEdit",value:function(t,e){t[e].SVGElement=[];var i=t[e],a=this,r=i.start,n=i.end;function s(e){if(2==e.button){var i=parseInt(u.l(this).attr("index"));u.m(".deleteOpEdge").filter((function(){return parseInt(u.l(this).attr("index"))==i})).remove();var r=t[i].start,n=t[i].end;a.deletedEdge.push([r,n]),a.optimizeMST(!0)}}if(i.virtrual){for(var h,o=i.virtrualNodes,l=[this.pointData[r].x,this.pointData[r].y],d=0;d<o.length;d++){h=o[d];u.l(se).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",l[0]).attr("y1",l[1]).attr("x2",h[0]).attr("y2",h[1]).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,3").attr("opacity",.5).attr("index",e).attr("isvirtrual",!0).attr("segindex",d).on("mouseover",(function(t,e){var i=u.l(this).attr("index");u.l(se).select("#edgeGroup").selectAll(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=u.l(this).attr("index");u.l(se).select("#edgeGroup").selectAll(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",s);u.l(he).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",l[0]).attr("y1",l[1]).attr("x2",h[0]).attr("y2",h[1]).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,3").attr("opacity",.5).attr("index",e).attr("isvirtrual",!0).attr("segindex",d).on("mouseover",(function(t,e){var i=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",s),l=h}h=[this.pointData[n].x,this.pointData[n].y];u.l(se).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",l[0]).attr("y1",l[1]).attr("x2",h[0]).attr("y2",h[1]).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,3").attr("opacity",.5).attr("index",e).attr("isvirtrual",!0).attr("segindex",o.length).on("mouseover",(function(t,e){var i=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",s);u.l(he).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",l[0]).attr("y1",l[1]).attr("x2",h[0]).attr("y2",h[1]).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,3").attr("opacity",.5).attr("index",e).attr("isvirtrual",!0).attr("segindex",o.length).on("mouseover",(function(t,e){var i=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",s)}else{u.l(se).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",this.pointData[r].x).attr("y1",this.pointData[r].y).attr("x2",this.pointData[n].x).attr("y2",this.pointData[n].y).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,2").attr("opacity",.5).attr("index",e).attr("isvirtrual",!1).on("mouseover",(function(t,e){var i=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",s);u.l(he).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",this.pointData[r].x).attr("y1",this.pointData[r].y).attr("x2",this.pointData[n].x).attr("y2",this.pointData[n].y).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,2").attr("opacity",.5).attr("index",e).attr("isvirtrual",!1).on("mouseover",(function(t,e){var i=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m(".deleteOpEdge").filter((function(){return u.l(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",s)}}},{key:"checkCircle",value:function(t){for(var e=[],i={},a=0;a<this.edges.length;a++)if(this.edges[a].cat==t){e.push(this.edges[a]);var r=this.edges[a].start,n=this.edges[a].end;i.hasOwnProperty(r)||(i[r]=[]),i[r].push(a),i.hasOwnProperty(n)||(i[n]=[]),i[n].push(a)}for(var s=!1;!s;)for(var h in s=!0,i)if(1==i[h].length){s=!1;for(var o=i[h][0],l=this.edges[o].start,d=this.edges[o].end,c=0;c<i[l].length;c++)if(i[l][c]==o){i[l].splice(c,1);break}for(var g=0;g<i[d].length;g++)if(i[d][g]==o){i[d].splice(g,1);break}}var u=[];for(var h in i)if(i[h].length>0)for(var p=0;p<i[h].length;p++){for(var y=i[h][p],f=!1,x=0;x<u.length;x++)if(u[x]==y){f=!0;break}f||u.push(y)}return u}},{key:"findCircle",value:function(t){var e=this,i=e.checkCircle(t);if(i.length>0){for(var a=[],r=0;r<i.length;r++){var n=i[r],s=e.pointData[e.edges[n].start],h=e.pointData[e.edges[n].end],o=0;if(e.isAdded(e.edges[n].start,e.edges[n].end))a.push(-1);else{for(var l=0;l<e.edges.length;l++){var d=e.pointData[e.edges[l].start],c=e.pointData[e.edges[l].end];d.cat!=s.cat&&d.cat!=h.cat&&e.checkEdgeCrossing(s,h,d,c)&&(o+=1)}var g=e.calDistance(s,h),p=e.calEdgeMess(s,h),y=te*o+ee*g/e.maxDis+ie*p;a.push(y)}}for(var f=-1,x=-100,v=0;v<a.length;v++)a[v]>x&&(x=a[v],f=v);var m=e.edges[i[f]];u.m("line").filter((function(){return parseInt(u.l(this).attr("index"))==m.id})).attr("stroke","red").attr("stroke-width",5)}}},{key:"drawPointData",value:function(){var t=this;Kt=this.props.colorArray,this.setState({colorArray:Kt}),u.m("circle").remove(),u.m("rect").remove(),u.l(se).call(u.n().extent([[jt,Vt],[Lt,Xt]]).scaleExtent([1,8]).on("zoom",(function(t){var e=t.transform;u.m("g").attr("transform",e)})));var e=this;var i=u.e().on("start",(function(){console.log("start!");var t=parseInt(u.l(this).attr("index"));e.draggedIndex=t,Gt={},de=[];for(var i=0;i<e.edges.length;i++){var a=e.edges[i].start,r=e.edges[i].end;e.edges[i].new=!1,e.edges[i].rerouting=!1,e.edges[i].startpoint=xe(e.pointData[a]),e.edges[i].endpoint=xe(e.pointData[r]),Gt.hasOwnProperty(a)||(Gt[a]={}),Gt[a][r]=i,de.push(xe(e.edges[i]))}var n=xe(e.pointData[t]);n,n.flag=!1,oe.push(n);var s="#"+u.l(this).attr("id");u.m(s).attr("stroke","red")})).on("drag",(function(t){console.log("dragging points......"),u.l(se);var i=parseInt(u.l(this).attr("index"));if("circle"==e.itemShape){var a="#"+u.l(this).attr("id");u.m(a).attr("cx",t.x).attr("cy",t.y)}else{var r=e.pointData[i].width,n=e.pointData[i].height,s="#"+u.l(this).attr("id");u.m(s).attr("x",t.x-.5*r).attr("y",t.y-.5*n)}e.pointData[i].x=t.x,e.pointData[i].y=t.y;for(var h=[],o=[],l=e.pointData[i].cat,d=0;d<e.edges.length;d++){var c=e.pointData[e.edges[d].start],g=e.pointData[e.edges[d].end],p=G(t.x,t.y,c.x,c.y,g.x,g.y);e.edges[d].start==i||e.edges[d].end==i||l==e.edges[d].cat&&p>=0&&p<2*Qt?h.push(d):l!=e.edges[d].cat&&p>=0&&p<2*Qt&&o.push(d)}for(var y=0;y<h.length;y++){e.deleteEdge(h[y]);for(var f=y+1;f<h.length;f++)h[y]<h[f]&&(h[f]=h[f]-1);for(var x=y+1;x<o.length;x++)h[y]<o[x]&&(o[x]=o[x]-1)}e.optimizeMST(!1);for(var v=function(t){var i=xe(e.edges[o[t]]);i.startpoint=xe(e.pointData[i.start]),i.endpoint=xe(e.pointData[i.end]),i.flag=!1,e.edges[o[t]].preEdge=xe(i),e.edges[o[t]].new=!0,e.edges[o[t]].rerouting=!0,e.surfaceRoutingEdge(e.edges[o[t]]),u.m("line").filter((function(){return parseInt(u.l(this).attr("index"))==o[t]})).remove(),u.m(".controlPoints").filter((function(){return parseInt(u.l(this).attr("edgeindex"))==o[t]})).remove(),e.drawOneEdge(o[t])},m=0;m<o.length;m++)v(m)})).on("end",(function(){console.log("end!");var t=parseInt(u.l(this).attr("index")),i="#"+u.l(this).attr("id");u.m(i).attr("stroke","none");var a=xe(e.pointData[t]);a.id=t,a.flag=!0,oe.push(a),le=[],Yt={};for(var r=0;r<e.edges.length;r++){var n=e.edges[r].start,s=e.edges[r].end;Yt.hasOwnProperty(n)||(Yt[n]={}),Yt[n][s]=r;var h=xe(e.edges[r].virtrualNodes);h.length>0&&h.sort((function(t,e){return t[0]-e[0]}));var o=!0,l=!0;if(Gt.hasOwnProperty(n)&&Gt[n].hasOwnProperty(s)){l=!1;var d=Gt[n][s],c=e.pointData[n],g=e.pointData[s],p=de[d].startpoint,y=de[d].endpoint;if(parseInt(c.x)==parseInt(p.x)&&parseInt(c.y)==parseInt(p.y)&&parseInt(g.x)==parseInt(y.x)&&parseInt(g.y)==parseInt(y.y)){var f=xe(de[d].virtrualNodes);if(h.length==f.length){f.length>0&&f.sort((function(t,e){return t[0]-e[0]}));for(var x=0;x<f.length;x++)if(parseInt(h[x][0])!=parseInt(f[x][0])||parseInt(h[x][1])!=parseInt(f[x][1])){o=!1;break}}else o=!1}else o=!1}if(o){if(Gt.hasOwnProperty(s)&&Gt[s].hasOwnProperty(n)){l=!1;var v=Gt[s][n],m=e.pointData[n],E=e.pointData[s],D=de[v].endpoint,b=de[v].startpoint;if(parseInt(m.x)==parseInt(D.x)&&parseInt(m.y)==parseInt(D.y)&&parseInt(E.x)==parseInt(b.x)&&parseInt(E.y)==parseInt(b.y)){var F=xe(de[v].virtrualNodes);if(h.length==F.length){F.length>0&&F.sort((function(t,e){return t[0]-e[0]}));for(var M=0;M<F.length;M++)if(parseInt(h[M][0])!=parseInt(F[M][0])||parseInt(h[M][1])!=parseInt(F[M][1])){o=!1;break}}else o=!1}else o=!1}if(!o||l){var k=xe(e.edges[r]);k.id=r,k.flag=!0,le.push(k)}}else{var w=xe(e.edges[r]);w.id=r,w.flag=!0,le.push(w)}}for(var I=0;I<de.length;I++){var P=de[I].start,A=de[I].end,C=xe(de[I].virtrualNodes);C.length>0&&C.sort((function(t,e){return t[0]-e[0]}));var N=!0,S=!0;if(Yt.hasOwnProperty(P)&&Yt[P].hasOwnProperty(A)){S=!1;var B=Yt[P][A],_=de[I].startpoint,O=de[I].endpoint,j=e.pointData[P],V=e.pointData[A];if(parseInt(_.x)==parseInt(j.x)&&parseInt(_.y)==parseInt(j.y)&&parseInt(O.x)==parseInt(V.x)&&parseInt(O.y)==parseInt(V.y)){var L=xe(e.edges[B].virtrualNodes);if(C.length==L.length){L.length>0&&L.sort((function(t,e){return t[0]-e[0]}));for(var X=0;X<L.length;X++)if(parseInt(C[X][0])!=parseInt(L[X][0])||parseInt(C[X][1])!=parseInt(L[X][1])){N=!1;break}}else N=!1}else N=!1}if(N){if(Yt.hasOwnProperty(A)&&Yt[A].hasOwnProperty(P)){S=!1;var G=Yt[A][P],Y=de[I].startpoint,U=de[I].endpoint,T=e.pointData[P],R=e.pointData[A];if(parseInt(Y.x)==parseInt(T.x)&&parseInt(Y.y)==parseInt(T.y)&&parseInt(U.x)==parseInt(R.x)&&parseInt(U.y)==parseInt(R.y)){var W=xe(e.edges[G].virtrualNodes);if(C.length==W.length){W.length>0&&W.sort((function(t,e){return t[0]-e[0]}));for(var q=0;q<W.length;q++)if(parseInt(C[q][0])!=parseInt(W[q][0])||parseInt(C[q][1])!=parseInt(W[q][1])){N=!1;break}}else N=!1}else N=!1}if(!N||S){var z=xe(de[I]);z.flag=!1,le.push(z)}}else{var H=xe(de[I]);H.flag=!1,le.push(H)}}e.setState({pointData:e.pointData}),e.setState({edges:e.edges}),e.child.bubbleState()&&e.child.editReDraw(oe,le,e.pointData,e.edges),oe=[],le=[]}));function a(t){if(2!=t.button||e.props.isedit){if(2==t.button&&e.props.isedit){for(var i=parseInt(u.l(t.path[0]).attr("index")),a=e.pointData[i].catArray,r=0;r<a.length;r++)for(var n=a[r],s=0;s<e.catPointDict[n].length;s++)if(e.catPointDict[n][s].id==i){e.catPointDict[n].splice(s,1);break}for(var h=e.edges.length-1;h>=0;h--){var o=e.edges[h].start,l=e.edges[h].end;(o==i||l==i)&&e.edges.splice(h,1)}e.pointData.splice(i,1),u.m("#edgeGroup").remove(),u.m("#pointGroup").remove();for(var d=0;d<e.pointData.length;d++)e.pointData[d].id>i&&(e.pointData[d].id-=1);for(var c=0;c<e.edges.length;c++)e.edges[c].start>i&&(e.edges[c].start-=1),e.edges[c].end>i&&(e.edges[c].end-=1);e.drawPointData(),e.drawEdges(),e.setState({pointData:e.pointData}),e.setState({edges:e.edges}),console.log("delete pointdata!")}}else{console.log("click");var g=parseInt(u.l(this).attr("index"));if(-1==e.lastClickIndex){e.lastClickIndex=g,e.lastClickItem=u.l(this).attr("stroke","red").attr("stroke-width",5).attr("selected",!0);var p="#"+u.l(this).attr("id");u.m(p).attr("stroke","red").attr("stroke-width",5).attr("selected",!0)}else if(g==e.lastClickIndex){e.lastClickIndex=-1,e.lastClickItem=null,u.l(this).attr("stroke","red").attr("stroke-width",1).attr("selected",!1);var y="#"+u.l(this).attr("id");u.m(y).attr("stroke","red").attr("stroke-width",1).attr("selected",!1)}else{var f=e.lastClickItem.attr("category");if(f==u.l(this).attr("category")){if(!e.hasLinked(e.lastClickIndex,g)){e.addEdge(e.lastClickIndex,g,f),e.addedEdge.push([e.lastClickIndex,g]);var x=xe(e.edges[e.edges.length-1]);x.id=e.edges.length-1,x.flag=!0,le.push(x),e.setState({pointData:e.pointData}),e.setState({edges:e.edges}),e.child.bubbleState()&&e.child.editReDraw(oe,le,e.pointData,e.edges),oe=[],le=[],e.findCircle(f)}e.lastClickItem.attr("stroke-width",1).attr("stroke","none").attr("selected",!1);var v="#"+e.lastClickItem.attr("id");u.m(v).attr("stroke-width",1).attr("stroke","none").attr("selected",!1),e.lastClickItem=null,e.lastClickIndex=-1,e.optimizeMST(!0)}else{e.lastClickItem.attr("stroke-width",1).attr("stroke","none").attr("selected",!1);var m="#"+e.lastClickItem.attr("id");u.m(m).attr("stroke-width",1).attr("stroke","none").attr("selected",!1),m="#"+u.l(this).attr("id"),e.lastClickItem=u.l(this).attr("stroke","red").attr("stroke-width",5).attr("selected",!0).attr("id",u.l(this).attr("id")),u.m(m).attr("stroke","red").attr("stroke-width",5).attr("selected",!0),e.lastClickIndex=g}}}}var r=[];if(u.l(se).append("g").attr("id","pointGroup"),u.l(he).append("g").attr("id","pointGroup"),"circle"==this.itemShape){for(var n=function(r){var n=r;u.l(se).select("#pointGroup").append("circle").attr("class","dataPoint").attr("id","point"+n).attr("cx",t.pointData[r].x).attr("cy",t.pointData[r].y).attr("r",t.pointData[r].radius).attr("fill",(function(t,i){return Kt[e.pointData[n].catArray[e.pointData[n].catArray.length-1]]})).attr("category",t.pointData[r].cat).attr("index",n).on("mouseover",(function(t,i){u.l(this).attr("stroke","red"),console.log(e.pointData[n])})).on("mouseout",(function(){"true"!=u.l(this).attr("selected")&&u.l(this).attr("stroke","none")})).on("mousedown",a).call(i),u.l(he).select("#pointGroup").append("circle").attr("class","dataPoint").attr("id","point"+n).attr("cx",t.pointData[r].x).attr("cy",t.pointData[r].y).attr("r",t.pointData[r].radius).attr("fill",(function(t,i){return Kt[e.pointData[n].catArray[e.pointData[n].catArray.length-1]]})).attr("category",t.pointData[r].cat).attr("index",n).on("mouseover",(function(t,i){u.l(this).attr("stroke","red"),console.log(e.pointData[n])})).on("mouseout",(function(){"true"!=u.l(this).attr("selected")&&u.l(this).attr("stroke","none")})).on("mousedown",a).call(i)},s=0;s<this.pointData.length;s++)n(s);r=document.getElementsByClassName("dataPoint");for(var h=0;h<r.length;h++)this.itemBBox.push({id:r[h].getAttribute("index"),bbox:r[h].getBBox()})}else if("rectangle"==this.itemShape){for(var o=function(r){var n=r;u.l(se).select("#pointGroup").append("rect").attr("class","dataPoint").attr("id","point"+n).attr("x",t.pointData[r].x-t.pointData[r].width/2).attr("y",t.pointData[r].y-t.pointData[r].height/2).attr("width",t.pointData[r].width).attr("height",t.pointData[r].height).attr("fill",(function(){return Kt[e.pointData[n].catArray[e.pointData[n].catArray.length-1]]})).attr("category",t.pointData[r].cat).attr("index",n).on("mouseover",(function(t,i){u.l(this).attr("stroke","red"),console.log(e.pointData[n])})).on("mouseout",(function(){"true"!=u.l(this).attr("selected")&&u.l(this).attr("stroke","none")})).on("mousedown",a).call(i),u.l(he).select("#pointGroup").append("rect").attr("class","dataPoint").attr("id","point"+n).attr("x",t.pointData[r].x-t.pointData[r].width/2).attr("y",t.pointData[r].y-t.pointData[r].height/2).attr("width",t.pointData[r].width).attr("height",t.pointData[r].height).attr("fill",(function(){return Kt[e.pointData[n].catArray[e.pointData[n].catArray.length-1]]})).attr("category",t.pointData[r].cat).attr("index",n).on("mouseover",(function(t,i){u.l(this).attr("stroke","red"),console.log(e.pointData[n])})).on("mouseout",(function(){"true"!=u.l(this).attr("selected")&&u.l(this).attr("stroke","none")})).on("mousedown",a).call(i)},l=0;l<this.pointData.length;l++)o(l);r=document.getElementsByClassName("dataPoint");for(var d=0;d<r.length;d++)this.itemBBox.push({id:r[d].getAttribute("index"),bbox:r[d].getBBox()})}}},{key:"countEdgeCrossingWithRouting",value:function(){for(var t=0,e=0;e<this.edges.length;e++){var i=[],a=this.pointData[this.edges[e].start],r=this.pointData[this.edges[e].end];if(this.edges[e].virtrual){var n=this.edges[e].virtrualNodes;i.push([a.x,a.y]);for(var s=0;s<n.length;s++)i.push(n[s]);i.push([r.x,r.y])}else i.push([a.x,a.y]),i.push([r.x,r.y]);for(var h=e+1;h<this.edges.length;h++){var o=[],l=this.pointData[this.edges[h].start],d=this.pointData[this.edges[h].end];if(a.cat!=l.cat){if(this.edges[h].virtrual){var c=this.edges[h].virtrualNodes;o.push([l.x,l.y]);for(var g=0;g<c.length;g++)o.push(c[g]);o.push([d.x,d.y])}else o.push([l.x,l.y]),o.push([d.x,d.y]);for(var u=0;u<i.length-1;u++)for(var p={x:i[u][0],y:i[u][1]},y={x:i[u+1][0],y:i[u+1][1]},f=0;f<o.length-1;f++){var x={x:o[f][0],y:o[f][1]},v={x:o[f+1][0],y:o[f+1][1]};this.checkEdgeCrossing(p,y,x,v)&&(t+=1)}}}}console.log("num of edge crossing:"+t)}},{key:"countEdgeCrossing",value:function(){for(var t=0,e=0;e<this.edges.length;e++)for(var i=this.pointData[this.edges[e].start],a=this.pointData[this.edges[e].end],r=e+1;r<this.edges.length;r++){var n=this.pointData[this.edges[r].start],s=this.pointData[this.edges[r].end];i.cat!=n.cat&&this.checkEdgeCrossing(i,a,n,s)&&(t+=1)}console.log("num of edge crossing: "+t)}},{key:"createLocalTree",value:function(t){for(var e=0,i=0,a=0;a<t.length;a++)e+=t[a].x,i+=t[a].y;for(var r={x:e/=t.length,y:i/=t.length},n=Number.MAX_VALUE,s=-1,h=0;h<t.length;h++){var o=this.calDistance(r,t[h]);o<n&&(n=o,s=h)}for(var l=0;l<t.length;l++)l!=s&&(this.edges.push({start:t[s].id,end:t[l].id,virtrual:!1,virtrualNodes:[],cat:t[l].cat,isLocalTree:!0}),this.graph.addEdge(t[s].id,t[l].id))}},{key:"initWithNoCluster",value:function(){for(var t in this.catPointDict){this.clusterDict[t]=[];for(var e=0;e<this.catPointDict[t].length;e++)this.clusterDict[t].push([this.catPointDict[t][e]])}console.log(this.clusterDict)}},{key:"generateTreeWithHierarchical",value:function(){this.initWithNoCluster();for(var t=[],e=0;e<this.edges.length;e++){for(var i=this.pointData[this.edges[e].start],a=this.pointData[this.edges[e].end],r=i.cat,n=this.clusterDict[r],s=-1,h=-1,o=0;o<n.length;o++){for(var l=0;l<n[o].length&&(n[o][l].id==i.id&&(s=o),n[o][l].id==a.id&&(h=o),-1==s||-1==h);l++);if(-1!=s&&-1!=h)break}if(-1!=s&&-1!=h&&s!=h){for(var d=n[s],c=0;c<n[h].length;c++)d.push(n[h][c]);for(var g=[],u=0;u<n.length;u++)u!=s&&u!=h&&g.push(n[u]);g.push(d),this.clusterDict[r]=g,t.push([r,g.length-1]),console.log(r)}}for(var p in this.createGraphWithCluster(),this.clusterDict){this.clustergraphInfo[p]={edgesnum:0,nodesnum:this.clusterDict[p].length};for(var y=0;y<this.clusterDict[p].length;y++){for(var f=!1,x=0;x<t.length;x++){var v=t[x][0],m=t[x][1];p==v&&m==y&&(f=!0)}f||this.createLocalTree(this.clusterDict[p][y])}}this.drawEdges(),this.hierarchicalMergeV2()}},{key:"findCluster",value:function(){for(var t in this.catPointDict){for(var e=new $t.DBSCAN,i=[],a=[],r=0;r<this.catPointDict[t].length;r++)i.push([this.catPointDict[t][r].x,this.catPointDict[t][r].y]),a.push(this.pointData[this.catPointDict[t][r].id]);if(i.length>0){this.clusterDict[t]=[],this.noiseDict[t]=[];for(var n=e.run(i,Zt,2),s=0;s<n.length;s++){for(var h=[],o=0;o<n[s].length;o++)h.push(a[n[s][o]]);this.clusterDict[t].push(h)}for(var l=0;l<e.noise.length;l++)this.clusterDict[t].push([a[e.noise[l]]])}}}},{key:"createGraph",value:function(){}},{key:"createGraphWithCluster",value:function(){var t=[],e=0;for(var i in this.clusterDict)for(var a=0;a<this.clusterDict[i].length;a++)t.push({points:this.clusterDict[i][a],cat:i,id:e}),this.clusterDict[i][a].id=e,e+=1;this.clusterArr=t;for(var r=new Jt.Graph(this.clusterArr.length),n=0;n<r.V;n++)r.node(n).label=this.clusterArr[n].cat;this.clustergraph=r,console.log(r.V);for(var s=new Jt.Graph(this.pointData.length),h=0;h<s.V;h++)s.node(h).label=this.pointData[h].cat;this.graph=s;for(var o=0;o<this.edges.length;o++)this.graph.addEdge(this.edges[o].start,this.edges[o].end)}},{key:"calClusterDistance",value:function(t,e){for(var i=Number.MAX_VALUE,a=0;a<t.length;a++)for(var r=0;r<e.length;r++){var n=this.calDistance(t[a],e[r]);n<i&&(i=n)}return i}},{key:"sortEdgesGlobalWithCluster",value:function(){var t=[],e=[],i=[],a=Number.MIN_VALUE;for(var r in this.clusterDict)for(var n=0;n<this.clusterDict[r].length;n++)for(var s=n+1;s<this.clusterDict[r].length;s++){var h=this.calClusterDistance(this.clusterDict[r][n],this.clusterDict[r][s]);e.push(h),h>a&&(a=h),i.push([this.clusterDict[r][n].id,this.clusterDict[r][s].id,h])}this.maxDistance=a;for(var o=0;o<i.length;o++){var l=i[o][0],d=i[o][1],c=i[o][2]/a,g=c;t.push([l,d,g,c])}return t.sort((function(t,e){return t[2]-e[2]})),t}},{key:"findLinkBetweenCluster",value:function(t,e){for(var i=Number.MAX_VALUE,a=null,r=null,n=!1,s=0;s<t.length;s++)for(var h=t[s],o=0;o<e.length;o++){var l=e[o];if(!this.checkNewEdge(h,l)){n=!0;var d=this.calDistance(h,l);d<i&&(i=d,a=h,r=l)}}return[n,a,r,i]}},{key:"findOptimalLink",value:function(t,e){for(var i=Number.MAX_VALUE,a=null,r=null,n=Number.MAX_VALUE,s=0;s<t.length;s++)for(var h=t[s],o=0;o<e.length;o++){for(var l=e[o],d=0,c=0;c<this.edges.length;c++){var g=this.pointData[this.edges[c].start],u=this.pointData[this.edges[c].end];g.cat!=h.cat&&g.cat!=l.cat&&this.checkEdgeCrossing(h,l,g,u)&&(d+=1)}var p=this.calDistance(h,l),y=this.calEdgeMess(h,l);d>ae&&(ae=d);var f=te*d+ee*p/this.maxDis+ie*y;f<i&&(a=h,r=l,i=f),p<re&&f<n&&(h,l,n=f,!0)}return[a,r,i,this.calDistance(a,r)]}},{key:"findMinScoreTest",value:function(t){for(var e=Number.MAX_VALUE,i=-1,a=Number.MAX_VALUE,r=-1,n=!1,s=t.length-1;s>=0;s--){var h=t[s].clusterid1,o=t[s].clusterid2;this.checkConnectBetweenTwoCluster(h,o)||(t[s].score<e&&(e=t[s].score,i=s),t[s].distance<re&&t[s].score<a&&(a=t[s].score,r=s,n=!0))}return n?t[r]:t[i]}},{key:"findMinScore",value:function(t){for(var e=Number.MAX_VALUE,i=-1,a=Number.MAX_VALUE,r=-1,n=!1,s=0;s<t.length;s++)t[s].score<e&&(e=t[s].score,i=s),t[s].distance<re&&t[s].score<a&&(a=t[s].score,r=s,n=!0);return n?t[r]:t[i]}},{key:"findCrossingBetweenEdgeRect",value:function(t,e,i){for(var a=[],r={x:t[0],y:t[1]},n={x:e[0],y:e[1]},s=0;s<this.itemBBox.length;s++){var h=parseInt(this.itemBBox[s].id);if(i!=this.pointData[h].cat){var o=qt.rectangle({top:this.itemBBox[s].bbox.y,left:this.itemBBox[s].bbox.x,width:this.itemBBox[s].bbox.width,height:this.itemBBox[s].bbox.height}),l=qt.line([r.x,r.y],[n.x,n.y]),d=zt.intersect(o,l);if("Intersection"==d.status&&d.points.length>1){a.push({rect:this.itemBBox[s].bbox,points:d.points});break}}}return a}},{key:"checkVNodeInBound",value:function(t,e){for(var i=0;i<this.itemBBox.length;i++){var a=parseInt(this.itemBBox[i].id);if(e!=this.pointData[a].cat)if(Ht.pointInRectangle({x:t[0],y:t[1]},{x:this.itemBBox[i].bbox.x,y:this.itemBBox[i].bbox.y},{x:this.itemBBox[i].bbox.x+this.itemBBox[i].bbox.width,y:this.itemBBox[i].bbox.y+this.itemBBox[i].bbox.height}))return!0}return!1}},{key:"isAdded",value:function(t,e){for(var i=0;i<this.addedEdge.length;i++)if(this.addedEdge[i][0]==t&&this.addedEdge[i][1]==e||this.addedEdge[i][0]==e&&this.addedEdge[i][1]==t)return!0;return!1}},{key:"isDeleted",value:function(t,e){for(var i=0;i<this.deletedEdge.length;i++)if(this.deletedEdge[i][0]==t&&this.deletedEdge[i][1]==e||this.deletedEdge[i][0]==e&&this.deletedEdge[i][1]==t)return!0;return!1}},{key:"addLinksTest",value:function(t,e,i,a,r,n){for(var s=0;s<a.length;s++)for(var h=a[s],o=0;o<r.length;o++){var l=r[o],d=this.calDistance(h,l),c=this.calEdgeMess(h,l),g={clusterid1:t,clusterid2:e,start:h,end:l,score:0*te+ee*d/this.maxDis+ie*c,distance:d,cat:i,idx:this.idx,pid:-1};n.push(g),this.idx++}}},{key:"addLinks",value:function(t,e,i,a,r,n,s){for(var h=0;h<a.length;h++)for(var o=a[h],l=0;l<r.length;l++){for(var d=r[l],c=0,g=0;g<this.edges.length;g++){var u=this.pointData[this.edges[g].start],p=this.pointData[this.edges[g].end];u.cat!=o.cat&&u.cat!=d.cat&&this.checkEdgeCrossing(o,d,u,p)&&(c+=1)}var y=this.calDistance(o,d),f=this.calEdgeMess(o,d),x={clusterid1:t,clusterid2:e,start:o,end:d,score:te*c+ee*y/this.maxDis+ie*f,distance:y,cat:i,idx:this.idx,pid:-1};this.isDeleted(o.id,d.id)?(x.score=Number.MAX_VALUE,s._d[this.idx]=x,s.enq(this.idx),this.idx++):this.isAdded(o.id,d.id)?(x.score=-1,n._d[this.idx]=x,n.enq(this.idx),this.idx++):y<re?(n._d[this.idx]=x,n.enq(this.idx),this.idx++):(s._d[this.idx]=x,s.enq(this.idx),this.idx++)}}},{key:"findBestLink",value:function(t){for(var e,i=Number.MAX_VALUE,a=t.length-1;a>=0;a--){var r=t[a].clusterid1,n=t[a].clusterid2;this.checkConnectBetweenTwoClusterV2(r,n)?t.splice(a,1):i>t[a].score&&(e=t[a],i=t[a].score)}return e}},{key:"recalculateSpanningTreeAfterEdit",value:function(t){var e=[];ie=this.pointData.length<150?0:1,this.f=[];var i=0;for(var a in this.clusterDict)i+=this.clusterDict[a].length;for(var r=0;r<=i;r++)this.f.push(r);var n=new ne({}),s=new ne({});for(var h in this.clusterDict)for(var o=0;o<this.clusterDict[h].length;o++)for(var l=this.clusterDict[h][o].id,d=o+1;d<this.clusterDict[h].length;d++){var c=this.clusterDict[h][d].id;this.addLinks(l,c,h,this.clusterDict[h][o],this.clusterDict[h][d],n,s)}for(;!this.checkConnectBetweenAllCluster();){var g=void 0;if(n.isEmpty()){if(s.isEmpty())break;g=s._d[s.deq()]}else g=n._d[n.deq()];this.unionFather(g.clusterid1,g.clusterid2),n.modify_Kruskal_V2(g.start,g.end,this.f,te),s.modify_Kruskal_V2(g.start,g.end,this.f,te),this.clustergraph.addEdge(g.clusterid1,g.clusterid2),this.clustergraphInfo[g.cat].edgesnum+=1,t.push({start:g.start.id,end:g.end.id,weight:g.score,cat:g.cat,dis:g.score,virtrual:!1,virtrualNodes:[],isLocalTree:!1}),this.graph.addEdge(g.start.id,g.end.id);var u=this.pointData[g.start.id],p=this.pointData[g.end.id],y=this.pointData[g.start.id].cat,f=[];f.push([u.x,u.y]),f.push([p.x,p.y]);for(var x=[{start:[u.x,u.y],end:[p.x,p.y],ids:[0,1]}];x.length>0;){var v=5,m=!1,E=x.pop();u=E.start,p=E.end;var D=E.ids,b=this.findCrossingBetweenEdgeRect(u,p,y);if(0!=b.length){t[t.length-1].virtrual=!0;var F=b[0].points,M=b[0].rect,k=[[M.x,M.y],[M.x+M.width,M.y]],w=[[M.x,M.y+M.height],[M.x+M.width,M.y+M.height]],I=[[M.x,M.y],[M.x,M.y+M.height]],P=[[M.x+M.width,M.y],[M.x+M.width,M.y+M.height]],A=F[0],C=F[1],N=void 0;if(k[1][1]==A.y&&w[1][1]==C.y||w[1][1]==A.y&&k[1][1]==C.y||I[0][0]==A.x&&P[0][0]==C.x||I[0][0]==C.x&&P[0][0]==A.x){var S=-1;if(k[1][1]==A.y&&w[1][1]==C.y){var B=A.x-M.x,_=C.x-M.x;S=B+_<M.width?B>_?3:2:B<_?4:1}else if(w[1][1]==A.y&&k[1][1]==C.y){var O=C.x-M.x,j=A.x-M.x;S=O+j<M.width?O>j?3:2:O<j?4:1}else if(I[0][0]==A.x&&P[0][0]==C.x){var V=A.y-M.y,L=C.y-M.y;S=V+L<M.width?V>L?3:4:V<L?2:1}else if(I[0][0]==C.x&&P[0][0]==A.x){var X=C.y-M.y,G=A.y-M.y;S=X+G<M.width?X>G?3:4:X<G?2:1}for(var Y=[],U=0,T=-1,R=-1;;){1==S?Y=m?[M.x+M.width,M.y+M.height]:[M.x,M.y]:2==S?Y=m?[M.x,M.y+M.height]:[M.x+M.width,M.y]:3==S?Y=m?[M.x,M.y]:[M.x+M.width,M.y+M.height]:4==S&&(Y=m?[M.x+M.width,M.y]:[M.x,M.y+M.height]);var W=[M.x+M.width/2,M.y+M.height/2],q=[Y[0]-W[0],Y[1]-W[1]],z=this.getVecNorm(q);if(q[0]=q[0]/z,q[1]=q[1]/z,N=[Y[0]+v*q[0],Y[1]+v*q[1]],this.checkVNodeInBound(N,y)){if(m||(v/=1.5),m=!m,(U+=1)>10)break}else if(m?T=N:R=N,m=!m,-1!=T&&-1!=R)break}if(-1==T&&-1==R){t[t.length-1].virtrual=!1;continue}if(-1!=T&&-1!=R){for(var H=Number.MAX_VALUE,K=null,J=[T,R],Q=0;Q<J.length;Q++){for(var Z=J[Q],$=0,tt=0;tt<t.length;tt++){var et=this.pointData[t[tt].start],it=this.pointData[t[tt].end];if(et.cat!=y){var at={x:u[0],y:u[1],cat:y},rt={x:Z[0],y:Z[1],cat:y},nt={x:p[0],y:p[1],cat:y};this.checkEdgeCrossing(et,it,at,rt)&&($+=1),this.checkEdgeCrossing(et,it,rt,nt)&&($+=1)}}$<H&&(H=$,K=J[Q])}N=K}else N=-1!=T?T:R}else{var st=[A.x,C.y],ht=[];st[0]==M.x&&st[1]==M.y?ht=[M.x,M.y]:st[0]==M.x+M.width&&st[1]==M.y?ht=[M.x+M.width,M.y]:st[0]==M.x+M.width&&st[1]==M.y+M.height?ht=[M.x+M.width,M.y+M.height]:st[0]==M.x&&st[1]==M.y+M.height?ht=[M.x,M.y+M.height]:(st=[C.x,A.y])[0]==M.x&&st[1]==M.y?ht=[M.x,M.y]:st[0]==M.x+M.width&&st[1]==M.y?ht=[M.x+M.width,M.y]:st[0]==M.x+M.width&&st[1]==M.y+M.height?ht=[M.x+M.width,M.y+M.height]:st[0]==M.x&&st[1]==M.y+M.height&&(ht=[M.x,M.y+M.height]);var ot=[M.x+M.width/2,M.y+M.height/2],lt=[ht[0]-ot[0],ht[1]-ot[1]],dt=this.getVecNorm(lt);lt[0]=lt[0]/dt,lt[1]=lt[1]/dt,N=[ht[0]+v*lt[0],ht[1]+v*lt[1]]}for(var ct=!1,gt=0;gt<f.length;gt++)if(N[0]==f[gt][0]&&N[1]==f[gt][1]){ct=!0;break}if(!ct){var ut;ut=D[0]+1,f.splice(ut,0,N);for(var pt=0;pt<x.length;pt++)x[pt].ids[0]>=ut&&(x[pt].ids[0]=x[pt].ids[0]+1),x[pt].ids[1]>=ut&&(x[pt].ids[1]=x[pt].ids[1]+1);x.push({start:u,end:N,ids:[D[0],ut]}),x.push({start:N,end:p,ids:[ut,D[1]+1]})}}}f.pop(),f.splice(0,1),t[t.length-1].virtrualNodes=f,e.push(t.length-1)}return e}},{key:"recalculateSpanningTree",value:function(){var t=[];ie=this.pointData.length<150?0:1,this.f=[];var e=0;for(var i in this.clusterDict)e+=this.clusterDict[i].length;for(var a=0;a<=e;a++)this.f.push(a);var r=new ne({}),n=new ne({});for(var s in this.clusterDict)for(var h=0;h<this.clusterDict[s].length;h++)for(var o=this.clusterDict[s][h].id,l=h+1;l<this.clusterDict[s].length;l++){var d=this.clusterDict[s][l].id;this.addLinks(o,d,s,this.clusterDict[s][h],this.clusterDict[s][l],r,n)}for(;!this.checkConnectBetweenAllCluster();){var c=void 0;if(r.isEmpty()){if(n.isEmpty())break;c=n._d[n.deq()]}else c=r._d[r.deq()];this.unionFather(c.clusterid1,c.clusterid2),r.modify_Kruskal_V2(c.start,c.end,this.f,te),n.modify_Kruskal_V2(c.start,c.end,this.f,te),this.clustergraph.addEdge(c.clusterid1,c.clusterid2),this.clustergraphInfo[c.cat].edgesnum+=1,this.edges.push({start:c.start.id,end:c.end.id,weight:c.score,cat:c.cat,dis:c.score,virtrual:!1,virtrualNodes:[],isLocalTree:!1}),this.graph.addEdge(c.start.id,c.end.id);var g=this.pointData[c.start.id],u=this.pointData[c.end.id],p=this.pointData[c.start.id].cat,y=[];y.push([g.x,g.y]),y.push([u.x,u.y]);for(var f=[{start:[g.x,g.y],end:[u.x,u.y],ids:[0,1]}];f.length>0;){var x=5,v=!1,m=f.pop();g=m.start,u=m.end;var E=m.ids,D=this.findCrossingBetweenEdgeRect(g,u,p);if(0!=D.length){this.edges[this.edges.length-1].virtrual=!0;var b=D[0].points,F=D[0].rect,M=[[F.x,F.y],[F.x+F.width,F.y]],k=[[F.x,F.y+F.height],[F.x+F.width,F.y+F.height]],w=[[F.x,F.y],[F.x,F.y+F.height]],I=[[F.x+F.width,F.y],[F.x+F.width,F.y+F.height]],P=b[0],A=b[1],C=void 0;if(M[1][1]==P.y&&k[1][1]==A.y||k[1][1]==P.y&&M[1][1]==A.y||w[0][0]==P.x&&I[0][0]==A.x||w[0][0]==A.x&&I[0][0]==P.x){var N=-1;if(M[1][1]==P.y&&k[1][1]==A.y){var S=P.x-F.x,B=A.x-F.x;N=S+B<F.width?S>B?3:2:S<B?4:1}else if(k[1][1]==P.y&&M[1][1]==A.y){var _=A.x-F.x,O=P.x-F.x;N=_+O<F.width?_>O?3:2:_<O?4:1}else if(w[0][0]==P.x&&I[0][0]==A.x){var j=P.y-F.y,V=A.y-F.y;N=j+V<F.width?j>V?3:4:j<V?2:1}else if(w[0][0]==A.x&&I[0][0]==P.x){var L=A.y-F.y,X=P.y-F.y;N=L+X<F.width?L>X?3:4:L<X?2:1}for(var G=[],Y=0,U=-1,T=-1;;){1==N?G=v?[F.x+F.width,F.y+F.height]:[F.x,F.y]:2==N?G=v?[F.x,F.y+F.height]:[F.x+F.width,F.y]:3==N?G=v?[F.x,F.y]:[F.x+F.width,F.y+F.height]:4==N&&(G=v?[F.x+F.width,F.y]:[F.x,F.y+F.height]);var R=[F.x+F.width/2,F.y+F.height/2],W=[G[0]-R[0],G[1]-R[1]],q=this.getVecNorm(W);if(W[0]=W[0]/q,W[1]=W[1]/q,C=[G[0]+x*W[0],G[1]+x*W[1]],this.checkVNodeInBound(C,p)){if(v||(x/=1.5),v=!v,(Y+=1)>10)break}else if(v?U=C:T=C,v=!v,-1!=U&&-1!=T)break}if(-1==U&&-1==T){this.edges[this.edges.length-1].virtrual=!1;continue}if(-1!=U&&-1!=T){for(var z=Number.MAX_VALUE,H=null,K=[U,T],J=0;J<K.length;J++){for(var Q=K[J],Z=0,$=0;$<this.edges.length;$++){var tt=this.pointData[this.edges[$].start],et=this.pointData[this.edges[$].end];if(tt.cat!=p){var it={x:g[0],y:g[1],cat:p},at={x:Q[0],y:Q[1],cat:p},rt={x:u[0],y:u[1],cat:p};this.checkEdgeCrossing(tt,et,it,at)&&(Z+=1),this.checkEdgeCrossing(tt,et,at,rt)&&(Z+=1)}}Z<z&&(z=Z,H=K[J])}C=H}else C=-1!=U?U:T}else{var nt=[P.x,A.y],st=[];nt[0]==F.x&&nt[1]==F.y?st=[F.x,F.y]:nt[0]==F.x+F.width&&nt[1]==F.y?st=[F.x+F.width,F.y]:nt[0]==F.x+F.width&&nt[1]==F.y+F.height?st=[F.x+F.width,F.y+F.height]:nt[0]==F.x&&nt[1]==F.y+F.height?st=[F.x,F.y+F.height]:(nt=[A.x,P.y])[0]==F.x&&nt[1]==F.y?st=[F.x,F.y]:nt[0]==F.x+F.width&&nt[1]==F.y?st=[F.x+F.width,F.y]:nt[0]==F.x+F.width&&nt[1]==F.y+F.height?st=[F.x+F.width,F.y+F.height]:nt[0]==F.x&&nt[1]==F.y+F.height&&(st=[F.x,F.y+F.height]);var ht=[F.x+F.width/2,F.y+F.height/2],ot=[st[0]-ht[0],st[1]-ht[1]],lt=this.getVecNorm(ot);ot[0]=ot[0]/lt,ot[1]=ot[1]/lt,C=[st[0]+x*ot[0],st[1]+x*ot[1]]}for(var dt=!1,ct=0;ct<y.length;ct++)if(C[0]==y[ct][0]&&C[1]==y[ct][1]){dt=!0;break}if(!dt){var gt;gt=E[0]+1,y.splice(gt,0,C);for(var ut=0;ut<f.length;ut++)f[ut].ids[0]>=gt&&(f[ut].ids[0]=f[ut].ids[0]+1),f[ut].ids[1]>=gt&&(f[ut].ids[1]=f[ut].ids[1]+1);f.push({start:g,end:C,ids:[E[0],gt]}),f.push({start:C,end:u,ids:[gt,E[1]+1]})}}}y.pop(),y.splice(0,1),this.edges[this.edges.length-1].virtrualNodes=y,t.push(this.edges.length-1)}return t}},{key:"hierarchicalMergeV2",value:function(){ie=this.pointData.length<150?0:1,this.f=[];var t=0;for(var e in this.clusterDict)t+=this.clusterDict[e].length;for(var i=0;i<=t;i++)this.f.push(i);var a=new ne({}),r=new ne({});for(var n in this.clusterDict)for(var s=0;s<this.clusterDict[n].length;s++)for(var h=this.clusterDict[n][s].id,o=s+1;o<this.clusterDict[n].length;o++){var l=this.clusterDict[n][o].id;this.addLinks(h,l,n,this.clusterDict[n][s],this.clusterDict[n][o],a,r)}for(;!this.checkConnectBetweenAllClusterV2();){var d=void 0;if(a.isEmpty()){if(r.isEmpty())break;d=r._d[r.deq()]}else d=a._d[a.deq()];this.unionFather(d.clusterid1,d.clusterid2),a.modify_Kruskal_V2(d.start,d.end,this.f,te),r.modify_Kruskal_V2(d.start,d.end,this.f,te),this.clustergraph.addEdge(d.clusterid1,d.clusterid2),this.clustergraphInfo[d.cat].edgesnum+=1,this.edges.push({start:d.start.id,end:d.end.id,weight:d.score,cat:d.cat,dis:d.score,virtrual:!1,virtrualNodes:[],isLocalTree:!1}),this.graph.addEdge(d.start.id,d.end.id),this.drawEdges(),console.log();var c=this.pointData[d.start.id],g=this.pointData[d.end.id],u=this.pointData[d.start.id].cat,p=[];p.push([c.x,c.y]),p.push([g.x,g.y]);for(var y=[{start:[c.x,c.y],end:[g.x,g.y],ids:[0,1]}];y.length>0;){var f=5,x=!1,v=y.pop();c=v.start,g=v.end;var m=v.ids,E=this.findCrossingBetweenEdgeRect(c,g,u);if(0!=E.length){this.edges[this.edges.length-1].virtrual=!0;var D=E[0].points,b=E[0].rect,F=[[b.x,b.y],[b.x+b.width,b.y]],M=[[b.x,b.y+b.height],[b.x+b.width,b.y+b.height]],k=[[b.x,b.y],[b.x,b.y+b.height]],w=[[b.x+b.width,b.y],[b.x+b.width,b.y+b.height]],I=D[0],P=D[1],A=void 0;if(F[1][1]==I.y&&M[1][1]==P.y||M[1][1]==I.y&&F[1][1]==P.y||k[0][0]==I.x&&w[0][0]==P.x||k[0][0]==P.x&&w[0][0]==I.x){var C=-1;if(F[1][1]==I.y&&M[1][1]==P.y){var N=I.x-b.x,S=P.x-b.x;C=N+S<b.width?N>S?3:2:N<S?4:1}else if(M[1][1]==I.y&&F[1][1]==P.y){var B=P.x-b.x,_=I.x-b.x;C=B+_<b.width?B>_?3:2:B<_?4:1}else if(k[0][0]==I.x&&w[0][0]==P.x){var O=I.y-b.y,j=P.y-b.y;C=O+j<b.width?O>j?3:4:O<j?2:1}else if(k[0][0]==P.x&&w[0][0]==I.x){var V=P.y-b.y,L=I.y-b.y;C=V+L<b.width?V>L?3:4:V<L?2:1}for(var X=[],G=0,Y=-1,U=-1;;){1==C?X=x?[b.x+b.width,b.y+b.height]:[b.x,b.y]:2==C?X=x?[b.x,b.y+b.height]:[b.x+b.width,b.y]:3==C?X=x?[b.x,b.y]:[b.x+b.width,b.y+b.height]:4==C&&(X=x?[b.x+b.width,b.y]:[b.x,b.y+b.height]);var T=[b.x+b.width/2,b.y+b.height/2],R=[X[0]-T[0],X[1]-T[1]],W=this.getVecNorm(R);if(R[0]=R[0]/W,R[1]=R[1]/W,A=[X[0]+f*R[0],X[1]+f*R[1]],this.checkVNodeInBound(A,u)){if(x||(f/=1.5),x=!x,(G+=1)>10)break}else if(x?Y=A:U=A,x=!x,-1!=Y&&-1!=U)break}if(-1==Y&&-1==U){this.edges[this.edges.length-1].virtrual=!1;continue}if(-1!=Y&&-1!=U){for(var q=Number.MAX_VALUE,z=null,H=[Y,U],K=0;K<H.length;K++){for(var J=H[K],Q=0,Z=0;Z<this.edges.length;Z++){var $=this.pointData[this.edges[Z].start],tt=this.pointData[this.edges[Z].end];if($.cat!=u){var et={x:c[0],y:c[1],cat:u},it={x:J[0],y:J[1],cat:u},at={x:g[0],y:g[1],cat:u};this.checkEdgeCrossing($,tt,et,it)&&(Q+=1),this.checkEdgeCrossing($,tt,it,at)&&(Q+=1)}}Q<q&&(q=Q,z=H[K])}A=z}else A=-1!=Y?Y:U}else{var rt=[I.x,P.y],nt=[];rt[0]==b.x&&rt[1]==b.y?nt=[b.x,b.y]:rt[0]==b.x+b.width&&rt[1]==b.y?nt=[b.x+b.width,b.y]:rt[0]==b.x+b.width&&rt[1]==b.y+b.height?nt=[b.x+b.width,b.y+b.height]:rt[0]==b.x&&rt[1]==b.y+b.height?nt=[b.x,b.y+b.height]:(rt=[P.x,I.y])[0]==b.x&&rt[1]==b.y?nt=[b.x,b.y]:rt[0]==b.x+b.width&&rt[1]==b.y?nt=[b.x+b.width,b.y]:rt[0]==b.x+b.width&&rt[1]==b.y+b.height?nt=[b.x+b.width,b.y+b.height]:rt[0]==b.x&&rt[1]==b.y+b.height&&(nt=[b.x,b.y+b.height]);var st=[b.x+b.width/2,b.y+b.height/2],ht=[nt[0]-st[0],nt[1]-st[1]],ot=this.getVecNorm(ht);ht[0]=ht[0]/ot,ht[1]=ht[1]/ot,A=[nt[0]+f*ht[0],nt[1]+f*ht[1]]}for(var lt=!1,dt=0;dt<p.length;dt++)if(A[0]==p[dt][0]&&A[1]==p[dt][1]){lt=!0;break}if(!lt){var ct;ct=m[0]+1,p.splice(ct,0,A);for(var gt=0;gt<y.length;gt++)y[gt].ids[0]>=ct&&(y[gt].ids[0]=y[gt].ids[0]+1),y[gt].ids[1]>=ct&&(y[gt].ids[1]=y[gt].ids[1]+1);y.push({start:c,end:A,ids:[m[0],ct]}),y.push({start:A,end:g,ids:[ct,m[1]+1]})}}}p.pop(),p.splice(0,1),this.edges[this.edges.length-1].virtrualNodes=p,this.drawOneEdge(this.edges.length-1),console.log()}}},{key:"hierarchicalMerge",value:function(){for(ie=this.pointData.length<150?0:1;!this.checkConnectBetweenAllCluster();){var t=[];for(var e in this.clusterDict)for(var i=0;i<this.clusterDict[e].length;i++)for(var a=this.clusterDict[e][i].id,r=i+1;r<this.clusterDict[e].length;r++){var n=this.clusterDict[e][r].id;if(!this.checkConnectBetweenTwoCluster(a,n)){var s=this.findOptimalLink(this.clusterDict[e][i],this.clusterDict[e][r]);t.push({clusterid1:a,clusterid2:n,start:s[0],end:s[1],score:s[2],distance:s[3],cat:e})}}var h=this.findMinScore(t);this.clustergraph.addEdge(h.clusterid1,h.clusterid2),this.edges.push({start:h.start.id,end:h.end.id,weight:h.score,cat:h.cat,dis:h.score,virtrual:!1,virtrualNodes:[],isLocalTree:!1}),this.graph.addEdge(h.start.id,h.end.id);var o=this.pointData[h.start.id],l=this.pointData[h.end.id],d=this.pointData[h.start.id].cat,c=[];c.push([o.x,o.y]),c.push([l.x,l.y]);for(var g=[{start:[o.x,o.y],end:[l.x,l.y],ids:[0,1]}];g.length>0;){var u=5,p=!1,y=g.pop();o=y.start,l=y.end;var f=y.ids,x=this.findCrossingBetweenEdgeRect(o,l,d);if(0!=x.length){this.edges[this.edges.length-1].virtrual=!0;var v=x[0].points,m=x[0].rect,E=[[m.x,m.y],[m.x+m.width,m.y]],D=[[m.x,m.y+m.height],[m.x+m.width,m.y+m.height]],b=[[m.x,m.y],[m.x,m.y+m.height]],F=[[m.x+m.width,m.y],[m.x+m.width,m.y+m.height]],M=v[0],k=v[1],w=void 0;if(E[1][1]==M.y&&D[1][1]==k.y||D[1][1]==M.y&&E[1][1]==k.y||b[0][0]==M.x&&F[0][0]==k.x||b[0][0]==k.x&&F[0][0]==M.x){var I=-1;if(E[1][1]==M.y&&D[1][1]==k.y){var P=M.x-m.x,A=k.x-m.x;I=P+A<m.width?P>A?3:2:P<A?4:1}else if(D[1][1]==M.y&&E[1][1]==k.y){var C=k.x-m.x,N=M.x-m.x;I=C+N<m.width?C>N?3:2:C<N?4:1}else if(b[0][0]==M.x&&F[0][0]==k.x){var S=M.y-m.y,B=k.y-m.y;I=S+B<m.width?S>B?3:4:S<B?2:1}else if(b[0][0]==k.x&&F[0][0]==M.x){var _=k.y-m.y,O=M.y-m.y;I=_+O<m.width?_>O?3:4:_<O?2:1}for(var j=[],V=0,L=-1,X=-1;;){1==I?j=p?[m.x+m.width,m.y+m.height]:[m.x,m.y]:2==I?j=p?[m.x,m.y+m.height]:[m.x+m.width,m.y]:3==I?j=p?[m.x,m.y]:[m.x+m.width,m.y+m.height]:4==I&&(j=p?[m.x+m.width,m.y]:[m.x,m.y+m.height]);var G=[m.x+m.width/2,m.y+m.height/2],Y=[j[0]-G[0],j[1]-G[1]],U=this.getVecNorm(Y);if(Y[0]=Y[0]/U,Y[1]=Y[1]/U,w=[j[0]+u*Y[0],j[1]+u*Y[1]],this.checkVNodeInBound(w,d)){if(p||(u/=1.5),p=!p,(V+=1)>10)break}else if(p?L=w:X=w,p=!p,-1!=L&&-1!=X)break}if(-1==L&&-1==X){this.edges[this.edges.length-1].virtrual=!1;continue}if(-1!=L&&-1!=X){for(var T=Number.MAX_VALUE,R=null,W=[L,X],q=0;q<W.length;q++){for(var z=W[q],H=0,K=0;K<this.edges.length;K++){var J=this.pointData[this.edges[K].start],Q=this.pointData[this.edges[K].end];if(J.cat!=d){var Z={x:o[0],y:o[1],cat:d},$={x:z[0],y:z[1],cat:d},tt={x:l[0],y:l[1],cat:d};this.checkEdgeCrossing(J,Q,Z,$)&&(H+=1),this.checkEdgeCrossing(J,Q,$,tt)&&(H+=1)}}H<T&&(T=H,R=W[q])}w=R}else w=-1!=L?L:X}else{var et=[M.x,k.y],it=[];et[0]==m.x&&et[1]==m.y?it=[m.x,m.y]:et[0]==m.x+m.width&&et[1]==m.y?it=[m.x+m.width,m.y]:et[0]==m.x+m.width&&et[1]==m.y+m.height?it=[m.x+m.width,m.y+m.height]:et[0]==m.x&&et[1]==m.y+m.height?it=[m.x,m.y+m.height]:(et=[k.x,M.y])[0]==m.x&&et[1]==m.y?it=[m.x,m.y]:et[0]==m.x+m.width&&et[1]==m.y?it=[m.x+m.width,m.y]:et[0]==m.x+m.width&&et[1]==m.y+m.height?it=[m.x+m.width,m.y+m.height]:et[0]==m.x&&et[1]==m.y+m.height&&(it=[m.x,m.y+m.height]);var at=[m.x+m.width/2,m.y+m.height/2],rt=[it[0]-at[0],it[1]-at[1]],nt=this.getVecNorm(rt);rt[0]=rt[0]/nt,rt[1]=rt[1]/nt,w=[it[0]+u*rt[0],it[1]+u*rt[1]]}for(var st=!1,ht=0;ht<c.length;ht++)if(w[0]==c[ht][0]&&w[1]==c[ht][1]){st=!0;break}if(!st){var ot;ot=f[0]+1,c.splice(ot,0,w);for(var lt=0;lt<g.length;lt++)g[lt].ids[0]>=ot&&(g[lt].ids[0]=g[lt].ids[0]+1),g[lt].ids[1]>=ot&&(g[lt].ids[1]=g[lt].ids[1]+1);g.push({start:o,end:w,ids:[f[0],ot]}),g.push({start:w,end:l,ids:[ot,f[1]+1]})}}}c.pop(),c.splice(0,1),this.edges[this.edges.length-1].virtrualNodes=c}console.log(ae)}},{key:"mergeCluster",value:function(){var t,e=[];t=this.sortEdgesGlobalWithCluster();for(var i=0;i<t.length;i++){var a=t[i][0],r=t[i][1],n=t[i][2],s=t[i][3];if(this.clusterArr[a].cat==this.clusterArr[r].cat)if(!new Jt.DepthFirstSearch(this.clustergraph,a).hasPathTo(r)){var h=this.findLinkBetweenCluster(this.clusterArr[a].points,this.clusterArr[r].points);h[0]?(this.clustergraph.addEdge(a,r),this.graph.addEdge(h[1].id,h[2].id),this.edges.push({start:h[1].id,end:h[2].id,weight:h[3],dis:h[3]})):e.push({start:a,end:r,weight:n,dis:s,crossnum:-1})}}for(;!this.checkConnectBetweenCluster();){for(var o=[],l=0;l<e.length;l++){var d=e[l].start,c=e[l].end;if(!new Jt.DepthFirstSearch(this.clustergraph,d).hasPathTo(c)){var g=this.findOptimalLink(this.clusterArr[d].points,this.clusterArr[c].points);e[l].weight=g[3],e[l].crossnum=g[3],o.push({clusterstart:d,clusterend:c,start:g[0].id,end:g[1].id,weight:g[2],crossnum:g[2]})}}for(var u=Number.MAX_VALUE,p=-1,y=0;y<o.length;y++)u>o[y].weight&&(u=o[y].weight,p=y);var f=o[p].start,x=o[p].end;this.graph.addEdge(f,x),this.clustergraph.addEdge(o[p].clusterstart,o[p].clusterend),this.edges.push({start:f,end:x,weight:o[p].weight,crossnum:o[p].crossnum}),console.log()}console.log(this.graph),console.log(this.edges),console.log(e)}},{key:"editBackbone",value:function(){if(ge=!ge,this.setState({editV:ge}),ge){if(u.l("svg").selectAll(".dataPoint").remove(),u.l("svg").selectAll("line").remove(),this.drawPointData(),this.drawEdges(),document.getElementsByTagName("g")[0].attributes.hasOwnProperty("transform")){var t=document.getElementsByTagName("g")[0].attributes.transform.value.toString();u.m("g").attr("transform",t)}this.props.handleManually(!1)}else u.m("#edgeGroup").remove(),u.m("#pointGroup").remove(),this.child.afterEditReDraw()}},{key:"editMST",value:function(){this.issplit=!this.issplit,1==this.issplit?(u.l("#mainsvg").attr("width",580*ye/ue).attr("height",750*fe/pe),u.l("#leftsvg").attr("width",580*ye/ue).attr("height",750*fe/pe).attr("style","border:1px solid #000000"),se="#leftsvg",he="#mainsvg",u.l(se).selectAll("*").remove(),this.drawPointData(),this.drawEdges(),this.props.handleManually(!1)):(u.l(se).selectAll("*").remove(),u.m("#edgeGroup").remove(),u.m("#pointGroup").remove(),this.child.afterEditReDraw(),u.l("#mainsvg").attr("width",1200*ye/ue).attr("height",750*fe/pe),u.l("#leftsvg").attr("width",0).attr("height",0).attr("style","border:0px solid #000000"),se="#mainsvg",he="#leftsvg")}},{key:"handleCreated",value:function(){this.setState({hascreated:!0})}},{key:"saveSVG",value:function(){}},{key:"saveData",value:function(){var t;t=this.state.hasinit?this.pointData:this.props.pointData;var e=JSON.stringify(t),i=new Blob([e],{type:"text/plain;charset=utf-8"});Rt.saveAs(i,"data.json")}},{key:"render",value:function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{}),Object(a.jsxs)("div",{style:{marginTop:20*fe/pe},children:[Object(a.jsx)(B.a,{onClick:this.getData.bind(this),disabled:!(this.props.hasLoadData&&!this.state.hasinit||this.state.hasEdit),children:this.state.hasinit?"Apply Changes":"Create Backbone"}),"\xa0\xa0\xa0\xa0\xa0\xa0",Object(a.jsx)(Tt.a,{checkedChildren:"Edit Backbone",unCheckedChildren:"Edit Backbone",onClick:this.editBackbone.bind(this),checked:this.state.editV,disabled:!this.state.hascreated})]}),Object(a.jsx)(Ut,{pointData:this.state.pointData,hasLoadData:this.props.hasLoadData,edges:this.state.edges,handleCreated:this.handleCreated.bind(this),createMST:this.getData.bind(this),onRef:this.onRef,colorArray:this.props.colorArray})]})}}]),i}(r.Component);ve.defaultProps={pointData:[]};var me=ve;var Ee=["#f700ff","#fbb132","#0885c2","#001aff","#7b28b7","#1c8b3c","#ed334e"],De=(r.Component,i(73)),be=function(t){Object(c.a)(i,t);var e=Object(g.a)(i);function i(){return Object(l.a)(this,i),e.call(this)}return Object(d.a)(i,[{key:"finishInput",value:function(){this.props.pointData&&(alert("Finish input and start creating spanning tree!"),console.log(this.props.pointData))}},{key:"render",value:function(){return Object(a.jsx)("button",{onClick:this.finishInput.bind(this),children:"Create MST"})}}]),i}(r.Component);be.defaultProps={pointData:[]};var Fe,Me,ke=i(381),we=i(86),Ie=i(60),Pe=i(106),Ae=i(71),Ce=i(382),Ne=i(388),Se=i(289),Be=i(81),_e=Be.ShapeInfo,Oe=Be.Intersection,je=(Be.Point2D,Be.IntersectionQuery),Ve=(we.a.Option,ke.a.Header),Le=ke.a.Footer,Xe=ke.a.Sider,Ge=ke.a.Content,Ye=[{title:"Group",dataIndex:"name",render:function(t){return Object(a.jsx)("a",{children:t})}},{title:"Color",key:"tags",dataIndex:"tags",render:function(t){return Object(a.jsx)(a.Fragment,{children:t.map((function(t){var e=t;return Object(a.jsx)(Ne.a,{color:e,children:"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"},t)}))})}}],Ue=1,Te={"Group 0":1},Re=0,We=i(118),qe=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],ze=!1,He=1920,Ke=1040,Je=1920,Qe=1040,Ze=function(t){Object(c.a)(i,t);var e=Object(g.a)(i);function i(){var t;return Object(l.a)(this,i),(t=e.call(this)).onRef=function(e){t.child=e},t.state={updateview:!1,is_input:!1,GroupData:[{key:"0",name:"Group 0",tags:[]}],pointData:[],edges:[],hasLoadData:!1,dataFile:[],colorArray:["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"]},t.shape="circle",t.cur_idx=0,t.width=0,t.height=0,t.offsetY=0,t.offsetX=0,t.scaleX=1,t.scaleY=1,t.selValue="",t.maxX=0,t.maxY=0,t.minX=0,t.minY=0,t.pointData=[],t.edges=[],t.lastClickIndex=-1,t.lastClickItem=null,t.itemBBox=[],t.hasCreateMST=!1,t.menu=Object(a.jsxs)(Ie.a,{children:[Object(a.jsx)(Ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:t.savePNG.bind(Object(De.a)(t)),children:"PNG"})}),Object(a.jsx)(Ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:t.saveSVG.bind(Object(De.a)(t)),children:"SVG"})}),Object(a.jsx)(Ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:t.saveData.bind(Object(De.a)(t)),children:"JSON"})})]}),t}return Object(d.a)(i,[{key:"init",value:function(){u.l("svg").selectAll("*").remove(),this.setState({updateview:!1,is_input:!1,GroupData:[{key:"0",name:"Group 0",tags:[]}],pointData:[],edges:[],hasLoadData:!1,dataFile:[],colorArray:["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"]}),Ue=1,(Te={})["Group 0"]=1,Re=0,"#mainsvg",qe=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],ze=!1,this.shape="circle",this.cur_idx=0,this.width=0,this.height=0,this.offsetY=0,this.offsetX=0,this.scaleX=1,this.scaleY=1,this.selValue="",this.maxX=0,this.maxY=0,this.minX=0,this.minY=0,this.pointData=[],this.edges=[],this.lastClickIndex=-1,this.lastClickItem=null,this.itemBBox=[],this.hasCreateMST=!1,this.menu=Object(a.jsxs)(Ie.a,{children:[Object(a.jsx)(Ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:this.savePNG.bind(this),children:"PNG"})}),Object(a.jsx)(Ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:this.saveSVG.bind(this),children:"SVG"})}),Object(a.jsx)(Ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:this.saveData.bind(this),children:"JSON"})})]}),this.child.init()}},{key:"componentWillMount",value:function(){Qe=window.screen.availHeight,Je=window.screen.availWidth}},{key:"componentDidMount",value:function(){var t=this,e=document.getElementById("mainsvg");this.width=e.getBoundingClientRect().width,this.height=e.getBoundingClientRect().height,Me=u.l("svg"),Fe=u.l("svg").append("g"),Me.on("mousedown",this.handleMousedown.bind(this)),Me.call(u.n().extent([[0,0],[this.width,this.height]]).scaleExtent([1,8]).on("zoom",(function(t){var e=t.transform;Fe.attr("transform",e)}))),fetch("/data/datalist.json",{method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"},mode:"cors",cache:"default"}).then((function(t){return t.json()})).then((function(e){t.setState({dataFile:e})})),document.oncontextmenu=function(){return!1}}},{key:"centralizeData",value:function(){for(var t=Number.MAX_VALUE,e=Number.MAX_VALUE,i=Number.MIN_VALUE,a=Number.MIN_VALUE,r=0;r<this.pointData.length;r++)this.pointData[r].x>i&&(i=this.pointData[r].x),this.pointData[r].y>a&&(a=this.pointData[r].y),this.pointData[r].x<t&&(t=this.pointData[r].x),this.pointData[r].y<e&&(e=this.pointData[r].y);this.maxX=i,this.minX=t,this.maxY=a,this.minY=e,u.l("#mainsvg").attr("viewBox",t-20+" "+(e-20)+" "+(i-t+40)+" "+(a-e+40)),Me.on("mousedown",this.handleMousedown.bind(this)),this.offsetX=t-20,this.offsetY=e-20,this.scaleX=(i-t+40)/this.width,this.scaleY=(a-e+40)/this.height,(Me=u.l("svg")).call(u.n().extent([[this.offsetX,this.offsetY],[this.scaleX,this.scaleY]]).scaleExtent([1,8]).on("zoom",(function(t){var e=t.transform;Fe.attr("transform",e)})))}},{key:"handleMousedown",value:function(t){if(0===t.button&&ze){var e=u.i(t)[0],i=u.i(t)[1],a=Fe._groups[0][0].attributes;if(void 0!=a.transform){for(var r=a.transform.value,n="",s="",h="",o=9;o<r.length;o++)if("("==r[o]){if(o++,""!=n){for(;")"!=r[o];)h+=r[o++];break}for(;","!=r[o];)n+=r[o++];for(o++;")"!=r[o];)s+=r[o++]}n=parseFloat(n),s=parseFloat(s),e=(e-n)/(h=parseFloat(h)),i=(i-s)/h}if("circle"===this.shape){var l=u.l("#pointGroup");null==l._groups[0][0]&&(l=u.l("g")),l.append("circle").attr("r",10).attr("cx",e).attr("cy",i).attr("fill",qe[Re]).attr("set",Re).attr("idx",this.cur_idx).on("mousedown",this.handleDeleteNode.bind(this))}else if("rectangle"===this.shape){var d=u.l("#pointGroup");null==d._groups[0][0]&&(d=u.l("g")),d.append("rect").attr("x",e-5).attr("y",i-5).attr("width",10).attr("height",10).attr("fill",qe[Re]).attr("set",Re).attr("idx",this.cur_idx).on("mousedown",this.handleDeleteNode.bind(this))}var c={radius:10,width:10,height:10};c.x=e,c.y=i,c.cat=Re,c.id=this.cur_idx++,c.shape=this.shape,1==this.hasCreateMST?this.child.addNewPoints(c):this.pointData.push(c),this.setState({pointData:this.pointData}),console.log(this.pointData)}}},{key:"getVecNorm",value:function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}},{key:"hasLinked",value:function(t,e){for(var i=0;i<this.edges.length;i++){var a=this.edges[i];if(a.start==t&&a.end==e)return!0;if(a.start==e&&a.end==t)return!0}return!1}},{key:"findCrossingBetweenEdgeRect",value:function(t,e,i){for(var a=[],r={x:t[0],y:t[1]},n={x:e[0],y:e[1]},s=0;s<this.itemBBox.length;s++){var h=parseInt(this.itemBBox[s].id);if(i!=this.pointData[h].cat){var o=_e.rectangle({top:this.itemBBox[s].bbox.y,left:this.itemBBox[s].bbox.x,width:this.itemBBox[s].bbox.width,height:this.itemBBox[s].bbox.height}),l=_e.line([r.x,r.y],[n.x,n.y]),d=Oe.intersect(o,l);if("Intersection"==d.status&&d.points.length>1){a.push({rect:this.itemBBox[s].bbox,points:d.points});break}}}return a}},{key:"checkVNodeInBound",value:function(t,e){for(var i=0;i<this.itemBBox.length;i++){var a=parseInt(this.itemBBox[i].id);if(e!=this.pointData[a].cat)if(je.pointInRectangle({x:t[0],y:t[1]},{x:this.itemBBox[i].bbox.x,y:this.itemBBox[i].bbox.y},{x:this.itemBBox[i].bbox.x+this.itemBBox[i].bbox.width,y:this.itemBBox[i].bbox.y+this.itemBBox[i].bbox.height}))return!0}return!1}},{key:"surfaceRoutingEdge",value:function(t){var e=this.pointData[t.start],i=this.pointData[t.end],a=this.pointData[t.start].cat,r=[];r.push([e.x,e.y]),r.push([i.x,i.y]);for(var n=[{start:[e.x,e.y],end:[i.x,i.y],ids:[0,1]}];n.length>0;){var s=5,h=!1,o=n.pop();e=o.start,i=o.end;var l=o.ids,d=this.findCrossingBetweenEdgeRect(e,i,a);if(0!=d.length){t.virtrual=!0;var c=d[0].points,g=d[0].rect,u=[[g.x,g.y],[g.x+g.width,g.y]],p=[[g.x,g.y+g.height],[g.x+g.width,g.y+g.height]],y=[[g.x,g.y],[g.x,g.y+g.height]],f=[[g.x+g.width,g.y],[g.x+g.width,g.y+g.height]],x=c[0],v=c[1],m=void 0;if(u[1][1]==x.y&&p[1][1]==v.y||p[1][1]==x.y&&u[1][1]==v.y||y[0][0]==x.x&&f[0][0]==v.x||y[0][0]==v.x&&f[0][0]==x.x){var E=-1;if(u[1][1]==x.y&&p[1][1]==v.y){var D=x.x-g.x,b=v.x-g.x;E=D+b<g.width?D>b?3:2:D<b?4:1}else if(p[1][1]==x.y&&u[1][1]==v.y){var F=v.x-g.x,M=x.x-g.x;E=F+M<g.width?F>M?3:2:F<M?4:1}else if(y[0][0]==x.x&&f[0][0]==v.x){var k=x.y-g.y,w=v.y-g.y;E=k+w<g.width?k>w?3:4:k<w?2:1}else if(y[0][0]==v.x&&f[0][0]==x.x){var I=v.y-g.y,P=x.y-g.y;E=I+P<g.width?I>P?3:4:I<P?2:1}for(var A=[],C=0,N=-1,S=-1;;){1==E?A=h?[g.x+g.width,g.y+g.height]:[g.x,g.y]:2==E?A=h?[g.x,g.y+g.height]:[g.x+g.width,g.y]:3==E?A=h?[g.x,g.y]:[g.x+g.width,g.y+g.height]:4==E&&(A=h?[g.x+g.width,g.y]:[g.x,g.y+g.height]);var B=[g.x+g.width/2,g.y+g.height/2],_=[A[0]-B[0],A[1]-B[1]],O=this.getVecNorm(_);if(_[0]=_[0]/O,_[1]=_[1]/O,m=[A[0]+s*_[0],A[1]+s*_[1]],this.checkVNodeInBound(m,a)){if(h||(s/=1.5),h=!h,(C+=1)>10)break}else if(h?N=m:S=m,h=!h,-1!=N&&-1!=S)break}if(-1==N&&-1==S){t.virtrual=!1;continue}if(-1!=N&&-1!=S){for(var j=Number.MAX_VALUE,V=null,L=[N,S],X=0;X<L.length;X++){for(var G=L[X],Y=0,U=0;U<this.edges.length;U++){var T=this.pointData[this.edges[U].start],R=this.pointData[this.edges[U].end];if(T.cat!=a){var W={x:e[0],y:e[1],cat:a},q={x:G[0],y:G[1],cat:a},z={x:i[0],y:i[1],cat:a};this.checkEdgeCrossing(T,R,W,q)&&(Y+=1),this.checkEdgeCrossing(T,R,q,z)&&(Y+=1)}}Y<j&&(j=Y,V=L[X])}m=V}else m=-1!=N?N:S}else{var H=[x.x,v.y],K=[];H[0]==g.x&&H[1]==g.y?K=[g.x,g.y]:H[0]==g.x+g.width&&H[1]==g.y?K=[g.x+g.width,g.y]:H[0]==g.x+g.width&&H[1]==g.y+g.height?K=[g.x+g.width,g.y+g.height]:H[0]==g.x&&H[1]==g.y+g.height?K=[g.x,g.y+g.height]:(H=[v.x,x.y])[0]==g.x&&H[1]==g.y?K=[g.x,g.y]:H[0]==g.x+g.width&&H[1]==g.y?K=[g.x+g.width,g.y]:H[0]==g.x+g.width&&H[1]==g.y+g.height?K=[g.x+g.width,g.y+g.height]:H[0]==g.x&&H[1]==g.y+g.height&&(K=[g.x,g.y+g.height]);var J=[g.x+g.width/2,g.y+g.height/2],Q=[K[0]-J[0],K[1]-J[1]],Z=this.getVecNorm(Q);Q[0]=Q[0]/Z,Q[1]=Q[1]/Z,m=[K[0]+s*Q[0],K[1]+s*Q[1]]}for(var $=!1,tt=0;tt<r.length;tt++)if(m[0]==r[tt][0]&&m[1]==r[tt][1]){$=!0;break}if(!$){var et;et=l[0]+1,r.splice(et,0,m);for(var it=0;it<n.length;it++)n[it].ids[0]>=et&&(n[it].ids[0]=n[it].ids[0]+1),n[it].ids[1]>=et&&(n[it].ids[1]=n[it].ids[1]+1);n.push({start:e,end:m,ids:[l[0],et]}),n.push({start:m,end:i,ids:[et,l[1]+1]})}}}return r.pop(),r.splice(0,1),t.virtrualNodes=r,t}},{key:"deleteEdge",value:function(t){var e=t,i=this;Fe.selectAll("line").filter((function(){return parseInt(u.l(this).attr("index"))==e})).remove(),Fe.selectAll(".controlPoints").filter((function(){return parseInt(u.l(this).attr("edgeindex"))==e})).remove(),Fe.selectAll(".controlPoints").filter((function(){return parseInt(u.l(this).attr("edgeindex"))>e})).attr("edgeindex",(function(){return parseInt(u.l(this).attr("edgeindex"))-1})),Fe.selectAll("line").filter((function(){return parseInt(u.l(this).attr("index"))>e})).attr("index",(function(){return parseInt(u.l(this).attr("index"))-1})),i.edges.splice(e,1);for(var a=0;a<i.edges.length;a++)i.edges[a].id=a}},{key:"drawOneEdge",value:function(t){this.edges[t].SVGElement=[];var e=this.edges[t],i=this;function a(t){if(2==t.button){var e=parseInt(u.l(this).attr("index"));i.edges[e].start,i.edges[e].end;i.deleteEdge(e)}}var r=e.start,n=e.end;if(e.virtrual){for(var s,h=e.virtrualNodes,o=[this.pointData[r].x,this.pointData[r].y],l=0;l<h.length;l++){s=h[l];var d=Fe.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",s[0]).attr("y2",s[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",l).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",a);o=s,this.edges[t].SVGElement.push(d)}s=[this.pointData[n].x,this.pointData[n].y];var c=Fe.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",s[0]).attr("y2",s[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",h.length).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",a);this.edges[t].SVGElement.push(c);for(var g=0;g<h.length;g++)Fe.append("circle").attr("class","controlPoints").attr("cx",h[g][0]).attr("cy",h[g][1]).attr("r",5).attr("edgeindex",t).attr("segindex",g).attr("fill","red").attr("opacity",0).on("mouseover",(function(){u.l(this).attr("opacity",1)})).on("mouseout",(function(){u.l(this).attr("opacity",0)}))}else{var p=Fe.append("line").attr("x1",this.pointData[r].x).attr("y1",this.pointData[r].y).attr("x2",this.pointData[n].x).attr("y2",this.pointData[n].y).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!1).on("mouseover",(function(t,e){var a=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=u.l(this).attr("index");u.m("line").filter((function(){return u.l(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",a);this.edges[t].SVGElement.push(p)}}},{key:"addEdge",value:function(t,e,i){var a={start:t,end:e,weight:-1,cat:i,dis:-1,virtrual:!1,virtrualNodes:[],id:this.edges.length,isLocalTree:!1};a=this.surfaceRoutingEdge(a),this.edges.push(a),this.drawOneEdge(a.id)}},{key:"handleDeleteNode",value:function(t){if(2===t.button&&ze){console.log(t);parseInt(u.l(t.path[0])._groups[0][0].attributes.set.value);var e=parseInt(u.l(t.path[0])._groups[0][0].attributes.idx.value);u.l(t.path[0]).remove(),this.pointData.splice(this.pointData.findIndex((function(t){return t.id===e})),1)}}},{key:"drawInit",value:function(){this.centralizeData();var t=this.pointData;console.log(t);var e=this;var i=u.e().on("start",(function(){u.l(this).attr("stroke","red")})).on("drag",(function(t){u.l("svg");var i=parseInt(u.l(this).attr("idx"));if(e.pointData[i].x=t.x,e.pointData[i].y=t.y,"circle"==e.shape)u.l(this).attr("cx",t.x).attr("cy",t.y);else{var a=e.pointData[i].width,r=e.pointData[i].height;u.l(this).attr("x",t.x-.5*a).attr("y",t.y-.5*r)}})).on("end",(function(){u.l(this).attr("stroke","none")}));function a(t){if(2===t.button&&ze){console.log(t);parseInt(u.l(t.path[0])._groups[0][0].attributes.set.value);var i=parseInt(u.l(t.path[0])._groups[0][0].attributes.idx.value);u.l(t.path[0]).remove(),e.pointData.splice(e.pointData.findIndex((function(t){return t.id===i})),1)}else if(2==t.button&&!ze){console.log("click");var a=parseInt(u.l(this).attr("index"));if(-1==e.lastClickIndex)e.lastClickIndex=a,e.lastClickItem=u.l(this).attr("stroke","red").attr("stroke-width",5).attr("selected",!0);else if(a==e.lastClickIndex)e.lastClickIndex=-1,e.lastClickItem=null,u.l(this).attr("stroke","red").attr("stroke-width",1).attr("selected",!1);else{var r=e.lastClickItem.attr("category");r==u.l(this).attr("category")?(e.hasLinked(e.lastClickIndex,a)||e.addEdge(e.lastClickIndex,a,r),e.lastClickItem.attr("stroke-width",1).attr("stroke","none").attr("selected",!1),e.lastClickItem=null,e.lastClickIndex=-1):(e.lastClickItem.attr("stroke-width",1).attr("stroke","none").attr("selected",!1),e.lastClickItem=u.l(this).attr("stroke","red").attr("stroke-width",5).attr("selected",!0),e.lastClickIndex=a)}}}for(var r={},n=0;n<t.length;n++){var s=-1,h=t[n].cat.toString(),o=h.split(",");if(o.length>1)for(var l=0;l<o.length;l++)r[parseInt(o[l])]=1,s=Math.max(parseInt(o[l]),s);else r[parseInt(h)]=1,s=Math.max(parseInt(h),s);Re=Math.max(s,Re),"circle"===this.shape?Fe.append("circle").attr("class","dataPoint").attr("r",t[n].radius).attr("cx",t[n].x).attr("cy",t[n].y).attr("fill",qe[s]).attr("category",s).attr("set",s).attr("index",n).attr("idx",n).on("mousedown",a).on("mouseover",(function(){u.l(this).attr("stroke","red")})).on("mouseout",(function(){"true"!=u.l(this).attr("selected")&&u.l(this).attr("stroke","none")})).call(i):"rectangle"===this.shape&&Fe.append("rect").attr("class","dataPoint").attr("x",t[n].x-.5*t[n].width).attr("y",t[n].y-.5*t[n].height).attr("width",t[n].width).attr("height",t[n].height).attr("fill",qe[s]).attr("category",s).attr("set",s).attr("index",n).attr("idx",n).on("mousedown",a).on("mouseover",(function(){u.l(this).attr("stroke","red")})).on("mouseout",(function(){"true"!=u.l(this).attr("selected")&&u.l(this).attr("stroke","none")})).call(i)}this.itemBBox=[];for(var d=document.getElementsByClassName("dataPoint"),c=0;c<d.length;c++)this.itemBBox.push({id:d[c].getAttribute("index"),bbox:d[c].getBBox()});for(var g=[],p=0;p<this.state.GroupData.length;p++)g.push(this.state.GroupData[p]);for(var y in Ue=0,Te={},r)Te["Group "+y.toString()]=1;for(var f in Te)console.log(f),0==Ue?g[0].tags=[qe[parseInt(Ue)]]:g.push({key:Ue.toString(),name:f,tags:[qe[parseInt(Ue)]]}),Ue++;this.setState({GroupData:g}),console.log("GroupData!!!"),console.log(Te),console.log(this.state.GroupData),this.cur_idx=t.length,Re=Ue}},{key:"addNewSet",value:function(){for(var t in Ue=0,Te)Ue++;Te["Group "+Ue.toString()]=1;for(var e=[],i=0;i<this.state.GroupData.length;i++)e.push(this.state.GroupData[i]);e.push({key:Ue.toString(),name:"Group "+Ue.toString(),tags:[qe[parseInt(Ue.toString())]]}),Ue++,this.setState({GroupData:e}),alert("Succellfully add new set "+(Ue-1)+" !")}},{key:"scaleData",value:function(){var t,e,i,a,r=Number.MAX_VALUE,n=Number.MAX_VALUE,s=Number.MIN_VALUE,h=Number.MIN_VALUE;if(!(this.pointData.length<=0)){if("rectangle"==this.pointData[0].shape)for(var o=0;o<this.pointData.length;o++){var l=this.pointData[o].x-this.pointData[o].width/2,d=this.pointData[o].x+this.pointData[o].width/2,c=this.pointData[o].y-this.pointData[o].height/2,g=this.pointData[o].y+this.pointData[o].height/2;r=Math.min(r,l),n=Math.min(n,c),s=Math.max(s,d),h=Math.max(h,g)}else for(var u=0;u<this.pointData.length;u++){var p=this.pointData[u].x-this.pointData[u].radius,y=this.pointData[u].x+this.pointData[u].radius,f=this.pointData[u].y-this.pointData[u].radius,x=this.pointData[u].y+this.pointData[u].radius;r=Math.min(r,p),n=Math.min(n,f),s=Math.max(s,y),h=Math.max(h,x)}t=1500/(s-r),e=1500/(h-n);var v=Math.min(t,e);i=0-r,a=0-n;for(var m=0;m<this.pointData.length;m++)this.pointData[m].x=(this.pointData[m].x+i)*v,this.pointData[m].y=(this.pointData[m].y+a)*v,this.pointData[m].radius*=v,this.pointData[m].width*=v,this.pointData[m].height*=v}}},{key:"handleUpload",value:function(){var t=this,e=this.selValue;this.init(),this.componentWillMount(),this.render(),this.componentDidMount(),"Manhattan.txt"==e?qe=["#f16b22","#7e519f","#713e3a"]:"simpleScatterplot.json"==e&&(qe=["#d35d6d","#0885c2","#4aa15f"]),this.setState({colorArray:qe}),console.log("filename:"),console.log(e),fetch("/data/"+e,{method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"},mode:"cors",cache:"default"}).then((function(t){return t.json()})).then((function(e){t.setState({hasLoadData:!0}),t.pointData=e;for(var i=0;i<t.pointData.length;i++)t.pointData[i].radius=10;t.setState({pointData:t.pointData}),t.shape=e[0].shape,t.drawInit(),t.setState({edges:t.edges})}))}},{key:"changeSel",value:function(t){this.selValue=t}},{key:"handleInput",value:function(){ze=!ze,this.setState({is_input:ze})}},{key:"hasCreate",value:function(){this.hasCreateMST=!0}},{key:"saveData",value:function(){this.child.saveData()}},{key:"savePNG",value:function(){Se.saveSvgAsPng(document.getElementById("mainsvg"),"result.png")}},{key:"saveSVG",value:function(){var t=u.l("#mainsvg"),e=t.attr("width"),i=t.attr("height"),a=t.attr("viewBox"),r=t.html();r='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+i+'" viewBox="'+a+'" >\n'+r+"\n</svg>";var n=new Blob([r],{type:"text/plain;charset=utf-8"});We.saveAs(n,"result.svg")}},{key:"handleManually",value:function(t){ze=t,this.setState({is_input:ze})}},{key:"render",value:function(){var t=this.state.dataFile.map((function(t){return Object(a.jsx)("option",{value:t,children:t})}));console.log("Ratio"),console.log(Qe/Ke),console.log(Je/He);var e=50*Je/He,i=20*Qe/Ke,r=20*Je/He,n=25*Qe/Ke,s=(20*Qe/Ke).toString()+"px "+e.toString()+"px "+i.toString()+"px "+r.toString()+"px",h=n.toString()+"px "+r.toString()+"px";return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)(ke.a,{children:[Object(a.jsx)(Ve,{style:{background:"rgb(255, 255, 255, 0.1)",textAlign:"center",fontFamily:"Segoe UI",fontWeight:"bold",fontSize:"25px",color:"black"},children:"AceBubble"}),Object(a.jsxs)(ke.a,{children:[Object(a.jsxs)(Ge,{theme:"light",style:{padding:s,background:"rgb(255, 255, 255)"},children:[Object(a.jsx)("div",{className:"right",style:{float:"right"},children:Object(a.jsx)("svg",{id:"mainsvg",width:1200*Je/He,height:750*Qe/Ke,style:{border:"1px solid #000000"}})}),Object(a.jsx)("div",{className:"left",style:{float:"left"},children:Object(a.jsx)("svg",{id:"leftsvg",width:0,height:0})})]}),Object(a.jsx)(Xe,{theme:"light",width:600*Je/He,className:"site-layout-background",style:{padding:h,background:"rgb(255, 255, 255)"},children:Object(a.jsxs)("div",{className:"right",children:[Object(a.jsx)(we.a,{showSearch:!0,style:{width:320*Je/He},placeholder:"Select an example data..",onChange:this.changeSel.bind(this),children:t}),Object(a.jsx)(B.a,{onClick:this.handleUpload.bind(this),children:"Load Example Data"}),Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),Object(a.jsx)("p",{children:Object(a.jsx)(Pe.a,{overlay:this.menu,arrow:!0,children:Object(a.jsxs)(B.a,{children:["Save As ",Object(a.jsx)(Ae.a,{})]})})}),Object(a.jsx)("div",{style:{width:"80%"},children:Object(a.jsx)(Ce.a,{pagination:{disabled:!0,position:["none","none"]},scroll:{y:200*Qe/Ke},columns:Ye,dataSource:this.state.GroupData})}),Object(a.jsx)("br",{}),Object(a.jsx)(me,{pointData:this.state.pointData,hasLoadData:this.state.hasLoadData,isedit:this.state.is_input,edges:this.state.edges,hasCreate:this.hasCreate.bind(this),handleManually:this.handleManually.bind(this),onRef:this.onRef,colorArray:this.state.colorArray})]})})]}),Object(a.jsx)(Le,{style:{background:"rgb(255, 255, 255, 0.1)",textAlign:"center",fontSize:"16px"},children:"AceBubble \xa92021"})]})})}}]),i}(r.Component),$e=function(t){Object(c.a)(i,t);var e=Object(g.a)(i);function i(){return Object(l.a)(this,i),e.call(this)}return Object(d.a)(i,[{key:"render",value:function(){return Object(a.jsx)(Ze,{})}}]),i}(r.Component),ti=i(81),ei=ti.ShapeInfo,ii=ti.Intersection,ai=(ti.Point2D,ti.IntersectionQuery),ri=i(155),ni=i(63),si=["#f700ff","#0885c2","#1c8b3c","#ed334e"],hi=20,oi=0,li=10/180*Math.PI,di=(r.Component,i(81)),ci=di.ShapeInfo,gi=di.Intersection,ui=(di.Point2D,di.IntersectionQuery),pi=i(155),yi=i(63),fi=i(362),xi=i(143),vi=i(118),mi=["#fbf4a4","#c4da90","#a7bfd9","#f3c4d3","#f5c3a0","#a5c3af","#b9b9b4","#d2c1d5","#e7f1f5","#f9dce2","#e7f1f5","#cdcadb"],Ei=0,Di=10/180*Math.PI,bi=15,Fi=10,Mi={},ki=u.f().x((function(t){return t[0]})).y((function(t){return t[1]})),wi=(r.Component,i(35)),Ii=(i(373),i(374).pathDataToPolys,i(142)),Pi=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"];r.Component;h.a.render(Object(a.jsx)(n.a.StrictMode,{children:Object(a.jsx)($e,{})}),document.getElementById("root")),o()},89:function(t,e,i){}},[[378,1,2]]]);
//# sourceMappingURL=main.947b2a35.chunk.js.map