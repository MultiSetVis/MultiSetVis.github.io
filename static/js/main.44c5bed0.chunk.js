(this["webpackJsonpbubble-set-demo"]=this["webpackJsonpbubble-set-demo"]||[]).push([[0],{122:function(t,e,i){},219:function(t,e){function i(t){this._d=t,this._elements=[]}t.exports=i,i.prototype.checkEdgeCrossing=function(t,e,i,a){return Math.min(t.x,e.x)<=Math.max(i.x,a.x)&&Math.min(i.x,a.x)<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=Math.max(i.y,a.y)&&Math.min(i.y,a.y)<=Math.max(t.y,e.y)&&(((i.x-t.x)*(i.y-a.y)-(i.y-t.y)*(i.x-a.x))*((i.x-e.x)*(i.y-a.y)-(i.y-e.y)*(i.x-a.x))<0&&((t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x))*((t.x-a.x)*(t.y-e.y)-(t.y-a.y)*(t.x-e.x))<0)},i.prototype.isEmpty=function(){return 0===this.size()},i.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]},i.prototype.modify_Prim=function(t,e,i,a){for(var r=this._elements.length,s=this._elements.length-1;s>=0;s--){var n=this._d[this._elements[s]].start,h=this._d[this._elements[s]].end,o=this._d[this._elements[s]].clusterid2;this._d.hasOwnProperty(this._elements[s])&&o!=i?this.checkEdgeCrossing(n,h,t,e)&&n.cat!=t.cat&&h.cat!=e.cat&&(this._d[this._elements[s]].score+=a):this._elements.splice(s,1)}var d=this._elements;this._elements=[];for(var l=0;l<d.length;l++)this.enq(d[l]);var g=this._elements.length;if(!(g<=1||g==r))for(var c=parseInt((g-2)/2);c>=0;c--)this.adjust(c,g-1)},i.prototype.searchFather=function(t,e){for(;e!=t[e];)t[e]=t[t[e]],e=t[e];return e},i.prototype.adjust=function(t,e){for(var i=t,a=2*i+1,r=this._elements[i];a<=e&&(a<e&&this._compare(a,a+1)&&a++,!(this._d[r].score<=this._d[this._elements[a]].score));)this._elements[i]=this._elements[a],i=a,a=2*a+1;this._elements[i]=r},i.prototype.modify_Kruskal_V2=function(t,e,i,a){for(var r=[],s=this._elements.length-1;s>=0;s--){var n=this._d[this._elements[s]].start,h=this._d[this._elements[s]].end,o=this.searchFather(i,this._d[this._elements[s]].clusterid1),d=this.searchFather(i,this._d[this._elements[s]].clusterid2);this._d.hasOwnProperty(this._elements[s])?o!=d?(this.checkEdgeCrossing(n,h,t,e)&&n.cat!=t.cat&&h.cat!=e.cat&&(this._d[this._elements[s]].score+=a),r.push(this._elements[s])):(delete this._d[this._elements[s]],this._elements.splice(s,1)):this._elements.splice(s,1)}var l=r.length;if(!(l<=1)){this._elements=[];for(var g=0;g<l;g++)this.enq(r[g])}},i.prototype.modify_Kruskal=function(t,e,i,a,r){for(var s=this._elements.length,n=parseInt((s-2)/2);n>=0;n--)this.adjust(n,s-1)},i.prototype.deq=function(){var t=this.peek(),e=this._elements.pop(),i=this.size();if(0===i)return t;this._elements[0]=e;for(var a=0;a<i;){var r=a,s=2*a+1,n=2*a+2;if(s<i&&this._compare(s,r)>=0&&(r=s),n<i&&this._compare(n,r)>=0&&(r=n),r===a)break;this._swap(r,a),a=r}return t},i.prototype.enq=function(t){for(var e=this._elements.push(t),i=e-1;i>0;){var a=Math.floor((i-1)/2);if(this._compare(i,a)<=0)break;this._swap(a,i),i=a}return e},i.prototype.size=function(){return this._elements.length},i.prototype.forEach=function(t){return this._elements.forEach(t)},i.prototype._compare=function(t,e){return this._d[this._elements[e]].score-this._d[this._elements[t]].score},i.prototype._swap=function(t,e){var i=this._elements[t];this._d[this._elements[t]].pid=e,this._d[this._elements[e]].pid=t,this._elements[t]=this._elements[e],this._elements[e]=i}},295:function(t,e,i){"use strict";i.r(e);var a=i(7),r=i(0),s=i.n(r),n=i(29),h=i.n(n),o=(i(122),function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,306)).then((function(e){var i=e.getCLS,a=e.getFID,r=e.getFCP,s=e.getLCP,n=e.getTTFB;i(t),a(t),r(t),s(t),n(t)}))}),d=i(18),l=i(19),g=i(40),c=i(39),u=i(70),p=i(1),y=i(24),f=i(302),x=i(303),v=i(300),E=i(301),m=(i(208),i(57));function D(t,e,i,a){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-a,2))}function F(t){var e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/e,t[1]/e]}function b(t,e,i,a,r){p.g("svg").append("rect").attr("x",t-i/2).attr("y",e-a/2).attr("width",i).attr("height",a).attr("fill","none").attr("stroke",r).attr("stroke-width",2)}function k(t,e,i,a,r,s){var n=(r-i)*(t-i)+(s-a)*(e-a);if(n<=0)return-1;var h=(r-i)*(r-i)+(s-a)*(s-a);if(n>=h)return-1;var o=n/h,d=i+(r-i)*o,l=a+(s-a)*o;return Math.sqrt((t-d)*(t-d)+(l-e)*(l-e))}var M=function(t,e,i){if(i){this.points=[];for(var a=0;a<t.length;a++)this.points.push(t[a])}else this.points=t;this.degree=e,this.dimension=t[0].length,2==e?(this.baseFunc=this.basisDeg2,this.baseFuncRangeInt=2):3==e?(this.baseFunc=this.basisDeg3,this.baseFuncRangeInt=2):4==e?(this.baseFunc=this.basisDeg4,this.baseFuncRangeInt=3):5==e&&(this.baseFunc=this.basisDeg5,this.baseFuncRangeInt=3)};M.prototype.seqAt=function(t){var e=this.points,i=this.degree+1;return function(a){return a<i?e[0][t]:e.length+i<=a?e[e.length-1][t]:e[a-i][t]}},M.prototype.basisDeg2=function(t){return-.5<=t&&t<.5?.75-t*t:.5<=t&&t<=1.5?1.125+(t/2-1.5)*t:-1.5<=t&&t<-.5?1.125+(1.5+t/2)*t:0},M.prototype.basisDeg3=function(t){return-1<=t&&t<0?2/3+(-1-t/2)*t*t:1<=t&&t<=2?4/3+t*((1-t/6)*t-2):-2<=t&&t<-1?4/3+t*(2+(1+t/6)*t):0<=t&&t<1?2/3+(t/2-1)*t*t:0},M.prototype.basisDeg4=function(t){return-1.5<=t&&t<-.5?55/96+t*(-5/24+t*(-5/4+(-5/6-t/6)*t)):.5<=t&&t<1.5?55/96+t*(5/24+t*(-5/4+(5/6-t/6)*t)):1.5<=t&&t<=2.5?625/384+t*(-125/48+t*(25/16+(-5/12+t/24)*t)):-2.5<=t&&t<=-1.5?625/384+t*(125/48+t*(25/16+(5/12+t/24)*t)):-1.5<=t&&t<1.5?115/192+t*t*(-5/8+t*t/4):0},M.prototype.basisDeg5=function(t){return-2<=t&&t<-1?.425+t*(-5/8+t*(-7/4+t*(-5/4+(-3/8-t/24)*t))):0<=t&&t<1?.55+t*t*((1/4-t/12)*t*t-.5):2<=t&&t<=3?2.025+t*(-27/8+t*(9/4+t*(-3/4+(1/8-t/120)*t))):-3<=t&&t<-2?2.025+t*(27/8+t*(9/4+t*(3/4+(1/8+t/120)*t))):1<=t&&t<2?.425+t*(5/8+t*(-7/4+t*(5/4+(-3/8+t/24)*t))):-1<=t&&t<0?.55+t*t*((1/4+t/12)*t*t-.5):0},M.prototype.getInterpol=function(t,e){for(var i=this.baseFunc,a=this.baseFuncRangeInt,r=Math.floor(e),s=0,n=r-a;n<=r+a;n++)s+=t(n)*i(e-n);return s},M.prototype.calcAt=function(t){if(t*=2*(this.degree+1)+this.points.length,2==this.dimension)return[this.getInterpol(this.seqAt(0),t),this.getInterpol(this.seqAt(1),t)];if(3==this.dimension)return[this.getInterpol(this.seqAt(0),t),this.getInterpol(this.seqAt(1),t),this.getInterpol(this.seqAt(2),t)];for(var e=[],i=0;i<this.dimension;i++)e.push(this.getInterpol(this.seqAt(i),t));return e};var w,I,P,A,C,N=M,B=i(209),S=i(210),_=i(211),O=i(111),j=(O.ShapeInfo,O.Intersection,O.Point2D,O.IntersectionQuery),V=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],L=10,X=15,G=X-5,Y=20,U=Y-5,R=5,T="circle",W=1,q=1,z=3,H=[.001],K=2,Q=1,J=Math.sqrt(.25*(K-1)*(K-1)+.25*(K-1)*(K-1)),Z={},$={},tt={},et=1e-10,it=[],at=!1,rt=[],st=2e3,nt=2e3,ht=10,ot=Number.MAX_VALUE,dt={},lt=p.e().x((function(t){return t[0]})).y((function(t){return t[1]})).curve(p.a),gt=p.e().x((function(t){return t[0]})).y((function(t){return t[1]})).curve(p.b);function ct(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array|t instanceof Object){var e=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(e[i]=ct(t[i]));return e}throw new Error("Unable to clone obj! Its type isn't supported.")}var ut=function(t){Object(g.a)(i,t);var e=Object(c.a)(i);function i(){var t;return Object(d.a)(this,i),(t=e.call(this)).onChangeEdgeWidth=function(e){e,t.setState({edgeWidth:e}),t.changeEdgeWidth(t.selectedEdge,e)},t.onChangeNodeR0=function(e){G=e,t.setState({nodeR0:e})},t.onChangeNodeR1=function(e){G=(X=e)-5,t.setState({nodeR1:e,nodeR0:X-5})},t.onChangeEdgeR0=function(e){U=e,t.setState({edgeR0:e})},t.onChangeEdgeR1=function(e){U=(Y=e)-5,t.setState({edgeR1:e,edgeR0:U})},t.onChangePixelGroup=function(e){K=e,t.setState({pixelGroup:e})},t.onChangeGap=function(e){Q=e,t.setState({gapBetween:e})},t.state={nodeR0:10,nodeR1:20,edgeR0:15,edgeR1:20,pixelGroup:3,gapBetween:1,edgeWidth:R,hasSelectEdge:!1},t.isfirstcreate=!0,t.pointData=[],t.canvasWidth=-1,t.canvasHeight=-1,t.maxX=-1,t.maxY=-1,t.minX=-1,t.minY=-1,t.maxDis=Number.MIN_VALUE,t.catPointDict={},t.catEdgeDict={},t.edges=[],t.maxDistance=-1,t.itemShape="",t.itemBBox=[],t.catEnergyField={},t.catNotGroup={},t.activeRegion={x:0,y:0,width:0,height:0},t.energyField={width:0,height:0,field:[]},t.editMode=!1,t.editIndex=-1,t.updatedEnergyPoints={},t.selectedEdge=-1,t.edgeControlPoints=[],t.hasMST=!1,t.updateIdx=[],t.hasBubbles=!1,t.firstFlag=!0,t}return Object(l.a)(i,[{key:"init",value:function(){this.pointData=[],this.canvasWidth=-1,this.canvasHeight=-1,this.maxX=-1,this.maxY=-1,this.minX=-1,this.minY=-1,this.maxDis=Number.MIN_VALUE,this.catPointDict={},this.catEdgeDict={},this.edges=[],this.maxDistance=-1,this.itemShape="",this.itemBBox=[],this.catEnergyField={},this.catNotGroup={},this.activeRegion={x:0,y:0,width:0,height:0},this.energyField={width:0,height:0,field:[]},this.editMode=!1,this.editIndex=-1,this.updatedEnergyPoints={},this.selectedEdge=-1,this.updateIdx=[],this.firstFlag=!0}},{key:"init_all",value:function(){V=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],L=10,G=(X=15)-5,U=(Y=20)-5,R=5,5,T="circle",W=1,q=1,-.8,0,z=3,H=[.001],K=2,Q=1,J=Math.sqrt(.25*(K-1)*(K-1)+.25*(K-1)*(K-1)),Z={},$={},tt={},et=1e-10,[],0,it=[],at=!1,rt=[],st=2e3,nt=2e3,ht=10,ot=Number.MAX_VALUE,dt={},0,!1,{},this.setState({nodeR0:10,nodeR1:20,edgeR0:15,edgeR1:20,pixelGroup:3,gapBetween:1,edgeWidth:R,hasSelectEdge:!1}),this.isfirstcreate=!0,this.pointData=[],this.canvasWidth=-1,this.canvasHeight=-1,this.maxX=-1,this.maxY=-1,this.minX=-1,this.minY=-1,this.maxDis=Number.MIN_VALUE,this.catPointDict={},this.catEdgeDict={},this.edges=[],this.maxDistance=-1,this.itemShape="",this.itemBBox=[],this.catEnergyField={},this.catNotGroup={},this.activeRegion={x:0,y:0,width:0,height:0},this.energyField={width:0,height:0,field:[]},this.editMode=!1,this.editIndex=-1,this.updatedEnergyPoints={},this.selectedEdge=-1,this.edgeControlPoints=[],this.hasMST=!1,this.updateIdx=[],this.hasBubbles=!1,this.firstFlag=!0,this.render(),this.componentDidMount()}},{key:"bubbleState",value:function(){return this.hasBubbles}},{key:"setViewBox",value:function(t,e,i,a){}},{key:"componentDidMount",value:function(){this.props.onRef(this),this.canvasWidth=document.getElementById("mainsvg").getBoundingClientRect().width,this.canvasHeight=document.getElementById("mainsvg").getBoundingClientRect().height,document.oncontextmenu=function(){return!1}}},{key:"preProcessPoints",value:function(t,e){for(var i=0;i<t.length;i++){var a=void 0;1==t[i].flag?(a=this.pointData[t[i].id]).flag=!0:a=t[i];for(var r=0;r<a.catArray.length;r++){var s=a.catArray[r];e.hasOwnProperty(s)||(e[s]=[]),e[s].push(a)}}}},{key:"preProcessEdges",value:function(t,e,i){for(var a=0;a<t.length;a++){var r=void 0,s=void 0;1==t[a].flag?((r=this.edges[t[a].id]).flag=!0,s=this.pointData[r.start].catArray,i.push(r)):s=(r=t[a]).startpoint.catArray;for(var n=0;n<s.length;n++){var h=s[n];e.hasOwnProperty(h)||(e[h]=[]),e[h].push(r)}}}},{key:"editReDraw",value:function(t,e,i,a){ct(this.edges);this.pointData=i,this.edges=a,this.catPointDict={},this.catEdgeDict={},this.updateIdx=[],this.itemShape=this.pointData[0].shape;for(var r=0;r<this.pointData.length;r++){this.pointData[r].x=parseFloat(this.pointData[r].x),this.pointData[r].y=parseFloat(this.pointData[r].y),this.pointData[r].id=r,this.pointData[r].cat=this.pointData[r].cat.toString();var s=this.pointData[r].cat.split(","),n=[];if(s.length>1){this.pointData[r].multicat=!0;for(var h=0;h<s.length;h++)n.push(s[h])}else this.pointData[r].multicat=!1,n.push(this.pointData[r].cat);this.pointData[r].catArray=n}this.centralizeData(!1),this.calEdgeLength(),this.calActiveRegion(!1);var o={},d={},l=[];this.preProcessPoints(t,o),this.preProcessEdges(e,d,l),this.calEnergyField_Part(o,d),this.calFinalEnergeField_Part(),this.fillCrossingEdge_Part(l),p.h("path").remove(),!1,0,this.firstFlag=!0,this.findOutLine(),this.calOutLine(),this.calEdgeControlPoints();var g=this;p.g("svg").on("click",(function(){p.g("svg").selectAll("line").filter((function(){return parseInt(p.g(this).attr("index"))==g.selectedEdge})).attr("stroke","red").attr("opacity",0),g.selectedEdge=-1,g.setState({hasSelectEdge:!1,edgeWidth:R})}))}},{key:"getData",value:function(){if(this.props.pointData&&this.props.edges){if(this.props.edges.length>0&&(this.hasMST=!0),this.init(),0==this.hasMST){var t=this.props.createMST();this.pointData=t[0],this.edges=t[1],V=t[2],this.hasMST=!0}else this.pointData=this.props.pointData,this.edges=this.props.edges;this.itemShape=this.pointData[0].shape;for(var e=0;e<this.pointData.length;e++){this.pointData[e].x=parseFloat(this.pointData[e].x),this.pointData[e].y=parseFloat(this.pointData[e].y),this.pointData[e].id=e,this.pointData[e].cat=this.pointData[e].cat.toString(),ot=this.pointData[e].hasOwnProperty("radius")?Math.min(ot,this.pointData[e].radius*this.pointData[e].radius*Math.PI):Math.min(ot,this.pointData[e].width*this.pointData[e].width);var i=this.pointData[e].cat.split(","),a=[];if(i.length>1){this.pointData[e].multicat=!0;for(var r=0;r<i.length;r++)a.push(i[r])}else this.pointData[e].multicat=!1,a.push(this.pointData[e].cat);this.pointData[e].catArray=a}this.loadEdgeData(),this.props.handleCreated&&this.props.handleCreated()}}},{key:"centralizeData",value:function(t){this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxX=Number.MIN_VALUE,this.maxY=Number.MIN_VALUE;for(var e=0;e<this.pointData.length;e++){if("circle"==T){if("rectangle"==this.itemShape){var i=Math.sqrt(Math.pow(this.pointData[e].width,2)+Math.pow(this.pointData[e].height,2))/2;this.pointData[e].radius=i}this.pointData[e].maxX=this.pointData[e].x+this.pointData[e].radius,this.pointData[e].minX=this.pointData[e].x-this.pointData[e].radius,this.pointData[e].maxY=this.pointData[e].y+this.pointData[e].radius,this.pointData[e].minY=this.pointData[e].y-this.pointData[e].radius}else"rectangle"==T&&("circle"==this.itemShape&&(this.pointData[e].width=2*this.pointData[e].radius,this.pointData[e].height=2*this.pointData[e].radius),this.pointData[e].maxX=this.pointData[e].x+this.pointData[e].width/2,this.pointData[e].minX=this.pointData[e].x-this.pointData[e].width/2,this.pointData[e].maxY=this.pointData[e].y+this.pointData[e].height/2,this.pointData[e].minY=this.pointData[e].y-this.pointData[e].height/2);this.maxX=Math.max(this.maxX,this.pointData[e].maxX),this.maxY=Math.max(this.maxY,this.pointData[e].maxY),this.minX=Math.min(this.minX,this.pointData[e].minX),this.minY=Math.min(this.minY,this.pointData[e].minY);for(var a=0;a<this.pointData[e].catArray.length;a++){var r=this.pointData[e].catArray[a];this.catPointDict.hasOwnProperty(r)||(this.catPointDict[r]=[],this.catPointDict[r].minX=Number.MAX_VALUE,this.catPointDict[r].maxX=Number.MIN_VALUE,this.catPointDict[r].minY=Number.MAX_VALUE,this.catPointDict[r].maxY=Number.MIN_VALUE),this.catPointDict[r].push(this.pointData[e]),this.catPointDict[r].minX=Math.min(this.catPointDict[r].minX,this.pointData[e].minX),this.catPointDict[r].maxX=Math.max(this.catPointDict[r].maxX,this.pointData[e].maxX),this.catPointDict[r].minY=Math.min(this.catPointDict[r].minY,this.pointData[e].minY),this.catPointDict[r].maxY=Math.max(this.catPointDict[r].maxY,this.pointData[e].maxY)}}for(var s=0;s<this.edges.length;s++){var n=this.edges[s].start,h=this.edges[s].end,o=this.pointData[n].catArray,d=Math.min(this.pointData[n].x,this.pointData[h].x),l=Math.min(this.pointData[n].y,this.pointData[h].y),g=Math.max(this.pointData[n].x,this.pointData[h].x),c=Math.max(this.pointData[n].y,this.pointData[h].y);if(this.edges[s].virtrual)for(var u=this.edges[s].virtrualNodes,y=0;y<u.length;y++){var f=u[y][0],x=u[y][1];d=Math.min(d,f),l=Math.min(l,x),g=Math.max(g,f),c=Math.max(c,x)}this.maxX=Math.max(this.maxX,g),this.maxY=Math.max(this.maxY,c),this.minX=Math.min(this.minX,d),this.minY=Math.min(this.minY,l),this.edges[s].x=d,this.edges[s].y=l,this.edges[s].width=g-d,this.edges[s].height=c-l;for(var v=0;v<o.length;v++){var E=o[v];this.catPointDict[E].minX=Math.min(this.catPointDict[E].minX,d),this.catPointDict[E].maxX=Math.max(this.catPointDict[E].maxX,g),this.catPointDict[E].minY=Math.min(this.catPointDict[E].minY,l),this.catPointDict[E].maxY=Math.max(this.catPointDict[E].maxY,c)}}for(var m=0;m<this.edges.length;m++){var D=this.edges[m].cat;this.catEdgeDict.hasOwnProperty(D)||(this.catEdgeDict[D]=[]),this.catEdgeDict[D].push(this.edges[m])}t&&(p.g("#mainsvg").attr("viewBox",this.minX-Math.max(X,Y)-L-10+" "+(this.minY-Math.max(X,Y)-L-10)+" "+(this.maxX-this.minX+2*Math.max(X,Y)+2*L+20)+" "+(this.maxY-this.minY+2*Math.max(X,Y)+2*L+20)),p.g("#leftsvg").attr("viewBox",this.minX-Math.max(X,Y)-L-10+" "+(this.minY-Math.max(X,Y)-L-10)+" "+(this.maxX-this.minX+2*Math.max(X,Y)+2*L+20)+" "+(this.maxY-this.minY+2*Math.max(X,Y)+2*L+20)),p.h("g").attr("transform","")),0==at&&(I=this.minX-Math.max(X,Y)-L-10,P=this.minY-Math.max(X,Y)-L-10,A=this.maxX-this.minX+2*Math.max(X,Y)+2*L+20,C=this.maxY-this.minY+2*Math.max(X,Y)+2*L+20,at=!0)}},{key:"drawPointData",value:function(){var t=this;V=this.props.colorArray,p.g("svg").call(p.i().extent([[I,P],[A,C]]).scaleExtent([1,8]).on("zoom",(function(t){var e=t.transform;p.h("g").attr("transform",e)})));var e=this;p.d().on("start",(function(){})).on("drag",(function(t){p.g(this).attr("cx",t.x).attr("cy",t.y)}));var i=[];if("circle"==this.itemShape){for(var a=function(i){var a=i;w.append("circle").attr("class","dataPoint").attr("cx",t.pointData[i].x).attr("cy",t.pointData[i].y).attr("r",t.pointData[i].radius).attr("fill",(function(t,i){return V[e.pointData[a].catArray[e.pointData[a].catArray.length-1]]})).attr("catefory",t.pointData[i].cat).attr("index",a).on("mouseover",(function(t,e){}))},r=0;r<this.pointData.length;r++)a(r);i=document.getElementsByTagName("circle");for(var s=0;s<i.length;s++)this.itemBBox.push({id:i[s].getAttribute("index"),bbox:i[s].getBBox()})}else if("rectangle"==this.itemShape){for(var n=function(i){var a=i;w.append("rect").attr("class","dataPoint").attr("x",t.pointData[i].x-t.pointData[i].width/2).attr("y",t.pointData[i].y-t.pointData[i].height/2).attr("width",t.pointData[i].width).attr("height",t.pointData[i].height).attr("fill",(function(){return V[e.pointData[a].catArray[e.pointData[a].catArray.length-1]]})).attr("catefory",t.pointData[i].cat).attr("index",a).on("mouseover",(function(t,e){}))},h=0;h<this.pointData.length;h++)n(h);i=document.getElementsByTagName("rect");for(var o=0;o<i.length;o++)this.itemBBox.push({id:i[o].getAttribute("index"),bbox:i[o].getBBox()})}}},{key:"isInEdgeRange",value:function(t,e,i,a){var r=i.x,s=i.y,n=a.x,h=a.y,o=(n-r)*(t-r)+(h-s)*(e-s);return!(o<=0)&&!(o>=(n-r)*(n-r)+(h-s)*(h-s))}},{key:"calEdgeControlPoints",value:function(){function t(t,e){return t.avgdis-e.avgdis}this.edgeControlPoints=[];for(var e=[],i=0;i<this.edges.length;i++)this.edgeControlPoints.push([]),e.push([]);for(var a in Z)for(var r=0;r<Z[a].length;r++)for(var s=Z[a][r],n=0;n<s.length;n++){for(var h=Number.MAX_VALUE,o=-1,d=0;d<this.edges.length;d++){var l=this.edges[d];if(l.cat==a){var g=this.pointData[l.start],c=this.pointData[l.end],u=k(s[n][0],s[n][1],g.x,g.y,c.x,c.y);u>0&&u<h&&(h=u,o=d)}}o>=0&&e[o].push({order:r,index:n,dis:h})}for(var p=0;p<e.length;p++){for(var y=!1,f=[],x=1;x<e[p].length;x++){var v=e[p][x-1].index;e[p][x].index-v==1?(y||(y=!0),f.push(e[p][x-1])):y&&(f.push(e[p][x-1]),y=!1,this.edgeControlPoints[p].push(f),f=[])}y&&(f.push(e[p][e[p].length-1]),this.edgeControlPoints[p].push(f))}for(var E=0;E<this.edgeControlPoints.length;E++)if(this.edgeControlPoints[E].length>2){for(var m=0;m<this.edgeControlPoints[E].length;m++){for(var D=0,F=0;F<this.edgeControlPoints[E][m].length;F++)D+=this.edgeControlPoints[E][m][F].dis;D/=this.edgeControlPoints[E][m].length,this.edgeControlPoints[E][m].avgdis=D}this.edgeControlPoints[E].sort(t);var b=[this.edgeControlPoints[E][0],this.edgeControlPoints[E][1]];this.edgeControlPoints[E]=b}}},{key:"changeEdgeWidth",value:function(t,e){var i=e-R;i*=1.5;var a=this.edges[t].cat,r=this.pointData[this.edges[t].start],s=this.pointData[this.edges[t].end],n=[s.x-r.x,s.y-r.y],h=[-n[1],n[0]];h=F(h);var o=this.edgeControlPoints[t],d=o[0],l=o[1],g=Z[a][d[0].order][d[0].index],c=[g[0]-r.x,g[1]-r.y],u=c[0]*h[0]+c[1]*h[1];d.length,l.length;if(u>0){for(var p=i*h[0],y=i*h[1],f=0;f<d.length;f++){var x=d[f].index,v=d[f].order;Z[a][v][x][0]=$[a][v][x][0]+p,Z[a][v][x][1]=$[a][v][x][1]+y}for(var E=0;E<l.length;E++){var m=l[E].index,D=l[E].order;Z[a][D][m][0]=$[a][D][m][0]-p,Z[a][D][m][1]=$[a][D][m][1]-y}}else{for(var b=i*h[0],k=i*h[1],M=0;M<d.length;M++){var w=d[M].index,I=d[M].order;Z[a][I][w][0]=$[a][I][w][0]-b,Z[a][I][w][1]=$[a][I][w][1]-k}for(var P=0;P<l.length;P++){var A=l[P].index,C=l[P].order;Z[a][C][A][0]=$[a][C][A][0]+b,Z[a][C][A][1]=$[a][C][A][1]+k}}for(var N="",B=0;B<Z[a].length;B++)N+=lt(Z[a][B]);this.reDraw(a,this,N)}},{key:"handleEdgeWidth",value:function(t,e){t.stopPropagation();var i=this;i.selectedEdge=parseInt(p.g(e).attr("index")),i.setState({hasSelectEdge:!0}),p.g("svg").selectAll("line").filter((function(){return parseInt(p.g(e).attr("index"))==i.selectedEdge})).attr("stroke","red").attr("opacity",1)}},{key:"drawEdges",value:function(){p.g("#mainsvg").selectAll("line").remove();var t=this;function e(e){e.stopPropagation(),t.selectedEdge=parseInt(p.g(this).attr("index")),t.setState({hasSelectEdge:!0}),p.g("svg").selectAll("line").filter((function(){return parseInt(p.g(this).attr("index"))==t.selectedEdge})).attr("stroke","red").attr("opacity",1)}for(var i=0;i<this.edges.length;i++){var a=this.edges[i].start,r=this.edges[i].end,s=i;if(this.edges[i].virtrual){for(var n=this.edges[i].virtrualNodes,h=[this.pointData[a].x,this.pointData[a].y],o=void 0,d=0;d<n.length;d++)o=n[d],w.append("line").attr("x1",h[0]).attr("y1",h[1]).attr("x2",o[0]).attr("y2",o[1]).attr("index",s).attr("stroke-width",3).attr("stroke","black").attr("opacity",0).on("mouseover",(function(e,i){if(!t.state.hasSelectEdge){var a=p.g(this).attr("index");p.g("svg").selectAll("line").filter((function(){return p.g(this).attr("index")==a})).attr("opacity",1)}})).on("mouseout",(function(e,i){if(!t.state.hasSelectEdge){var a=p.g(this).attr("index");p.g("svg").selectAll("line").filter((function(){return p.g(this).attr("index")==a})).attr("opacity",0)}})).on("click",e),h=o;o=[this.pointData[r].x,this.pointData[r].y],w.append("line").attr("x1",h[0]).attr("y1",h[1]).attr("x2",o[0]).attr("y2",o[1]).attr("index",s).attr("stroke-width",3).attr("stroke","black").attr("opacity",0).on("mouseover",(function(e,i){if(!t.state.hasSelectEdge){var a=p.g(this).attr("index");p.g("svg").selectAll("line").filter((function(){return p.g(this).attr("index")==a})).attr("opacity",1)}})).on("mouseout",(function(e,i){if(!t.state.hasSelectEdge){var a=p.g(this).attr("index");p.g("svg").selectAll("line").filter((function(){return p.g(this).attr("index")==a})).attr("opacity",0)}})).on("click",e)}else w.append("line").attr("x1",this.pointData[a].x).attr("y1",this.pointData[a].y).attr("x2",this.pointData[r].x).attr("y2",this.pointData[r].y).attr("index",s).attr("stroke-width",3).attr("stroke","black").attr("opacity",0).on("mouseover",(function(e,i){if(!t.state.hasSelectEdge){var a=p.g(this).attr("index");p.g("svg").selectAll("line").filter((function(){return p.g(this).attr("index")==a})).attr("opacity",1)}})).on("mouseout",(function(e,i){if(!t.state.hasSelectEdge){var a=p.g(this).attr("index");p.g("svg").selectAll("line").filter((function(){return p.g(this).attr("index")==a})).attr("opacity",0)}})).on("click",e)}}},{key:"calEdgeLength",value:function(){for(var t=Number.MAX_VALUE,e=Number.MIN_VALUE,i=0;i<this.edges.length;i++){var a=this.pointData[this.edges[i].start],r=this.pointData[this.edges[i].end];if(this.edges[i].virtrual){var s=this.edges[i].virtrualNodes,n=void 0,h=void 0,o=0;n=[a.x,a.y];for(var d=0;d<s.length;d++)h=s[d],o+=D(n[0],n[1],h[0],h[1]),n=h;(o+=D(n[0],n[1],r.x,r.y))>e&&(e=o),o<t&&(t=o)}else{var l=D(a.x,a.y,r.x,r.y);l>e&&(e=l),l<t&&(t=l)}}this.maxEdgeLength=e,this.minEdgeLength=t}},{key:"componentWillUpdate",value:function(t,e,i){}},{key:"findOutLine",value:function(){for(var t in this.catEnergyField)this.updatedEnergyPoints[t]=[];H=[.01];var e={};for(var t in this.catEnergyField){e[t]=[];for(var i=parseInt((this.catEnergyField[t].boundingY-this.catEnergyField[t].y)/K),a=parseInt((this.catEnergyField[t].boundingX-this.catEnergyField[t].x)/K),r=parseInt((this.catEnergyField[t].boundingHeight*K+this.catEnergyField[t].boundingY-this.catEnergyField[t].y)/K),s=parseInt((this.catEnergyField[t].boundingWidth*K+this.catEnergyField[t].boundingX-this.catEnergyField[t].x)/K),n=0,h=i;h<r;h++){e[t].push([]);for(var o=a;o<s;o++)e[t][n].push(this.catEnergyField[t].finalField[h][o]);n++}}var d=this.calISOLine(H,e),l={};Z={};var g={};for(var t in d)for(var c=this.catEnergyField[t].boundingX,u=this.catEnergyField[t].boundingY,p=0,y=0;y<d[t].length;y++){var f=[];g.hasOwnProperty(t)||(g[t]=[]);var x=ht;d[t][y].length,d[t][y].length;for(var v=0;v<d[t][y].length;v+=x)f.push([d[t][y][v][0]*K+c,d[t][y][v][1]*K+u]);g[t].push(f);for(var E=!1,m=0;m<this.catPointDict[t].length&&!(E=S([this.catPointDict[t][m].x,this.catPointDict[t][m].y],f));m++);if(E){0==p&&(g[t].selectidx=[],Z[t]=[]),g[t].selectidx.push(g[t].length-1),l[t]=[];for(var F=0;F<d[t][y].length;F+=x)l[t].push([d[t][y][F][0],d[t][y][F][1]]);tt[t]=!1;var b=Z[t].length;Z[t][b]=[],Z[t][b]=f;for(var k=0,M=Z[t][b].length,w=0;w<M;w++)k+=D(Z[t][b][w][0],Z[t][b][w][1],Z[t][b][(w+1)%M][0],Z[t][b][(w+1)%M][1]);k/=M,Z[t][b].meandis=k,p++}}for(var I in this.catEnergyField)this.updatedEnergyPoints[I]=[];for(var t in d)for(var P=g[t].selectidx,A=0;A<g[t].length;A++){for(var C=!1,N=0;N<P.length;N++)if(A==P[N]){C=!0;break}if(!C){for(var B=!0,O=0;O<P.length;O++){for(var j=0;j<g[t][A].length&&0!=(B=S([g[t][A][j][0],g[t][A][j][1]],g[t][P[O]]));j++);if(B)break}if(B){if(_(g[t][A])<ot)continue;for(var V=0,L=g[t][A].length,X=[-1,-1];V<L;){var G=(V-1+L)%L,Y=(V+1)%L,U=[g[t][A][G][0]-g[t][A][V][0],g[t][A][G][1]-g[t][A][V][1]],R=[g[t][A][Y][0]-g[t][A][V][0],g[t][A][Y][1]-g[t][A][V][1]],T=[U[0]+R[0],U[1]+R[1]],W=Math.sqrt(T[0]*T[0]+T[1]*T[1]);0!=W&&(T=[T[0]/W,T[1]/W]);var q=[g[t][A][V][0]+2*T[0],g[t][A][V][1]+2*T[1]];if(S(q,g[t][A])){X=[q[0],q[1]];break}V++}var z=!0;if(-1!=X[0]&&-1!=X[1]){var Q=parseInt((X[1]-this.catEnergyField[t].y)/K),J=parseInt((X[0]-this.catEnergyField[t].x)/K);this.catEnergyField[t].finalField[Q][J]>.01&&(z=!1)}if(!z)continue;var $=Z[t].length;Z[t][$]=[];for(var et=0;et<g[t][A].length;et++)Z[t][$].push([g[t][A][et][0],g[t][A][et][1]]);for(var it=0,at=Z[t][$].length,rt=0;rt<at;rt++)it+=D(Z[t][$][rt][0],Z[t][$][rt][1],Z[t][$][(rt+1)%at][0],Z[t][$][(rt+1)%at][1]);it/=at,Z[t][$].meandis=it}}}}},{key:"calOutLine",value:function(){var t={};for(var e in this.catEnergyField){t[e]=[];for(var i="",a=0;a<Z[e].length;a++)t[e].push(lt(Z[e][a])),i+=lt(Z[e][a]);this.drawISOLinesV2(e,this,i)}for(var e in Z){$[e]=[];for(var r=0;r<Z[e].length;r++){$[e][r]=[];for(var s=0;s<Z[e][r].length;s++)$[e][r].push([]),$[e][r][s].push(Z[e][r][s][0]),$[e][r][s].push(Z[e][r][s][1])}}}},{key:"loadEdgeData",value:function(){this.centralizeData(!0),this.calEdgeLength(),this.calActiveRegion(!0),this.calEnergyField(),this.calFinalEnergeField(),this.fillCrossingEdge(),this.createGapInBoundary(),p.g("svg").selectAll("*").remove(),w=p.g("svg").append("g"),!1,0,this.findOutLine(),this.calOutLine(),this.calEdgeControlPoints(),this.drawEdges(),this.drawPointData();var t=this;p.g("svg").on("click",(function(){p.g("svg").selectAll("line").filter((function(){return parseInt(p.g(this).attr("index"))==t.selectedEdge})).attr("stroke","red").attr("opacity",0),t.selectedEdge=-1,t.setState({hasSelectEdge:!1,edgeWidth:R})}))}},{key:"afterEditReDraw",value:function(){this.pointData=this.props.pointData,this.edges=this.props.edges,this.drawEdges(),this.drawPointData();var t=this;p.g("svg").on("click",(function(){p.g("svg").selectAll("line").filter((function(){return parseInt(p.g(this).attr("index"))==t.selectedEdge})).attr("stroke","red").attr("opacity",0),t.selectedEdge=-1,t.setState({hasSelectEdge:!1,edgeWidth:R})}))}},{key:"calActiveRegion",value:function(t){for(var e in this.catPointDict){!t&&this.catEnergyField.hasOwnProperty(e)||(this.catEnergyField[e]={});var i=this.catPointDict[e].maxX,a=this.catPointDict[e].minX,r=this.catPointDict[e].maxY,s=this.catPointDict[e].minY;if(this.catEnergyField[e].boundingX=a-Math.max(X,Y)-L,this.catEnergyField[e].boundingY=s-Math.max(X,Y)-L,this.catEnergyField[e].boundingWidth=Math.ceil((i-a+2*Math.max(X,Y)+2*L)/K),this.catEnergyField[e].boundingHeight=Math.ceil((r-s+2*Math.max(X,Y)+2*L)/K),t||!this.catEnergyField[e].hasOwnProperty("field")){var n=this.catEnergyField[e].boundingX+.5*this.catEnergyField[e].boundingWidth,h=this.catEnergyField[e].boundingY+.5*this.catEnergyField[e].boundingHeight;this.catEnergyField[e].x=parseInt(n-.5*st),this.catEnergyField[e].y=parseInt(h-.5*nt),this.catEnergyField[e].width=parseInt(st/K),this.catEnergyField[e].height=parseInt(nt/K),this.catEnergyField[e].field=[],this.catEnergyField[e].barrierMap=[];for(var o=0;o<nt;o++)this.catEnergyField[e].field.push(new Array(st).fill(0)),this.catEnergyField[e].barrierMap.push(new Array(st).fill(0))}}this.hasBubbles=!0}},{key:"calDistanceToItem",value:function(t,e,i){if("circle"==T){var a=D(t,e,i.x,i.y);return a<i.radius?0:a-i.radius}}},{key:"getPointEdgeDistance",value:function(t,e,i,a,r,s){var n,h=i-t,o=a-e,d=r-t,l=s-e,g=d*h+l*o;n=g<=0||(g=(d=h-d)*h+(l=o-l)*o)<=0?0:g*g/(h*h+o*o);var c=d*d+l*l-n;return c<0&&(c=0),Math.sqrt(c)}},{key:"calDistanceToEdgeV2",value:function(t,e,i){var a,r;if(0==i.flag?(a=i.startpoint,r=i.endpoint):(a=this.pointData[i.start],r=this.pointData[i.end]),i.virtrual&&i.virtrualNodes.length>0){for(var s,n,h,o=i.virtrualNodes,d=[a.x,a.y],l=Number.MAX_VALUE,g=0,c=0,u=-1,p=0;p<o.length;p++){s=o[p];var y=this.getPointEdgeDistance(d[0],d[1],s[0],s[1],t,e);y<l&&(l=y,u=p),d=s}d=[a.x,a.y];for(var f=0;f<u;f++)s=o[f],g+=D(d[0],d[1],s[0],s[1]),d=s;0==u?(d=[a.x,a.y],s=o[0]):(d=o[u-1],s=o[u]);var x=this.getPointEdgeDistance(r.x,r.y,o[o.length-1][0],o[o.length-1][1],t,e);x<l&&(l=x,g+=D(d[0],d[1],s[0],s[1]),d=s,s=[r.x,r.y]),h=l;var v=[t-d[0],e-d[1]],E=[s[0]-d[0],s[1]-d[1]],m=(d[0],s[0],d[1],s[1],s[0],s[1],D(d[0],d[1],s[0],s[1]));g+=(E[0]*v[0]+E[1]*v[1])/m,d=[a.x,a.y];for(var F=0;F<o.length;F++)s=o[F],c+=D(d[0],d[1],s[0],s[1]),d=s;n=(c+=D(d[0],d[1],r.x,r.y))-g;var b=Math.min(g,n);return b<0&&(b=-1),[h,b,c]}var k=this.getPointEdgeDistance(a.x,a.y,r.x,r.y,t,e),M=[t-a.x,e-a.y],w=[r.x-a.x,r.y-a.y],I=(a.x,r.x,a.y,r.y,r.x,r.y,D(a.x,a.y,r.x,r.y)),P=(w[0]*M[0]+w[1]*M[1])/I,A=P,C=I-P,N=Math.min(A,C);return N<0&&(N=-1),[k,N,I]}},{key:"calDistanceToEdge",value:function(t,e,i){var a=this.pointData[i.start],r=this.pointData[i.end];if(i.virtrual){for(var s,n,h,o=i.virtrualNodes,d=[a.x,a.y],l=Number.MAX_VALUE,g=0,c=0,u=-1,p=0;p<o.length;p++){s=o[p];var y=this.getPointEdgeDistance(d[0],d[1],s[0],s[1],t,e);y<l&&(l=y,u=p),d=s}d=[a.x,a.y];for(var f=0;f<u;f++)s=o[f],g+=D(d[0],d[1],s[0],s[1]),d=s;0==u?(d=[a.x,a.y],s=o[0]):(d=o[u-1],s=o[u]);var x=this.getPointEdgeDistance(r.x,r.y,o[o.length-1][0],o[o.length-1][1],t,e);x<l&&(l=x,g+=D(d[0],d[1],s[0],s[1]),d=s,s=[r.x,r.y]),h=l;var v=[t-d[0],e-d[1]],E=[s[0]-d[0],s[1]-d[1]],m=(d[0],s[0],d[1],s[1],s[0],s[1],D(d[0],d[1],s[0],s[1]));g+=(E[0]*v[0]+E[1]*v[1])/m,d=[a.x,a.y];for(var F=0;F<o.length;F++)s=o[F],c+=D(d[0],d[1],s[0],s[1]),d=s;n=(c+=D(d[0],d[1],r.x,r.y))-g;var b=Math.min(g,n);return b<0&&(b=-1),[h,b,c]}var k=this.getPointEdgeDistance(a.x,a.y,r.x,r.y,t,e),M=[t-a.x,e-a.y],w=[r.x-a.x,r.y-a.y],I=(a.x,r.x,a.y,r.y,r.x,r.y,D(a.x,a.y,r.x,r.y)),P=(w[0]*M[0]+w[1]*M[1])/I,A=P,C=I-P,N=Math.min(A,C);return N<0&&(N=-1),[k,N,I]}},{key:"isRectIntersects",value:function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0)&&(e.maxX>t.minX&&e.maxY>t.minY&&e.minX<t.maxX&&e.minY<t.maxY)}},{key:"isThisCat",value:function(t,e){for(var i=t.catArray,a=0;a<i.length;a++)if(i[a]==e)return!0;return!1}},{key:"LabelGroupElement",value:function(){var t=2*X;for(var e in this.catPointDict){for(var i=0;i<this.catPointDict[e].length;i++)if(0!=this.catPointDict[e][i].isGroup){var a=!0,r=this.catPointDict[e][i].x,s=this.catPointDict[e][i].y;for(var n in this.catPointDict)if(e!=n){for(var h=0;h<this.catPointDict[n].length;h++){if(D(r,s,this.catPointDict[n][h].x,this.catPointDict[n][h].y)<t+this.catPointDict[n][h].radius+this.catPointDict[e][i].radius){a=!1,this.catPointDict[n][h].isGroup=!1;break}}if(0==a)break;if(this.catEdgeDict.hasOwnProperty(n)){for(var o=0;o<this.catEdgeDict[n].length;o++)if(this.calDistanceToEdge(r,s,this.catEdgeDict[n][o])[0]<t+this.catPointDict[e][i].radius){a=!1,this.catEdgeDict[n][o].isGroup=!1;break}if(0==a)break}}this.catPointDict[e][i].isGroup=a}if(this.catEdgeDict.hasOwnProperty(e))for(var d=0;d<this.catEdgeDict[e].length;d++){this.pointData[this.catEdgeDict[e][d].start],this.pointData[this.catEdgeDict[e][d].end];if(0!=this.catEdgeDict[e][d].isGroup){var l=!0;for(var g in this.catPointDict)if(e!=g){for(var c=0;c<this.catPointDict[g].length;c++){var u=this.catPointDict[g][c].x,p=this.catPointDict[g][c].y;if(this.calDistanceToEdge(u,p,this.catEdgeDict[e][d])[0]<t+this.catPointDict[g][c].radius){l=!1,this.catPointDict[g][c].isGroup=!1;break}}if(0==l)break}this.catEdgeDict[e][d].isGroup=l}}}}},{key:"calEnergyField_Part",value:function(t,e){for(var i in this.catPointDict)if(!this.catEnergyField[i].hasOwnProperty("finalField")){this.catPointDict[i].pointMap=[],this.catEnergyField[i].pointBarrierMap=[],this.catEnergyField[i].edgeBarrierMap=[],this.catEnergyField[i].pointIndexMap=[],this.catEnergyField[i].edgeIndexMap=[],this.catEnergyField[i].edgeIndexMap2=[],this.catEnergyField[i].finalField=[],this.catEnergyField[i].subUpdate=[];for(var a=0;a<nt;a++){this.catEnergyField[i].finalField.push(new Array(st).fill(0)),this.catEnergyField[i].subUpdate.push(new Array(st).fill(0)),this.catEnergyField[i].pointBarrierMap.push(new Array(st).fill(0)),this.catEnergyField[i].edgeBarrierMap.push(new Array(st).fill(0)),this.catEnergyField[i].pointIndexMap.push(new Array(st).fill(-1)),this.catEnergyField[i].edgeIndexMap.push(new Array(st).fill(-1)),this.catEnergyField[i].edgeIndexMap2.push([]);for(var r=0;r<st;r++)this.catEnergyField[i].edgeIndexMap2[a].push([])}}for(var i in this.catPointDict){t.hasOwnProperty(i)||(t[i]=[]),e.hasOwnProperty(i)||(e[i]=[]);for(var s=t[i],n=0;n<s.length;n++){var h=s[n],o=void 0,d=void 0,l=void 0,g=void 0;o=Math.floor((h.minX-X-10-this.catEnergyField[i].x)/K),o=Math.max(0,o),d=Math.min(Math.ceil((h.maxX+X+10-this.catEnergyField[i].x)/K),this.catEnergyField[i].width),d=Math.max(0,d),l=Math.floor((h.minY-X-10-this.catEnergyField[i].y)/K),l=Math.max(0,l),g=Math.min(Math.ceil((h.maxY+X+10-this.catEnergyField[i].y)/K),this.catEnergyField[i].height),g=Math.max(0,g);for(var c=l;c<g;c++)for(var u=o;u<d;u++){var p=u*K+this.catEnergyField[i].x,y=c*K+this.catEnergyField[i].y;this.updateIdx.push([parseInt(y),parseInt(p)]);var f=this.calDistanceToItem(p,y,h);if(f<X+J){var x=W*Math.pow(X-f,2)/Math.pow(X-G,2);0==s[n].flag?(this.catEnergyField[i].field[c][u]-=x,this.catEnergyField[i].finalField[c][u]=0,this.catEnergyField[i].subUpdate[c][u]=1,(this.catEnergyField[i].field[c][u]<=.015||-1==this.catEnergyField[i].edgeIndexMap[c][u])&&(this.catEnergyField[i].field[c][u]=0,this.catEnergyField[i].pointBarrierMap[c][u]=0,this.catEnergyField[i].pointIndexMap[c][u]=-1,this.catEnergyField[i].barrierMap[c][u]=0)):(this.catEnergyField[i].field[c][u]+=x,this.catEnergyField[i].finalField[c][u]=0,this.catEnergyField[i].subUpdate[c][u]=0,0==this.catEnergyField[i].barrierMap[c][u]&&(this.catEnergyField[i].barrierMap[c][u]=5),0==this.catEnergyField[i].pointBarrierMap[c][u]&&(this.catEnergyField[i].pointBarrierMap[c][u]=5),-1==this.catEnergyField[i].pointIndexMap[c][u]&&(this.catEnergyField[i].pointIndexMap[c][u]=h.id))}1==s[n].flag&&(f<=z+J&&(3!=this.catEnergyField[i].barrierMap[c][u]&&(this.catEnergyField[i].barrierMap[c][u]=1),3!=this.catEnergyField[i].pointBarrierMap[c][u]&&(this.catEnergyField[i].pointBarrierMap[c][u]=1)),f<=J&&(this.catEnergyField[i].barrierMap[c][u]=3,this.catEnergyField[i].pointBarrierMap[c][u]=3,this.catEnergyField[i].pointIndexMap[c][u]=h.id))}}var v=this.maxEdgeLength/1.5,E=e[i];E.sort((function(t,e){return t.flag-e.flag}));for(var m=0;m<E.length;m++){var D=void 0,F=void 0,b=void 0,k=void 0,M=E[m].start,w=E[m].end;D=Math.floor((E[m].x-Y-10-this.catEnergyField[i].x)/K),D=Math.max(0,D),F=Math.min(Math.ceil((E[m].x+E[m].width+Y+10-this.catEnergyField[i].x)/K),this.catEnergyField[i].width),F=Math.max(0,F),b=Math.floor((E[m].y-Y-10-this.catEnergyField[i].y)/K),b=Math.max(0,b),k=Math.min(Math.ceil((E[m].y+E[m].height+Y+10-this.catEnergyField[i].y)/K),this.catEnergyField[i].height),k=Math.max(0,k);for(var I=b;I<k;I++)for(var P=D;P<F;P++){var A=P*K+this.catEnergyField[i].x,C=I*K+this.catEnergyField[i].y;this.updateIdx.push([parseInt(C),parseInt(A)]);var N=this.calDistanceToEdgeV2(A,C,E[m]),B=N[0],S=N[1],_=N[2];if(!(S<0)){if(B<Y+J){var O=Y;_>v&&(O=2*Y/(1+(Y-2)/(Y/10*_)*S)),O>Y&&(O=Y),O>2*X&&(O=2*X);var j=void 0;if(j=B>O?0:q*Math.pow(O-B,2)/Math.pow(Y-U,2),1==E[m].flag){this.catEnergyField[i].finalField[I][P];this.catEnergyField[i].field[I][P]+=j,this.catEnergyField[i].finalField[I][P]=0,this.catEnergyField[i].subUpdate[I][P]=0,0!=this.catEnergyField[i].barrierMap[I][P]&&5!=this.catEnergyField[i].barrierMap[I][P]||j>0&&(this.catEnergyField[i].barrierMap[I][P]=6),0!=this.catEnergyField[i].edgeBarrierMap[I][P]&&5!=this.catEnergyField[i].edgeBarrierMap[I][P]||j>0&&(this.catEnergyField[i].edgeBarrierMap[I][P]=6),j>0&&(this.catEnergyField[i].edgeIndexMap[I][P]=M,this.catEnergyField[i].edgeIndexMap2[I][P].push({start:M,end:w}))}else{this.catEnergyField[i].field[I][P]-=j,this.catEnergyField[i].finalField[I][P]=0,this.catEnergyField[i].subUpdate[I][P]=1;var V=!1;if(-1==this.catEnergyField[i].pointIndexMap[I][P]&&1==this.catEnergyField[i].edgeIndexMap2[I][P].length&&this.catEnergyField[i].edgeIndexMap2[I][P][0].start==M&&this.catEnergyField[i].edgeIndexMap2[I][P][0].end==w&&(V=!0),this.catEnergyField[i].field[I][P]<=.015||V){this.catEnergyField[i].field[I][P]=0,this.catEnergyField[i].edgeBarrierMap[I][P]=0,this.catEnergyField[i].edgeIndexMap[I][P]=-1;for(var L=this.catEnergyField[i].edgeIndexMap2[I][P].length-1;L>=0;L--){var R=this.catEnergyField[i].edgeIndexMap2[I][P][L].start,T=this.catEnergyField[i].edgeIndexMap2[I][P][L].end;R==M&&T==w&&this.catEnergyField[i].edgeIndexMap2[I][P].splice(L,1)}this.catEnergyField[i].barrierMap[I][P]=0}}}1==E[m].flag&&(B<=z+J&&(4!=this.catEnergyField[i].barrierMap[I][P]&&3!=this.catEnergyField[i].barrierMap[I][P]&&1!=this.catEnergyField[i].barrierMap[I][P]&&(this.catEnergyField[i].barrierMap[I][P]=2),4!=this.catEnergyField[i].edgeBarrierMap[I][P]&&3!=this.catEnergyField[i].edgeBarrierMap[I][P]&&1!=this.catEnergyField[i].edgeBarrierMap[I][P]&&(this.catEnergyField[i].edgeBarrierMap[I][P]=2)),B<=2+J&&(this.catEnergyField[i].barrierMap[I][P]=4,this.catEnergyField[i].edgeBarrierMap[I][P]=4))}}}}}},{key:"calEnergyField",value:function(){for(var t in this.catPointDict){this.catPointDict[t].pointMap=[],this.catEnergyField[t].pointBarrierMap=[],this.catEnergyField[t].edgeBarrierMap=[],this.catEnergyField[t].pointIndexMap=[],this.catEnergyField[t].edgeIndexMap=[],this.catEnergyField[t].edgeIndexMap2=[],this.catEnergyField[t].finalField=[],this.catEnergyField[t].subUpdate=[];for(var e=0;e<nt;e++){this.catEnergyField[t].subUpdate.push(new Array(st).fill(0)),this.catEnergyField[t].finalField.push(new Array(st).fill(0)),this.catEnergyField[t].pointBarrierMap.push(new Array(st).fill(0)),this.catEnergyField[t].edgeBarrierMap.push(new Array(st).fill(0)),this.catEnergyField[t].pointIndexMap.push(new Array(st).fill(-1)),this.catEnergyField[t].edgeIndexMap.push(new Array(st).fill(-1)),this.catEnergyField[t].edgeIndexMap2.push([]);for(var i=0;i<st;i++)this.catEnergyField[t].edgeIndexMap2[e].push([])}}for(var t in this.catPointDict){for(var a=this.catPointDict[t],r=0;r<a.length;r++){var s=a[r];this.catPointDict[t].pointMap.push([]);var n,h,o,d;n=Math.floor((s.minX-X-10-this.catEnergyField[t].x)/K),h=Math.min(Math.ceil((s.maxX+X+10-this.catEnergyField[t].x)/K),this.catEnergyField[t].width),o=Math.floor((s.minY-X-10-this.catEnergyField[t].y)/K),d=Math.min(Math.ceil((s.maxY+X+10-this.catEnergyField[t].y)/K),this.catEnergyField[t].height);for(var l=o;l<d;l++)for(var g=n;g<h;g++){var c=g*K+this.catEnergyField[t].x,u=l*K+this.catEnergyField[t].y,p=this.calDistanceToItem(c,u,s);if(p<X+J){var y=W*Math.pow(X-p,2)/Math.pow(X-G,2);this.catEnergyField[t].field[l][g]+=y,0==this.catEnergyField[t].barrierMap[l][g]&&(this.catEnergyField[t].barrierMap[l][g]=5),0==this.catEnergyField[t].pointBarrierMap[l][g]&&(this.catEnergyField[t].pointBarrierMap[l][g]=5),-1==this.catEnergyField[t].pointIndexMap[l][g]&&(this.catEnergyField[t].pointIndexMap[l][g]=s.id)}if(s.multicat)for(var f=s.catArray,x=0;x<f.length;x++)if(f[x]!=t&&parseInt(f[x])<parseInt(t)&&p<X+10){var v=g*K+this.catEnergyField[t].x,E=l*K+this.catEnergyField[t].y,m=Math.floor((v-this.catEnergyField[f[x]].x)/K),D=Math.floor((E-this.catEnergyField[f[x]].y)/K);Math.pow(X-p,2),Math.pow(X-G,2);m>0&&D>0&&m<this.catEnergyField[f[x]].width&&this.catEnergyField[f[x]].height}p<=z+J&&(3!=this.catEnergyField[t].barrierMap[l][g]&&(this.catEnergyField[t].barrierMap[l][g]=1),3!=this.catEnergyField[t].pointBarrierMap[l][g]&&(this.catEnergyField[t].pointBarrierMap[l][g]=1)),p<=J&&(this.catEnergyField[t].barrierMap[l][g]=3,this.catPointDict[t].pointMap[r].push([g,l]),this.catEnergyField[t].pointBarrierMap[l][g]=3,this.catEnergyField[t].pointIndexMap[l][g]=s.id)}}var F=this.maxEdgeLength/2;if(this.catEdgeDict.hasOwnProperty(t))for(var b=this.catEdgeDict[t],k=0;k<b.length;k++){var M,w,I,P,A=b[k].start,C=b[k].end;M=Math.floor((b[k].x-Y-10-this.catEnergyField[t].x)/K),w=Math.min(Math.ceil((b[k].x+b[k].width+Y+10-this.catEnergyField[t].x)/K),this.catEnergyField[t].width),I=Math.floor((b[k].y-Y-10-this.catEnergyField[t].y)/K),P=Math.min(Math.ceil((b[k].y+b[k].height+Y+10-this.catEnergyField[t].y)/K),this.catEnergyField[t].height);for(var N=I;N<P;N++)for(var B=M;B<w;B++){var S=B*K+this.catEnergyField[t].x,_=N*K+this.catEnergyField[t].y,O=this.calDistanceToEdge(S,_,b[k]),j=O[0],V=O[1],L=O[2];if(!(V<0)){if(j<Y+J){var R=Y;L>F&&(R=2*Y/(1+(Y-2)/(Y/10*L)*V)),R>Y&&(R=Y),R>2*X&&(R=2*X);var T=void 0;T=j>R?0:q*Math.pow(R-j,2)/Math.pow(Y-U,2),this.catEnergyField[t].field[N][B]+=T,0!=this.catEnergyField[t].barrierMap[N][B]&&5!=this.catEnergyField[t].barrierMap[N][B]||T>0&&(this.catEnergyField[t].barrierMap[N][B]=6),0!=this.catEnergyField[t].edgeBarrierMap[N][B]&&5!=this.catEnergyField[t].edgeBarrierMap[N][B]||T>0&&(this.catEnergyField[t].edgeBarrierMap[N][B]=6),T>0&&(this.catEnergyField[t].edgeIndexMap[N][B]=A,this.catEnergyField[t].edgeIndexMap2[N][B].push({start:A,end:C}))}var H=this.pointData[A],Q=this.pointData[C];if(H.multicat&&Q.multicat){for(var Z=!1,$=-1,tt=0;tt<H.catArray.length;tt++){var et=H.catArray[tt];if(et!=t)for(var it=0;it<Q.catArray.length;it++){var at=Q.catArray[it];if(at!=t&&at==et){Z=!0,$=et;break}}}if(Z&&parseInt($)<parseInt(t)&&j<Y+20+J){var rt=B*K+this.catEnergyField[t].x,ht=N*K+this.catEnergyField[t].y,ot=Math.floor((rt-this.catEnergyField[$].x)/K),dt=Math.floor((ht-this.catEnergyField[$].y)/K),lt=q*Math.pow(Y-0,2)/Math.pow(Y-U,2);ot>0&&dt>0&&ot<this.catEnergyField[$].width&&dt<this.catEnergyField[$].height&&(this.catEnergyField[$].field[dt][ot]+=lt,this.catEnergyField[$].edgeIndexMap[dt][ot]=H.id,this.catEnergyField[$].edgeIndexMap2[dt][ot].push({start:H.id,end:Q.id}))}}j<=z+J&&(4!=this.catEnergyField[t].barrierMap[N][B]&&3!=this.catEnergyField[t].barrierMap[N][B]&&1!=this.catEnergyField[t].barrierMap[N][B]&&(this.catEnergyField[t].barrierMap[N][B]=2),4!=this.catEnergyField[t].edgeBarrierMap[N][B]&&3!=this.catEnergyField[t].edgeBarrierMap[N][B]&&1!=this.catEnergyField[t].edgeBarrierMap[N][B]&&(this.catEnergyField[t].edgeBarrierMap[N][B]=2)),j<=2+J&&(this.catEnergyField[t].barrierMap[N][B]=4,this.catEnergyField[t].edgeBarrierMap[N][B]=4)}}}}}},{key:"checkEdgeCrossing",value:function(t,e,i,a){var r=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),s=(t.x-a.x)*(e.y-a.y)-(t.y-a.y)*(e.x-a.x);if(r*s>=0)return[!1];var n=(i.x-t.x)*(a.y-t.y)-(i.y-t.y)*(a.x-t.x);if(n*(n+r-s)>=0)return[!1];var h=n/(s-r),o=h*(e.x-t.x),d=h*(e.y-t.y);return[!0,{x:t.x+o,y:t.y+d}]}},{key:"createGapInBoundary",value:function(){var t=this.state.gapBetween;if(0!=t)for(var e in this.catEnergyField){for(var i=this.catEnergyField[e].finalField,a=[],r=parseInt((this.catEnergyField[e].boundingY-this.catEnergyField[e].y)/K),s=parseInt((this.catEnergyField[e].boundingX-this.catEnergyField[e].x)/K),n=parseInt((this.catEnergyField[e].boundingHeight*K+this.catEnergyField[e].boundingY-this.catEnergyField[e].y)/K),h=parseInt((this.catEnergyField[e].boundingWidth*K+this.catEnergyField[e].boundingX-this.catEnergyField[e].x)/K),o=r;o<n;o++)for(var d=s;d<h;d++)if(0!=i[o][d]&&4!=this.catEnergyField[e].barrierMap[o][d]){for(var l=!1,g=0;g<t;g++){var c=g+1;if(d+c<this.catEnergyField[e].width&&0==i[o][d+c]){l=!0;break}if(d-c>0&&0==i[o][d-c]){l=!0;break}if(o-c>0&&0==i[o-c][d]){l=!0;break}if(o+c<this.catEnergyField[e].height&&0==i[o+c][d]){l=!0;break}if(d+c<this.catEnergyField[e].width&&o-c>0&&0==i[o-c][d+c]){l=!0;break}if(d+c<this.catEnergyField[e].width&&o+c<this.catEnergyField[e].height&&0==i[o+c][d+c]){l=!0;break}if(d-c>0&&o-c>0&&0==i[o-c][d-c]){l=!0;break}if(d-c>0&&o+c<this.catEnergyField[e].height&&0==i[o+c][d-c]){l=!0;break}}l&&a.push([d,o])}for(var u=0;u<a.length;u++){var p=a[u][0],y=a[u][1];this.catEnergyField[e].finalField[y][p]=0}}}},{key:"removeEmptyZone",value:function(t){for(var e in t){var i=t[e],a=[],r=this.catEnergyField[e].finalField;this.catEnergyField[e].isoLineMap=[];for(var s=0;s<i.length;s++){for(var n=[],h=0;h<i[s].length;h++)n.push({x:i[s][h][0],y:i[s][h][1]});a.push(n)}for(var o=[],d=0;d<a.length;d++)o.push([]);for(var l=0;l<this.catEnergyField[e].height;l++){this.catEnergyField[e].isoLineMap.push([]);for(var g=0;g<this.catEnergyField[e].width;g++)if(this.catEnergyField[e].isoLineMap[l].push(-1),r[l][g]>0)for(var c=0;c<a.length;c++){if(j.pointInPolygon({x:g,y:l},a[c])){o[c].push([g,l]),this.catEnergyField[e].isoLineMap[l][g]=c;break}}}for(var u=[],p=0;p<this.catPointDict[e].pointMap.length;p++){for(var y=this.catPointDict[e].pointMap[p],f=!0,x=-1,v=0;v<y.length;v++){var E=y[v][0],m=y[v][1];if(0==v&&this.catEnergyField[e].isoLineMap[m][E]>-1&&(x=this.catEnergyField[e].isoLineMap[m][E]),-1==this.catEnergyField[e].isoLineMap[m][E]||this.catEnergyField[e].isoLineMap[m][E]!=x){f=!1;break}}f&&u.push(x)}for(var D=[],F=0;F<o.length;F++){for(var b=!0,k=0;k<u.length;k++)if(F==u[k]){b=!1;break}b&&D.push(F)}for(var M=0;M<D.length;M++)for(var w=o[D[M]],I=0;I<w.length;I++){var P=w[I][0],A=w[I][1];this.catEnergyField[e].finalField[A][P]=0}for(var C=[],N=0;N<i.length;N++){for(var B=!1,S=0;S<D.length;S++)if(N==D[S]){B=!0;break}B||C.push(i[N])}t[e]=C}return t}},{key:"isSameCat",value:function(t,e){for(var i=0;i<t.length;i++)for(var a=t[i],r=0;r<e.length;r++){if(a==e[r])return!0}return!1}},{key:"isContained",value:function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}},{key:"calFinalEnergeFieldForOverlap",value:function(){for(var t in this.catEnergyField)for(var e in this.catNotGroup[t])for(var i in this.catNotGroup[t][e]){e=parseInt(e),i=parseInt(i);var a=Math.ceil(i/K),r=Math.ceil(e/K),s=i+this.catEnergyField[t].x,n=e+this.catEnergyField[t].y,h=this.catEnergyField[t].gfield[e][i],o=h,d=!1,l=this.catEnergyField[t].gpointIndexMap[e][i],g=this.catEnergyField[t].gedgeIndexMap[e][i],c=void 0;if((-1!=g||-1!=l)&&(g>-1&&(c=this.pointData[g].multicat?this.pointData[g].catArray:[this.pointData[g].cat]),l>-1&&(c=this.pointData[l].multicat?this.pointData[l].catArray:[this.pointData[l].cat]),3!=this.catEnergyField[t].gbarrierMap[e][i]&&4!=this.catEnergyField[t].gbarrierMap[e][i]||(d=!0),d&&0==this.catEnergyField[t].gfield[e][i]&&(h=1,this.catEnergyField[t].gfield[e][i]=1,this.catEnergyField[t].field[r][a]=1),0!=h)){for(var u in this.catEnergyField)if(u!=t&&u!=t&&s<this.catEnergyField[u].x+this.catEnergyField[u].gwidth&&s>this.catEnergyField[u].x&&n<this.catEnergyField[u].y+this.catEnergyField[u].gheight&&n>this.catEnergyField[u].y){var p=Math.floor(s-this.catEnergyField[u].x),y=Math.floor(n-this.catEnergyField[u].y),f=this.catEnergyField[u].gfield[y][p],x=!1,v=this.catEnergyField[u].gpointIndexMap[y][p],E=this.catEnergyField[u].gedgeIndexMap[y][p],m=void 0;if(-1==v&&-1==E)continue;if(E>-1&&(m=this.pointData[E].multicat?this.pointData[E].catArray:[this.pointData[E].cat]),v>-1&&(m=this.pointData[v].multicat?this.pointData[v].catArray:[this.pointData[v].cat]),this.isContained(m,t))continue;if(this.isContained(c,u)&&3!=this.catEnergyField[u].gpointBarrierMap[y][p])continue;if(3!=this.catEnergyField[u].gbarrierMap[y][p]&&4!=this.catEnergyField[u].gbarrierMap[y][p]||(x=!0),0==f)continue;if(d||x)if(d&&!x)o=h;else{if(!d&&x){o=0;break}d&&x&&(o=4==this.catEnergyField[t].gbarrierMap[e][i]?h:0)}else{if(f>h){o=0;break}o=h}}this.catEnergyField[t].finalField[r][a]=o,4==this.catEnergyField[t].barrierMap[r][a]&&(this.catEnergyField[t].finalField[r][a]=1e4)}}}},{key:"updateEnergyPoints",value:function(){for(var t in this.updatedEnergyPoints)for(var e=0;e<this.updatedEnergyPoints[t].length;e++){var i=this.updatedEnergyPoints[t][e][0],a=this.updatedEnergyPoints[t][e][1],r=i*K+this.catEnergyField[t].x,s=a*K+this.catEnergyField[t].y,n=this.catEnergyField[t].field[a][i],h=n,o=!1;if(0!=n&&(3!=this.catEnergyField[t].barrierMap[a][i]&&4!=this.catEnergyField[t].barrierMap[a][i]||(o=!0),o&&0==this.catEnergyField[t].field[a][i]&&(n=1,this.catEnergyField[t].field[a][i]=1),0!=n)){for(var d in this.catEnergyField)if(d!=t&&d!=t&&r<this.catEnergyField[d].boundingX+this.catEnergyField[d].boundingWidth*K&&r>this.catEnergyField[d].boundingX&&s<this.catEnergyField[d].boundingY+this.catEnergyField[d].boundingHeight*K&&s>this.catEnergyField[d].boundingY){var l=Math.floor((r-this.catEnergyField[d].x)/K),g=Math.floor((s-this.catEnergyField[d].y)/K),c=this.catEnergyField[d].field[g][l],u=!1;if(1!=this.catEnergyField[d].pointBarrierMap[g][l]&&3!=this.catEnergyField[d].pointBarrierMap[g][l]||(u=!0),0==c)continue;if(o||u)if(o&&!u)h=n;else{if(!o&&u){h=0;break}o&&u&&(h=4==this.catEnergyField[t].barrierMap[a][i]?n:0)}else{if(c>n){h=0;break}h=n}}this.catEnergyField[t].finalField[a][i]=h}}}},{key:"calFinalEnergeField_Part",value:function(){for(var t in this.updateIdx=new Set(this.updateIdx),this.catEnergyField){var e,i=Object(y.a)(this.updateIdx);try{for(i.s();!(e=i.n()).done;){var a=e.value,r=parseInt(a[1]),s=parseInt(a[0]),n=parseInt((r-this.catEnergyField[t].x)/K),h=parseInt((s-this.catEnergyField[t].y)/K);n=Math.min(n,this.catEnergyField[t].width-1),h=Math.min(h,this.catEnergyField[t].height-1),n=Math.max(n,0),h=Math.max(h,0);var o=this.catEnergyField[t].field[h][n],d=o,l=!1,g=this.catEnergyField[t].pointIndexMap[h][n],c=this.catEnergyField[t].edgeIndexMap[h][n],u=void 0;if((-1!=c||-1!=g)&&(c>-1&&(u=this.pointData[c].multicat?this.pointData[c].catArray:[this.pointData[c].cat]),g>-1&&(u=this.pointData[g].multicat?this.pointData[g].catArray:[this.pointData[g].cat]),3!=this.catEnergyField[t].barrierMap[h][n]&&4!=this.catEnergyField[t].barrierMap[h][n]||(l=!0),l&&this.catEnergyField[t].field[h][n]<=.015&&1!=this.catEnergyField[t].subUpdate[h][n]&&(o=1,this.catEnergyField[t].edgeIndexMap[h][n]=this.edges[c].start,this.catEnergyField[t].edgeIndexMap2[h][n].push({start:this.edges[c].start,end:this.edges[c].end}),this.catEnergyField[t].field[h][n]=1),0!=o)){for(var p in this.catEnergyField)if(p!=t&&p!=t&&r<this.catEnergyField[p].boundingX+this.catEnergyField[p].boundingWidth*K&&r>this.catEnergyField[p].boundingX&&s<this.catEnergyField[p].boundingY+this.catEnergyField[p].boundingHeight*K&&s>this.catEnergyField[p].boundingY){var f=Math.floor((r-this.catEnergyField[p].x)/K),x=Math.floor((s-this.catEnergyField[p].y)/K),v=this.catEnergyField[p].field[x][f],E=!1,m=this.catEnergyField[p].pointIndexMap[x][f],D=this.catEnergyField[p].edgeIndexMap[x][f],F=void 0;if(-1==m&&-1==D)continue;if(D>-1&&(F=this.pointData[D].multicat?this.pointData[D].catArray:[this.pointData[D].cat]),m>-1&&(F=this.pointData[m].multicat?this.pointData[m].catArray:[this.pointData[m].cat]),this.isContained(F,t))continue;if(this.isContained(u,p)&&3!=this.catEnergyField[p].pointBarrierMap[x][f])continue;if(3!=this.catEnergyField[p].barrierMap[x][f]&&4!=this.catEnergyField[p].barrierMap[x][f]||(E=!0),0==v)continue;if(l||E)if(l&&!E)d=o;else{if(!l&&E){d=0;break}l&&E&&(d=4==this.catEnergyField[t].barrierMap[h][n]?o:0)}else{if(v>o){d=0;break}d=o}}this.catEnergyField[t].finalField[h][n]=d,4==this.catEnergyField[t].barrierMap[h][n]&&1!=this.catEnergyField[t].subUpdate[h][n]&&(this.catEnergyField[t].finalField[h][n]=1e4)}}}catch(b){i.e(b)}finally{i.f()}}}},{key:"calFinalEnergeField",value:function(){for(var t in this.catEnergyField)for(var e=parseInt((this.catEnergyField[t].boundingY-this.catEnergyField[t].y)/K),i=parseInt((this.catEnergyField[t].boundingX-this.catEnergyField[t].x)/K),a=parseInt((this.catEnergyField[t].boundingHeight*K+this.catEnergyField[t].boundingY-this.catEnergyField[t].y)/K),r=parseInt((this.catEnergyField[t].boundingWidth*K+this.catEnergyField[t].boundingX-this.catEnergyField[t].x)/K),s=e;s<a;s++)for(var n=i;n<r;n++){var h=n*K+this.catEnergyField[t].x,o=s*K+this.catEnergyField[t].y,d=this.catEnergyField[t].field[s][n],l=d,g=!1,c=this.catEnergyField[t].pointIndexMap[s][n],u=this.catEnergyField[t].edgeIndexMap[s][n],p=void 0;if((-1!=u||-1!=c)&&(u>-1&&(p=this.pointData[u].multicat?this.pointData[u].catArray:[this.pointData[u].cat]),c>-1&&(p=this.pointData[c].multicat?this.pointData[c].catArray:[this.pointData[c].cat]),3!=this.catEnergyField[t].barrierMap[s][n]&&4!=this.catEnergyField[t].barrierMap[s][n]||(g=!0),g&&0==this.catEnergyField[t].field[s][n]&&(this.catEnergyField[t].edgeIndexMap[s][n]=this.edges[u].start,this.catEnergyField[t].edgeIndexMap2[s][n].push({start:this.edges[u].start,end:this.edges[u].end}),d=1,this.catEnergyField[t].field[s][n]=1),0!=d)){for(var y in this.catEnergyField)if(y!=t&&y!=t&&h<=this.catEnergyField[y].boundingX+this.catEnergyField[y].boundingWidth*K&&h>=this.catEnergyField[y].boundingX&&o<=this.catEnergyField[y].boundingY+this.catEnergyField[y].boundingHeight*K&&o>=this.catEnergyField[y].boundingY){var f=Math.floor((h-this.catEnergyField[y].x)/K),x=Math.floor((o-this.catEnergyField[y].y)/K),v=this.catEnergyField[y].field[x][f],E=!1,m=this.catEnergyField[y].pointIndexMap[x][f],D=this.catEnergyField[y].edgeIndexMap[x][f],F=void 0;if(-1==m&&-1==D)continue;if(D>-1&&(F=this.pointData[D].multicat?this.pointData[D].catArray:[this.pointData[D].cat]),m>-1&&(F=this.pointData[m].multicat?this.pointData[m].catArray:[this.pointData[m].cat]),this.isContained(F,t))continue;if(this.isContained(p,y)&&3!=this.catEnergyField[y].pointBarrierMap[x][f])continue;if(3!=this.catEnergyField[y].barrierMap[x][f]&&4!=this.catEnergyField[y].barrierMap[x][f]||(E=!0),0==v)continue;if(g||E)if(g&&!E)l=d;else{if(!g&&E){l=0;break}g&&E&&(l=4==this.catEnergyField[t].barrierMap[s][n]?d:0)}else{if(v>d){l=0;break}l=d}}this.catEnergyField[t].finalField[s][n]=l,4==this.catEnergyField[t].barrierMap[s][n]&&(this.catEnergyField[t].finalField[s][n]=1e4)}}}},{key:"recalFinalEnergeField",value:function(t){var e={};for(var i in this.catEnergyField)e[i]={minX:Number.MAX_VALUE,minY:Number.MAX_VALUE,maxX:Number.MIN_VALUE,maxY:Number.MIN_VALUE};for(var a in this.catEnergyField)if(a!=t)for(var r=0;r<this.updatedEnergyPoints[t].length;r++){var s=this.updatedEnergyPoints[t][r][0]*K+this.catEnergyField[t].x,n=this.updatedEnergyPoints[t][r][1]*K+this.catEnergyField[t].y,h=parseInt((s-this.catEnergyField[a].x)/K),o=parseInt((n-this.catEnergyField[a].y)/K);e[a].minX=Math.min(e[a].minX,h),e[a].minY=Math.min(e[a].minY,o),e[a].maxX=Math.max(e[a].maxX,h),e[a].maxY=Math.max(e[a].maxY,o);var d=this.catEnergyField[a].field[o][h],l=d,g=!1,c=this.catEnergyField[a].pointIndexMap[o][h],u=this.catEnergyField[a].edgeIndexMap[o][h],p=void 0;if((-1!=u||-1!=c)&&(u>-1&&(p=this.pointData[u].multicat?this.pointData[u].catArray:[this.pointData[u].cat]),c>-1&&(p=this.pointData[c].multicat?this.pointData[c].catArray:[this.pointData[c].cat]),3!=this.catEnergyField[a].barrierMap[o][h]&&4!=this.catEnergyField[a].barrierMap[o][h]||(g=!0),g&&0==this.catEnergyField[a].field[o][h]&&(this.catEnergyField[a].edgeIndexMap[o][h]=this.edges[u].start,this.catEnergyField[a].edgeIndexMap2[o][h].push({start:this.edges[u].start,end:this.edges[u].end}),d=1,this.catEnergyField[a].field[o][h]=1),0!=d)){for(var y in this.catEnergyField)if(y!=a&&y!=t&&s<=this.catEnergyField[y].boundingX+this.catEnergyField[y].boundingWidth*K&&s>=this.catEnergyField[y].boundingX&&n<=this.catEnergyField[y].boundingY+this.catEnergyField[y].boundingHeight*K&&n>=this.catEnergyField[y].boundingY){var f=Math.floor((s-this.catEnergyField[y].x)/K),x=Math.floor((n-this.catEnergyField[y].y)/K),v=this.catEnergyField[y].field[x][f],E=!1,m=this.catEnergyField[y].pointIndexMap[x][f],D=this.catEnergyField[y].edgeIndexMap[x][f],F=void 0;if(-1==m&&-1==D)continue;if(D>-1&&(F=this.pointData[D].multicat?this.pointData[D].catArray:[this.pointData[D].cat]),m>-1&&(F=this.pointData[m].multicat?this.pointData[m].catArray:[this.pointData[m].cat]),this.isContained(F,a))continue;if(this.isContained(p,y)&&3!=this.catEnergyField[y].pointBarrierMap[x][f])continue;if(3!=this.catEnergyField[y].barrierMap[x][f]&&4!=this.catEnergyField[y].barrierMap[x][f]||(E=!0),0==v)continue;if(g||E)if(g&&!E)l=d;else{if(!g&&E){l=0;break}g&&E&&(l=4==this.catEnergyField[a].barrierMap[o][h]?d:0)}else{if(v>d){l=0;break}l=d}}this.catEnergyField[a].finalField[o][h]=l,4==this.catEnergyField[a].barrierMap[o][h]&&(this.catEnergyField[a].finalField[o][h]=1e4)}}this.smoothEnergyField(e)}},{key:"updateFinalField",value:function(t,e,i){for(var a=parseInt(t),r=Z[e].length,s=[],n=Number.MAX_VALUE,h=Number.MIN_VALUE,o=-1;o<=1;o++)s.push({x:Z[e][(a+o)%r][0],y:Z[e][(a+o)%r][1]}),n=Math.min(n,Z[e][(a+o)%r][1]),h=Math.max(h,Z[e][(a+o)%r][1]);for(var d=[],l=0;l<3;l++){var g=s[l],c=s[(l+1)%3],u={};u.y1=Math.min(g.y,c.y),u.y2=Math.max(g.y,c.y),g.y==c.y?(u.flag=!0,u.val1=Math.min(g.x,c.x),u.val2=Math.max(g.x,c.x)):(u.flag=!1,u.val1=(c.x-g.x)/(c.y-g.y),u.val2=(g.x*c.y-c.x*g.y)/(c.y-g.y)),d.push(u)}for(var p=n;p<h;p++){for(var y=Number.MAX_VALUE,f=Number.MIN_VALUE,x=!1,v=0;v<3;v++)if(p>=d[v].y1&&p<=d[v].y2){if(1==d[v].flag){y=d[v].val1,f=d[v].val2,x=!0;break}var E=d[v].val1*p+d[v].val2;y=Math.min(y,E),f=Math.max(f,E)}if(1!=x||0!=i){y=parseInt(y),f=parseInt(f);for(var m=y;m<=f;m++){var D=Math.min(parseInt((p-this.catEnergyField[e].y)/K),this.catEnergyField[e].height),F=Math.min(parseInt((m-this.catEnergyField[e].x)/K),this.catEnergyField[e].width);D=Math.max(D,0),F=Math.max(F,0),this.catEnergyField[e].field[parseInt(D)][parseInt(F)]=i,this.catEnergyField[e].finalField[parseInt(D)][parseInt(F)]=i,this.updatedEnergyPoints[e].push([parseInt(F),parseInt(D)])}}}}},{key:"drawEnergyField",value:function(t){V=this.props.colorArray;for(var e=this.catEnergyField[t].finalField,i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++)if(!(e[i][a]<1e-4)){var r=a*K+this.catEnergyField[t].x,s=i*K+this.catEnergyField[t].y,n=e[i][a];w.append("rect").attr("x",r-.5).attr("y",s-.5).attr("width",1).attr("height",1).attr("class","energyfieldrect").attr("fill",(function(){return V[parseInt(t)]})).attr("opacity",1).attr("fieldvalue",n).on("mouseover",(function(t){}))}}},{key:"drawBarrierMap",value:function(){for(var t in this.catEnergyField)for(var e=this.catEnergyField[t].barrierMap,i=0;i<this.catEnergyField[t].height;i++)for(var a=0;a<this.catEnergyField[t].width;a++){var r=i+this.catEnergyField[t].y,s=a+this.catEnergyField[t].x;3==e[i][a]&&b(s,r,1,1,"red"),4==e[i][a]&&b(s,r,1,1,"green"),1==e[i][a]&&b(s,r,1,1,"yellow"),2==e[i][a]&&b(s,r,1,1,"orange")}}},{key:"drawBSpline",value:function(t,e){p.g("svg");for(var i=function(i){w.append("path").style("fill",e).style("stroke","none").style("opacity",.5).attr("d",(function(){var e="";return e+=p.e().x((function(t){return t[0]})).y((function(t){return t[1]}))(t[i])+""})).on("mouseover",(function(){p.g(this).style("stroke","red").style("stroke-width",3)})).on("mouseout",(function(){p.g(this).style("stroke",e).style("stroke-width",.5)}))},a=0;a<t.length;a++)i(a)}},{key:"drawBSplineV2",value:function(t,e){p.g("svg");w.append("path").style("fill",e).style("stroke","none").style("opacity",.5).attr("d",(function(){var e="";return e+=p.e().x((function(t){return t[0]})).y((function(t){return t[1]}))(t)+""})).on("mouseover",(function(){p.g(this).style("stroke","red").style("stroke-width",3)})).on("mouseout",(function(){p.g(this).style("stroke",e).style("stroke-width",.5)}))}},{key:"fillPolygonForEdge",value:function(t,e,i,a){for(var r=t.length,s=Number.MIN_VALUE,n=Number.MAX_VALUE,h=Number.MIN_VALUE,o=Number.MAX_VALUE,d={},l=0;l<r;l++){var g=t[l][0],c=t[l][1],u=t[(l+1)%r][0],p=t[(l+1)%r][1];if(s=Math.max(s,c),n=Math.min(n,c),h=Math.max(h,g),o=Math.min(o,g),parseInt(c)!=parseInt(p)){var y=void 0;y=c>p?u:g;var f=parseInt(Math.min(c,p));d.hasOwnProperty(f)||(d[f]=[]),d[f].push({x:y,dx:(u-g)/(p-c),ymax:Math.max(c,p)})}}for(var x=[],v=n;v<s;v++){var E=parseInt(v);if(d.hasOwnProperty(E))for(var m=0;m<d[E].length;m++)x.push(d[E][m]);x.sort((function(t,e){return Math.abs(t.x-e.x)>et?t.x<e.x:Math.abs(t.dx-e.dx)>et?t.dx<e.dx:t.ymax<e.ymax}));var D=x.length;if(0==D);else if(D<=1){var F=Math.ceil((x[0].x-this.catEnergyField[e].x)/K),b=Math.ceil((v-this.catEnergyField[e].y)/K);F=Math.min(F,this.catEnergyField[e].width-2),F=Math.max(F,0),b=Math.min(b,this.catEnergyField[e].height-2),b=Math.max(b,0),F=parseInt(F),b=parseInt(b);var k=F*K+this.catEnergyField[e].x,M=b*K+this.catEnergyField[e].y,w=Math.floor((k-this.catEnergyField[a].x)/K),I=Math.floor((M-this.catEnergyField[a].y)/K);w>0&&w<this.catEnergyField[a].width&&I>0&&I<this.catEnergyField[a].height&&0==this.catEnergyField[e].finalField[b][F]&&this.catEnergyField[e].edgeBarrierMap[b][F]>0&&(i[e][b][F]=this.catEnergyField[e].field[b][F])}else for(var P=[],A=0;A<D;A++){var C={};if(C.x=x[A].x,C.y=x[A].ymax,parseInt(C.y)!=parseInt(v))if(0==P.length)P.push(C);else if(1==P.length){var N=P[0];if(Math.abs(C.x-N.x)<et?C.y>v&&N.y>v&&P.push(C):P.push(C),2==P.length){var B=P.shift().x,S=P.shift().x,_=Math.min(B,S),O=Math.max(B,S);for(_=Math.max(_,o),O=Math.min(O,h);_<O;){var j=Math.ceil((_-this.catEnergyField[e].x)/K),V=Math.ceil((v-this.catEnergyField[e].y)/K);j=Math.min(j,this.catEnergyField[e].width-2),j=Math.max(j,0),V=Math.min(V,this.catEnergyField[e].height-2),V=Math.max(V,0),j=parseInt(j),V=parseInt(V);var L=j*K+this.catEnergyField[e].x,X=V*K+this.catEnergyField[e].y,G=Math.floor((L-this.catEnergyField[a].x)/K),Y=Math.floor((X-this.catEnergyField[a].y)/K);G>0&&G<this.catEnergyField[a].width&&Y>0&&Y<this.catEnergyField[a].height&&0==this.catEnergyField[e].finalField[V][j]&&this.catEnergyField[e].edgeBarrierMap[V][j]>0&&(i[e][V][j]=this.catEnergyField[e].field[V][j]),_++}}}}for(var U=D-1;U>=0;U--)x[U].x+=x[U].dx,x[U].ymax<=v&&x.splice(U,1)}}},{key:"fillPolygon",value:function(t,e,i){for(var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=t.length,s=Number.MIN_VALUE,n=Number.MAX_VALUE,h=Number.MIN_VALUE,o=Number.MAX_VALUE,d={},l=0;l<r;l++){var g=t[l][0],c=t[l][1],u=t[(l+1)%r][0],p=t[(l+1)%r][1];if(s=Math.max(s,c),n=Math.min(n,c),h=Math.max(h,g),o=Math.min(o,g),parseInt(c)!=parseInt(p)){var y=void 0;y=c>p?u:g;var f=parseInt(Math.min(c,p));d.hasOwnProperty(f)||(d[f]=[]),d[f].push({x:y,dx:(u-g)/(p-c),ymax:Math.max(c,p)})}}for(var x=[],v=n;v<s;v++){var E=parseInt(v);if(d.hasOwnProperty(E))for(var m=0;m<d[E].length;m++)x.push(d[E][m]);x.sort((function(t,e){return Math.abs(t.x-e.x)>et?t.x<e.x:Math.abs(t.dx-e.dx)>et?t.dx<e.dx:t.ymax<e.ymax}));var D=x.length;if(0==D);else if(D<=1){var F=Math.ceil((x[0].x-this.catEnergyField[e].x)/K),b=Math.ceil((v-this.catEnergyField[e].y)/K);F=Math.min(F,this.catEnergyField[e].width-2),F=Math.max(F,0),b=Math.min(b,this.catEnergyField[e].height-2),b=Math.max(b,0),F=parseInt(F),b=parseInt(b),this.catEnergyField[e].finalField[b][F]=i,a||(this.catEnergyField[e].field[b][F]=i),this.updatedEnergyPoints[e].push([F,b])}else for(var k=[],M=0;M<D;M++){var w={};if(w.x=x[M].x,w.y=x[M].ymax,parseInt(w.y)!=parseInt(v))if(0==k.length)k.push(w);else if(1==k.length){var I=k[0];if(Math.abs(w.x-I.x)<et?w.y>v&&I.y>v&&k.push(w):k.push(w),2==k.length){var P=k.shift().x,A=k.shift().x,C=Math.min(P,A),N=Math.max(P,A);for(C=Math.max(C,o),N=Math.min(N,h);C<N;){var B=Math.ceil((C-this.catEnergyField[e].x)/K),S=Math.ceil((v-this.catEnergyField[e].y)/K);B=Math.min(B,this.catEnergyField[e].width-2),B=Math.max(B,0),S=Math.min(S,this.catEnergyField[e].height-2),S=Math.max(S,0),B=parseInt(B),S=parseInt(S),this.catEnergyField[e].finalField[S][B]=i,a||(this.catEnergyField[e].field[S][B]=i),this.updatedEnergyPoints[e].push([B,S]),C++}}}}for(var _=D-1;_>=0;_--)x[_].x+=x[_].dx,x[_].ymax<=v&&x.splice(_,1)}}},{key:"drawISOLinesV2",value:function(t,e,i){for(var a=0;a<4;a++)p.g("#bounding"+t.toString()+a.toString()).remove();for(var r=0;r<Z[t].length;r++)for(var s=0;s<Z[t][r].length;s++)p.g("#circle"+t.toString()+"i"+r.toString()+"i"+s.toString()).remove();for(var n in Z)n!=t&&p.g("#path"+n).attr("fill-opacity",.5);var h;tt[t]=!1,e.editMode=!1,V=this.props.colorArray,dt[t]=[];var o=[],d=e.catEnergyField[t].boundingX,l=e.catEnergyField[t].boundingY,g=e.catEnergyField[t].boundingX+e.catEnergyField[t].boundingWidth*K-5*K,c=e.catEnergyField[t].boundingY+e.catEnergyField[t].boundingHeight*K-5*K;function u(){var e=!1;if(p.g(this)._groups[0][0].attributes.hasOwnProperty("id")&&(e=!0),0!=e){var i=p.g(this)._groups[0][0].attributes.id.value,a=parseInt(i[6]);if(a>=0&&a<=9){for(var r="",s="",n=7;n<i.length;n++)if("i"==i[n]){for(n++;"i"!=i[n];)r+=i[n++];for(n++;n<i.length;)s+=i[n++];break}r=parseInt(r),s=parseInt(s),h=Z[t][r].length,rt=[];for(var o=0;o<Z[t].length;o++){rt[o]=[];for(var d=0;d<Z[t][o].length;d++)rt[o].push([Z[t][o][d][0],Z[t][o][d][1]])}[].push(s),0;var l=[];l[0]=Z[t][r][s][0],l[1]=Z[t][r][s][1];var g=[];g[0]=Z[t][r][(s+1)%h][0],g[1]=Z[t][r][(s+1)%h][1],(it=[]).push(l),it.push(g)}}}function y(i){var a=!1;if(i.sourceEvent.target.attributes.hasOwnProperty("id")&&(a=!0),0!=a){var r=i.sourceEvent.target.attributes.id.value.toString(),s=parseInt(r[6]),n=i.x,o=i.y;if(n=Math.min(n,g),n=Math.max(n,d),o=Math.min(o,c),o=Math.max(o,l),p.g(this).attr("cx",n).attr("cy",o),s>=0&&s<=9){for(var u="",y="",f=7;f<r.length;f++)if("i"==r[f]){for(f++;"i"!=r[f];)u+=r[f++];for(f++;f<r.length;)y+=r[f++];break}if(u=parseInt(u),y=parseInt(y),!Z[t].hasOwnProperty(u))return;h=Z[t][u].length,Z[t][u][y][0]=n,Z[t][u][y][1]=o;for(var x="",v=0;v<Z[t].length;v++)if(v==u){var E=Z[t][v].length,m=[],F=(y-1+E)%E;dt[t].push(F),dt[t].sort((function(t,e){return t-e}));for(var b={},k=0;k<dt[t].length;k++)b[dt[t][k]]=1;var M=void 0;M=dt[t].length>0?dt[t][0]:0;for(var w=0;w<E;w++){var I=(M+w)%E;if(b.hasOwnProperty(I)){var P=[];P.push([Z[t][v][(I-1+E)%E][0],Z[t][v][(I-1+E)%E][1]]),P.push([Z[t][v][I][0],Z[t][v][I][1]]),P.push([Z[t][v][(I+1)%E][0],Z[t][v][(I+1)%E][1]]),P.push([Z[t][v][(I+2)%E][0],Z[t][v][(I+2)%E][1]]),P.push([Z[t][v][(I+3)%E][0],Z[t][v][(I+2)%E][1]]);var A=[Z[t][v][I][0],Z[t][v][I][1]],C=[Z[t][v][(I+2)%E][0],Z[t][v][(I+2)%E][1]];p.g("svg").append("path").attr("id","temp_path").attr("d",gt(P)).attr("fill","none");for(var N=p.g("#temp_path").node(),B=N.getTotalLength(),S=0,_=Number.MAX_VALUE,O=B/5,j=Number.MAX_VALUE,V=0;V<=B/5;V++){var L=N.getPointAtLength(5*V),X=D(A[0],A[1],L.x,L.y),G=D(C[0],C[1],L.x,L.y);X<_&&(S=V,_=X),G<j&&(O=V,j=G)}for(var Y=S;Y<=O;Y++){var U=N.getPointAtLength(5*Y);m.push([U.x,U.y])}p.g("#temp_path").remove(),w++}else m.push([Z[t][v][I][0],Z[t][v][I][1]])}x+=lt(m)}else x+=lt(Z[t][v]);e.reDraw(t,e,x)}}}function f(){var i=!1;if(p.g(this)._groups[0][0].attributes.hasOwnProperty("id")&&(i=!0),0!=i){var a=p.g(this)._groups[0][0].attributes.id.value,r=parseInt(a[6]);if(r>=0&&r<=9){for(var s="",n="",h=7;h<a.length;h++)if("i"==a[h]){for(h++;"i"!=a[h];)s+=a[h++];for(h++;h<a.length;)n+=a[h++];break}s=parseInt(s),n=parseInt(n);var o=[],d=Z[t][s].length;o.push([Z[t][s][(n+d-1)%d][0],Z[t][s][(n+d-1)%d][1]]),o.push([rt[s][n][0],rt[s][n][1]]),o.push([Z[t][s][(n+1)%d][0],Z[t][s][(n+1)%d][1]]),o.push([Z[t][s][n][0],Z[t][s][n][1]]);var l=Z[t][s][n];it.push(l);var g=[it[1][0]-it[0][0],it[1][1]-it[0][1]],c=[it[2][0]-it[0][0],it[2][1]-it[0][1]],u=0;g[0]*c[1]-c[0]*g[1]<=0?0==s&&(u=10):s>0&&(u=10),e.fillPolygon(o,t,u)}}}o.push({x:d,y:l}),o.push({x:g,y:l}),o.push({x:g,y:c}),o.push({x:d,y:c}),w.append("path").attr("id","path"+t).attr("d",i).attr("fill",V[t]).attr("fill-opacity",.5).attr("fill-rule","evenodd").style("stroke",V[t]).style("stroke-width",1).on("mouseover",(function(){e.editMode||p.g(this).style("stroke","red").style("stroke-width",3)})).on("mouseout",(function(){e.editMode||p.g(this).style("stroke",V[t]).style("stroke-width",1)})).on("mousedown",(function(i){if(2==i.button)if(0!=tt[t]||e.editMode){if(e.editMode&&tt[t]){for(var a=0;a<4;a++)p.g("#bounding"+t.toString()+a.toString()).remove();for(var r=0;r<Z[t].length;r++)for(var s=0;s<Z[t][r].length;s++)p.g("#circle"+t.toString()+"i"+r.toString()+"i"+s.toString()).remove();for(var n in Z)n!=t&&p.g("#path"+n).attr("fill-opacity",.5);tt[t]=!1,e.editMode=!1}}else{e.editMode=!0;for(var h=0;h<4;h++)w.append("line").attr("id","bounding"+t.toString()+h.toString()).attr("x1",o[h].x).attr("y1",o[h].y).attr("x2",o[(h+1)%4].x).attr("y2",o[(h+1)%4].y).attr("stroke","red").attr("stroke-width","1px");for(var d in Z)d!=t&&p.g("#path"+d).attr("fill-opacity",.2);for(var l=0;l<Z[t].length;l++)for(var g=0;g<Z[t][l].length;g++)w.append("circle").attr("id","circle"+t.toString()+"i"+l.toString()+"i"+g.toString()).attr("cx",Z[t][l][g][0]).attr("cy",Z[t][l][g][1]).attr("r",3).attr("fill","red").attr("fill-opacity",.5).on("mouseover",(function(){p.g(this).attr("stroke","red").attr("stroke-width",2)})).on("mouseout",(function(){p.g(this).attr("stroke","none").attr("stroke-width",1)})).call(p.d().on("start",u).on("drag",y).on("end",f));tt[t]=!0}}))}},{key:"reDraw",value:function(t,e,i){V=this.props.colorArray;var a=Z[t].length,r=[],s=e.catEnergyField[t].boundingX,n=e.catEnergyField[t].boundingY,h=e.catEnergyField[t].boundingX+e.catEnergyField[t].boundingWidth*K-5*K,o=e.catEnergyField[t].boundingY+e.catEnergyField[t].boundingHeight*K-5*K;function d(){var e=!1;if(p.g(this)._groups[0][0].attributes.hasOwnProperty("id")&&(e=!0),0!=e){var i=p.g(this)._groups[0][0].attributes.id.value,r=parseInt(i[6]);if(r>=0&&r<=9){for(var s="",n="",h=7;h<i.length;h++)if("i"==i[h]){for(h++;"i"!=i[h];)s+=i[h++];for(h++;h<i.length;)n+=i[h++];break}s=parseInt(s),n=parseInt(n),a=Z[t][s].length,rt=[];for(var o=0;o<Z[t].length;o++){rt[o]=[];for(var d=0;d<Z[t][o].length;d++)rt[o].push([Z[t][o][d][0],Z[t][o][d][1]])}[].push(n),0;var l=[];l[0]=Z[t][s][n][0],l[1]=Z[t][s][n][1];var g=[];g[0]=Z[t][s][(n+1)%a][0],g[1]=Z[t][s][(n+1)%a][1],(it=[]).push(l),it.push(g)}}}function l(i){var r=!1;if(i.sourceEvent.target.attributes.hasOwnProperty("id")&&(r=!0),0!=r){var d=i.sourceEvent.target.attributes.id.value.toString(),l=parseInt(d[6]),g=i.x,c=i.y;if(g=Math.min(g,h),g=Math.max(g,s),c=Math.min(c,o),c=Math.max(c,n),p.g(this).attr("cx",g).attr("cy",c),l>=0&&l<=9){for(var u="",y="",f=7;f<d.length;f++)if("i"==d[f]){for(f++;"i"!=d[f];)u+=d[f++];for(f++;f<d.length;)y+=d[f++];break}if(u=parseInt(u),y=parseInt(y),!Z[t].hasOwnProperty(u))return;a=Z[t][u].length,Z[t][u][y][0]=g,Z[t][u][y][1]=c;for(var x="",v=0;v<Z[t].length;v++)if(v==u){var E=Z[t][v].length,m=[],D=(y-1+E)%E;dt[t].push(D),dt[t].sort((function(t,e){return t-e}));for(var F={},b=0;b<dt[t].length;b++)F[dt[t][b]]=1;var k=void 0;k=dt[t].length>0?dt[t][0]:0;for(var M=0;M<E;M++){var w=(k+M)%E;if(F.hasOwnProperty(w)){var I=[];I.push([Z[t][v][w][0],Z[t][v][w][1]]),I.push([Z[t][v][(w+1)%E][0],Z[t][v][(w+1)%E][1]]),I.push([Z[t][v][(w+2)%E][0],Z[t][v][(w+2)%E][1]]),p.g("svg").append("path").attr("id","temp_path").attr("d",gt(I)).attr("fill","none");for(var P=p.g("#temp_path").node(),A=P.getTotalLength(),C=0;C<=A/5;C++){var N=P.getPointAtLength(5*C);m.push([N.x,N.y])}p.g("#temp_path").remove(),M++}else m.push([Z[t][v][w][0],Z[t][v][w][1]])}x+=lt(m)}else x+=lt(Z[t][v]);e.reDraw(t,e,x)}}}function g(){var i=!1;if(p.g(this)._groups[0][0].attributes.hasOwnProperty("id")&&(i=!0),0!=i){var a=p.g(this)._groups[0][0].attributes.id.value,r=parseInt(a[6]);if(r>=0&&r<=9){for(var s="",n="",h=7;h<a.length;h++)if("i"==a[h]){for(h++;"i"!=a[h];)s+=a[h++];for(h++;h<a.length;)n+=a[h++];break}s=parseInt(s),n=parseInt(n);var o=[],d=Z[t][s].length;o.push([Z[t][s][(n+d-1)%d][0],Z[t][s][(n+d-1)%d][1]]),o.push([rt[s][n][0],rt[s][n][1]]),o.push([Z[t][s][(n+1)%d][0],Z[t][s][(n+1)%d][1]]),o.push([Z[t][s][n][0],Z[t][s][n][1]]);var l=Z[t][s][n];it.push(l);var g=[it[1][0]-it[0][0],it[1][1]-it[0][1]],c=[it[2][0]-it[0][0],it[2][1]-it[0][1]],u=0;g[0]*c[1]-c[0]*g[1]<=0?0==s&&(u=10):s>0&&(u=10),e.fillPolygon(o,t,u)}}}r.push({x:s,y:n}),r.push({x:h,y:n}),r.push({x:h,y:o}),r.push({x:s,y:o}),p.g("#path"+t).attr("id","path"+t).attr("d",i).attr("fill",V[t]).attr("fill-opacity",.5).attr("fill-rule","evenodd").style("stroke",V[t]).style("stroke-width",1).on("mouseover",(function(){e.editMode||p.g(this).style("stroke","red").style("stroke-width",3)})).on("mouseout",(function(){e.editMode||p.g(this).style("stroke",V[t]).style("stroke-width",1)})).on("mousedown",(function(i){if(2==i.button)if(0!=tt[t]||e.editMode){if(e.editMode&&tt[t]){for(var a=0;a<4;a++)p.g("#bounding"+t.toString()+a.toString()).remove();for(var s=0;s<Z[t].length;s++)for(var n=0;n<Z[t][s].length;n++)p.g("#circle"+t.toString()+"i"+s.toString()+"i"+n.toString()).remove();for(var h in Z)h!=t&&p.g("#path"+h).attr("fill-opacity",.5);tt[t]=!1,e.editMode=!1}}else{e.editMode=!0;for(var o=0;o<4;o++)w.append("line").attr("id","bounding"+t.toString()+o.toString()).attr("x1",r[o].x).attr("y1",r[o].y).attr("x2",r[(o+1)%4].x).attr("y2",r[(o+1)%4].y).attr("stroke","red").attr("stroke-width","1px");for(var c in Z)c!=t&&p.g("#path"+c).attr("fill-opacity",.2);for(var u=0;u<Z[t].length;u++)for(var y=0;y<Z[t][u].length;y++)w.append("circle").attr("id","circle"+t.toString()+"i"+u.toString()+"i"+y.toString()).attr("cx",Z[t][u][y][0]).attr("cy",Z[t][u][y][1]).attr("r",3).attr("fill","red").attr("fill-opacity",.5).on("mouseover",(function(){p.g(this).attr("stroke","red").attr("stroke-width",2)})).on("mouseout",(function(){p.g(this).attr("stroke","none").attr("stroke-width",1)})).call(p.d().on("start",d).on("drag",l).on("end",g));tt[t]=!0}}))}},{key:"drawOutline",value:function(t,e){new Array;var i=p.e().x((function(t){return t[0]})).y((function(t){return t[1]})).curve(p.c)(t);w.append("path").attr("d",i).attr("fill-opacity",.5).attr("fill",e).attr("fill-rule","evenodd")}},{key:"drawISOLines",value:function(t,e,i,a,r){p.g("svg");for(var s=function(e){w.append("path").style("fill","none").style("stroke",r).style("stroke-width",.5).style("opacity",1).attr("d",(function(){var r="";return r+=p.e().x((function(t){return t[0]+i})).y((function(t){return t[1]+a}))(t[e])+""})).on("mouseover",(function(){p.g(this).style("stroke","red").style("stroke-width",3)})).on("mouseout",(function(){p.g(this).style("stroke","black").style("stroke-width",.5)}))},n=0;n<t.length;n++)s(n)}},{key:"calOneISOLine",value:function(t,e){var i=this.catEnergyField[e].finalField;return B.isoLines(i,t,{polygons:!1,linearRing:!1,noFrame:!0})[0]}},{key:"calISOLine",value:function(t,e){var i={};for(var a in this.catEnergyField){var r,s=e[a];r=B.isoLines(s,t,{polygons:!1,linearRing:!1,noFrame:!0}),i[a]=r[0]}return i}},{key:"BSplineInterpolate",value:function(t){for(var e=[],i=[],a=0;a<t.length;a++){if(t.length-a>5){if(a%5==0&&e.push(t[a]),a>0&&a%15==0){for(var r=new N(e,3),s=.01;s<=1;s+=.01){var n=r.calcAt(s);i.push(n)}(e=[]).push(t[a])}}else a%3==0&&e.push(t[a])}for(r=new N(e,3),s=.01;s<=1;s+=.01){n=r.calcAt(s);i.push(n)}return i}},{key:"normalizeKernel",value:function(t){for(var e=0,i=0;i<t.length;i++)for(var a=0;a<t.length;a++)e+=t[i][a];for(var r=0;r<t.length;r++)for(var s=0;s<t.length;s++)t[r][s]=t[r][s]/e;return t}},{key:"getGaussianKernel",value:function(t,e){for(var i=[],a=0;a<e;a++){i.push([]);for(var r=0;r<e;r++)i[a].push(0)}for(var s=parseInt(e/2)/1,n=1/(2*Math.PI*t*t),h=0;h<e;h++)for(var o=0;o<e;o++){var d=h/1,l=o/1,g=Math.pow(d-s,2),c=Math.pow(l-s,2);i[h][o]=n*Math.exp(-(c*c+g*g)/(2*t*t))}return i=this.normalizeKernel(i)}},{key:"checkSingularPoint",value:function(t,e,i){var a=this.catEnergyField[t].finalField,r=!0;return e+1<this.catEnergyField[t].width&&a[i][e+1]>0&&(r=!1),e-1>0&&a[i][e-1]>0&&(r=!1),i-1>0&&a[i-1][e]>0&&(r=!1),i+1<this.catEnergyField[t].height&&a[i+1][e]>0&&(r=!1),e+1<this.catEnergyField[t].width&&i-1>0&&a[i-1][e+1]>0&&(r=!1),e+1<this.catEnergyField[t].width&&i+1<this.catEnergyField[t].height&&a[i+1][e+1]>0&&(r=!1),e-1>0&&i-1>0&&a[i-1][e-1]>0&&(r=!1),e-1>0&&i+1<this.catEnergyField[t].height&&a[i+1][e-1]>0&&(r=!1),r}},{key:"fillCrossingEdge_Part",value:function(t){for(var e in this.catEnergyField)this.catEnergyField[e].edgeCrossingList=[];for(var i=0;i<t.length;i++){var a=t[i].cat,r=this.pointData[t[i].start],s=this.pointData[t[i].end],n=[];if(this.edges[i].virtrual&&t[i].virtrualNodes.length>0){n.push([{x:r.x,y:r.y},{x:t[i].virtrualNodes[0][0],y:t[i].virtrualNodes[0][1]}]);for(var h=0;h<t[i].virtrualNodes.length;h++)h+1<t[i].virtrualNodes.length&&n.push([{x:t[i].virtrualNodes[h][0],y:t[i].virtrualNodes[h][1]},{x:t[i].virtrualNodes[h+1][0],y:t[i].virtrualNodes[h+1][1]}]);var o=t[i].virtrualNodes.length;n.push([{x:t[i].virtrualNodes[o-1][0],y:t[i].virtrualNodes[o-1][1]},{x:s.x,y:s.y}])}else n.push([{x:r.x,y:r.y},{x:s.x,y:s.y}]);for(var d=0;d<this.edges.length;d++){var l=this.edges[d].cat;if(a!=l){var g=this.pointData[this.edges[d].start],c=this.pointData[this.edges[d].end],u=[];if(this.edges[d].virtrual&&this.edges[d].virtrualNodes.length>0){u.push([{x:g.x,y:g.y},{x:this.edges[d].virtrualNodes[0][0],y:this.edges[d].virtrualNodes[0][1]}]);for(var p=0;p<this.edges[d].virtrualNodes.length;p++)p+1<this.edges[d].virtrualNodes.length&&u.push([{x:this.edges[d].virtrualNodes[p][0],y:this.edges[d].virtrualNodes[p][1]},{x:this.edges[d].virtrualNodes[p+1][0],y:this.edges[d].virtrualNodes[p+1][1]}]);var y=this.edges[d].virtrualNodes.length;u.push([{x:this.edges[d].virtrualNodes[y-1][0],y:this.edges[d].virtrualNodes[y-1][1]},{x:c.x,y:c.y}])}else u.push([{x:g.x,y:g.y},{x:c.x,y:c.y}]);for(var f=0;f<n.length;f++)for(var x=n[f][0],v=n[f][1],E=0;E<u.length;E++){var m=u[E][0],b=u[E][1],k=this.checkEdgeCrossing(x,v,m,b);k[0]&&(this.catEnergyField[a].edgeCrossingList.push([k[1],i,d,n[f],u[E]]),this.catEnergyField[l].edgeCrossingList.push([k[1],d,i,u[E],n[f]]))}}}}var M={};for(var e in this.catEnergyField){M[e]=this.catEnergyField[e].finalField;for(var w=this.catEnergyField[e].edgeCrossingList,I=[],P=0;P<w.length;P++){I.push([]);for(var A=w[P][0],C=(w[P][1],w[P][2]),N=w[P][3],B=w[P][4],S=this.edges[C].cat,_=0,O=D(N[0].x,N[0].y,N[1].x,N[1].y),j=[N[1].x-N[0].x,N[1].y-N[0].y],V=[B[1].x-B[0].x,B[1].y-B[0].y],L=F(j),X=F(V),G=.5,U=[],R=[],T=[],W=[],q=!1,z=!1,H=!1;_<Y&&!q;){for(var Q=[A.x+_*X[0],A.y+_*X[1]],J=0,Z=!1,$=!1;J<O/2;){if(!Z&&!q&&!z){var tt=[Q[0]+L[0]*J,Q[1]+L[1]*J],et=Math.floor((tt[0]-this.catEnergyField[e].x)/K),it=Math.floor((tt[1]-this.catEnergyField[e].y)/K),at=Math.floor((tt[0]-this.catEnergyField[S].x)/K),rt=Math.floor((tt[1]-this.catEnergyField[S].y)/K);if(at>0&&at<this.catEnergyField[S].width&&rt>0&&rt<this.catEnergyField[S].height&&3==this.catEnergyField[S].pointBarrierMap[rt][at]){q=!0;break}et>0&&et<this.catEnergyField[e].width&&it>0&&it<this.catEnergyField[e].height&&this.catEnergyField[e].finalField[it][et]>0&&(Z=!0,4!=this.catEnergyField[e].edgeBarrierMap[it][et]?0==T.length?(U.push([et,it]),T=[et,it]):Math.abs(T[0]-et)<=5&&Math.abs(T[1]-it)<=5?(T=[et,it],U.push([et,it])):z=!0:U.push([et,it]))}if(!$&&!q&&!H){var st=[Q[0]-L[0]*J,Q[1]-L[1]*J],nt=Math.floor((st[0]-this.catEnergyField[e].x)/K),ht=Math.floor((st[1]-this.catEnergyField[e].y)/K),ot=Math.floor((st[0]-this.catEnergyField[S].x)/K),dt=Math.floor((st[1]-this.catEnergyField[S].y)/K);if(ot>0&&ot<this.catEnergyField[S].width&&dt>0&&dt<this.catEnergyField[S].height&&3==this.catEnergyField[S].pointBarrierMap[dt][ot]){q=!0;break}nt>0&&nt<this.catEnergyField[e].width&&ht>0&&ht<this.catEnergyField[e].height&&this.catEnergyField[e].finalField[ht][nt]>0&&($=!0,4!=this.catEnergyField[e].edgeBarrierMap[ht][nt]?0==W.length?(R.push([nt,ht]),W=[nt,ht]):Math.abs(W[0]-nt)<=5&&Math.abs(W[1]-ht)<=5?(W=[nt,ht],R.push([nt,ht])):H=!0:R.push([nt,ht]))}if(Z&&$||z&&H)break;J+=G}_+=G}for(var lt=[[Math.floor((A.x-this.catEnergyField[e].x)/K),Math.floor((A.y-this.catEnergyField[e].y)/K)]],gt=0;gt<U.length;gt++)lt.push(U[gt]);for(var ct=R.length-1;ct>=0;ct--)lt.push(R[ct]);I[P].push(lt),U=[],R=[],T=[],W=[];var ut=!1;for(z=!1,H=!1,_=0;_<Y&&!ut;){for(var pt=[A.x-_*X[0],A.y-_*X[1]],yt=0,ft=!1,xt=!1;yt<O/2;){if(!ft&&!ut&&!z){var vt=[pt[0]+L[0]*yt,pt[1]+L[1]*yt],Et=Math.floor((vt[0]-this.catEnergyField[e].x)/K),mt=Math.floor((vt[1]-this.catEnergyField[e].y)/K),Dt=Math.floor((vt[0]-this.catEnergyField[S].x)/K),Ft=Math.floor((vt[1]-this.catEnergyField[S].y)/K);if(Dt>0&&Dt<this.catEnergyField[S].width&&Ft>0&&Ft<this.catEnergyField[S].height&&3==this.catEnergyField[S].pointBarrierMap[Ft][Dt]){ut=!0;break}Et>0&&Et<this.catEnergyField[e].width&&mt>0&&mt<this.catEnergyField[e].height&&this.catEnergyField[e].finalField[mt][Et]>0&&(ft=!0,4!=this.catEnergyField[e].edgeBarrierMap[mt][Et]?0==T.length?(U.push([Et,mt]),T=[Et,mt]):Math.abs(T[0]-Et)<=5&&Math.abs(T[1]-mt)<=5?(T=[Et,mt],U.push([Et,mt])):z=!0:U.push([Et,mt]))}if(!xt&&!ut&&!H){var bt=[pt[0]-L[0]*yt,pt[1]-L[1]*yt],kt=Math.floor((bt[0]-this.catEnergyField[e].x)/K),Mt=Math.floor((bt[1]-this.catEnergyField[e].y)/K),wt=Math.floor((bt[0]-this.catEnergyField[S].x)/K),It=Math.floor((bt[1]-this.catEnergyField[S].y)/K);if(wt>0&&wt<this.catEnergyField[S].width&&It>0&&It<this.catEnergyField[S].height&&3==this.catEnergyField[S].pointBarrierMap[It][wt]){ut=!0;break}kt>0&&kt<this.catEnergyField[e].width&&Mt>0&&Mt<this.catEnergyField[e].height&&this.catEnergyField[e].finalField[Mt][kt]>0&&(xt=!0,4!=this.catEnergyField[e].edgeBarrierMap[Mt][kt]?0==W.length?(R.push([kt,Mt]),W=[kt,Mt]):Math.abs(W[0]-kt)<=5&&Math.abs(W[1]-Mt)<=5?(W=[kt,Mt],R.push([kt,Mt])):H=!0:R.push([kt,Mt]))}if(ft&&xt||z&&H)break;yt+=G}_+=G}lt=[[Math.floor((A.x-this.catEnergyField[e].x)/K),Math.floor((A.y-this.catEnergyField[e].y)/K)]];for(var Pt=0;Pt<U.length;Pt++)lt.push(U[Pt]);for(var At=R.length-1;At>=0;At--)lt.push(R[At]);I[P].push(lt)}for(var Ct=0;Ct<I.length;Ct++)for(var Nt=w[Ct][2],Bt=this.edges[Nt].cat,St=this.catEnergyField[e].x,_t=this.catEnergyField[e].y,Ot=0;Ot<I[Ct].length;Ot++){for(var jt=0;jt<I[Ct][Ot].length;jt++)I[Ct][Ot][jt][0]=I[Ct][Ot][jt][0]*K+St,I[Ct][Ot][jt][1]=I[Ct][Ot][jt][1]*K+_t;this.fillPolygonForEdge(I[Ct][Ot],e,M,Bt)}}for(var e in this.catEnergyField)this.catEnergyField[e].finalField=M[e]}},{key:"fillCrossingEdge",value:function(){for(var t in this.catEnergyField)this.catEnergyField[t].edgeCrossingList=[];for(var e=0;e<this.edges.length;e++){var i=this.edges[e].cat,a=this.pointData[this.edges[e].start],r=this.pointData[this.edges[e].end],s=[];if(this.edges[e].virtrual){s.push([{x:a.x,y:a.y},{x:this.edges[e].virtrualNodes[0][0],y:this.edges[e].virtrualNodes[0][1]}]);for(var n=0;n<this.edges[e].virtrualNodes.length;n++)n+1<this.edges[e].virtrualNodes.length&&s.push([{x:this.edges[e].virtrualNodes[n][0],y:this.edges[e].virtrualNodes[n][1]},{x:this.edges[e].virtrualNodes[n+1][0],y:this.edges[e].virtrualNodes[n+1][1]}]);var h=this.edges[e].virtrualNodes.length;s.push([{x:this.edges[e].virtrualNodes[h-1][0],y:this.edges[e].virtrualNodes[h-1][1]},{x:r.x,y:r.y}])}else s.push([{x:a.x,y:a.y},{x:r.x,y:r.y}]);for(var o=e+1;o<this.edges.length;o++){var d=this.edges[o].cat;if(i!=d){var l=this.pointData[this.edges[o].start],g=this.pointData[this.edges[o].end],c=[];if(this.edges[o].virtrual){c.push([{x:l.x,y:l.y},{x:this.edges[o].virtrualNodes[0][0],y:this.edges[o].virtrualNodes[0][1]}]);for(var u=0;u<this.edges[o].virtrualNodes.length;u++)u+1<this.edges[o].virtrualNodes.length&&c.push([{x:this.edges[o].virtrualNodes[u][0],y:this.edges[o].virtrualNodes[u][1]},{x:this.edges[o].virtrualNodes[u+1][0],y:this.edges[o].virtrualNodes[u+1][1]}]);var p=this.edges[o].virtrualNodes.length;c.push([{x:this.edges[o].virtrualNodes[p-1][0],y:this.edges[o].virtrualNodes[p-1][1]},{x:g.x,y:g.y}])}else c.push([{x:l.x,y:l.y},{x:g.x,y:g.y}]);for(var y=0;y<s.length;y++)for(var f=s[y][0],x=s[y][1],v=0;v<c.length;v++){var E=c[v][0],m=c[v][1],b=this.checkEdgeCrossing(f,x,E,m);b[0]&&(this.catEnergyField[i].edgeCrossingList.push([b[1],e,o,s[y],c[v]]),this.catEnergyField[d].edgeCrossingList.push([b[1],o,e,c[v],s[y]]))}}}}var k={};for(var t in this.catEnergyField){k[t]=this.catEnergyField[t].finalField;for(var M=this.catEnergyField[t].edgeCrossingList,w=[],I=0;I<M.length;I++){w.push([]);for(var P=M[I][0],A=(M[I][1],M[I][2],M[I][3]),C=M[I][4],N=0,B=D(A[0].x,A[0].y,A[1].x,A[1].y),S=[A[1].x-A[0].x,A[1].y-A[0].y],_=[C[1].x-C[0].x,C[1].y-C[0].y],O=F(S),j=F(_),V=.5,L=[],X=[],G=[],U=[],R=!1,T=!1,W=!1;N<Y&&!R;){for(var q=[P.x+N*j[0],P.y+N*j[1]],z=0,H=!1,Q=!1;z<B/2;){if(!H&&!R&&!T){var J=[q[0]+O[0]*z,q[1]+O[1]*z],Z=Math.floor((J[0]-this.catEnergyField[t].x)/K),$=Math.floor((J[1]-this.catEnergyField[t].y)/K);for(var tt in this.catEdgeDict){var et=tt,it=Math.floor((J[0]-this.catEnergyField[et].x)/K),at=Math.floor((J[1]-this.catEnergyField[et].y)/K);if(it>0&&it<this.catEnergyField[et].width&&at>0&&at<this.catEnergyField[et].height&&3==this.catEnergyField[et].pointBarrierMap[at][it]){R=!0;break}}Z>0&&Z<this.catEnergyField[t].width&&$>0&&$<this.catEnergyField[t].height&&this.catEnergyField[t].finalField[$][Z]>0&&(H=!0,4!=this.catEnergyField[t].edgeBarrierMap[$][Z]?0==G.length?(L.push([Z,$]),G=[Z,$]):Math.abs(G[0]-Z)<=5&&Math.abs(G[1]-$)<=5?(G=[Z,$],L.push([Z,$])):T=!0:L.push([Z,$]))}if(!Q&&!R&&!W){var rt=[q[0]-O[0]*z,q[1]-O[1]*z],st=Math.floor((rt[0]-this.catEnergyField[t].x)/K),nt=Math.floor((rt[1]-this.catEnergyField[t].y)/K);for(var tt in this.catEdgeDict){var ht=tt,ot=Math.floor((rt[0]-this.catEnergyField[ht].x)/K),dt=Math.floor((rt[1]-this.catEnergyField[ht].y)/K);if(ot>0&&ot<this.catEnergyField[ht].width&&dt>0&&dt<this.catEnergyField[ht].height&&3==this.catEnergyField[ht].pointBarrierMap[dt][ot]){R=!0;break}}st>0&&st<this.catEnergyField[t].width&&nt>0&&nt<this.catEnergyField[t].height&&this.catEnergyField[t].finalField[nt][st]>0&&(Q=!0,4!=this.catEnergyField[t].edgeBarrierMap[nt][st]?0==U.length?(X.push([st,nt]),U=[st,nt]):Math.abs(U[0]-st)<=5&&Math.abs(U[1]-nt)<=5?(U=[st,nt],X.push([st,nt])):W=!0:X.push([st,nt]))}if(H&&Q||T&&W)break;z+=V}N+=V}for(var lt=[[Math.floor((P.x-this.catEnergyField[t].x)/K),Math.floor((P.y-this.catEnergyField[t].y)/K)]],gt=0;gt<L.length;gt++)lt.push(L[gt]);for(var ct=X.length-1;ct>=0;ct--)lt.push(X[ct]);w[I].push(lt),L=[],X=[],G=[],U=[];var ut=!1;for(T=!1,W=!1,N=0;N<Y&&!ut;){for(var pt=[P.x-N*j[0],P.y-N*j[1]],yt=0,ft=!1,xt=!1;yt<B/2;){if(!ft&&!ut&&!T){var vt=[pt[0]+O[0]*yt,pt[1]+O[1]*yt],Et=Math.floor((vt[0]-this.catEnergyField[t].x)/K),mt=Math.floor((vt[1]-this.catEnergyField[t].y)/K);for(var tt in this.catEdgeDict){var Dt=tt,Ft=Math.floor((vt[0]-this.catEnergyField[Dt].x)/K),bt=Math.floor((vt[1]-this.catEnergyField[Dt].y)/K);if(Ft>0&&Ft<this.catEnergyField[Dt].width&&bt>0&&bt<this.catEnergyField[Dt].height&&3==this.catEnergyField[Dt].pointBarrierMap[bt][Ft]){ut=!0;break}}Et>0&&Et<this.catEnergyField[t].width&&mt>0&&mt<this.catEnergyField[t].height&&this.catEnergyField[t].finalField[mt][Et]>0&&(ft=!0,4!=this.catEnergyField[t].edgeBarrierMap[mt][Et]?0==G.length?(L.push([Et,mt]),G=[Et,mt]):Math.abs(G[0]-Et)<=5&&Math.abs(G[1]-mt)<=5?(G=[Et,mt],L.push([Et,mt])):T=!0:L.push([Et,mt]))}if(!xt&&!ut&&!W){var kt=[pt[0]-O[0]*yt,pt[1]-O[1]*yt],Mt=Math.floor((kt[0]-this.catEnergyField[t].x)/K),wt=Math.floor((kt[1]-this.catEnergyField[t].y)/K);for(var tt in this.catEdgeDict){var It=tt,Pt=Math.floor((kt[0]-this.catEnergyField[It].x)/K),At=Math.floor((kt[1]-this.catEnergyField[It].y)/K);if(Pt>0&&Pt<this.catEnergyField[It].width&&At>0&&At<this.catEnergyField[It].height&&3==this.catEnergyField[It].pointBarrierMap[At][Pt]){ut=!0;break}}Mt>0&&Mt<this.catEnergyField[t].width&&wt>0&&wt<this.catEnergyField[t].height&&this.catEnergyField[t].finalField[wt][Mt]>0&&(xt=!0,4!=this.catEnergyField[t].edgeBarrierMap[wt][Mt]?0==U.length?(X.push([Mt,wt]),U=[Mt,wt]):Math.abs(U[0]-Mt)<=5&&Math.abs(U[1]-wt)<=5?(U=[Mt,wt],X.push([Mt,wt])):W=!0:X.push([Mt,wt]))}if(ft&&xt||T&&W)break;yt+=V}N+=V}lt=[[Math.floor((P.x-this.catEnergyField[t].x)/K),Math.floor((P.y-this.catEnergyField[t].y)/K)]];for(var Ct=0;Ct<L.length;Ct++)lt.push(L[Ct]);for(var Nt=X.length-1;Nt>=0;Nt--)lt.push(X[Nt]);w[I].push(lt)}for(var Bt=0;Bt<w.length;Bt++)for(var St=M[Bt][2],_t=this.edges[St].cat,Ot=this.catEnergyField[t].x,jt=this.catEnergyField[t].y,Vt=0;Vt<w[Bt].length;Vt++){for(var Lt=0;Lt<w[Bt][Vt].length;Lt++)w[Bt][Vt][Lt][0]=w[Bt][Vt][Lt][0]*K+Ot,w[Bt][Vt][Lt][1]=w[Bt][Vt][Lt][1]*K+jt;this.fillPolygonForEdge(w[Bt][Vt],t,k,_t)}}for(var t in this.catEnergyField)this.catEnergyField[t].finalField=k[t]}},{key:"smoothEnergyField",value:function(t){var e=this.getGaussianKernel(1.5,3),i=parseInt(1.5);for(var a in this.catEnergyField){for(var r=t[a].minX,s=t[a].maxX,n=t[a].minY,h=t[a].maxY,o=s-r+1,d=h-n+1,l=[],g=0;g<d+10;g++)l.push(new Array(o+10).fill(0));for(var c=n;c<=h;c++)for(var u=r;u<=s;u++){for(var p=0,y=0;y<3;y++)for(var f=0;f<3;f++){var x=c+(y-i),v=u+(f-i);x>0&&x<this.catEnergyField[a].height&&v>0&&v<this.catEnergyField[a].width&&(p+=e[y][f]*this.catEnergyField[a].finalField[x][v])}p>0&&(l[c-n][u-r]=p)}for(var E=n;E<=h;E++)for(var m=r;m<=s;m++)this.catEnergyField[a].finalField[E][m]=l[E-n][m-r]}}},{key:"saveOutline",value:function(t){var e=[];for(var i in t)for(var a=0;a<t[i].length;a++){for(var r=[],s=0;s<t[i][a].length;s++)r.push({x:t[i][a][s][0],y:t[i][a][s][1]});e.push({cat:i,id:a,isInterior:!1,parentID:-1,points:r})}}},{key:"removeOverlaps",value:function(){for(var t in this.updateEnergyPoints(),p.g("svg").selectAll("path").remove(),!1,0,this.firstFlag=!0,this.findOutLine(),this.calOutLine(),this.calEdgeControlPoints(),this.catEnergyField)this.updatedEnergyPoints[t]=[]}},{key:"render",value:function(){return Object(a.jsxs)("div",{id:"Sliders",children:[Object(a.jsx)("br",{}),Object(a.jsxs)(f.a,{children:[Object(a.jsxs)(x.a,{span:12,children:[Object(a.jsx)("h4",{children:"Node Radius"}),Object(a.jsx)(v.a,{min:1,max:50,onChange:this.onChangeNodeR1,value:"number"===typeof X?X:20})]}),Object(a.jsx)(x.a,{span:4,children:Object(a.jsx)(E.a,{min:1,max:50,style:{margin:"0 16px"},value:X,onChange:this.onChangeNodeR1})})]}),Object(a.jsxs)(f.a,{children:[Object(a.jsxs)(x.a,{span:12,children:[Object(a.jsx)("h4",{children:"Global Edge Width"}),Object(a.jsx)(v.a,{min:10,max:100,onChange:this.onChangeEdgeR1,value:"number"===typeof Y?Y:20})]}),Object(a.jsx)(x.a,{span:4,children:Object(a.jsx)(E.a,{min:10,max:100,style:{margin:"0 16px"},value:Y,onChange:this.onChangeEdgeR1})})]}),Object(a.jsxs)(f.a,{children:[Object(a.jsxs)(x.a,{span:12,children:[Object(a.jsx)("h4",{children:"Pixel Group"}),Object(a.jsx)(v.a,{min:1,max:10,onChange:this.onChangePixelGroup,value:"number"===typeof K?K:2})]}),Object(a.jsx)(x.a,{span:4,children:Object(a.jsx)(E.a,{min:1,max:10,style:{margin:"0 16px"},value:K,onChange:this.onChangePixelGroup})})]}),Object(a.jsxs)(f.a,{children:[Object(a.jsxs)(x.a,{span:12,children:[Object(a.jsx)("h4",{children:"Gap Between Different Groups"}),Object(a.jsx)(v.a,{min:0,max:5,onChange:this.onChangeGap,value:"number"===typeof Q?Q:1})]}),Object(a.jsx)(x.a,{span:4,children:Object(a.jsx)(E.a,{min:0,max:5,style:{margin:"0 16px"},value:Q,onChange:this.onChangeGap})})]}),Object(a.jsxs)(f.a,{children:[Object(a.jsxs)(x.a,{span:12,children:[Object(a.jsx)("h4",{children:"Edge Width"}),Object(a.jsx)(v.a,{min:1,max:10,onChange:this.onChangeEdgeWidth,value:this.state.edgeWidth,disabled:!this.state.hasSelectEdge})]}),Object(a.jsx)(x.a,{span:4,children:Object(a.jsx)(E.a,{min:1,max:10,style:{margin:"0 16px"},value:this.state.edgeWidth,onChange:this.onChangeEdgeWidth,disabled:!this.state.hasSelectEdge})})]}),Object(a.jsx)("br",{}),Object(a.jsx)(m.a,{onClick:this.getData.bind(this),disabled:!this.props.hasLoadData,children:"Draw Bubbles"}),Object(a.jsx)(m.a,{onClick:this.removeOverlaps.bind(this),disabled:!this.props.hasLoadData,children:"Remove Overlaps"})]})}}]),i}(r.Component);ut.defaultProps={pointData:[],edges:[]};var pt,yt,ft,xt,vt,Et,mt=ut,Dt=i(304),Ft=i(124),bt=i(111),kt=bt.ShapeInfo,Mt=bt.Intersection,wt=(bt.Point2D,bt.IntersectionQuery),It=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],Pt=i(213),At=10,Ct=40,Nt=i(215),Bt=1,St=1,_t=1,Ot=Number.MIN_VALUE,jt=Number.MAX_VALUE,Vt=i(219),Lt="#mainsvg",Xt="#leftsvg",Gt=[],Yt=[],Ut=[],Rt=[],Tt=!1,Wt=1920,qt=1040,zt=1920,Ht=1040;function Kt(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array|t instanceof Object){var e=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(e[i]=Kt(t[i]));return e}throw new Error("Unable to clone obj! Its type isn't supported.")}var Qt=function(t){Object(g.a)(i,t);var e=Object(c.a)(i);function i(){var t;return Object(d.a)(this,i),(t=e.call(this)).onRef=function(e){t.child=e},t.state={read:!1,pointData:[],edges:[],hasinit:!1,hasEdit:!1,hascreated:!1,editV:!1,colorArray:["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"]},t.issplit=!1,t.pointData=[],t.canvasWidth=-1,t.canvasHeight=-1,t.maxX=-1,t.maxY=-1,t.minX=-1,t.minY=-1,t.maxDis=Number.MIN_VALUE,t.catPointDict={},t.edges=[],t.graph=null,t.clustergraph=null,t.maxDistance=-1,t.itemShape="",t.isSelect=!1,t.selectItem=null,t.clusterDict={},t.clustergraphInfo={},t.clusterArr=[],t.noiseDict={},t.itemBBox=[],t.intersecEdges=[],t.vis=[],t.heap1={},t.heap2={},t.QTree=null,t.f=[],t.edgesdict=[],t.idx=0,t.draggedIndex=-1,t.draggedEdgeIndex=-1,t.draggedEdgeSeg=-1,t.nodeStartDict=[],t.nodeEndDict=[],t.lastClickIndex=-1,t.lastClickItem=null,t.deletedEdge=[],t.addedEdge=[],t.tempEdges=[],t}return Object(l.a)(i,[{key:"init",value:function(){It=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],At=10,Ct=40,50,Bt=1,St=1,_t=1,Ot=Number.MIN_VALUE,jt=Number.MAX_VALUE,Lt="#mainsvg",Xt="#leftsvg",[],[],[],[],Gt=[],Yt=[],Ut=[],Rt=[],Tt=!1,this.setState({read:!1,pointData:[],edges:[],hasinit:!1,hasEdit:!1,hascreated:!1,editV:!1,colorArray:["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"]}),this.pointData=[],this.canvasWidth=-1,this.canvasHeight=-1,this.maxX=-1,this.maxY=-1,this.minX=-1,this.minY=-1,this.maxDis=Number.MIN_VALUE,this.catPointDict={},this.edges=[],this.graph=null,this.clustergraph=null,this.maxDistance=-1,this.itemShape="",this.isSelect=!1,this.selectItem=null,this.clusterDict={},this.clustergraphInfo={},this.clusterArr=[],this.noiseDict={},this.itemBBox=[],this.intersecEdges=[],this.vis=[],this.heap1={},this.heap2={},this.QTree=null,this.f=[],this.edgesdict=[],this.idx=0,this.draggedEdgeIndex=-1,this.draggedEdgeSeg=-1,this.nodeStartDict=[],this.nodeEndDict=[],this.lastClickIndex=-1,this.lastClickItem=null,this.deletedEdge=[],this.addedEdge=[],this.tempEdges=[],this.componentWillMount(),this.render(),this.componentDidMount(),this.child.init_all()}},{key:"searchFather",value:function(t){for(;t!=this.f[t];)this.f[t]=this.f[this.f[t]],t=this.f[t];return t}},{key:"unionFather",value:function(t,e){this.f[this.searchFather(e)]=this.searchFather(t)}},{key:"componentWillMount",value:function(){Ht=window.screen.availHeight,zt=window.screen.availWidth}},{key:"componentDidMount",value:function(){this.props.onRef(this),this.canvasWidth=document.getElementById("mainsvg").getBoundingClientRect().width,this.canvasHeight=document.getElementById("mainsvg").getBoundingClientRect().height}},{key:"centralizeData",value:function(){for(var t=Number.MAX_VALUE,e=Number.MAX_VALUE,i=Number.MIN_VALUE,a=Number.MIN_VALUE,r=0;r<this.pointData.length;r++)this.pointData[r].x>i&&(i=this.pointData[r].x),this.pointData[r].y>a&&(a=this.pointData[r].y),this.pointData[r].x<t&&(t=this.pointData[r].x),this.pointData[r].y<e&&(e=this.pointData[r].y);this.maxX=i,this.minX=t,this.maxY=a,this.minY=e,p.g("#mainsvg").attr("viewBox",t-20+" "+(e-20)+" "+(i-t+40)+" "+(a-e+40)),p.g("#leftsvg").attr("viewBox",t-20+" "+(e-20)+" "+(i-t+40)+" "+(a-e+40)),pt=t-20,yt=e-20,ft=i-t+40,xt=a-e+40}},{key:"calEPS",value:function(){for(var t=0,e=0,i=Number.MIN_VALUE,a=0;a<this.pointData.length;a++)for(var r=a+1;r<this.pointData.length;r++){var s=this.calDistance(this.pointData[a],this.pointData[r]);t+=s,e+=1,s>i&&(i=s)}At=.035*i,this.maxDis=i,jt=t/e-10}},{key:"addNewPoints",value:function(t){t.x=parseFloat(t.x),t.y=parseFloat(t.y),t.id=this.pointData.length,t.cat=t.cat.toString();var e=t.cat.split(","),i=[];if(e.length>1){t.multicat=!0;for(var a=0;a<e.length;a++)i.push(e[a])}else t.multicat=!1,i.push(t.cat);t.catArray=i;for(var r=0;r<t.catArray.length;r++){var s=t.catArray[r];this.catPointDict.hasOwnProperty(s)||(this.catPointDict[s]=[]),this.catPointDict[s].push(t)}this.pointData.push(t);var n=Kt(this.pointData[this.pointData.length-1]);n.flag=!0,n.id=this.pointData.length-1,Gt.push(n),this.calEPS(),this.drawPointData(),this.optimizeMST(!0),this.setState({pointData:this.pointData}),this.setState({edges:this.edges})}},{key:"getData",value:function(){if(It=this.props.colorArray,this.setState({colorArray:It}),this.state.hasinit)this.applyEdit();else if(this.props.pointData){this.init(),this.props.edges&&(this.edges=this.props.edges),this.pointData=this.props.pointData,this.itemShape=this.pointData[0].shape;for(var t=0;t<this.pointData.length;t++){this.pointData[t].x=parseFloat(this.pointData[t].x),this.pointData[t].y=parseFloat(this.pointData[t].y),this.pointData[t].id=t,this.pointData[t].cat=this.pointData[t].cat.toString();var e=this.pointData[t].cat.split(","),i=[];if(e.length>1){this.pointData[t].multicat=!0;for(var a=0;a<e.length;a++)i.push(e[a])}else this.pointData[t].multicat=!1,i.push(this.pointData[t].cat);this.pointData[t].catArray=i;for(var r=0;r<this.pointData[t].catArray.length;r++){var s=this.pointData[t].catArray[r];this.catPointDict.hasOwnProperty(s)||(this.catPointDict[s]=[]),this.catPointDict[s].push(this.pointData[t])}}this.centralizeData(),this.calEPS(),p.g(Lt).selectAll("*").remove(),this.drawPointData(),this.generateTreeWithHierarchical(),this.drawEdges(),this.props.hasCreate(),this.setState({pointData:this.pointData}),this.setState({edges:this.edges}),this.setState({hasinit:!0})}return[this.pointData,this.edges,It]}},{key:"createGraph",value:function(){for(var t=new Pt.Graph(this.pointData.length),e=0;e<t.V;e++)t.node(e).label=this.pointData[e].cat;this.graph=t}},{key:"sortEdgesGlobal",value:function(){var t=[],e=[],i=[],a=[],r=Number.MIN_VALUE;for(var s in this.catPointDict)for(var n=0;n<this.catPointDict[s].length;n++)for(var h=n+1;h<this.catPointDict[s].length;h++){var o=this.calDistance(this.catPointDict[s][n],this.catPointDict[s][h]),d=this.calEdgeMess(this.catPointDict[s][n],this.catPointDict[s][h]);e.push(o),i.push(d),o>r&&(r=o),a.push([this.catPointDict[s][n].id,this.catPointDict[s][h].id,o,d])}this.maxDistance=r;for(var l=0;l<a.length;l++){var g=a[l][0],c=a[l][1],u=a[l][2]/r,p=a[l][3],y=u*(p+1);t.push([g,c,y,u,p])}return t.sort((function(t,e){return t[2]-e[2]})),t}},{key:"sortEdgesGlobalWithMinDis",value:function(){var t=[],e=[],i=[],a=[],r=Number.MIN_VALUE;for(var s in this.catPointDict)for(var n=0;n<this.catPointDict[s].length;n++)for(var h=n+1;h<this.catPointDict[s].length;h++){var o=this.calDistance(this.catPointDict[s][n],this.catPointDict[s][h]),d=this.calEdgeMess(this.catPointDict[s][n],this.catPointDict[s][h]);e.push(o),i.push(d),o>r&&(r=o),a.push([this.catPointDict[s][n].id,this.catPointDict[s][h].id,o,d])}this.maxDistance=r;for(var l=0;l<a.length;l++){var g=a[l][0],c=a[l][1],u=a[l][2]/r,p=a[l][3],y=u;t.push([g,c,y,u,p])}return t.sort((function(t,e){return t[2]-e[2]})),t}},{key:"sortEdgesInCategory",value:function(t){for(var e=[],i=0;i<this.catPointDict[t].length;i++)for(var a=i+1;a<this.catPointDict[t].length;a++){var r=this.calEdgeWeight(this.catPointDict[t][i],this.catPointDict[t][a]);e.push([this.catPointDict[t][i].id,this.catPointDict[t][a].id,r])}return e.sort((function(t,e){return t[2]-e[2]})),e}},{key:"checkEdgeCrossing",value:function(t,e,i,a){return Math.min(t.x,e.x)<=Math.max(i.x,a.x)&&Math.min(i.x,a.x)<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=Math.max(i.y,a.y)&&Math.min(i.y,a.y)<=Math.max(t.y,e.y)&&(((i.x-t.x)*(i.y-a.y)-(i.y-t.y)*(i.x-a.x))*((i.x-e.x)*(i.y-a.y)-(i.y-e.y)*(i.x-a.x))<0&&((t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x))*((t.x-a.x)*(t.y-e.y)-(t.y-a.y)*(t.x-e.x))<0)}},{key:"calEdgeWeightWithCrossing",value:function(t,e){for(var i=this.calDistance(t,e),a=this.calEdgeMess(t,e),r=0,s=0;s<this.edges.length;s++){var n=this.edges[s].start,h=this.edges[s].end,o=this.pointData[n].cat;t.cat!=o&&this.checkEdgeCrossing(t,e,this.pointData[n],this.pointData[h])&&(r+=1)}return[i*(a+1)*(r+1)/this.maxDistance,i/this.maxDistance,a,r]}},{key:"calEdgeWeightWithCrossing2",value:function(t,e){for(var i=this.calDistance(t,e),a=this.calEdgeMess(t,e),r=0,s=0;s<this.edges.length;s++){var n=this.edges[s].start,h=this.edges[s].end,o=this.pointData[n].cat;t.cat!=o&&this.checkEdgeCrossing(t,e,this.pointData[n],this.pointData[h])&&(r+=1)}return[i*(a+1)*(r+1)/this.maxDistance,i/this.maxDistance,a,r]}},{key:"checkNewEdge",value:function(t,e){if(t.cat!=e.cat)return!0;for(var i=0;i<this.edges.length;i++){var a=this.pointData[this.edges[i].start],r=this.pointData[this.edges[i].end];if(a.cat!=t.cat&&a.cat!=e.cat&&r.cat!=t.cat&&r.cat!=e.cat&&this.checkEdgeCrossing(a,r,t,e))return!0}return!1}},{key:"calBackbone",value:function(){var t,e=[];t=this.sortEdgesGlobal();for(var i=0;i<t.length;i++){var a=t[i][0],r=t[i][1],s=t[i][2],n=t[i][3],h=t[i][4];if(this.pointData[a].cat==this.pointData[r].cat)new Pt.DepthFirstSearch(this.graph,a).hasPathTo(r)||(this.checkNewEdge(this.pointData[a],this.pointData[r])?e.push({start:a,end:r,weight:s,dis:n,crossnum:-1,mess:h}):(this.graph.addEdge(a,r),this.edges.push({start:a,end:r,weight:s,dis:n,mess:h})))}for(;!this.checkConnect();){for(var o=[],d=0;d<e.length;d++){var l=e[d].start,g=e[d].end;this.pointData[l].cat;if(!new Pt.DepthFirstSearch(this.graph,l).hasPathTo(g)){var c=this.calEdgeWeightWithCrossing(this.pointData[l],this.pointData[g]);e[d].weight=c[0],e[d].crossnum=c[3],o.push(e[d])}}for(var u=Number.MAX_VALUE,p=-1,y=0;y<o.length;y++)u>o[y].weight&&(u=o[y].weight,p=y);var f=o[p].start,x=o[p].end;this.graph.addEdge(f,x),this.edges.push({start:f,end:x,weight:o[p].weight,dis:o[p].dis,mess:o[p].mess,crossnum:o[p].crossnum})}}},{key:"calBackboneWithMinDis",value:function(){var t;t=this.sortEdgesGlobalWithMinDis();for(var e=0;e<t.length;e++){var i=t[e][0],a=t[e][1],r=t[e][2],s=t[e][3],n=t[e][4];if(this.pointData[i].cat==this.pointData[a].cat)new Pt.DepthFirstSearch(this.graph,i).hasPathTo(a)||(this.graph.addEdge(i,a),this.edges.push({start:i,end:a,weight:r,dis:s,mess:n}))}}},{key:"checkConnectBetweenAllClusterV2",value:function(){for(var t in this.clusterDict){if(this.clustergraphInfo[t].edgesnum!=this.clustergraphInfo[t].nodesnum-1)return!1}return!0}},{key:"checkConnectBetweenAllCluster",value:function(){for(var t in this.clusterDict)for(var e=this.clusterDict[t][0].id,i=new Pt.DepthFirstSearch(this.clustergraph,e),a=1;a<this.clusterDict[t].length;a++)if(!i.hasPathTo(this.clusterDict[t][a].id))return!1;return!0}},{key:"checkConnectBetweenTwoClusterV2",value:function(t,e){return this.searchFather(t)==this.searchFather(e)}},{key:"checkConnectBetweenTwoCluster",value:function(t,e){return!!new Pt.DepthFirstSearch(this.clustergraph,t).hasPathTo(e)}},{key:"checkConnect",value:function(){for(var t in this.catPointDict)for(var e=this.catPointDict[t][0].id,i=new Pt.DepthFirstSearch(this.graph,e),a=1;a<this.catPointDict[t].length;a++)if(!i.hasPathTo(this.catPointDict[t][a].id))return!1;return!0}},{key:"sortRemoveEdges",value:function(t){var e,i;return t.sort(e.weight-i.weight),t}},{key:"calEdgeWeightWithCrossing",value:function(t,e){for(var i=this.calDistance(t,e),a=this.calEdgeMess(t,e),r=0,s=0;s<this.edges.length;s++){var n=this.edges[s].start,h=this.edges[s].end,o=this.pointData[n].cat;t.cat!=o&&this.checkEdgeCrossing(t,e,this.pointData[n],this.pointData[h])&&(r+=1)}return[i*(a+1)*(r+1)/this.maxDistance,i/this.maxDistance,a,r]}},{key:"calEdgeWeightWithCrossing2",value:function(t,e){for(var i=this.calDistance(t,e),a=this.calEdgeMess(t,e),r=0,s=0;s<this.edges.length;s++){var n=this.edges[s].start,h=this.edges[s].end,o=this.pointData[n].cat;t.cat!=o&&this.checkEdgeCrossing(t,e,this.pointData[n],this.pointData[h])&&(r+=1)}return[i*(a+1)*(r+1)/this.maxDistance,i/this.maxDistance,a,r]}},{key:"calDistance",value:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}},{key:"calEdgeMess",value:function(t,e){for(var i=0,a=0;a<this.pointData.length;a++){if(this.pointData[a].cat!=t.cat&&this.pointData[a].cat!=e.cat)if(this.isPointInEdgeRange(t,e,this.pointData[a]))this.calPointEdgeDistance(t,e,this.pointData[a])<At&&(i+=1)}return i}},{key:"calEdgeWeight",value:function(t,e){return[this.calDistance(t,e),this.calEdgeMess(t,e)]}},{key:"getVecNorm",value:function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}},{key:"calVecCosine",value:function(t,e){return(t[0]*e[0]+t[1]*e[1])/(this.getVecNorm(t)*this.getVecNorm(e))}},{key:"isPointInEdgeRange",value:function(t,e,i){var a=[i.x-t.x,i.y-t.y],r=[e.x-t.x,e.y-t.y];if(this.calVecCosine(a,r)<0)return!1;var s=[i.x-e.x,i.y-e.y],n=[t.x-e.x,t.y-e.y];return!(this.calVecCosine(s,n)<0)}},{key:"calPointEdgeDistance",value:function(t,e,i){var a=[e.x-t.x,e.y-t.y],r=[i.x-t.x,i.y-t.y],s=(a[0]*r[0]+a[1]*r[1])/this.getVecNorm(a),n=this.getVecNorm(r);return Math.sqrt(Math.pow(n,2)-Math.pow(s,2))}},{key:"calCrossingCost",value:function(){}},{key:"drawLine",value:function(t,e,i,a,r){p.g(Lt).append("line").attr("x1",t).attr("y1",e).attr("x2",i).attr("y2",a).attr("stroke-width",2).attr("stroke",r)}},{key:"drawEdges",value:function(){for(var t=this,e=0;e<t.edges.length;e++)t.edges[e].id=e,t.edges[e].SVGElement=[];p.g(Lt).select("#edgeGroup").empty()&&p.g(Lt).insert("g","#pointGroup").attr("id","edgeGroup"),p.g(Xt).select("#edgeGroup").empty()&&p.g(Xt).insert("g","#pointGroup").attr("id","edgeGroup"),p.h("line").remove(),p.h(".controlPoints").remove();for(var i=0;i<this.edges.length;i++)this.drawOneEdge(i)}},{key:"savePointData",value:function(){var t=this;p.h("circle").each((function(){var e=p.g(this).attr("cx"),i=p.g(this).attr("cy"),a=p.g(this).attr("index");t.pointData[a].x=parseFloat(e),t.pointData[a].y=parseFloat(i),t.pointData[a].cat=t.pointData[a].cat.toString()}))}},{key:"saveEdgeData",value:function(){for(var t=[],e=0;e<this.edges.length;e++)this.edges[e].isdelete||(this.edges[e].index=t.length,t.push(this.edges[e]));this.edges=t}},{key:"loadEdgeData",value:function(){var t=this;fetch("/data/manuallyDataEdge.txt",{method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"},mode:"cors",cache:"default"}).then((function(t){return t.json()})).then((function(e){console.log(e),t.edges=e;for(var i=t,a=0;a<t.edges.length;a++){var r=t.edges[a].start,s=t.edges[a].end;p.g(Lt).append("line").attr("x1",t.pointData[r].x).attr("y1",t.pointData[r].y).attr("x2",t.pointData[s].x).attr("y2",t.pointData[s].y).attr("stroke-width",2).attr("stroke","black").attr("index",a).on("click",(function(){var t=p.g(this).attr("index");i.edges[t].isdelete=!0,p.g(this).remove()}))}}))}},{key:"clickItem",value:function(t){if(this.isSelect){if(p.g(t.target).attr("index")!=this.selectItem){var e=this.selectItem,i=p.g(t.target).attr("index");if(this.pointData[e].cat==this.pointData[i].cat){this.isSelect=!1,this.selectItem=null,this.edges.push({start:e,end:i,index:this.edges.length,isdelete:!1});var a=this;p.g(Lt).append("line").attr("x1",this.pointData[e].x).attr("y1",this.pointData[e].y).attr("x2",this.pointData[i].x).attr("y2",this.pointData[i].y).attr("stroke-width",2).attr("stroke","black").attr("index",this.edges.length-1).on("click",(function(){var t=p.g(this).attr("index");a.edges[t].isdelete=!0,p.g(this).remove()}))}}}else this.isSelect=!0,this.selectItem=p.g(t.target).attr("index")}},{key:"deleteEdge",value:function(t){var e=t,i=this;p.h("line").filter((function(){return parseInt(p.g(this).attr("index"))==e})).remove(),p.h(".controlPoints").filter((function(){return parseInt(p.g(this).attr("edgeindex"))==e})).remove(),p.h(".controlPoints").filter((function(){return parseInt(p.g(this).attr("edgeindex"))>e})).attr("edgeindex",(function(){return parseInt(p.g(this).attr("edgeindex"))-1})),p.h("line").filter((function(){return parseInt(p.g(this).attr("index"))>e})).attr("index",(function(){return parseInt(p.g(this).attr("index"))-1})),i.edges.splice(e,1);for(var a=0;a<i.edges.length;a++)i.edges[a].id=a}},{key:"optimizeMST",value:function(t){this.clustergraphInfo={};for(var e=new Pt.Graph(this.pointData.length),i=0;i<e.V;i++)e.node(i).label=this.pointData[i].cat;for(var a=0;a<this.edges.length;a++){var r=this.edges[a].start,s=this.edges[a].end;this.edges[a].cat;e.addEdge(r,s)}this.graph=e;var n=new Pt.ConnectedComponents(e),h={};for(var o in this.catPointDict)h[o]=[];for(var d=[],l=0;l<n.componentCount();l++)d.push([]);for(var g=0;g<e.V;g++){var c=this.pointData[g];d[n.componentId(g)].push(c)}for(var u=0;u<d.length;u++){h[d[u][0].cat].push(d[u])}for(var y in this.clusterDict=h,this.clusterDict)this.clustergraphInfo[y]={edgesnum:0,nodesnum:this.clusterDict[y].length};d=[];var f=0;for(var x in this.clusterDict)for(var v=0;v<this.clusterDict[x].length;v++)d.push({points:this.clusterDict[x][v],cat:x,id:f}),this.clusterDict[x][v].id=f,f+=1;this.clusterArr=d;for(var E=new Pt.Graph(this.clusterArr.length),m=0;m<E.V;m++)E.node(m).label=this.clusterArr[m].cat;this.clustergraph=E,this.itemBBox=[];for(var D=document.getElementsByClassName("dataPoint"),F=0;F<D.length;F++)this.itemBBox.push({id:D[F].getAttribute("index"),bbox:D[F].getBBox()});if(t){for(var b=[],k=0;k<this.edges.length;k++)b.push(this.edges[k]);var M=this.recalculateSpanningTreeAfterEdit(b);p.h(".deleteOpEdge").remove(),Rt=[];for(var w=0;w<M.length;w++){this.drawOneEdgeAfterEdit(b,M[w]);var I=Kt(b[M[w]]);I.id=M[w],I.flag=!0,Rt.push(I)}this.tempEdges=b}else{for(var P=this.recalculateSpanningTree(),A=0;A<P.length;A++)this.drawOneEdge(P[A]),this.edges[P[A]].new=!0;this.draggedIndex=-1,this.deletedEdge=[],this.addedEdge=[],this.setState({pointData:this.pointData,edges:this.edges})}}},{key:"sufaceRoutingAll",value:function(){for(var t=0;t<this.edges.length;t++){var e=this.edges[t],i=this.pointData[e.start.id],a=this.pointData[e.end.id],r=this.pointData[e.start.id].cat,s=[];s.push([i.x,i.y]),s.push([a.x,a.y]);for(var n=[{start:[i.x,i.y],end:[a.x,a.y],ids:[0,1]}];n.length>0;){var h=5,o=!1,d=n.pop();i=d.start,a=d.end;var l=d.ids;p.h("line").remove(),p.g(Lt).append("line").attr("x1",i[0]).attr("y1",i[1]).attr("x2",a[0]).attr("y2",a[1]).attr("stroke-width",2).attr("stroke","red");var g=this.findCrossingBetweenEdgeRect(i,a,r);if(0!=g.length){this.edges[t].virtrual=!0;var c=g[0].points,u=g[0].rect,y=[[u.x,u.y],[u.x+u.width,u.y]],f=[[u.x,u.y+u.height],[u.x+u.width,u.y+u.height]],x=[[u.x,u.y],[u.x,u.y+u.height]],v=[[u.x+u.width,u.y],[u.x+u.width,u.y+u.height]],E=c[0],m=c[1],D=void 0;if(y[1][1]==E.y&&f[1][1]==m.y||f[1][1]==E.y&&y[1][1]==m.y||x[0][0]==E.x&&v[0][0]==m.x||x[0][0]==m.x&&v[0][0]==E.x){var F=-1;if(y[1][1]==E.y&&f[1][1]==m.y){var b=E.x-u.x,k=m.x-u.x;F=b+k<u.width?b>k?3:2:b<k?4:1}else if(f[1][1]==E.y&&y[1][1]==m.y){var M=m.x-u.x,w=E.x-u.x;F=M+w<u.width?M>w?3:2:M<w?4:1}else if(x[0][0]==E.x&&v[0][0]==m.x){var I=E.y-u.y,P=m.y-u.y;F=I+P<u.width?I>P?3:4:I<P?2:1}else if(x[0][0]==m.x&&v[0][0]==E.x){var A=m.y-u.y,C=E.y-u.y;F=A+C<u.width?A>C?3:4:A<C?2:1}for(var N=[],B=0,S=-1,_=-1;;){1==F?N=o?[u.x+u.width,u.y+u.height]:[u.x,u.y]:2==F?N=o?[u.x,u.y+u.height]:[u.x+u.width,u.y]:3==F?N=o?[u.x,u.y]:[u.x+u.width,u.y+u.height]:4==F&&(N=o?[u.x+u.width,u.y]:[u.x,u.y+u.height]);var O=[u.x+u.width/2,u.y+u.height/2],j=[N[0]-O[0],N[1]-O[1]],V=this.getVecNorm(j);if(j[0]=j[0]/V,j[1]=j[1]/V,D=[N[0]+h*j[0],N[1]+h*j[1]],this.checkVNodeInBound(D,r)){if(o||(h/=1.5),o=!o,(B+=1)>10)break}else if(o?S=D:_=D,o=!o,-1!=S&&-1!=_)break}if(-1==S&&-1==_){this.edges[t].virtrual=!1;continue}if(-1!=S&&-1!=_){for(var L=Number.MAX_VALUE,X=null,G=[S,_],Y=0;Y<G.length;Y++){for(var U=G[Y],R=0,T=0;T<this.edges.length;T++){var W=this.pointData[this.edges[T].start],q=this.pointData[this.edges[T].end];if(W.cat!=r){var z={x:i[0],y:i[1],cat:r},H={x:U[0],y:U[1],cat:r},K={x:a[0],y:a[1],cat:r};this.checkEdgeCrossing(W,q,z,H)&&(R+=1),this.checkEdgeCrossing(W,q,H,K)&&(R+=1)}}R<L&&(L=R,X=G[Y])}D=X}else D=-1!=S?S:_}else{var Q=[E.x,m.y],J=[];Q[0]==u.x&&Q[1]==u.y?J=[u.x,u.y]:Q[0]==u.x+u.width&&Q[1]==u.y?J=[u.x+u.width,u.y]:Q[0]==u.x+u.width&&Q[1]==u.y+u.height?J=[u.x+u.width,u.y+u.height]:Q[0]==u.x&&Q[1]==u.y+u.height?J=[u.x,u.y+u.height]:(Q=[m.x,E.y])[0]==u.x&&Q[1]==u.y?J=[u.x,u.y]:Q[0]==u.x+u.width&&Q[1]==u.y?J=[u.x+u.width,u.y]:Q[0]==u.x+u.width&&Q[1]==u.y+u.height?J=[u.x+u.width,u.y+u.height]:Q[0]==u.x&&Q[1]==u.y+u.height&&(J=[u.x,u.y+u.height]);var Z=[u.x+u.width/2,u.y+u.height/2],$=[J[0]-Z[0],J[1]-Z[1]],tt=this.getVecNorm($);$[0]=$[0]/tt,$[1]=$[1]/tt,D=[J[0]+h*$[0],J[1]+h*$[1]]}for(var et=!1,it=0;it<s.length;it++)if(D[0]==s[it][0]&&D[1]==s[it][1]){et=!0;break}if(!et){var at;at=l[0]+1,s.splice(at,0,D);for(var rt=0;rt<n.length;rt++)n[rt].ids[0]>=at&&(n[rt].ids[0]=n[rt].ids[0]+1),n[rt].ids[1]>=at&&(n[rt].ids[1]=n[rt].ids[1]+1);n.push({start:i,end:D,ids:[l[0],at]}),n.push({start:D,end:a,ids:[at,l[1]+1]})}}}s.pop(),s.splice(0,1),this.edges[t].virtrualNodes=s}}},{key:"surfaceRoutingEdge",value:function(t){var e=this.pointData[t.start],i=this.pointData[t.end],a=this.pointData[t.start].cat,r=[];r.push([e.x,e.y]),r.push([i.x,i.y]);for(var s=[{start:[e.x,e.y],end:[i.x,i.y],ids:[0,1]}];s.length>0;){var n=5,h=!1,o=s.pop();e=o.start,i=o.end;var d=o.ids,l=this.findCrossingBetweenEdgeRect(e,i,a);if(0!=l.length){t.virtrual=!0;var g=l[0].points,c=l[0].rect,u=[[c.x,c.y],[c.x+c.width,c.y]],p=[[c.x,c.y+c.height],[c.x+c.width,c.y+c.height]],y=[[c.x,c.y],[c.x,c.y+c.height]],f=[[c.x+c.width,c.y],[c.x+c.width,c.y+c.height]],x=g[0],v=g[1],E=void 0;if(u[1][1]==x.y&&p[1][1]==v.y||p[1][1]==x.y&&u[1][1]==v.y||y[0][0]==x.x&&f[0][0]==v.x||y[0][0]==v.x&&f[0][0]==x.x){var m=-1;if(u[1][1]==x.y&&p[1][1]==v.y){var D=x.x-c.x,F=v.x-c.x;m=D+F<c.width?D>F?3:2:D<F?4:1}else if(p[1][1]==x.y&&u[1][1]==v.y){var b=v.x-c.x,k=x.x-c.x;m=b+k<c.width?b>k?3:2:b<k?4:1}else if(y[0][0]==x.x&&f[0][0]==v.x){var M=x.y-c.y,w=v.y-c.y;m=M+w<c.width?M>w?3:4:M<w?2:1}else if(y[0][0]==v.x&&f[0][0]==x.x){var I=v.y-c.y,P=x.y-c.y;m=I+P<c.width?I>P?3:4:I<P?2:1}for(var A=[],C=0,N=-1,B=-1;;){1==m?A=h?[c.x+c.width,c.y+c.height]:[c.x,c.y]:2==m?A=h?[c.x,c.y+c.height]:[c.x+c.width,c.y]:3==m?A=h?[c.x,c.y]:[c.x+c.width,c.y+c.height]:4==m&&(A=h?[c.x+c.width,c.y]:[c.x,c.y+c.height]);var S=[c.x+c.width/2,c.y+c.height/2],_=[A[0]-S[0],A[1]-S[1]],O=this.getVecNorm(_);if(_[0]=_[0]/O,_[1]=_[1]/O,E=[A[0]+n*_[0],A[1]+n*_[1]],this.checkVNodeInBound(E,a)){if(h||(n/=1.5),h=!h,(C+=1)>10)break}else if(h?N=E:B=E,h=!h,-1!=N&&-1!=B)break}if(-1==N&&-1==B){t.virtrual=!1;continue}if(-1!=N&&-1!=B){for(var j=Number.MAX_VALUE,V=null,L=[N,B],X=0;X<L.length;X++){for(var G=L[X],Y=0,U=0;U<this.edges.length;U++){var R=this.pointData[this.edges[U].start],T=this.pointData[this.edges[U].end];if(R.cat!=a){var W={x:e[0],y:e[1],cat:a},q={x:G[0],y:G[1],cat:a},z={x:i[0],y:i[1],cat:a};this.checkEdgeCrossing(R,T,W,q)&&(Y+=1),this.checkEdgeCrossing(R,T,q,z)&&(Y+=1)}}Y<j&&(j=Y,V=L[X])}E=V}else E=-1!=N?N:B}else{var H=[x.x,v.y],K=[];H[0]==c.x&&H[1]==c.y?K=[c.x,c.y]:H[0]==c.x+c.width&&H[1]==c.y?K=[c.x+c.width,c.y]:H[0]==c.x+c.width&&H[1]==c.y+c.height?K=[c.x+c.width,c.y+c.height]:H[0]==c.x&&H[1]==c.y+c.height?K=[c.x,c.y+c.height]:(H=[v.x,x.y])[0]==c.x&&H[1]==c.y?K=[c.x,c.y]:H[0]==c.x+c.width&&H[1]==c.y?K=[c.x+c.width,c.y]:H[0]==c.x+c.width&&H[1]==c.y+c.height?K=[c.x+c.width,c.y+c.height]:H[0]==c.x&&H[1]==c.y+c.height&&(K=[c.x,c.y+c.height]);var Q=[c.x+c.width/2,c.y+c.height/2],J=[K[0]-Q[0],K[1]-Q[1]],Z=this.getVecNorm(J);J[0]=J[0]/Z,J[1]=J[1]/Z,E=[K[0]+n*J[0],K[1]+n*J[1]]}for(var $=!1,tt=0;tt<r.length;tt++)if(E[0]==r[tt][0]&&E[1]==r[tt][1]){$=!0;break}if(!$){var et;et=d[0]+1,r.splice(et,0,E);for(var it=0;it<s.length;it++)s[it].ids[0]>=et&&(s[it].ids[0]=s[it].ids[0]+1),s[it].ids[1]>=et&&(s[it].ids[1]=s[it].ids[1]+1);s.push({start:e,end:E,ids:[d[0],et]}),s.push({start:E,end:i,ids:[et,d[1]+1]})}}}return r.pop(),r.splice(0,1),t.virtrualNodes=r,0==r.length&&(t.virtrual=!1),t}},{key:"hasLinked",value:function(t,e){for(var i=0;i<this.edges.length;i++){var a=this.edges[i];if(a.start==t&&a.end==e)return!0;if(a.start==e&&a.end==t)return!0}return!1}},{key:"addEdge",value:function(t,e,i){var a={start:t,end:e,weight:-1,cat:i,dis:-1,virtrual:!1,virtrualNodes:[],id:this.edges.length,isLocalTree:!1};a=this.surfaceRoutingEdge(a);for(var r=0,s=this.pointData[t],n=this.pointData[e],h=0;h<this.edges.length;h++){var o=this.pointData[this.edges[h].start],d=this.pointData[this.edges[h].end];o.cat!=s.cat&&o.cat!=n.cat&&this.checkEdgeCrossing(s,n,o,d)&&(r+=1)}var l=this.calDistance(s,n),g=this.calEdgeMess(s,n),c=Bt*r+St*l/this.maxDis+_t*g;a.score=c,this.edges.push(a),this.drawOneEdge(a.id)}},{key:"drawOneEdge",value:function(t){this.edges[t].SVGElement=[];var e=this.edges[t],i=this;var a=p.d().on("start",(function(){var t=parseInt(p.g(this).attr("edgeindex"));Yt=[];var e=Kt(i.edges[t]);e.startpoint=Kt(i.pointData[i.edges[t].start]),e.endpoint=Kt(i.pointData[i.edges[t].end]),e.flag=!1,Yt.push(e)})).on("drag",(function(t){var e=parseInt(p.g(this).attr("edgeindex")),a=parseInt(p.g(this).attr("segindex"));i.edges[e].virtrualNodes[a][0]=t.x,i.edges[e].virtrualNodes[a][1]=t.y;var r="#"+p.g(this).attr("id");p.h(r).attr("cx",t.x).attr("cy",t.y),p.h("line").filter((function(){return parseInt(p.g(this).attr("index"))==e&&parseInt(p.g(this).attr("segindex"))==a})).attr("x2",t.x).attr("y2",t.y),p.h("line").filter((function(){return parseInt(p.g(this).attr("index"))==e&&parseInt(p.g(this).attr("segindex"))==a+1})).attr("x1",t.x).attr("y1",t.y)})).on("end",(function(){var t=parseInt(p.g(this).attr("edgeindex")),e=Kt(i.edges[t]);e.id=t,e.flag=!0,Yt.push(e),i.setState({pointData:i.pointData}),i.setState({edges:i.edges}),i.child.bubbleState()&&i.child.editReDraw(Gt,Yt,i.pointData,i.edges),Gt=[],Yt=[]}));var r=p.d().on("start",(function(t){var e=parseInt(p.g(this).attr("index")),n=i.pointData[i.edges[e].start],h=i.pointData[i.edges[e].end];Yt=[];var o=Kt(i.edges[e]);if(o.startpoint=Kt(n),o.endpoint=Kt(h),o.flag=!1,Yt.push(o),p.h("line").filter((function(){return parseInt(p.g(this).attr("index"))==e})).attr("stroke","red"),"true"==p.g(this).attr("isvirtrual")){var d=parseInt(p.g(this).attr("segindex"));i.edges[e].virtrualNodes.splice(d,0,[t.x,t.y]),i.draggedEdgeIndex=e,i.draggedEdgeSeg=d}else i.edges[e].virtrual=!0,i.edges[e].virtrualNodes.push([t.x,t.y]),i.draggedEdgeIndex=e,i.draggedEdgeSeg=0;p.h("line").filter((function(){return parseInt(p.g(this).attr("index"))==e})).remove(),i.edges[e].SVGElement=[];for(var l=i.edges[e].virtrualNodes,g=[n.x,n.y],c=[],u=0;u<l.length;u++){c=l[u];var y=p.g(Lt).select("#edgeGroup").append("line").attr("x1",g[0]).attr("y1",g[1]).attr("x2",c[0]).attr("y2",c[1]).attr("stroke-width",2).attr("stroke","black").attr("index",e).attr("isvirtrual",!0).attr("segindex",u).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black")})).on("mousedown",s).call(r);p.g(Xt).select("#edgeGroup").append("line").attr("x1",g[0]).attr("y1",g[1]).attr("x2",c[0]).attr("y2",c[1]).attr("stroke-width",2).attr("stroke","black").attr("index",e).attr("isvirtrual",!0).attr("segindex",u).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black")})).on("mousedown",s).call(r),i.edges[e].SVGElement.push(y),g=c}var f=p.g(Lt).select("#edgeGroup").append("line").attr("x1",g[0]).attr("y1",g[1]).attr("x2",h.x).attr("y2",h.y).attr("stroke-width",2).attr("stroke","black").attr("index",e).attr("isvirtrual",!0).attr("segindex",l.length).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black")})).on("mousedown",s).call(r);p.g(Xt).select("#edgeGroup").append("line").attr("x1",g[0]).attr("y1",g[1]).attr("x2",h.x).attr("y2",h.y).attr("stroke-width",2).attr("stroke","black").attr("index",e).attr("isvirtrual",!0).attr("segindex",l.length).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black")})).on("mousedown",s).call(r),i.edges[e].SVGElement.push(f);for(var x=0;x<l.length;x++)p.g(Lt).select("#edgeGroup").append("circle").attr("class","controlPoints").attr("cx",l[x][0]).attr("cy",l[x][1]).attr("r",5).attr("fill","red").attr("opacity",0).attr("edgeindex",e).attr("segindex",x).attr("id","e"+e.toString()+"s"+x.toString()).on("mouseover",(function(){var t="#"+p.g(this).attr("id");p.h(t).attr("opacity",1)})).on("mouseout",(function(){var t="#"+p.g(this).attr("id");p.h(t).attr("opacity",0)})).call(a),p.g(Xt).select("#edgeGroup").append("circle").attr("class","controlPoints").attr("cx",l[x][0]).attr("cy",l[x][1]).attr("r",5).attr("fill","red").attr("opacity",0).attr("edgeindex",e).attr("segindex",x).attr("id","e"+e.toString()+"s"+x.toString()).on("mouseover",(function(){var t="#"+p.g(this).attr("id");p.h(t).attr("opacity",1)})).on("mouseout",(function(){var t="#"+p.g(this).attr("id");p.h(t).attr("opacity",0)})).call(a)})).on("drag",(function(t){if(-1!=i.draggedEdgeIndex){t.sourceEvent.stopPropagation();var e=i.draggedEdgeIndex,a=i.draggedEdgeSeg;i.edges[e].virtrualNodes[a][0]=t.x,i.edges[e].virtrualNodes[a][1]=t.y,p.h("line").filter((function(){var t=parseInt(p.g(this).attr("index")),e=parseInt(p.g(this).attr("segindex"));return t==i.draggedEdgeIndex&&e==i.draggedEdgeSeg})).attr("x2",t.x).attr("y2",t.y),p.h("line").filter((function(){var t=parseInt(p.g(this).attr("index")),e=parseInt(p.g(this).attr("segindex"));return t==i.draggedEdgeIndex&&e==i.draggedEdgeSeg+1})).attr("x1",t.x).attr("y1",t.y),p.h(".controlPoints").filter((function(){var t=parseInt(p.g(this).attr("edgeindex")),e=parseInt(p.g(this).attr("segindex"));return t==i.draggedEdgeIndex&&e==i.draggedEdgeSeg})).attr("cx",t.x).attr("cy",t.y)}})).on("end",(function(t){var e=i.draggedEdgeIndex,a=Kt(i.edges[e]);a.id=e,a.flag=!0,Yt.push(a),i.setState({pointData:i.pointData}),i.setState({edges:i.edges}),i.child.bubbleState()&&i.child.editReDraw(Gt,Yt,i.pointData,i.edges),Gt=[],Yt=[],i.draggedEdgeSeg=-1,i.draggedEdgeIndex=-1}));function s(t){if(2==t.button){i.setState({hasEdit:!0});var e=parseInt(p.g(this).attr("index")),a=i.edges[e].start,r=i.edges[e].end,s=Kt(i.edges[e]);for(var n in s.startpoint=Kt(i.pointData[a]),s.endpoint=Kt(i.pointData[r]),s.flag=!1,Yt.push(s),i.setState({pointData:i.pointData}),i.setState({edges:i.edges}),i.child.bubbleState()&&i.child.editReDraw(Gt,Yt,i.pointData,i.edges),Gt=[],Yt=[],i.deletedEdge.push([a,r]),i.deleteEdge(e),i.optimizeMST(!0),i.catPointDict)i.findCircle(n)}}var n=e.start,h=e.end;if(e.virtrual){for(var o,d=e.virtrualNodes,l=[this.pointData[n].x,this.pointData[n].y],g=0;g<d.length;g++){o=d[g];var c=p.g(Lt).select("#edgeGroup").append("line").attr("x1",l[0]).attr("y1",l[1]).attr("x2",o[0]).attr("y2",o[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",g).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2)})).on("mousedown",s).call(r);p.g(Xt).select("#edgeGroup").append("line").attr("x1",l[0]).attr("y1",l[1]).attr("x2",o[0]).attr("y2",o[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",g).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2)})).on("mousedown",s).call(r),l=o,this.edges[t].SVGElement.push(c)}o=[this.pointData[h].x,this.pointData[h].y];var u=p.g(Lt).select("#edgeGroup").append("line").attr("x1",l[0]).attr("y1",l[1]).attr("x2",o[0]).attr("y2",o[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",d.length).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2)})).on("mousedown",s).call(r);p.g(Xt).select("#edgeGroup").append("line").attr("x1",l[0]).attr("y1",l[1]).attr("x2",o[0]).attr("y2",o[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",d.length).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2)})).on("mousedown",s).call(r),this.edges[t].SVGElement.push(u);for(var y=0;y<d.length;y++)p.g(Lt).select("#edgeGroup").append("circle").attr("class","controlPoints").attr("cx",d[y][0]).attr("cy",d[y][1]).attr("r",5).attr("edgeindex",t).attr("segindex",y).attr("fill","red").attr("opacity",0).attr("id","e"+t.toString()+"s"+y.toString()).on("mouseover",(function(){var t="#"+p.g(this).attr("id");p.h(t).attr("opacity",1)})).on("mouseout",(function(){var t="#"+p.g(this).attr("id");p.h(t).attr("opacity",0)})).call(a),p.g(Xt).select("#edgeGroup").append("circle").attr("class","controlPoints").attr("cx",d[y][0]).attr("cy",d[y][1]).attr("r",5).attr("edgeindex",t).attr("segindex",y).attr("fill","red").attr("opacity",0).attr("id","e"+t.toString()+"s"+y.toString()).on("mouseover",(function(){var t="#"+p.g(this).attr("id");p.h(t).attr("opacity",1)})).on("mouseout",(function(){var t="#"+p.g(this).attr("id");p.h(t).attr("opacity",0)})).call(a)}else{var f=p.g(Lt).select("#edgeGroup").append("line").attr("x1",this.pointData[n].x).attr("y1",this.pointData[n].y).attr("x2",this.pointData[h].x).attr("y2",this.pointData[h].y).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!1).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2)})).on("mousedown",s).call(r);p.g(Xt).select("#edgeGroup").append("line").attr("x1",this.pointData[n].x).attr("y1",this.pointData[n].y).attr("x2",this.pointData[h].x).attr("y2",this.pointData[h].y).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!1).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==i})).attr("stroke","red")})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2)})).on("mousedown",s).call(r),this.edges[t].SVGElement.push(f)}}},{key:"applyEdit",value:function(){this.edges=this.tempEdges,this.deletedEdge=[],this.addedEdge=[],this.drawEdges(),this.setState({hasEdit:!1,edges:this.edges,pointData:this.pointData}),this.child.bubbleState()&&this.child.editReDraw([],Rt,this.pointData,this.edges),Rt=[]}},{key:"drawOneEdgeAfterEdit",value:function(t,e){t[e].SVGElement=[];var i=t[e],a=this,r=i.start,s=i.end;function n(e){if(2==e.button){var i=parseInt(p.g(this).attr("index"));p.h(".deleteOpEdge").filter((function(){return parseInt(p.g(this).attr("index"))==i})).remove();var r=t[i].start,s=t[i].end;a.deletedEdge.push([r,s]),a.optimizeMST(!0)}}if(i.virtrual){for(var h,o=i.virtrualNodes,d=[this.pointData[r].x,this.pointData[r].y],l=0;l<o.length;l++){h=o[l];p.g(Lt).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",d[0]).attr("y1",d[1]).attr("x2",h[0]).attr("y2",h[1]).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,3").attr("opacity",.5).attr("index",e).attr("isvirtrual",!0).attr("segindex",l).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.g(Lt).select("#edgeGroup").selectAll(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=p.g(this).attr("index");p.g(Lt).select("#edgeGroup").selectAll(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",n);p.g(Xt).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",d[0]).attr("y1",d[1]).attr("x2",h[0]).attr("y2",h[1]).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,3").attr("opacity",.5).attr("index",e).attr("isvirtrual",!0).attr("segindex",l).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",n),d=h}h=[this.pointData[s].x,this.pointData[s].y];p.g(Lt).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",d[0]).attr("y1",d[1]).attr("x2",h[0]).attr("y2",h[1]).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,3").attr("opacity",.5).attr("index",e).attr("isvirtrual",!0).attr("segindex",o.length).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",n);p.g(Xt).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",d[0]).attr("y1",d[1]).attr("x2",h[0]).attr("y2",h[1]).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,3").attr("opacity",.5).attr("index",e).attr("isvirtrual",!0).attr("segindex",o.length).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",n)}else{p.g(Lt).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",this.pointData[r].x).attr("y1",this.pointData[r].y).attr("x2",this.pointData[s].x).attr("y2",this.pointData[s].y).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,2").attr("opacity",.5).attr("index",e).attr("isvirtrual",!1).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",n);p.g(Xt).select("#edgeGroup").append("line").attr("class","deleteOpEdge").attr("x1",this.pointData[r].x).attr("y1",this.pointData[r].y).attr("x2",this.pointData[s].x).attr("y2",this.pointData[s].y).attr("stroke-width",5).attr("stroke","red").attr("stroke-dasharray","5,2").attr("opacity",.5).attr("index",e).attr("isvirtrual",!1).on("mouseover",(function(t,e){var i=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==i})).attr("opacity",1)})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h(".deleteOpEdge").filter((function(){return p.g(this).attr("index")==t})).attr("opacity",.5)})).on("mousedown",n)}}},{key:"checkCircle",value:function(t){for(var e=[],i={},a=0;a<this.edges.length;a++)if(this.edges[a].cat==t){e.push(this.edges[a]);var r=this.edges[a].start,s=this.edges[a].end;i.hasOwnProperty(r)||(i[r]=[]),i[r].push(a),i.hasOwnProperty(s)||(i[s]=[]),i[s].push(a)}for(var n=!1;!n;)for(var h in n=!0,i)if(1==i[h].length){n=!1;for(var o=i[h][0],d=this.edges[o].start,l=this.edges[o].end,g=0;g<i[d].length;g++)if(i[d][g]==o){i[d].splice(g,1);break}for(var c=0;c<i[l].length;c++)if(i[l][c]==o){i[l].splice(c,1);break}}var u=[];for(var h in i)if(i[h].length>0)for(var p=0;p<i[h].length;p++){for(var y=i[h][p],f=!1,x=0;x<u.length;x++)if(u[x]==y){f=!0;break}f||u.push(y)}return u}},{key:"findCircle",value:function(t){var e=this,i=e.checkCircle(t);if(i.length>0){for(var a=[],r=0;r<i.length;r++){var s=i[r],n=e.pointData[e.edges[s].start],h=e.pointData[e.edges[s].end],o=0;if(e.isAdded(e.edges[s].start,e.edges[s].end))a.push(-1);else{for(var d=0;d<e.edges.length;d++){var l=e.pointData[e.edges[d].start],g=e.pointData[e.edges[d].end];l.cat!=n.cat&&l.cat!=h.cat&&e.checkEdgeCrossing(n,h,l,g)&&(o+=1)}var c=e.calDistance(n,h),u=e.calEdgeMess(n,h),y=Bt*o+St*c/e.maxDis+_t*u;a.push(y)}}for(var f=-1,x=-100,v=0;v<a.length;v++)a[v]>x&&(x=a[v],f=v);var E=e.edges[i[f]];p.h("line").filter((function(){return parseInt(p.g(this).attr("index"))==E.id})).attr("stroke","red").attr("stroke-width",5)}}},{key:"drawPointData",value:function(){var t=this;It=this.props.colorArray,this.setState({colorArray:It}),p.h("circle").remove(),p.h("rect").remove(),p.g(Lt).call(p.i().extent([[pt,yt],[ft,xt]]).scaleExtent([1,8]).on("zoom",(function(t){var e=t.transform;p.h("g").attr("transform",e)})));var e=this;var i=p.d().on("start",(function(){var t=parseInt(p.g(this).attr("index"));e.draggedIndex=t,vt={},Ut=[];for(var i=0;i<e.edges.length;i++){var a=e.edges[i].start,r=e.edges[i].end;e.edges[i].new=!1,e.edges[i].rerouting=!1,e.edges[i].startpoint=Kt(e.pointData[a]),e.edges[i].endpoint=Kt(e.pointData[r]),vt.hasOwnProperty(a)||(vt[a]={}),vt[a][r]=i,Ut.push(Kt(e.edges[i]))}var s=Kt(e.pointData[t]);s,s.flag=!1,Gt.push(s);var n="#"+p.g(this).attr("id");p.h(n).attr("stroke","red")})).on("drag",(function(t){p.g(Lt);var i=parseInt(p.g(this).attr("index"));if("circle"==e.itemShape){var a="#"+p.g(this).attr("id");p.h(a).attr("cx",t.x).attr("cy",t.y)}else{var r=e.pointData[i].width,s=e.pointData[i].height,n="#"+p.g(this).attr("id");p.h(n).attr("x",t.x-.5*r).attr("y",t.y-.5*s)}e.pointData[i].x=t.x,e.pointData[i].y=t.y;for(var h=[],o=[],d=e.pointData[i].cat,l=0;l<e.edges.length;l++){var g=e.pointData[e.edges[l].start],c=e.pointData[e.edges[l].end],u=k(t.x,t.y,g.x,g.y,c.x,c.y);e.edges[l].start==i||e.edges[l].end==i||d==e.edges[l].cat&&u>=0&&u<2*At?h.push(l):d!=e.edges[l].cat&&u>=0&&u<2*At&&o.push(l)}for(var y=0;y<h.length;y++){e.deleteEdge(h[y]);for(var f=y+1;f<h.length;f++)h[y]<h[f]&&(h[f]=h[f]-1);for(var x=y+1;x<o.length;x++)h[y]<o[x]&&(o[x]=o[x]-1)}e.optimizeMST(!1);for(var v=function(t){var i=Kt(e.edges[o[t]]);i.startpoint=Kt(e.pointData[i.start]),i.endpoint=Kt(e.pointData[i.end]),i.flag=!1,e.edges[o[t]].preEdge=Kt(i),e.edges[o[t]].new=!0,e.edges[o[t]].rerouting=!0,e.surfaceRoutingEdge(e.edges[o[t]]),p.h("line").filter((function(){return parseInt(p.g(this).attr("index"))==o[t]})).remove(),p.h(".controlPoints").filter((function(){return parseInt(p.g(this).attr("edgeindex"))==o[t]})).remove(),e.drawOneEdge(o[t])},E=0;E<o.length;E++)v(E)})).on("end",(function(){var t=parseInt(p.g(this).attr("index")),i="#"+p.g(this).attr("id");p.h(i).attr("stroke","none");var a=Kt(e.pointData[t]);a.id=t,a.flag=!0,Gt.push(a),Yt=[],Et={};for(var r=0;r<e.edges.length;r++){var s=e.edges[r].start,n=e.edges[r].end;Et.hasOwnProperty(s)||(Et[s]={}),Et[s][n]=r;var h=Kt(e.edges[r].virtrualNodes);h.length>0&&h.sort((function(t,e){return t[0]-e[0]}));var o=!0,d=!0;if(vt.hasOwnProperty(s)&&vt[s].hasOwnProperty(n)){d=!1;var l=vt[s][n],g=e.pointData[s],c=e.pointData[n],u=Ut[l].startpoint,y=Ut[l].endpoint;if(parseInt(g.x)==parseInt(u.x)&&parseInt(g.y)==parseInt(u.y)&&parseInt(c.x)==parseInt(y.x)&&parseInt(c.y)==parseInt(y.y)){var f=Kt(Ut[l].virtrualNodes);if(h.length==f.length){f.length>0&&f.sort((function(t,e){return t[0]-e[0]}));for(var x=0;x<f.length;x++)if(parseInt(h[x][0])!=parseInt(f[x][0])||parseInt(h[x][1])!=parseInt(f[x][1])){o=!1;break}}else o=!1}else o=!1}if(o){if(vt.hasOwnProperty(n)&&vt[n].hasOwnProperty(s)){d=!1;var v=vt[n][s],E=e.pointData[s],m=e.pointData[n],D=Ut[v].endpoint,F=Ut[v].startpoint;if(parseInt(E.x)==parseInt(D.x)&&parseInt(E.y)==parseInt(D.y)&&parseInt(m.x)==parseInt(F.x)&&parseInt(m.y)==parseInt(F.y)){var b=Kt(Ut[v].virtrualNodes);if(h.length==b.length){b.length>0&&b.sort((function(t,e){return t[0]-e[0]}));for(var k=0;k<b.length;k++)if(parseInt(h[k][0])!=parseInt(b[k][0])||parseInt(h[k][1])!=parseInt(b[k][1])){o=!1;break}}else o=!1}else o=!1}if(!o||d){var M=Kt(e.edges[r]);M.id=r,M.flag=!0,Yt.push(M)}}else{var w=Kt(e.edges[r]);w.id=r,w.flag=!0,Yt.push(w)}}for(var I=0;I<Ut.length;I++){var P=Ut[I].start,A=Ut[I].end,C=Kt(Ut[I].virtrualNodes);C.length>0&&C.sort((function(t,e){return t[0]-e[0]}));var N=!0,B=!0;if(Et.hasOwnProperty(P)&&Et[P].hasOwnProperty(A)){B=!1;var S=Et[P][A],_=Ut[I].startpoint,O=Ut[I].endpoint,j=e.pointData[P],V=e.pointData[A];if(parseInt(_.x)==parseInt(j.x)&&parseInt(_.y)==parseInt(j.y)&&parseInt(O.x)==parseInt(V.x)&&parseInt(O.y)==parseInt(V.y)){var L=Kt(e.edges[S].virtrualNodes);if(C.length==L.length){L.length>0&&L.sort((function(t,e){return t[0]-e[0]}));for(var X=0;X<L.length;X++)if(parseInt(C[X][0])!=parseInt(L[X][0])||parseInt(C[X][1])!=parseInt(L[X][1])){N=!1;break}}else N=!1}else N=!1}if(N){if(Et.hasOwnProperty(A)&&Et[A].hasOwnProperty(P)){B=!1;var G=Et[A][P],Y=Ut[I].startpoint,U=Ut[I].endpoint,R=e.pointData[P],T=e.pointData[A];if(parseInt(Y.x)==parseInt(R.x)&&parseInt(Y.y)==parseInt(R.y)&&parseInt(U.x)==parseInt(T.x)&&parseInt(U.y)==parseInt(T.y)){var W=Kt(e.edges[G].virtrualNodes);if(C.length==W.length){W.length>0&&W.sort((function(t,e){return t[0]-e[0]}));for(var q=0;q<W.length;q++)if(parseInt(C[q][0])!=parseInt(W[q][0])||parseInt(C[q][1])!=parseInt(W[q][1])){N=!1;break}}else N=!1}else N=!1}if(!N||B){var z=Kt(Ut[I]);z.flag=!1,Yt.push(z)}}else{var H=Kt(Ut[I]);H.flag=!1,Yt.push(H)}}e.setState({pointData:e.pointData}),e.setState({edges:e.edges}),e.child.bubbleState()&&e.child.editReDraw(Gt,Yt,e.pointData,e.edges),Gt=[],Yt=[]}));function a(t){if(2!=t.button||e.props.isedit){if(2==t.button&&e.props.isedit){for(var i=parseInt(p.g(t.path[0]).attr("index")),a=e.pointData[i].catArray,r=0;r<a.length;r++)for(var s=a[r],n=0;n<e.catPointDict[s].length;n++)if(e.catPointDict[s][n].id==i){e.catPointDict[s].splice(n,1);break}for(var h=e.edges.length-1;h>=0;h--){var o=e.edges[h].start,d=e.edges[h].end;(o==i||d==i)&&e.edges.splice(h,1)}e.pointData.splice(i,1),p.h("#edgeGroup").remove(),p.h("#pointGroup").remove();for(var l=0;l<e.pointData.length;l++)e.pointData[l].id>i&&(e.pointData[l].id-=1);for(var g=0;g<e.edges.length;g++)e.edges[g].start>i&&(e.edges[g].start-=1),e.edges[g].end>i&&(e.edges[g].end-=1);e.drawPointData(),e.drawEdges(),e.setState({pointData:e.pointData}),e.setState({edges:e.edges})}}else{var c=parseInt(p.g(this).attr("index"));if(-1==e.lastClickIndex){e.lastClickIndex=c,e.lastClickItem=p.g(this).attr("stroke","red").attr("stroke-width",5).attr("selected",!0);var u="#"+p.g(this).attr("id");p.h(u).attr("stroke","red").attr("stroke-width",5).attr("selected",!0)}else if(c==e.lastClickIndex){e.lastClickIndex=-1,e.lastClickItem=null,p.g(this).attr("stroke","red").attr("stroke-width",1).attr("selected",!1);var y="#"+p.g(this).attr("id");p.h(y).attr("stroke","red").attr("stroke-width",1).attr("selected",!1)}else{var f=e.lastClickItem.attr("category");if(f==p.g(this).attr("category")){if(!e.hasLinked(e.lastClickIndex,c)){e.addEdge(e.lastClickIndex,c,f),e.addedEdge.push([e.lastClickIndex,c]);var x=Kt(e.edges[e.edges.length-1]);x.id=e.edges.length-1,x.flag=!0,Yt.push(x),e.setState({pointData:e.pointData}),e.setState({edges:e.edges}),e.child.bubbleState()&&e.child.editReDraw(Gt,Yt,e.pointData,e.edges),Gt=[],Yt=[],e.findCircle(f)}e.lastClickItem.attr("stroke-width",1).attr("stroke","none").attr("selected",!1);var v="#"+e.lastClickItem.attr("id");p.h(v).attr("stroke-width",1).attr("stroke","none").attr("selected",!1),e.lastClickItem=null,e.lastClickIndex=-1,e.optimizeMST(!0)}else{e.lastClickItem.attr("stroke-width",1).attr("stroke","none").attr("selected",!1);var E="#"+e.lastClickItem.attr("id");p.h(E).attr("stroke-width",1).attr("stroke","none").attr("selected",!1),E="#"+p.g(this).attr("id"),e.lastClickItem=p.g(this).attr("stroke","red").attr("stroke-width",5).attr("selected",!0).attr("id",p.g(this).attr("id")),p.h(E).attr("stroke","red").attr("stroke-width",5).attr("selected",!0),e.lastClickIndex=c}}}}var r=[];if(p.g(Lt).append("g").attr("id","pointGroup"),p.g(Xt).append("g").attr("id","pointGroup"),"circle"==this.itemShape){for(var s=function(r){var s=r;p.g(Lt).select("#pointGroup").append("circle").attr("class","dataPoint").attr("id","point"+s).attr("cx",t.pointData[r].x).attr("cy",t.pointData[r].y).attr("r",t.pointData[r].radius).attr("fill",(function(t,i){return It[e.pointData[s].catArray[e.pointData[s].catArray.length-1]]})).attr("category",t.pointData[r].cat).attr("index",s).on("mouseover",(function(t,e){p.g(this).attr("stroke","red")})).on("mouseout",(function(){"true"!=p.g(this).attr("selected")&&p.g(this).attr("stroke","none")})).on("mousedown",a).call(i),p.g(Xt).select("#pointGroup").append("circle").attr("class","dataPoint").attr("id","point"+s).attr("cx",t.pointData[r].x).attr("cy",t.pointData[r].y).attr("r",t.pointData[r].radius).attr("fill",(function(t,i){return It[e.pointData[s].catArray[e.pointData[s].catArray.length-1]]})).attr("category",t.pointData[r].cat).attr("index",s).on("mouseover",(function(t,e){p.g(this).attr("stroke","red")})).on("mouseout",(function(){"true"!=p.g(this).attr("selected")&&p.g(this).attr("stroke","none")})).on("mousedown",a).call(i)},n=0;n<this.pointData.length;n++)s(n);r=document.getElementsByClassName("dataPoint");for(var h=0;h<r.length;h++)this.itemBBox.push({id:r[h].getAttribute("index"),bbox:r[h].getBBox()})}else if("rectangle"==this.itemShape){for(var o=function(r){var s=r;p.g(Lt).select("#pointGroup").append("rect").attr("class","dataPoint").attr("id","point"+s).attr("x",t.pointData[r].x-t.pointData[r].width/2).attr("y",t.pointData[r].y-t.pointData[r].height/2).attr("width",t.pointData[r].width).attr("height",t.pointData[r].height).attr("fill",(function(){return It[e.pointData[s].catArray[e.pointData[s].catArray.length-1]]})).attr("category",t.pointData[r].cat).attr("index",s).on("mouseover",(function(t,e){p.g(this).attr("stroke","red")})).on("mouseout",(function(){"true"!=p.g(this).attr("selected")&&p.g(this).attr("stroke","none")})).on("mousedown",a).call(i),p.g(Xt).select("#pointGroup").append("rect").attr("class","dataPoint").attr("id","point"+s).attr("x",t.pointData[r].x-t.pointData[r].width/2).attr("y",t.pointData[r].y-t.pointData[r].height/2).attr("width",t.pointData[r].width).attr("height",t.pointData[r].height).attr("fill",(function(){return It[e.pointData[s].catArray[e.pointData[s].catArray.length-1]]})).attr("category",t.pointData[r].cat).attr("index",s).on("mouseover",(function(t,e){p.g(this).attr("stroke","red")})).on("mouseout",(function(){"true"!=p.g(this).attr("selected")&&p.g(this).attr("stroke","none")})).on("mousedown",a).call(i)},d=0;d<this.pointData.length;d++)o(d);r=document.getElementsByClassName("dataPoint");for(var l=0;l<r.length;l++)this.itemBBox.push({id:r[l].getAttribute("index"),bbox:r[l].getBBox()})}}},{key:"countEdgeCrossingWithRouting",value:function(){for(var t=0;t<this.edges.length;t++){var e=[],i=this.pointData[this.edges[t].start],a=this.pointData[this.edges[t].end];if(this.edges[t].virtrual){var r=this.edges[t].virtrualNodes;e.push([i.x,i.y]);for(var s=0;s<r.length;s++)e.push(r[s]);e.push([a.x,a.y])}else e.push([i.x,i.y]),e.push([a.x,a.y]);for(var n=t+1;n<this.edges.length;n++){var h=[],o=this.pointData[this.edges[n].start],d=this.pointData[this.edges[n].end];if(i.cat!=o.cat){if(this.edges[n].virtrual){var l=this.edges[n].virtrualNodes;h.push([o.x,o.y]);for(var g=0;g<l.length;g++)h.push(l[g]);h.push([d.x,d.y])}else h.push([o.x,o.y]),h.push([d.x,d.y]);for(var c=0;c<e.length-1;c++)for(var u={x:e[c][0],y:e[c][1]},p={x:e[c+1][0],y:e[c+1][1]},y=0;y<h.length-1;y++){var f={x:h[y][0],y:h[y][1]},x={x:h[y+1][0],y:h[y+1][1]};this.checkEdgeCrossing(u,p,f,x)&&1}}}}}},{key:"countEdgeCrossing",value:function(){for(var t=0;t<this.edges.length;t++)for(var e=this.pointData[this.edges[t].start],i=this.pointData[this.edges[t].end],a=t+1;a<this.edges.length;a++){var r=this.pointData[this.edges[a].start],s=this.pointData[this.edges[a].end];e.cat!=r.cat&&this.checkEdgeCrossing(e,i,r,s)&&1}}},{key:"createLocalTree",value:function(t){for(var e=0,i=0,a=0;a<t.length;a++)e+=t[a].x,i+=t[a].y;for(var r={x:e/=t.length,y:i/=t.length},s=Number.MAX_VALUE,n=-1,h=0;h<t.length;h++){var o=this.calDistance(r,t[h]);o<s&&(s=o,n=h)}for(var d=0;d<t.length;d++)d!=n&&(this.edges.push({start:t[n].id,end:t[d].id,virtrual:!1,virtrualNodes:[],cat:t[d].cat,isLocalTree:!0}),this.graph.addEdge(t[n].id,t[d].id))}},{key:"initWithNoCluster",value:function(){for(var t in this.catPointDict){this.clusterDict[t]=[];for(var e=0;e<this.catPointDict[t].length;e++)this.clusterDict[t].push([this.catPointDict[t][e]])}}},{key:"generateTreeWithHierarchical",value:function(){this.initWithNoCluster();for(var t=[],e=0;e<this.edges.length;e++){for(var i=this.pointData[this.edges[e].start],a=this.pointData[this.edges[e].end],r=i.cat,s=this.clusterDict[r],n=-1,h=-1,o=0;o<s.length;o++){for(var d=0;d<s[o].length&&(s[o][d].id==i.id&&(n=o),s[o][d].id==a.id&&(h=o),-1==n||-1==h);d++);if(-1!=n&&-1!=h)break}if(-1!=n&&-1!=h&&n!=h){for(var l=s[n],g=0;g<s[h].length;g++)l.push(s[h][g]);for(var c=[],u=0;u<s.length;u++)u!=n&&u!=h&&c.push(s[u]);c.push(l),this.clusterDict[r]=c,t.push([r,c.length-1])}}for(var p in this.createGraphWithCluster(),this.clusterDict){this.clustergraphInfo[p]={edgesnum:0,nodesnum:this.clusterDict[p].length};for(var y=0;y<this.clusterDict[p].length;y++){for(var f=!1,x=0;x<t.length;x++){var v=t[x][0],E=t[x][1];p==v&&E==y&&(f=!0)}f||this.createLocalTree(this.clusterDict[p][y])}}this.drawEdges(),this.hierarchicalMergeV2()}},{key:"findCluster",value:function(){for(var t in this.catPointDict){for(var e=new Nt.DBSCAN,i=[],a=[],r=0;r<this.catPointDict[t].length;r++)i.push([this.catPointDict[t][r].x,this.catPointDict[t][r].y]),a.push(this.pointData[this.catPointDict[t][r].id]);if(i.length>0){this.clusterDict[t]=[],this.noiseDict[t]=[];for(var s=e.run(i,Ct,2),n=0;n<s.length;n++){for(var h=[],o=0;o<s[n].length;o++)h.push(a[s[n][o]]);this.clusterDict[t].push(h)}for(var d=0;d<e.noise.length;d++)this.clusterDict[t].push([a[e.noise[d]]])}}}},{key:"createGraph",value:function(){}},{key:"createGraphWithCluster",value:function(){var t=[],e=0;for(var i in this.clusterDict)for(var a=0;a<this.clusterDict[i].length;a++)t.push({points:this.clusterDict[i][a],cat:i,id:e}),this.clusterDict[i][a].id=e,e+=1;this.clusterArr=t;for(var r=new Pt.Graph(this.clusterArr.length),s=0;s<r.V;s++)r.node(s).label=this.clusterArr[s].cat;this.clustergraph=r;for(var n=new Pt.Graph(this.pointData.length),h=0;h<n.V;h++)n.node(h).label=this.pointData[h].cat;this.graph=n;for(var o=0;o<this.edges.length;o++)this.graph.addEdge(this.edges[o].start,this.edges[o].end)}},{key:"calClusterDistance",value:function(t,e){for(var i=Number.MAX_VALUE,a=0;a<t.length;a++)for(var r=0;r<e.length;r++){var s=this.calDistance(t[a],e[r]);s<i&&(i=s)}return i}},{key:"sortEdgesGlobalWithCluster",value:function(){var t=[],e=[],i=[],a=Number.MIN_VALUE;for(var r in this.clusterDict)for(var s=0;s<this.clusterDict[r].length;s++)for(var n=s+1;n<this.clusterDict[r].length;n++){var h=this.calClusterDistance(this.clusterDict[r][s],this.clusterDict[r][n]);e.push(h),h>a&&(a=h),i.push([this.clusterDict[r][s].id,this.clusterDict[r][n].id,h])}this.maxDistance=a;for(var o=0;o<i.length;o++){var d=i[o][0],l=i[o][1],g=i[o][2]/a,c=g;t.push([d,l,c,g])}return t.sort((function(t,e){return t[2]-e[2]})),t}},{key:"findLinkBetweenCluster",value:function(t,e){for(var i=Number.MAX_VALUE,a=null,r=null,s=!1,n=0;n<t.length;n++)for(var h=t[n],o=0;o<e.length;o++){var d=e[o];if(!this.checkNewEdge(h,d)){s=!0;var l=this.calDistance(h,d);l<i&&(i=l,a=h,r=d)}}return[s,a,r,i]}},{key:"findOptimalLink",value:function(t,e){for(var i=Number.MAX_VALUE,a=null,r=null,s=Number.MAX_VALUE,n=0;n<t.length;n++)for(var h=t[n],o=0;o<e.length;o++){for(var d=e[o],l=0,g=0;g<this.edges.length;g++){var c=this.pointData[this.edges[g].start],u=this.pointData[this.edges[g].end];c.cat!=h.cat&&c.cat!=d.cat&&this.checkEdgeCrossing(h,d,c,u)&&(l+=1)}var p=this.calDistance(h,d),y=this.calEdgeMess(h,d);l>Ot&&(Ot=l);var f=Bt*l+St*p/this.maxDis+_t*y;f<i&&(a=h,r=d,i=f),p<jt&&f<s&&(h,d,s=f,!0)}return[a,r,i,this.calDistance(a,r)]}},{key:"findMinScoreTest",value:function(t){for(var e=Number.MAX_VALUE,i=-1,a=Number.MAX_VALUE,r=-1,s=!1,n=t.length-1;n>=0;n--){var h=t[n].clusterid1,o=t[n].clusterid2;this.checkConnectBetweenTwoCluster(h,o)||(t[n].score<e&&(e=t[n].score,i=n),t[n].distance<jt&&t[n].score<a&&(a=t[n].score,r=n,s=!0))}return s?t[r]:t[i]}},{key:"findMinScore",value:function(t){for(var e=Number.MAX_VALUE,i=-1,a=Number.MAX_VALUE,r=-1,s=!1,n=0;n<t.length;n++)t[n].score<e&&(e=t[n].score,i=n),t[n].distance<jt&&t[n].score<a&&(a=t[n].score,r=n,s=!0);return s?t[r]:t[i]}},{key:"findCrossingBetweenEdgeRect",value:function(t,e,i){for(var a=[],r={x:t[0],y:t[1]},s={x:e[0],y:e[1]},n=0;n<this.itemBBox.length;n++){var h=parseInt(this.itemBBox[n].id);if(i!=this.pointData[h].cat){var o=kt.rectangle({top:this.itemBBox[n].bbox.y,left:this.itemBBox[n].bbox.x,width:this.itemBBox[n].bbox.width,height:this.itemBBox[n].bbox.height}),d=kt.line([r.x,r.y],[s.x,s.y]),l=Mt.intersect(o,d);if("Intersection"==l.status&&l.points.length>1){a.push({rect:this.itemBBox[n].bbox,points:l.points});break}}}return a}},{key:"checkVNodeInBound",value:function(t,e){for(var i=0;i<this.itemBBox.length;i++){var a=parseInt(this.itemBBox[i].id);if(e!=this.pointData[a].cat)if(wt.pointInRectangle({x:t[0],y:t[1]},{x:this.itemBBox[i].bbox.x,y:this.itemBBox[i].bbox.y},{x:this.itemBBox[i].bbox.x+this.itemBBox[i].bbox.width,y:this.itemBBox[i].bbox.y+this.itemBBox[i].bbox.height}))return!0}return!1}},{key:"isAdded",value:function(t,e){for(var i=0;i<this.addedEdge.length;i++)if(this.addedEdge[i][0]==t&&this.addedEdge[i][1]==e||this.addedEdge[i][0]==e&&this.addedEdge[i][1]==t)return!0;return!1}},{key:"isDeleted",value:function(t,e){for(var i=0;i<this.deletedEdge.length;i++)if(this.deletedEdge[i][0]==t&&this.deletedEdge[i][1]==e||this.deletedEdge[i][0]==e&&this.deletedEdge[i][1]==t)return!0;return!1}},{key:"addLinksTest",value:function(t,e,i,a,r,s){for(var n=0;n<a.length;n++)for(var h=a[n],o=0;o<r.length;o++){var d=r[o],l=this.calDistance(h,d),g=this.calEdgeMess(h,d),c={clusterid1:t,clusterid2:e,start:h,end:d,score:0*Bt+St*l/this.maxDis+_t*g,distance:l,cat:i,idx:this.idx,pid:-1};s.push(c),this.idx++}}},{key:"addLinks",value:function(t,e,i,a,r,s,n){for(var h=0;h<a.length;h++)for(var o=a[h],d=0;d<r.length;d++){for(var l=r[d],g=0,c=0;c<this.edges.length;c++){var u=this.pointData[this.edges[c].start],p=this.pointData[this.edges[c].end];u.cat!=o.cat&&u.cat!=l.cat&&this.checkEdgeCrossing(o,l,u,p)&&(g+=1)}var y=this.calDistance(o,l),f=this.calEdgeMess(o,l),x={clusterid1:t,clusterid2:e,start:o,end:l,score:Bt*g+St*y/this.maxDis+_t*f,distance:y,cat:i,idx:this.idx,pid:-1};this.isDeleted(o.id,l.id)?(x.score=Number.MAX_VALUE,n._d[this.idx]=x,n.enq(this.idx),this.idx++):this.isAdded(o.id,l.id)?(x.score=-1,s._d[this.idx]=x,s.enq(this.idx),this.idx++):y<jt?(s._d[this.idx]=x,s.enq(this.idx),this.idx++):(n._d[this.idx]=x,n.enq(this.idx),this.idx++)}}},{key:"findBestLink",value:function(t){for(var e,i=Number.MAX_VALUE,a=t.length-1;a>=0;a--){var r=t[a].clusterid1,s=t[a].clusterid2;this.checkConnectBetweenTwoClusterV2(r,s)?t.splice(a,1):i>t[a].score&&(e=t[a],i=t[a].score)}return e}},{key:"recalculateSpanningTreeAfterEdit",value:function(t){var e=[];_t=this.pointData.length<150?0:1,this.f=[];var i=0;for(var a in this.clusterDict)i+=this.clusterDict[a].length;for(var r=0;r<=i;r++)this.f.push(r);var s=new Vt({}),n=new Vt({});for(var h in this.clusterDict)for(var o=0;o<this.clusterDict[h].length;o++)for(var d=this.clusterDict[h][o].id,l=o+1;l<this.clusterDict[h].length;l++){var g=this.clusterDict[h][l].id;this.addLinks(d,g,h,this.clusterDict[h][o],this.clusterDict[h][l],s,n)}for(;!this.checkConnectBetweenAllCluster();){var c=void 0;if(s.isEmpty()){if(n.isEmpty())break;c=n._d[n.deq()]}else c=s._d[s.deq()];this.unionFather(c.clusterid1,c.clusterid2),s.modify_Kruskal_V2(c.start,c.end,this.f,Bt),n.modify_Kruskal_V2(c.start,c.end,this.f,Bt),this.clustergraph.addEdge(c.clusterid1,c.clusterid2),this.clustergraphInfo[c.cat].edgesnum+=1,t.push({start:c.start.id,end:c.end.id,weight:c.score,cat:c.cat,dis:c.score,virtrual:!1,virtrualNodes:[],isLocalTree:!1}),this.graph.addEdge(c.start.id,c.end.id);var u=this.pointData[c.start.id],p=this.pointData[c.end.id],y=this.pointData[c.start.id].cat,f=[];f.push([u.x,u.y]),f.push([p.x,p.y]);for(var x=[{start:[u.x,u.y],end:[p.x,p.y],ids:[0,1]}];x.length>0;){var v=5,E=!1,m=x.pop();u=m.start,p=m.end;var D=m.ids,F=this.findCrossingBetweenEdgeRect(u,p,y);if(0!=F.length){t[t.length-1].virtrual=!0;var b=F[0].points,k=F[0].rect,M=[[k.x,k.y],[k.x+k.width,k.y]],w=[[k.x,k.y+k.height],[k.x+k.width,k.y+k.height]],I=[[k.x,k.y],[k.x,k.y+k.height]],P=[[k.x+k.width,k.y],[k.x+k.width,k.y+k.height]],A=b[0],C=b[1],N=void 0;if(M[1][1]==A.y&&w[1][1]==C.y||w[1][1]==A.y&&M[1][1]==C.y||I[0][0]==A.x&&P[0][0]==C.x||I[0][0]==C.x&&P[0][0]==A.x){var B=-1;if(M[1][1]==A.y&&w[1][1]==C.y){var S=A.x-k.x,_=C.x-k.x;B=S+_<k.width?S>_?3:2:S<_?4:1}else if(w[1][1]==A.y&&M[1][1]==C.y){var O=C.x-k.x,j=A.x-k.x;B=O+j<k.width?O>j?3:2:O<j?4:1}else if(I[0][0]==A.x&&P[0][0]==C.x){var V=A.y-k.y,L=C.y-k.y;B=V+L<k.width?V>L?3:4:V<L?2:1}else if(I[0][0]==C.x&&P[0][0]==A.x){var X=C.y-k.y,G=A.y-k.y;B=X+G<k.width?X>G?3:4:X<G?2:1}for(var Y=[],U=0,R=-1,T=-1;;){1==B?Y=E?[k.x+k.width,k.y+k.height]:[k.x,k.y]:2==B?Y=E?[k.x,k.y+k.height]:[k.x+k.width,k.y]:3==B?Y=E?[k.x,k.y]:[k.x+k.width,k.y+k.height]:4==B&&(Y=E?[k.x+k.width,k.y]:[k.x,k.y+k.height]);var W=[k.x+k.width/2,k.y+k.height/2],q=[Y[0]-W[0],Y[1]-W[1]],z=this.getVecNorm(q);if(q[0]=q[0]/z,q[1]=q[1]/z,N=[Y[0]+v*q[0],Y[1]+v*q[1]],this.checkVNodeInBound(N,y)){if(E||(v/=1.5),E=!E,(U+=1)>10)break}else if(E?R=N:T=N,E=!E,-1!=R&&-1!=T)break}if(-1==R&&-1==T){t[t.length-1].virtrual=!1;continue}if(-1!=R&&-1!=T){for(var H=Number.MAX_VALUE,K=null,Q=[R,T],J=0;J<Q.length;J++){for(var Z=Q[J],$=0,tt=0;tt<t.length;tt++){var et=this.pointData[t[tt].start],it=this.pointData[t[tt].end];if(et.cat!=y){var at={x:u[0],y:u[1],cat:y},rt={x:Z[0],y:Z[1],cat:y},st={x:p[0],y:p[1],cat:y};this.checkEdgeCrossing(et,it,at,rt)&&($+=1),this.checkEdgeCrossing(et,it,rt,st)&&($+=1)}}$<H&&(H=$,K=Q[J])}N=K}else N=-1!=R?R:T}else{var nt=[A.x,C.y],ht=[];nt[0]==k.x&&nt[1]==k.y?ht=[k.x,k.y]:nt[0]==k.x+k.width&&nt[1]==k.y?ht=[k.x+k.width,k.y]:nt[0]==k.x+k.width&&nt[1]==k.y+k.height?ht=[k.x+k.width,k.y+k.height]:nt[0]==k.x&&nt[1]==k.y+k.height?ht=[k.x,k.y+k.height]:(nt=[C.x,A.y])[0]==k.x&&nt[1]==k.y?ht=[k.x,k.y]:nt[0]==k.x+k.width&&nt[1]==k.y?ht=[k.x+k.width,k.y]:nt[0]==k.x+k.width&&nt[1]==k.y+k.height?ht=[k.x+k.width,k.y+k.height]:nt[0]==k.x&&nt[1]==k.y+k.height&&(ht=[k.x,k.y+k.height]);var ot=[k.x+k.width/2,k.y+k.height/2],dt=[ht[0]-ot[0],ht[1]-ot[1]],lt=this.getVecNorm(dt);dt[0]=dt[0]/lt,dt[1]=dt[1]/lt,N=[ht[0]+v*dt[0],ht[1]+v*dt[1]]}for(var gt=!1,ct=0;ct<f.length;ct++)if(N[0]==f[ct][0]&&N[1]==f[ct][1]){gt=!0;break}if(!gt){var ut;ut=D[0]+1,f.splice(ut,0,N);for(var pt=0;pt<x.length;pt++)x[pt].ids[0]>=ut&&(x[pt].ids[0]=x[pt].ids[0]+1),x[pt].ids[1]>=ut&&(x[pt].ids[1]=x[pt].ids[1]+1);x.push({start:u,end:N,ids:[D[0],ut]}),x.push({start:N,end:p,ids:[ut,D[1]+1]})}}}f.pop(),f.splice(0,1),t[t.length-1].virtrualNodes=f,e.push(t.length-1)}return e}},{key:"recalculateSpanningTree",value:function(){var t=[];_t=this.pointData.length<150?0:1,this.f=[];var e=0;for(var i in this.clusterDict)e+=this.clusterDict[i].length;for(var a=0;a<=e;a++)this.f.push(a);var r=new Vt({}),s=new Vt({});for(var n in this.clusterDict)for(var h=0;h<this.clusterDict[n].length;h++)for(var o=this.clusterDict[n][h].id,d=h+1;d<this.clusterDict[n].length;d++){var l=this.clusterDict[n][d].id;this.addLinks(o,l,n,this.clusterDict[n][h],this.clusterDict[n][d],r,s)}for(;!this.checkConnectBetweenAllCluster();){var g=void 0;if(r.isEmpty()){if(s.isEmpty())break;g=s._d[s.deq()]}else g=r._d[r.deq()];this.unionFather(g.clusterid1,g.clusterid2),r.modify_Kruskal_V2(g.start,g.end,this.f,Bt),s.modify_Kruskal_V2(g.start,g.end,this.f,Bt),this.clustergraph.addEdge(g.clusterid1,g.clusterid2),this.clustergraphInfo[g.cat].edgesnum+=1,this.edges.push({start:g.start.id,end:g.end.id,weight:g.score,cat:g.cat,dis:g.score,virtrual:!1,virtrualNodes:[],isLocalTree:!1}),this.graph.addEdge(g.start.id,g.end.id);var c=this.pointData[g.start.id],u=this.pointData[g.end.id],p=this.pointData[g.start.id].cat,y=[];y.push([c.x,c.y]),y.push([u.x,u.y]);for(var f=[{start:[c.x,c.y],end:[u.x,u.y],ids:[0,1]}];f.length>0;){var x=5,v=!1,E=f.pop();c=E.start,u=E.end;var m=E.ids,D=this.findCrossingBetweenEdgeRect(c,u,p);if(0!=D.length){this.edges[this.edges.length-1].virtrual=!0;var F=D[0].points,b=D[0].rect,k=[[b.x,b.y],[b.x+b.width,b.y]],M=[[b.x,b.y+b.height],[b.x+b.width,b.y+b.height]],w=[[b.x,b.y],[b.x,b.y+b.height]],I=[[b.x+b.width,b.y],[b.x+b.width,b.y+b.height]],P=F[0],A=F[1],C=void 0;if(k[1][1]==P.y&&M[1][1]==A.y||M[1][1]==P.y&&k[1][1]==A.y||w[0][0]==P.x&&I[0][0]==A.x||w[0][0]==A.x&&I[0][0]==P.x){var N=-1;if(k[1][1]==P.y&&M[1][1]==A.y){var B=P.x-b.x,S=A.x-b.x;N=B+S<b.width?B>S?3:2:B<S?4:1}else if(M[1][1]==P.y&&k[1][1]==A.y){var _=A.x-b.x,O=P.x-b.x;N=_+O<b.width?_>O?3:2:_<O?4:1}else if(w[0][0]==P.x&&I[0][0]==A.x){var j=P.y-b.y,V=A.y-b.y;N=j+V<b.width?j>V?3:4:j<V?2:1}else if(w[0][0]==A.x&&I[0][0]==P.x){var L=A.y-b.y,X=P.y-b.y;N=L+X<b.width?L>X?3:4:L<X?2:1}for(var G=[],Y=0,U=-1,R=-1;;){1==N?G=v?[b.x+b.width,b.y+b.height]:[b.x,b.y]:2==N?G=v?[b.x,b.y+b.height]:[b.x+b.width,b.y]:3==N?G=v?[b.x,b.y]:[b.x+b.width,b.y+b.height]:4==N&&(G=v?[b.x+b.width,b.y]:[b.x,b.y+b.height]);var T=[b.x+b.width/2,b.y+b.height/2],W=[G[0]-T[0],G[1]-T[1]],q=this.getVecNorm(W);if(W[0]=W[0]/q,W[1]=W[1]/q,C=[G[0]+x*W[0],G[1]+x*W[1]],this.checkVNodeInBound(C,p)){if(v||(x/=1.5),v=!v,(Y+=1)>10)break}else if(v?U=C:R=C,v=!v,-1!=U&&-1!=R)break}if(-1==U&&-1==R){this.edges[this.edges.length-1].virtrual=!1;continue}if(-1!=U&&-1!=R){for(var z=Number.MAX_VALUE,H=null,K=[U,R],Q=0;Q<K.length;Q++){for(var J=K[Q],Z=0,$=0;$<this.edges.length;$++){var tt=this.pointData[this.edges[$].start],et=this.pointData[this.edges[$].end];if(tt.cat!=p){var it={x:c[0],y:c[1],cat:p},at={x:J[0],y:J[1],cat:p},rt={x:u[0],y:u[1],cat:p};this.checkEdgeCrossing(tt,et,it,at)&&(Z+=1),this.checkEdgeCrossing(tt,et,at,rt)&&(Z+=1)}}Z<z&&(z=Z,H=K[Q])}C=H}else C=-1!=U?U:R}else{var st=[P.x,A.y],nt=[];st[0]==b.x&&st[1]==b.y?nt=[b.x,b.y]:st[0]==b.x+b.width&&st[1]==b.y?nt=[b.x+b.width,b.y]:st[0]==b.x+b.width&&st[1]==b.y+b.height?nt=[b.x+b.width,b.y+b.height]:st[0]==b.x&&st[1]==b.y+b.height?nt=[b.x,b.y+b.height]:(st=[A.x,P.y])[0]==b.x&&st[1]==b.y?nt=[b.x,b.y]:st[0]==b.x+b.width&&st[1]==b.y?nt=[b.x+b.width,b.y]:st[0]==b.x+b.width&&st[1]==b.y+b.height?nt=[b.x+b.width,b.y+b.height]:st[0]==b.x&&st[1]==b.y+b.height&&(nt=[b.x,b.y+b.height]);var ht=[b.x+b.width/2,b.y+b.height/2],ot=[nt[0]-ht[0],nt[1]-ht[1]],dt=this.getVecNorm(ot);ot[0]=ot[0]/dt,ot[1]=ot[1]/dt,C=[nt[0]+x*ot[0],nt[1]+x*ot[1]]}for(var lt=!1,gt=0;gt<y.length;gt++)if(C[0]==y[gt][0]&&C[1]==y[gt][1]){lt=!0;break}if(!lt){var ct;ct=m[0]+1,y.splice(ct,0,C);for(var ut=0;ut<f.length;ut++)f[ut].ids[0]>=ct&&(f[ut].ids[0]=f[ut].ids[0]+1),f[ut].ids[1]>=ct&&(f[ut].ids[1]=f[ut].ids[1]+1);f.push({start:c,end:C,ids:[m[0],ct]}),f.push({start:C,end:u,ids:[ct,m[1]+1]})}}}y.pop(),y.splice(0,1),this.edges[this.edges.length-1].virtrualNodes=y,t.push(this.edges.length-1)}return t}},{key:"hierarchicalMergeV2",value:function(){_t=this.pointData.length<150?0:1,this.f=[];var t=0;for(var e in this.clusterDict)t+=this.clusterDict[e].length;for(var i=0;i<=t;i++)this.f.push(i);var a=new Vt({}),r=new Vt({});for(var s in this.clusterDict)for(var n=0;n<this.clusterDict[s].length;n++)for(var h=this.clusterDict[s][n].id,o=n+1;o<this.clusterDict[s].length;o++){var d=this.clusterDict[s][o].id;this.addLinks(h,d,s,this.clusterDict[s][n],this.clusterDict[s][o],a,r)}for(;!this.checkConnectBetweenAllClusterV2();){var l=void 0;if(a.isEmpty()){if(r.isEmpty())break;l=r._d[r.deq()]}else l=a._d[a.deq()];this.unionFather(l.clusterid1,l.clusterid2),a.modify_Kruskal_V2(l.start,l.end,this.f,Bt),r.modify_Kruskal_V2(l.start,l.end,this.f,Bt),this.clustergraph.addEdge(l.clusterid1,l.clusterid2),this.clustergraphInfo[l.cat].edgesnum+=1,this.edges.push({start:l.start.id,end:l.end.id,weight:l.score,cat:l.cat,dis:l.score,virtrual:!1,virtrualNodes:[],isLocalTree:!1}),this.graph.addEdge(l.start.id,l.end.id),this.drawEdges(),console.log();var g=this.pointData[l.start.id],c=this.pointData[l.end.id],u=this.pointData[l.start.id].cat,p=[];p.push([g.x,g.y]),p.push([c.x,c.y]);for(var y=[{start:[g.x,g.y],end:[c.x,c.y],ids:[0,1]}];y.length>0;){var f=5,x=!1,v=y.pop();g=v.start,c=v.end;var E=v.ids,m=this.findCrossingBetweenEdgeRect(g,c,u);if(0!=m.length){this.edges[this.edges.length-1].virtrual=!0;var D=m[0].points,F=m[0].rect,b=[[F.x,F.y],[F.x+F.width,F.y]],k=[[F.x,F.y+F.height],[F.x+F.width,F.y+F.height]],M=[[F.x,F.y],[F.x,F.y+F.height]],w=[[F.x+F.width,F.y],[F.x+F.width,F.y+F.height]],I=D[0],P=D[1],A=void 0;if(b[1][1]==I.y&&k[1][1]==P.y||k[1][1]==I.y&&b[1][1]==P.y||M[0][0]==I.x&&w[0][0]==P.x||M[0][0]==P.x&&w[0][0]==I.x){var C=-1;if(b[1][1]==I.y&&k[1][1]==P.y){var N=I.x-F.x,B=P.x-F.x;C=N+B<F.width?N>B?3:2:N<B?4:1}else if(k[1][1]==I.y&&b[1][1]==P.y){var S=P.x-F.x,_=I.x-F.x;C=S+_<F.width?S>_?3:2:S<_?4:1}else if(M[0][0]==I.x&&w[0][0]==P.x){var O=I.y-F.y,j=P.y-F.y;C=O+j<F.width?O>j?3:4:O<j?2:1}else if(M[0][0]==P.x&&w[0][0]==I.x){var V=P.y-F.y,L=I.y-F.y;C=V+L<F.width?V>L?3:4:V<L?2:1}for(var X=[],G=0,Y=-1,U=-1;;){1==C?X=x?[F.x+F.width,F.y+F.height]:[F.x,F.y]:2==C?X=x?[F.x,F.y+F.height]:[F.x+F.width,F.y]:3==C?X=x?[F.x,F.y]:[F.x+F.width,F.y+F.height]:4==C&&(X=x?[F.x+F.width,F.y]:[F.x,F.y+F.height]);var R=[F.x+F.width/2,F.y+F.height/2],T=[X[0]-R[0],X[1]-R[1]],W=this.getVecNorm(T);if(T[0]=T[0]/W,T[1]=T[1]/W,A=[X[0]+f*T[0],X[1]+f*T[1]],this.checkVNodeInBound(A,u)){if(x||(f/=1.5),x=!x,(G+=1)>10)break}else if(x?Y=A:U=A,x=!x,-1!=Y&&-1!=U)break}if(-1==Y&&-1==U){this.edges[this.edges.length-1].virtrual=!1;continue}if(-1!=Y&&-1!=U){for(var q=Number.MAX_VALUE,z=null,H=[Y,U],K=0;K<H.length;K++){for(var Q=H[K],J=0,Z=0;Z<this.edges.length;Z++){var $=this.pointData[this.edges[Z].start],tt=this.pointData[this.edges[Z].end];if($.cat!=u){var et={x:g[0],y:g[1],cat:u},it={x:Q[0],y:Q[1],cat:u},at={x:c[0],y:c[1],cat:u};this.checkEdgeCrossing($,tt,et,it)&&(J+=1),this.checkEdgeCrossing($,tt,it,at)&&(J+=1)}}J<q&&(q=J,z=H[K])}A=z}else A=-1!=Y?Y:U}else{var rt=[I.x,P.y],st=[];rt[0]==F.x&&rt[1]==F.y?st=[F.x,F.y]:rt[0]==F.x+F.width&&rt[1]==F.y?st=[F.x+F.width,F.y]:rt[0]==F.x+F.width&&rt[1]==F.y+F.height?st=[F.x+F.width,F.y+F.height]:rt[0]==F.x&&rt[1]==F.y+F.height?st=[F.x,F.y+F.height]:(rt=[P.x,I.y])[0]==F.x&&rt[1]==F.y?st=[F.x,F.y]:rt[0]==F.x+F.width&&rt[1]==F.y?st=[F.x+F.width,F.y]:rt[0]==F.x+F.width&&rt[1]==F.y+F.height?st=[F.x+F.width,F.y+F.height]:rt[0]==F.x&&rt[1]==F.y+F.height&&(st=[F.x,F.y+F.height]);var nt=[F.x+F.width/2,F.y+F.height/2],ht=[st[0]-nt[0],st[1]-nt[1]],ot=this.getVecNorm(ht);ht[0]=ht[0]/ot,ht[1]=ht[1]/ot,A=[st[0]+f*ht[0],st[1]+f*ht[1]]}for(var dt=!1,lt=0;lt<p.length;lt++)if(A[0]==p[lt][0]&&A[1]==p[lt][1]){dt=!0;break}if(!dt){var gt;gt=E[0]+1,p.splice(gt,0,A);for(var ct=0;ct<y.length;ct++)y[ct].ids[0]>=gt&&(y[ct].ids[0]=y[ct].ids[0]+1),y[ct].ids[1]>=gt&&(y[ct].ids[1]=y[ct].ids[1]+1);y.push({start:g,end:A,ids:[E[0],gt]}),y.push({start:A,end:c,ids:[gt,E[1]+1]})}}}p.pop(),p.splice(0,1),this.edges[this.edges.length-1].virtrualNodes=p,this.drawOneEdge(this.edges.length-1),console.log()}}},{key:"hierarchicalMerge",value:function(){for(_t=this.pointData.length<150?0:1;!this.checkConnectBetweenAllCluster();){var t=[];for(var e in this.clusterDict)for(var i=0;i<this.clusterDict[e].length;i++)for(var a=this.clusterDict[e][i].id,r=i+1;r<this.clusterDict[e].length;r++){var s=this.clusterDict[e][r].id;if(!this.checkConnectBetweenTwoCluster(a,s)){var n=this.findOptimalLink(this.clusterDict[e][i],this.clusterDict[e][r]);t.push({clusterid1:a,clusterid2:s,start:n[0],end:n[1],score:n[2],distance:n[3],cat:e})}}var h=this.findMinScore(t);this.clustergraph.addEdge(h.clusterid1,h.clusterid2),this.edges.push({start:h.start.id,end:h.end.id,weight:h.score,cat:h.cat,dis:h.score,virtrual:!1,virtrualNodes:[],isLocalTree:!1}),this.graph.addEdge(h.start.id,h.end.id);var o=this.pointData[h.start.id],d=this.pointData[h.end.id],l=this.pointData[h.start.id].cat,g=[];g.push([o.x,o.y]),g.push([d.x,d.y]);for(var c=[{start:[o.x,o.y],end:[d.x,d.y],ids:[0,1]}];c.length>0;){var u=5,p=!1,y=c.pop();o=y.start,d=y.end;var f=y.ids,x=this.findCrossingBetweenEdgeRect(o,d,l);if(0!=x.length){this.edges[this.edges.length-1].virtrual=!0;var v=x[0].points,E=x[0].rect,m=[[E.x,E.y],[E.x+E.width,E.y]],D=[[E.x,E.y+E.height],[E.x+E.width,E.y+E.height]],F=[[E.x,E.y],[E.x,E.y+E.height]],b=[[E.x+E.width,E.y],[E.x+E.width,E.y+E.height]],k=v[0],M=v[1],w=void 0;if(m[1][1]==k.y&&D[1][1]==M.y||D[1][1]==k.y&&m[1][1]==M.y||F[0][0]==k.x&&b[0][0]==M.x||F[0][0]==M.x&&b[0][0]==k.x){var I=-1;if(m[1][1]==k.y&&D[1][1]==M.y){var P=k.x-E.x,A=M.x-E.x;I=P+A<E.width?P>A?3:2:P<A?4:1}else if(D[1][1]==k.y&&m[1][1]==M.y){var C=M.x-E.x,N=k.x-E.x;I=C+N<E.width?C>N?3:2:C<N?4:1}else if(F[0][0]==k.x&&b[0][0]==M.x){var B=k.y-E.y,S=M.y-E.y;I=B+S<E.width?B>S?3:4:B<S?2:1}else if(F[0][0]==M.x&&b[0][0]==k.x){var _=M.y-E.y,O=k.y-E.y;I=_+O<E.width?_>O?3:4:_<O?2:1}for(var j=[],V=0,L=-1,X=-1;;){1==I?j=p?[E.x+E.width,E.y+E.height]:[E.x,E.y]:2==I?j=p?[E.x,E.y+E.height]:[E.x+E.width,E.y]:3==I?j=p?[E.x,E.y]:[E.x+E.width,E.y+E.height]:4==I&&(j=p?[E.x+E.width,E.y]:[E.x,E.y+E.height]);var G=[E.x+E.width/2,E.y+E.height/2],Y=[j[0]-G[0],j[1]-G[1]],U=this.getVecNorm(Y);if(Y[0]=Y[0]/U,Y[1]=Y[1]/U,w=[j[0]+u*Y[0],j[1]+u*Y[1]],this.checkVNodeInBound(w,l)){if(p||(u/=1.5),p=!p,(V+=1)>10)break}else if(p?L=w:X=w,p=!p,-1!=L&&-1!=X)break}if(-1==L&&-1==X){this.edges[this.edges.length-1].virtrual=!1;continue}if(-1!=L&&-1!=X){for(var R=Number.MAX_VALUE,T=null,W=[L,X],q=0;q<W.length;q++){for(var z=W[q],H=0,K=0;K<this.edges.length;K++){var Q=this.pointData[this.edges[K].start],J=this.pointData[this.edges[K].end];if(Q.cat!=l){var Z={x:o[0],y:o[1],cat:l},$={x:z[0],y:z[1],cat:l},tt={x:d[0],y:d[1],cat:l};this.checkEdgeCrossing(Q,J,Z,$)&&(H+=1),this.checkEdgeCrossing(Q,J,$,tt)&&(H+=1)}}H<R&&(R=H,T=W[q])}w=T}else w=-1!=L?L:X}else{var et=[k.x,M.y],it=[];et[0]==E.x&&et[1]==E.y?it=[E.x,E.y]:et[0]==E.x+E.width&&et[1]==E.y?it=[E.x+E.width,E.y]:et[0]==E.x+E.width&&et[1]==E.y+E.height?it=[E.x+E.width,E.y+E.height]:et[0]==E.x&&et[1]==E.y+E.height?it=[E.x,E.y+E.height]:(et=[M.x,k.y])[0]==E.x&&et[1]==E.y?it=[E.x,E.y]:et[0]==E.x+E.width&&et[1]==E.y?it=[E.x+E.width,E.y]:et[0]==E.x+E.width&&et[1]==E.y+E.height?it=[E.x+E.width,E.y+E.height]:et[0]==E.x&&et[1]==E.y+E.height&&(it=[E.x,E.y+E.height]);var at=[E.x+E.width/2,E.y+E.height/2],rt=[it[0]-at[0],it[1]-at[1]],st=this.getVecNorm(rt);rt[0]=rt[0]/st,rt[1]=rt[1]/st,w=[it[0]+u*rt[0],it[1]+u*rt[1]]}for(var nt=!1,ht=0;ht<g.length;ht++)if(w[0]==g[ht][0]&&w[1]==g[ht][1]){nt=!0;break}if(!nt){var ot;ot=f[0]+1,g.splice(ot,0,w);for(var dt=0;dt<c.length;dt++)c[dt].ids[0]>=ot&&(c[dt].ids[0]=c[dt].ids[0]+1),c[dt].ids[1]>=ot&&(c[dt].ids[1]=c[dt].ids[1]+1);c.push({start:o,end:w,ids:[f[0],ot]}),c.push({start:w,end:d,ids:[ot,f[1]+1]})}}}g.pop(),g.splice(0,1),this.edges[this.edges.length-1].virtrualNodes=g}}},{key:"mergeCluster",value:function(){var t,e=[];t=this.sortEdgesGlobalWithCluster();for(var i=0;i<t.length;i++){var a=t[i][0],r=t[i][1],s=t[i][2],n=t[i][3];if(this.clusterArr[a].cat==this.clusterArr[r].cat)if(!new Pt.DepthFirstSearch(this.clustergraph,a).hasPathTo(r)){var h=this.findLinkBetweenCluster(this.clusterArr[a].points,this.clusterArr[r].points);h[0]?(this.clustergraph.addEdge(a,r),this.graph.addEdge(h[1].id,h[2].id),this.edges.push({start:h[1].id,end:h[2].id,weight:h[3],dis:h[3]})):e.push({start:a,end:r,weight:s,dis:n,crossnum:-1})}}for(;!this.checkConnectBetweenCluster();){for(var o=[],d=0;d<e.length;d++){var l=e[d].start,g=e[d].end;if(!new Pt.DepthFirstSearch(this.clustergraph,l).hasPathTo(g)){var c=this.findOptimalLink(this.clusterArr[l].points,this.clusterArr[g].points);e[d].weight=c[3],e[d].crossnum=c[3],o.push({clusterstart:l,clusterend:g,start:c[0].id,end:c[1].id,weight:c[2],crossnum:c[2]})}}for(var u=Number.MAX_VALUE,p=-1,y=0;y<o.length;y++)u>o[y].weight&&(u=o[y].weight,p=y);var f=o[p].start,x=o[p].end;this.graph.addEdge(f,x),this.clustergraph.addEdge(o[p].clusterstart,o[p].clusterend),this.edges.push({start:f,end:x,weight:o[p].weight,crossnum:o[p].crossnum}),console.log()}}},{key:"editBackbone",value:function(){if(Tt=!Tt,this.setState({editV:Tt}),Tt){if(p.g("svg").selectAll(".dataPoint").remove(),p.g("svg").selectAll("line").remove(),this.drawPointData(),this.drawEdges(),document.getElementsByTagName("g")[0].attributes.hasOwnProperty("transform")){var t=document.getElementsByTagName("g")[0].attributes.transform.value.toString();p.h("g").attr("transform",t)}this.props.handleManually(!1)}else p.h("#edgeGroup").remove(),p.h("#pointGroup").remove(),this.child.afterEditReDraw()}},{key:"editMST",value:function(){this.issplit=!this.issplit,1==this.issplit?(p.g("#mainsvg").attr("width",580*zt/Wt).attr("height",750*Ht/qt),p.g("#leftsvg").attr("width",580*zt/Wt).attr("height",750*Ht/qt).attr("style","border:1px solid #000000"),Lt="#leftsvg",Xt="#mainsvg",p.g(Lt).selectAll("*").remove(),this.drawPointData(),this.drawEdges(),this.props.handleManually(!1)):(p.g(Lt).selectAll("*").remove(),p.h("#edgeGroup").remove(),p.h("#pointGroup").remove(),this.child.afterEditReDraw(),p.g("#mainsvg").attr("width",1200*zt/Wt).attr("height",750*Ht/qt),p.g("#leftsvg").attr("width",0).attr("height",0).attr("style","border:0px solid #000000"),Lt="#mainsvg",Xt="#leftsvg")}},{key:"handleCreated",value:function(){this.setState({hascreated:!0})}},{key:"saveSVG",value:function(){}},{key:"saveData",value:function(){var t;t=this.state.hasinit?this.pointData:this.props.pointData;var e=JSON.stringify(t),i=new Blob([e],{type:"text/plain;charset=utf-8"});Ft.saveAs(i,"data.json")}},{key:"render",value:function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{}),Object(a.jsxs)("div",{style:{marginTop:20*Ht/qt},children:[Object(a.jsx)(m.a,{onClick:this.getData.bind(this),disabled:!(this.props.hasLoadData&&!this.state.hasinit||this.state.hasEdit),children:this.state.hasinit?"Apply Changes":"Create Backbone"}),"\xa0\xa0\xa0\xa0\xa0\xa0",Object(a.jsx)(Dt.a,{checkedChildren:"Edit Backbone",unCheckedChildren:"Edit Backbone",onClick:this.editBackbone.bind(this),checked:this.state.editV,disabled:!this.state.hascreated})]}),Object(a.jsx)(mt,{pointData:this.state.pointData,hasLoadData:this.props.hasLoadData,edges:this.state.edges,handleCreated:this.handleCreated.bind(this),createMST:this.getData.bind(this),onRef:this.onRef,colorArray:this.props.colorArray})]})}}]),i}(r.Component);Qt.defaultProps={pointData:[]};var Jt,Zt,$t=Qt,te=i(298),ee=i(79),ie=i(58),ae=i(97),re=i(68),se=i(299),ne=i(305),he=i(220),oe=i(111),de=oe.ShapeInfo,le=oe.Intersection,ge=(oe.Point2D,oe.IntersectionQuery),ce=(ee.a.Option,te.a.Header),ue=te.a.Footer,pe=te.a.Sider,ye=te.a.Content,fe=[{title:"Group",dataIndex:"name",render:function(t){return Object(a.jsx)("a",{children:t})}},{title:"Color",key:"tags",dataIndex:"tags",render:function(t){return Object(a.jsx)(a.Fragment,{children:t.map((function(t){var e=t;return Object(a.jsx)(ne.a,{color:e,children:"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"},t)}))})}}],xe=1,ve={"Group 0":1},Ee=0,me=i(124),De=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],Fe=!1,be=1920,ke=1040,Me=1920,we=1040,Ie=function(t){Object(g.a)(i,t);var e=Object(c.a)(i);function i(){var t;return Object(d.a)(this,i),(t=e.call(this)).onRef=function(e){t.child=e},t.state={updateview:!1,is_input:!1,GroupData:[{key:"0",name:"Group 0",tags:[]}],pointData:[],edges:[],hasLoadData:!1,dataFile:[],colorArray:["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"]},t.shape="circle",t.cur_idx=0,t.width=0,t.height=0,t.offsetY=0,t.offsetX=0,t.scaleX=1,t.scaleY=1,t.selValue="",t.maxX=0,t.maxY=0,t.minX=0,t.minY=0,t.pointData=[],t.edges=[],t.lastClickIndex=-1,t.lastClickItem=null,t.itemBBox=[],t.hasCreateMST=!1,t.menu=Object(a.jsxs)(ie.a,{children:[Object(a.jsx)(ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:t.savePNG.bind(Object(u.a)(t)),children:"PNG"})}),Object(a.jsx)(ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:t.saveSVG.bind(Object(u.a)(t)),children:"SVG"})}),Object(a.jsx)(ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:t.saveData.bind(Object(u.a)(t)),children:"JSON"})})]}),t}return Object(l.a)(i,[{key:"init",value:function(){p.g("svg").selectAll("*").remove(),this.setState({updateview:!1,is_input:!1,GroupData:[{key:"0",name:"Group 0",tags:[]}],pointData:[],edges:[],hasLoadData:!1,dataFile:[],colorArray:["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"]}),xe=1,(ve={})["Group 0"]=1,Ee=0,"#mainsvg",De=["#e1642c","#d35d6d","#cecf7b","#4aa15f","#0885c2","#e2a2be","#ed334e","#6950a1","#1d953f","#ea66a6","#bed742","#2b4490"],Fe=!1,this.shape="circle",this.cur_idx=0,this.width=0,this.height=0,this.offsetY=0,this.offsetX=0,this.scaleX=1,this.scaleY=1,this.selValue="",this.maxX=0,this.maxY=0,this.minX=0,this.minY=0,this.pointData=[],this.edges=[],this.lastClickIndex=-1,this.lastClickItem=null,this.itemBBox=[],this.hasCreateMST=!1,this.menu=Object(a.jsxs)(ie.a,{children:[Object(a.jsx)(ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:this.savePNG.bind(this),children:"PNG"})}),Object(a.jsx)(ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:this.saveSVG.bind(this),children:"SVG"})}),Object(a.jsx)(ie.a.Item,{children:Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",onClick:this.saveData.bind(this),children:"JSON"})})]}),this.child.init()}},{key:"componentWillMount",value:function(){we=window.screen.availHeight,Me=window.screen.availWidth}},{key:"componentDidMount",value:function(){var t=this,e=document.getElementById("mainsvg");this.width=e.getBoundingClientRect().width,this.height=e.getBoundingClientRect().height,Zt=p.g("svg"),Jt=p.g("svg").append("g"),Zt.on("mousedown",this.handleMousedown.bind(this)),Zt.call(p.i().extent([[0,0],[this.width,this.height]]).scaleExtent([1,8]).on("zoom",(function(t){var e=t.transform;Jt.attr("transform",e)}))),fetch("/data/datalist.json",{method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"},mode:"cors",cache:"default"}).then((function(t){return t.json()})).then((function(e){t.setState({dataFile:e})})),document.oncontextmenu=function(){return!1}}},{key:"centralizeData",value:function(){for(var t=Number.MAX_VALUE,e=Number.MAX_VALUE,i=Number.MIN_VALUE,a=Number.MIN_VALUE,r=0;r<this.pointData.length;r++)this.pointData[r].x>i&&(i=this.pointData[r].x),this.pointData[r].y>a&&(a=this.pointData[r].y),this.pointData[r].x<t&&(t=this.pointData[r].x),this.pointData[r].y<e&&(e=this.pointData[r].y);this.maxX=i,this.minX=t,this.maxY=a,this.minY=e,p.g("#mainsvg").attr("viewBox",t-20+" "+(e-20)+" "+(i-t+40)+" "+(a-e+40)),Zt.on("mousedown",this.handleMousedown.bind(this)),this.offsetX=t-20,this.offsetY=e-20,this.scaleX=(i-t+40)/this.width,this.scaleY=(a-e+40)/this.height,(Zt=p.g("svg")).call(p.i().extent([[this.offsetX,this.offsetY],[this.scaleX,this.scaleY]]).scaleExtent([1,8]).on("zoom",(function(t){var e=t.transform;Jt.attr("transform",e)})))}},{key:"handleMousedown",value:function(t){if(0===t.button&&Fe){var e=p.f(t)[0],i=p.f(t)[1],a=Jt._groups[0][0].attributes;if(void 0!=a.transform){for(var r=a.transform.value,s="",n="",h="",o=9;o<r.length;o++)if("("==r[o]){if(o++,""!=s){for(;")"!=r[o];)h+=r[o++];break}for(;","!=r[o];)s+=r[o++];for(o++;")"!=r[o];)n+=r[o++]}s=parseFloat(s),n=parseFloat(n),e=(e-s)/(h=parseFloat(h)),i=(i-n)/h}if("circle"===this.shape){var d=p.g("#pointGroup");null==d._groups[0][0]&&(d=p.g("g")),d.append("circle").attr("r",10).attr("cx",e).attr("cy",i).attr("fill",De[Ee]).attr("set",Ee).attr("idx",this.cur_idx).on("mousedown",this.handleDeleteNode.bind(this))}else if("rectangle"===this.shape){var l=p.g("#pointGroup");null==l._groups[0][0]&&(l=p.g("g")),l.append("rect").attr("x",e-5).attr("y",i-5).attr("width",10).attr("height",10).attr("fill",De[Ee]).attr("set",Ee).attr("idx",this.cur_idx).on("mousedown",this.handleDeleteNode.bind(this))}var g={radius:10,width:10,height:10};g.x=e,g.y=i,g.cat=Ee,g.id=this.cur_idx++,g.shape=this.shape,1==this.hasCreateMST?this.child.addNewPoints(g):this.pointData.push(g),this.setState({pointData:this.pointData}),console.log(this.pointData)}}},{key:"getVecNorm",value:function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}},{key:"hasLinked",value:function(t,e){for(var i=0;i<this.edges.length;i++){var a=this.edges[i];if(a.start==t&&a.end==e)return!0;if(a.start==e&&a.end==t)return!0}return!1}},{key:"findCrossingBetweenEdgeRect",value:function(t,e,i){for(var a=[],r={x:t[0],y:t[1]},s={x:e[0],y:e[1]},n=0;n<this.itemBBox.length;n++){var h=parseInt(this.itemBBox[n].id);if(i!=this.pointData[h].cat){var o=de.rectangle({top:this.itemBBox[n].bbox.y,left:this.itemBBox[n].bbox.x,width:this.itemBBox[n].bbox.width,height:this.itemBBox[n].bbox.height}),d=de.line([r.x,r.y],[s.x,s.y]),l=le.intersect(o,d);if("Intersection"==l.status&&l.points.length>1){a.push({rect:this.itemBBox[n].bbox,points:l.points});break}}}return a}},{key:"checkVNodeInBound",value:function(t,e){for(var i=0;i<this.itemBBox.length;i++){var a=parseInt(this.itemBBox[i].id);if(e!=this.pointData[a].cat)if(ge.pointInRectangle({x:t[0],y:t[1]},{x:this.itemBBox[i].bbox.x,y:this.itemBBox[i].bbox.y},{x:this.itemBBox[i].bbox.x+this.itemBBox[i].bbox.width,y:this.itemBBox[i].bbox.y+this.itemBBox[i].bbox.height}))return!0}return!1}},{key:"surfaceRoutingEdge",value:function(t){var e=this.pointData[t.start],i=this.pointData[t.end],a=this.pointData[t.start].cat,r=[];r.push([e.x,e.y]),r.push([i.x,i.y]);for(var s=[{start:[e.x,e.y],end:[i.x,i.y],ids:[0,1]}];s.length>0;){var n=5,h=!1,o=s.pop();e=o.start,i=o.end;var d=o.ids,l=this.findCrossingBetweenEdgeRect(e,i,a);if(0!=l.length){t.virtrual=!0;var g=l[0].points,c=l[0].rect,u=[[c.x,c.y],[c.x+c.width,c.y]],p=[[c.x,c.y+c.height],[c.x+c.width,c.y+c.height]],y=[[c.x,c.y],[c.x,c.y+c.height]],f=[[c.x+c.width,c.y],[c.x+c.width,c.y+c.height]],x=g[0],v=g[1],E=void 0;if(u[1][1]==x.y&&p[1][1]==v.y||p[1][1]==x.y&&u[1][1]==v.y||y[0][0]==x.x&&f[0][0]==v.x||y[0][0]==v.x&&f[0][0]==x.x){var m=-1;if(u[1][1]==x.y&&p[1][1]==v.y){var D=x.x-c.x,F=v.x-c.x;m=D+F<c.width?D>F?3:2:D<F?4:1}else if(p[1][1]==x.y&&u[1][1]==v.y){var b=v.x-c.x,k=x.x-c.x;m=b+k<c.width?b>k?3:2:b<k?4:1}else if(y[0][0]==x.x&&f[0][0]==v.x){var M=x.y-c.y,w=v.y-c.y;m=M+w<c.width?M>w?3:4:M<w?2:1}else if(y[0][0]==v.x&&f[0][0]==x.x){var I=v.y-c.y,P=x.y-c.y;m=I+P<c.width?I>P?3:4:I<P?2:1}for(var A=[],C=0,N=-1,B=-1;;){1==m?A=h?[c.x+c.width,c.y+c.height]:[c.x,c.y]:2==m?A=h?[c.x,c.y+c.height]:[c.x+c.width,c.y]:3==m?A=h?[c.x,c.y]:[c.x+c.width,c.y+c.height]:4==m&&(A=h?[c.x+c.width,c.y]:[c.x,c.y+c.height]);var S=[c.x+c.width/2,c.y+c.height/2],_=[A[0]-S[0],A[1]-S[1]],O=this.getVecNorm(_);if(_[0]=_[0]/O,_[1]=_[1]/O,E=[A[0]+n*_[0],A[1]+n*_[1]],this.checkVNodeInBound(E,a)){if(h||(n/=1.5),h=!h,(C+=1)>10)break}else if(h?N=E:B=E,h=!h,-1!=N&&-1!=B)break}if(-1==N&&-1==B){t.virtrual=!1;continue}if(-1!=N&&-1!=B){for(var j=Number.MAX_VALUE,V=null,L=[N,B],X=0;X<L.length;X++){for(var G=L[X],Y=0,U=0;U<this.edges.length;U++){var R=this.pointData[this.edges[U].start],T=this.pointData[this.edges[U].end];if(R.cat!=a){var W={x:e[0],y:e[1],cat:a},q={x:G[0],y:G[1],cat:a},z={x:i[0],y:i[1],cat:a};this.checkEdgeCrossing(R,T,W,q)&&(Y+=1),this.checkEdgeCrossing(R,T,q,z)&&(Y+=1)}}Y<j&&(j=Y,V=L[X])}E=V}else E=-1!=N?N:B}else{var H=[x.x,v.y],K=[];H[0]==c.x&&H[1]==c.y?K=[c.x,c.y]:H[0]==c.x+c.width&&H[1]==c.y?K=[c.x+c.width,c.y]:H[0]==c.x+c.width&&H[1]==c.y+c.height?K=[c.x+c.width,c.y+c.height]:H[0]==c.x&&H[1]==c.y+c.height?K=[c.x,c.y+c.height]:(H=[v.x,x.y])[0]==c.x&&H[1]==c.y?K=[c.x,c.y]:H[0]==c.x+c.width&&H[1]==c.y?K=[c.x+c.width,c.y]:H[0]==c.x+c.width&&H[1]==c.y+c.height?K=[c.x+c.width,c.y+c.height]:H[0]==c.x&&H[1]==c.y+c.height&&(K=[c.x,c.y+c.height]);var Q=[c.x+c.width/2,c.y+c.height/2],J=[K[0]-Q[0],K[1]-Q[1]],Z=this.getVecNorm(J);J[0]=J[0]/Z,J[1]=J[1]/Z,E=[K[0]+n*J[0],K[1]+n*J[1]]}for(var $=!1,tt=0;tt<r.length;tt++)if(E[0]==r[tt][0]&&E[1]==r[tt][1]){$=!0;break}if(!$){var et;et=d[0]+1,r.splice(et,0,E);for(var it=0;it<s.length;it++)s[it].ids[0]>=et&&(s[it].ids[0]=s[it].ids[0]+1),s[it].ids[1]>=et&&(s[it].ids[1]=s[it].ids[1]+1);s.push({start:e,end:E,ids:[d[0],et]}),s.push({start:E,end:i,ids:[et,d[1]+1]})}}}return r.pop(),r.splice(0,1),t.virtrualNodes=r,t}},{key:"deleteEdge",value:function(t){var e=t,i=this;Jt.selectAll("line").filter((function(){return parseInt(p.g(this).attr("index"))==e})).remove(),Jt.selectAll(".controlPoints").filter((function(){return parseInt(p.g(this).attr("edgeindex"))==e})).remove(),Jt.selectAll(".controlPoints").filter((function(){return parseInt(p.g(this).attr("edgeindex"))>e})).attr("edgeindex",(function(){return parseInt(p.g(this).attr("edgeindex"))-1})),Jt.selectAll("line").filter((function(){return parseInt(p.g(this).attr("index"))>e})).attr("index",(function(){return parseInt(p.g(this).attr("index"))-1})),i.edges.splice(e,1);for(var a=0;a<i.edges.length;a++)i.edges[a].id=a}},{key:"drawOneEdge",value:function(t){this.edges[t].SVGElement=[];var e=this.edges[t],i=this;function a(t){if(2==t.button){var e=parseInt(p.g(this).attr("index"));i.edges[e].start,i.edges[e].end;i.deleteEdge(e)}}var r=e.start,s=e.end;if(e.virtrual){for(var n,h=e.virtrualNodes,o=[this.pointData[r].x,this.pointData[r].y],d=0;d<h.length;d++){n=h[d];var l=Jt.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",n[0]).attr("y2",n[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",d).on("mouseover",(function(t,e){var a=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",a);o=n,this.edges[t].SVGElement.push(l)}n=[this.pointData[s].x,this.pointData[s].y];var g=Jt.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",n[0]).attr("y2",n[1]).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!0).attr("segindex",h.length).on("mouseover",(function(t,e){var a=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",a);this.edges[t].SVGElement.push(g);for(var c=0;c<h.length;c++)Jt.append("circle").attr("class","controlPoints").attr("cx",h[c][0]).attr("cy",h[c][1]).attr("r",5).attr("edgeindex",t).attr("segindex",c).attr("fill","red").attr("opacity",0).on("mouseover",(function(){p.g(this).attr("opacity",1)})).on("mouseout",(function(){p.g(this).attr("opacity",0)}))}else{var u=Jt.append("line").attr("x1",this.pointData[r].x).attr("y1",this.pointData[r].y).attr("x2",this.pointData[s].x).attr("y2",this.pointData[s].y).attr("stroke-width",2).attr("stroke","black").attr("index",t).attr("isvirtrual",!1).on("mouseover",(function(t,e){var a=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==a})).attr("stroke","red"),console.log(i.edges[a])})).on("mouseout",(function(){var t=p.g(this).attr("index");p.h("line").filter((function(){return p.g(this).attr("index")==t})).attr("stroke","black").attr("stroke-width",2),console.log(i.edges[t])})).on("mousedown",a);this.edges[t].SVGElement.push(u)}}},{key:"addEdge",value:function(t,e,i){var a={start:t,end:e,weight:-1,cat:i,dis:-1,virtrual:!1,virtrualNodes:[],id:this.edges.length,isLocalTree:!1};a=this.surfaceRoutingEdge(a),this.edges.push(a),this.drawOneEdge(a.id)}},{key:"handleDeleteNode",value:function(t){if(2===t.button&&Fe){console.log(t);parseInt(p.g(t.path[0])._groups[0][0].attributes.set.value);var e=parseInt(p.g(t.path[0])._groups[0][0].attributes.idx.value);p.g(t.path[0]).remove(),this.pointData.splice(this.pointData.findIndex((function(t){return t.id===e})),1)}}},{key:"drawInit",value:function(){this.centralizeData();var t=this.pointData,e=this;var i=p.d().on("start",(function(){p.g(this).attr("stroke","red")})).on("drag",(function(t){p.g("svg");var i=parseInt(p.g(this).attr("idx"));if(e.pointData[i].x=t.x,e.pointData[i].y=t.y,"circle"==e.shape)p.g(this).attr("cx",t.x).attr("cy",t.y);else{var a=e.pointData[i].width,r=e.pointData[i].height;p.g(this).attr("x",t.x-.5*a).attr("y",t.y-.5*r)}})).on("end",(function(){p.g(this).attr("stroke","none")}));function a(t){if(2===t.button&&Fe){console.log(t);parseInt(p.g(t.path[0])._groups[0][0].attributes.set.value);var i=parseInt(p.g(t.path[0])._groups[0][0].attributes.idx.value);p.g(t.path[0]).remove(),e.pointData.splice(e.pointData.findIndex((function(t){return t.id===i})),1)}else if(2==t.button&&!Fe){console.log("click");var a=parseInt(p.g(this).attr("index"));if(-1==e.lastClickIndex)e.lastClickIndex=a,e.lastClickItem=p.g(this).attr("stroke","red").attr("stroke-width",5).attr("selected",!0);else if(a==e.lastClickIndex)e.lastClickIndex=-1,e.lastClickItem=null,p.g(this).attr("stroke","red").attr("stroke-width",1).attr("selected",!1);else{var r=e.lastClickItem.attr("category");r==p.g(this).attr("category")?(e.hasLinked(e.lastClickIndex,a)||e.addEdge(e.lastClickIndex,a,r),e.lastClickItem.attr("stroke-width",1).attr("stroke","none").attr("selected",!1),e.lastClickItem=null,e.lastClickIndex=-1):(e.lastClickItem.attr("stroke-width",1).attr("stroke","none").attr("selected",!1),e.lastClickItem=p.g(this).attr("stroke","red").attr("stroke-width",5).attr("selected",!0),e.lastClickIndex=a)}}}for(var r={},s=0;s<t.length;s++){var n=-1,h=t[s].cat.toString(),o=h.split(",");if(o.length>1)for(var d=0;d<o.length;d++)r[parseInt(o[d])]=1,n=Math.max(parseInt(o[d]),n);else r[parseInt(h)]=1,n=Math.max(parseInt(h),n);Ee=Math.max(n,Ee),"circle"===this.shape?Jt.append("circle").attr("class","dataPoint").attr("r",t[s].radius).attr("cx",t[s].x).attr("cy",t[s].y).attr("fill",De[n]).attr("category",n).attr("set",n).attr("index",s).attr("idx",s).on("mousedown",a).on("mouseover",(function(){p.g(this).attr("stroke","red")})).on("mouseout",(function(){"true"!=p.g(this).attr("selected")&&p.g(this).attr("stroke","none")})).call(i):"rectangle"===this.shape&&Jt.append("rect").attr("class","dataPoint").attr("x",t[s].x-.5*t[s].width).attr("y",t[s].y-.5*t[s].height).attr("width",t[s].width).attr("height",t[s].height).attr("fill",De[n]).attr("category",n).attr("set",n).attr("index",s).attr("idx",s).on("mousedown",a).on("mouseover",(function(){p.g(this).attr("stroke","red")})).on("mouseout",(function(){"true"!=p.g(this).attr("selected")&&p.g(this).attr("stroke","none")})).call(i)}this.itemBBox=[];for(var l=document.getElementsByClassName("dataPoint"),g=0;g<l.length;g++)this.itemBBox.push({id:l[g].getAttribute("index"),bbox:l[g].getBBox()});for(var c=[],u=0;u<this.state.GroupData.length;u++)c.push(this.state.GroupData[u]);for(var y in xe=0,ve={},r)ve["Group "+y.toString()]=1;for(var f in ve)console.log(f),0==xe?c[0].tags=[De[parseInt(xe)]]:c.push({key:xe.toString(),name:f,tags:[De[parseInt(xe)]]}),xe++;this.setState({GroupData:c}),this.cur_idx=t.length,Ee=xe}},{key:"addNewSet",value:function(){for(var t in xe=0,ve)xe++;ve["Group "+xe.toString()]=1;for(var e=[],i=0;i<this.state.GroupData.length;i++)e.push(this.state.GroupData[i]);e.push({key:xe.toString(),name:"Group "+xe.toString(),tags:[De[parseInt(xe.toString())]]}),xe++,this.setState({GroupData:e}),alert("Succellfully add new set "+(xe-1)+" !")}},{key:"scaleData",value:function(){var t,e,i,a,r=Number.MAX_VALUE,s=Number.MAX_VALUE,n=Number.MIN_VALUE,h=Number.MIN_VALUE;if(!(this.pointData.length<=0)){if("rectangle"==this.pointData[0].shape)for(var o=0;o<this.pointData.length;o++){var d=this.pointData[o].x-this.pointData[o].width/2,l=this.pointData[o].x+this.pointData[o].width/2,g=this.pointData[o].y-this.pointData[o].height/2,c=this.pointData[o].y+this.pointData[o].height/2;r=Math.min(r,d),s=Math.min(s,g),n=Math.max(n,l),h=Math.max(h,c)}else for(var u=0;u<this.pointData.length;u++){var p=this.pointData[u].x-this.pointData[u].radius,y=this.pointData[u].x+this.pointData[u].radius,f=this.pointData[u].y-this.pointData[u].radius,x=this.pointData[u].y+this.pointData[u].radius;r=Math.min(r,p),s=Math.min(s,f),n=Math.max(n,y),h=Math.max(h,x)}t=1500/(n-r),e=1500/(h-s);var v=Math.min(t,e);i=0-r,a=0-s;for(var E=0;E<this.pointData.length;E++)this.pointData[E].x=(this.pointData[E].x+i)*v,this.pointData[E].y=(this.pointData[E].y+a)*v,this.pointData[E].radius*=v,this.pointData[E].width*=v,this.pointData[E].height*=v}}},{key:"handleUpload",value:function(){var t=this,e=this.selValue;this.init(),this.componentWillMount(),this.render(),this.componentDidMount(),"Manhattan.txt"==e?De=["#f16b22","#7e519f","#713e3a"]:"simpleScatterplot.json"==e&&(De=["#d35d6d","#0885c2","#4aa15f"]),this.setState({colorArray:De}),console.log("filename:"),console.log(e),fetch("/data/"+e,{method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"},mode:"cors",cache:"default"}).then((function(t){return t.json()})).then((function(e){t.setState({hasLoadData:!0}),t.pointData=e;for(var i=0;i<t.pointData.length;i++)t.pointData[i].radius=10;t.setState({pointData:t.pointData}),t.shape=e[0].shape,t.drawInit(),t.setState({edges:t.edges})}))}},{key:"changeSel",value:function(t){this.selValue=t}},{key:"handleInput",value:function(){Fe=!Fe,this.setState({is_input:Fe})}},{key:"hasCreate",value:function(){this.hasCreateMST=!0}},{key:"saveData",value:function(){this.child.saveData()}},{key:"savePNG",value:function(){he.saveSvgAsPng(document.getElementById("mainsvg"),"result.png")}},{key:"saveSVG",value:function(){var t=p.g("#mainsvg"),e=t.attr("width"),i=t.attr("height"),a=t.attr("viewBox"),r=t.html();r='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+i+'" viewBox="'+a+'" >\n'+r+"\n</svg>";var s=new Blob([r],{type:"text/plain;charset=utf-8"});me.saveAs(s,"result.svg")}},{key:"handleManually",value:function(t){Fe=t,this.setState({is_input:Fe})}},{key:"render",value:function(){var t=this.state.dataFile.map((function(t){return Object(a.jsx)("option",{value:t,children:t})})),e=50*Me/be,i=20*we/ke,r=20*Me/be,s=25*we/ke,n=(20*we/ke).toString()+"px "+e.toString()+"px "+i.toString()+"px "+r.toString()+"px",h=s.toString()+"px "+r.toString()+"px";return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)(te.a,{children:[Object(a.jsx)(ce,{style:{background:"rgb(255, 255, 255, 0.1)",textAlign:"center",fontFamily:"Segoe UI",fontWeight:"bold",fontSize:"25px",color:"black"},children:"F2-Bubbles"}),Object(a.jsxs)(te.a,{children:[Object(a.jsxs)(ye,{theme:"light",style:{padding:n,background:"rgb(255, 255, 255)"},children:[Object(a.jsx)("div",{className:"right",style:{float:"right"},children:Object(a.jsx)("svg",{id:"mainsvg",width:1200*Me/be,height:750*we/ke,style:{border:"1px solid #000000"}})}),Object(a.jsx)("div",{className:"left",style:{float:"left"},children:Object(a.jsx)("svg",{id:"leftsvg",width:0,height:0})})]}),Object(a.jsx)(pe,{theme:"light",width:600*Me/be,className:"site-layout-background",style:{padding:h,background:"rgb(255, 255, 255)"},children:Object(a.jsxs)("div",{className:"right",children:[Object(a.jsx)(ee.a,{showSearch:!0,style:{width:320*Me/be},placeholder:"Select an example data..",onChange:this.changeSel.bind(this),children:t}),Object(a.jsx)(m.a,{onClick:this.handleUpload.bind(this),children:"Load Example Data"}),Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),Object(a.jsx)("p",{children:Object(a.jsx)(ae.a,{overlay:this.menu,arrow:!0,children:Object(a.jsxs)(m.a,{children:["Save As ",Object(a.jsx)(re.a,{})]})})}),Object(a.jsx)("div",{style:{width:"80%"},children:Object(a.jsx)(se.a,{pagination:{disabled:!0,position:["none","none"]},scroll:{y:200*we/ke},columns:fe,dataSource:this.state.GroupData})}),Object(a.jsx)("br",{}),Object(a.jsx)($t,{pointData:this.state.pointData,hasLoadData:this.state.hasLoadData,isedit:this.state.is_input,edges:this.state.edges,hasCreate:this.hasCreate.bind(this),handleManually:this.handleManually.bind(this),onRef:this.onRef,colorArray:this.state.colorArray})]})})]}),Object(a.jsx)(ue,{style:{background:"rgb(255, 255, 255, 0.1)",textAlign:"center",fontSize:"16px"},children:"F2-Bubbles \xa92021"})]})})}}]),i}(r.Component),Pe=function(t){Object(g.a)(i,t);var e=Object(c.a)(i);function i(){return Object(d.a)(this,i),e.call(this)}return Object(l.a)(i,[{key:"render",value:function(){return Object(a.jsx)(Ie,{})}}]),i}(r.Component);h.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(Pe,{})}),document.getElementById("root")),o()}},[[295,1,2]]]);
//# sourceMappingURL=main.44c5bed0.chunk.js.map